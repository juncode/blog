<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chapter 14 The InnoDB Storage Engine</title>
<link rel="stylesheet" href="mvl.css" type="text/css" />
<meta name="generator" content="DocBook XSL Stylesheets + chunker.py v1.9.2" />
<link rel="start" href="index.html" title="{book-title}" />
<link rel="up" href="" title="" />
<link rel="prev" href="sql-syntax.html" title="Chapter 13 SQL Statement Syntax" />
<link rel="next" href="storage-engines.html" title="Chapter 15 Alternative Storage Engines" />
<script language="javascript" type="text/javascript">
  function addOnload(theFunc)
  {
    var previous = window.onload;
    if (typeof window.onload != 'function')
    {
      window.onload = theFunc;
    }
    else
    {
      window.onload = function()
      {
        previous();
        theFunc();
      }
    }
  }

  addOnload(function()
  {
    var base = new Date(1429753320*1000);
    var now = new Date();
    var diff = ((now-base)/1000)/(24*3600);

    if (diff > 90) {
      var nodes = document.getElementsByClassName('titlepage');
      nodes[0].innerHTML = '<p style="border: 5px #ff0000 solid; padding: 5px; margin 5px">' +
        'This copy of the manual is more than 90 days old. We encourage you to download a ' +
        'new version from <a href="http://dev.mysql.com">dev.mysql.com/doc</a>.</p>' + nodes[0].innerHTML;
    }
  });
</script>
<noscript></noscript>
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr>
<th colspan="3" align="center">Chapter 14 The InnoDB Storage Engine</th>
</tr>
<tr>
<td width="20%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a> </td>
<th width="60%" align="center"></th>
<td width="20%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage">
<div>
<div>
<h1 class="title"><a name="innodb-storage-engine"></a>Chapter 14 The InnoDB Storage Engine</h1>

</div>

</div>

</div>
<div class="toc">
<p><b>Table of Contents</b></p><dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction">14.1 Introduction to InnoDB 1.1</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-features">14.1.1 Features of the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-default-se">14.1.2 InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">14.1.3 Checking InnoDB Availability</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-turning-off">14.1.4 Turning Off InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-obtaining">14.1.5 Obtaining and Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-version">14.1.6 Viewing the InnoDB Storage Engine Version Number</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-restrictions">14.1.7 Compatibility Considerations for Downgrade and Backup</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-changes">14.1.8 InnoDB Storage Engine Change History</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-contrib">14.1.9 Third-Party Software Contributions</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-installation">14.2 Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-upgrading">14.3 Upgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-downgrading">14.4 Downgrading the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-concepts">14.5 InnoDB Concepts and Architecture</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#mysql-acid">14.5.1 MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">14.5.2 The InnoDB Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-lock-modes">14.5.3 InnoDB Lock Modes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-consistent-read">14.5.4 Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking-reads">14.5.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-record-level-locks">14.5.6 InnoDB Record, Gap, and Next-Key Locks</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-next-key-locking">14.5.7 Avoiding the Phantom Problem Using Next-Key Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locks-set">14.5.8 Locks Set by Different SQL Statements in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-implicit-commit">14.5.9 Implicit Transaction Commit and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlock-detection">14.5.10 Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks">14.5.11 How to Cope with Deadlocks</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multi-versioning">14.5.12 InnoDB Multi-Versioning</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-and-index">14.5.13 InnoDB Table and Index Structures</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-configuration">14.6 InnoDB Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace">14.7 InnoDB Tablespace Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-resize-system-tablespace">14.7.1 Resizing the InnoDB System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-data-log-reconfiguration">14.7.2 Changing the Number or Size of InnoDB Log Files</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-raw-devices">14.7.3 Using Raw Disk Partitions for the System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-tablespaces">14.7.4 InnoDB File-Per-Table Tablespaces</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tables">14.8 InnoDB Table Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#using-innodb-tables">14.8.1 Creating InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-migration">14.8.2 Moving or Copying InnoDB Tables to Another Machine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transactions-with-different-apis">14.8.3 Grouping DML Operations with Transactions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#converting-tables-to-innodb">14.8.4 Converting Tables from MyISAM to InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-handling">14.8.5 AUTO_INCREMENT Handling in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-foreign-key-constraints">14.8.6 InnoDB and FOREIGN KEY Constraints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-restrictions">14.8.7 Limits on InnoDB Tables</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression">14.9 InnoDB Compressed Tables</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-background">14.9.1 Overview of Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-usage">14.9.2 Enabling Compression for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning">14.9.3 Tuning Compression for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning-monitoring">14.9.4 Monitoring Compression at Runtime</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-internals">14.9.5 How Compression Works for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-syntax-warnings">14.9.6 SQL Compression Syntax Warnings and Errors</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format">14.10 InnoDB File-Format Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-enabling">14.10.1 Enabling File Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility">14.10.2 Verifying File Format Compatibility</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-identifying">14.10.3 Identifying the File Format in Use</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-downgrading">14.10.4 Downgrading the File Format</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format">14.11 InnoDB Row Storage and Row Formats</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-overview">14.11.1 Overview of InnoDB Row Storage</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-specification">14.11.2 Specifying the Row Format for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-dynamic">14.11.3 DYNAMIC and COMPRESSED Row Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-antelope">14.11.4 COMPACT and REDUNDANT Row Formats</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-management">14.12 InnoDB Disk I/O and File Space Management</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">14.12.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">14.12.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">14.12.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">14.12.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">14.12.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index">14.13 InnoDB Fast Index Creation</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-overview">14.13.1 Overview of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-examples">14.13.2 Examples of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-implementation">14.13.3 Implementation Details of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-concurrency">14.13.4 Concurrency Considerations for Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-recovery">14.13.5 How Crash Recovery Works with Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-limitations">14.13.6 Limitations of Fast Index Creation</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-parameters">14.14 InnoDB Startup Options and System Variables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance">14.15 InnoDB Performance</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-overview">14.15.1 Overview of InnoDB Performance</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">14.15.2 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-latching">14.15.3 InnoDB Mutex and Read/Write Lock Implementation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-use_sys_malloc">14.15.4 Configuring the Memory Allocator for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-change_buffering">14.15.5 Configuring InnoDB Change Buffering</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">14.15.6 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">14.15.7 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-group_commit">14.15.8 Group Commit</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">14.15.9 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">14.15.10 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-schema">14.15.11 InnoDB Integration with MySQL Performance Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-rollback-segments">14.15.12 Better Scalability with Multiple Rollback Segments</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">14.15.13 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-statistics-estimation">14.15.14 Configuring Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-analyze-table-complexity">14.15.15 Estimating ANALYZE TABLE Complexity for InnoDB Tables</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema">14.16 InnoDB INFORMATION_SCHEMA Tables</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">14.16.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">14.16.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">14.16.3 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitors">14.17 InnoDB Monitors</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">14.17.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">14.17.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">14.17.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-monitor">14.17.4 InnoDB Tablespace Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-monitor">14.17.5 InnoDB Table Monitor Output</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-backup">14.18 InnoDB Backup and Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">14.18.1 The InnoDB Recovery Process</a></span></dt></dl></dd><dt><span class="section"><a href="innodb-storage-engine.html#innodb-and-mysql-replication">14.19 InnoDB and MySQL Replication</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting">14.20 InnoDB Troubleshooting</a></span></dt><dd><dl><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">14.20.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">14.20.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">14.20.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">14.20.4 InnoDB Error Handling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-codes">14.20.5 InnoDB Error Codes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#operating-system-error-codes">14.20.6 Operating System Error Codes</a></span></dt></dl></dd></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-introduction"></a>14.1 Introduction to InnoDB 1.1</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-features">14.1.1 Features of the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-default-se">14.1.2 InnoDB as the Default MySQL Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-check-availability">14.1.3 Checking InnoDB Availability</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-turning-off">14.1.4 Turning Off InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-obtaining">14.1.5 Obtaining and Installing the InnoDB Storage Engine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-version">14.1.6 Viewing the InnoDB Storage Engine Version Number</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-introduction-restrictions">14.1.7 Compatibility Considerations for Downgrade and Backup</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-changes">14.1.8 InnoDB Storage Engine Change History</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-contrib">14.1.9 Third-Party Software Contributions</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301498060144"></a><a class="indexterm" name="idm140301498058656"></a><a class="indexterm" name="idm140301498057584"></a><a class="indexterm" name="idm140301498056096"></a><a class="indexterm" name="idm140301498055024"></a><a class="indexterm" name="idm140301498053536"></a><a class="indexterm" name="idm140301498052464"></a><a class="indexterm" name="idm140301498051392"></a><a class="indexterm" name="idm140301498050320"></a><p>
    InnoDB 1.1 combines the familiar reliability and performance of the
    InnoDB storage engine, with new performance and usability
    enhancements. InnoDB 1.1 includes all the features that were part of
    the InnoDB Plugin for MySQL 5.1, plus new features specific to MySQL
    5.5 and higher.
  </p><p>
    Beginning with MySQL version 5.5, InnoDB is the default storage
    engine, rather than MyISAM. As of MySQL 5.5, issuing the
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement without an
    <code class="literal">ENGINE=</code> clause creates an
    <code class="literal">InnoDB</code> table.
</p>
<h3><a name="idm140301498045328"></a>Key Advantages of InnoDB</h3>
<p>
    Key advantages of InnoDB tables include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Its <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> operations follow the
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model, with
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> featuring
        <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>,
        <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>, and
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash-recovery</a>
        capabilities to protect user data.
      </p></li><li class="listitem"><p>
        Row-level <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> and
        Oracle-style <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
        reads</a> increase multi-user concurrency and performance.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> tables arrange your data on disk to
        optimize queries based on
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary keys</a>. Each
        <code class="literal">InnoDB</code> table has a primary key index called
        the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
        that organizes the data to minimize I/O for primary key lookups.
      </p></li><li class="listitem"><p>
        To maintain data
        <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">integrity</a>,
        <code class="literal">InnoDB</code> also supports
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key"><code class="literal">FOREIGN
        KEY</code></a> constraints. Inserts, updates, and deletes
        are all checked to ensure they do not result in inconsistencies
        across different tables.
      </p></li><li class="listitem"><p>
        You can freely mix <code class="literal">InnoDB</code> tables with tables
        from other MySQL storage engines, even within the same
        statement. For example, you can use a
        <a class="link" href="glossary.html#glos_join" title="join">join</a> operation to combine data
        from <code class="literal">InnoDB</code> and
        <a class="link" href="storage-engines.html#memory-storage-engine" title="15.4 The MEMORY Storage Engine"><code class="literal">MEMORY</code></a> tables in a single query.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> has been designed for CPU efficiency
        and maximum performance when processing large data volumes.
</p></li></ul>
</div>
<p>
    To determine whether your server supports <code class="literal">InnoDB</code>
    use the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17 SHOW ENGINES Syntax"><code class="literal">SHOW ENGINES</code></a> statement. See
    <a class="xref" href="sql-syntax.html#show-engines" title="13.7.5.17 SHOW ENGINES Syntax">Section 13.7.5.17, “SHOW ENGINES Syntax”</a>.
</p>
<div class="table">
<a name="idm140301498017248"></a><p class="title"><b>Table 14.1 InnoDB Storage Engine Features</b></p>
<div class="table-contents">
<table summary="InnoDB Storage Engine Features" border="1"><colgroup><col class="featurev0"><col class="featurevalue0"><col class="featurev1"><col class="featurevalue1"><col class="featurev2"><col class="featurevalue2"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Storage limits</strong></span></td><td>64TB</td><td><span class="bold"><strong>Transactions</strong></span></td><td>Yes</td><td><span class="bold"><strong>Locking granularity</strong></span></td><td>Row</td></tr><tr><td scope="row"><span class="bold"><strong>MVCC</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial data type support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Geospatial indexing support</strong></span></td><td>Yes<a href="#ftn.idm140301498004864" class="footnote" name="idm140301498004864"><sup class="footnote">[a]</sup></a></td></tr><tr><td scope="row"><span class="bold"><strong>B-tree indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>T-tree indexes</strong></span></td><td>No</td><td><span class="bold"><strong>Hash indexes</strong></span></td><td>No<a href="#ftn.idm140301498000656" class="footnote" name="idm140301498000656"><sup class="footnote">[b]</sup></a></td></tr><tr><td scope="row"><span class="bold"><strong>Full-text search indexes</strong></span></td><td>Yes<a href="#ftn.idm140301497998832" class="footnote" name="idm140301497998832"><sup class="footnote">[c]</sup></a></td><td><span class="bold"><strong>Clustered indexes</strong></span></td><td>Yes</td><td><span class="bold"><strong>Data caches</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Index caches</strong></span></td><td>Yes</td><td><span class="bold"><strong>Compressed data</strong></span></td><td>Yes<a href="#ftn.idm140301497993424" class="footnote" name="idm140301497993424"><sup class="footnote">[d]</sup></a></td><td><span class="bold"><strong>Encrypted data<a href="#ftn.idm140301497992144" class="footnote" name="idm140301497992144"><sup class="footnote">[e]</sup></a></strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Cluster database support</strong></span></td><td>No</td><td><span class="bold"><strong>Replication support<a href="#ftn.idm140301497989104" class="footnote" name="idm140301497989104"><sup class="footnote">[f]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Foreign key support</strong></span></td><td>Yes</td></tr><tr><td scope="row"><span class="bold"><strong>Backup / point-in-time recovery<a href="#ftn.idm140301497986096" class="footnote" name="idm140301497986096"><sup class="footnote">[g]</sup></a></strong></span></td><td>Yes</td><td><span class="bold"><strong>Query cache support</strong></span></td><td>Yes</td><td><span class="bold"><strong>Update statistics for data dictionary</strong></span></td><td>Yes</td></tr></tbody><tbody class="footnotes"><tr><td colspan="6">
<div id="ftn.idm140301498004864" class="footnote">
<p><a href="#idm140301498004864" class="para"><sup class="para">[a] </sup></a>InnoDB support for geospatial indexing is available in MySQL 5.7.5 and higher.</p>
</div>

<div id="ftn.idm140301498000656" class="footnote">
<p><a href="#idm140301498000656" class="para"><sup class="para">[b] </sup></a>InnoDB utilizes hash indexes internally for its Adaptive Hash Index feature.</p>
</div>

<div id="ftn.idm140301497998832" class="footnote">
<p><a href="#idm140301497998832" class="para"><sup class="para">[c] </sup></a>InnoDB support for FULLTEXT indexes is available in MySQL 5.6.4 and higher.</p>
</div>

<div id="ftn.idm140301497993424" class="footnote">
<p><a href="#idm140301497993424" class="para"><sup class="para">[d] </sup></a>Compressed InnoDB tables require the InnoDB Barracuda file format.</p>
</div>

<div id="ftn.idm140301497992144" class="footnote">
<p><a href="#idm140301497992144" class="para"><sup class="para">[e] </sup></a>Implemented in the server (via encryption functions), rather than in the storage engine.</p>
</div>

<div id="ftn.idm140301497989104" class="footnote">
<p><a href="#idm140301497989104" class="para"><sup class="para">[f] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>

<div id="ftn.idm140301497986096" class="footnote">
<p><a href="#idm140301497986096" class="para"><sup class="para">[g] </sup></a>Implemented in the server, rather than in the storage engine.</p>
</div>
</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
    The <code class="literal">InnoDB</code> storage engine maintains its own
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for caching data
    and indexes in main memory. When the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting is
    enabled, each new <code class="literal">InnoDB</code> table and its associated
    indexes are stored in a separate file. When the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    disabled, <code class="literal">InnoDB</code> stores all its tables and
    indexes in the single <a class="link" href="glossary.html#glos_tablespace" title="tablespace">system
    tablespace</a>, which may consist of several files (or raw disk
    partitions). <code class="literal">InnoDB</code> tables can handle large
    quantities of data, even on operating systems where file size is
    limited to 2GB.
  </p><p>
    To compare the features of <code class="literal">InnoDB</code> with other
    storage engines provided with MySQL, see the <span class="emphasis"><em>Storage
    Engine Features</em></span> table in
    <a class="xref" href="storage-engines.html" title="Chapter 15 Alternative Storage Engines">Chapter 15, <i>Alternative Storage Engines</i></a>.
</p>
<h3><a name="idm140301497972240"></a>InnoDB Enhancements and New Features</h3>
<p>
    The InnoDB storage engine in MySQL 5.5 releases
    includes a number performance improvements that in MySQL 5.1 were
    only available by installing the InnoDB Plugin. This latest InnoDB
    (now known as InnoDB 1.1) offers new features, improved performance
    and scalability, enhanced reliability and new capabilities for
    flexibility and ease of use. Among the top features are Fast Index
    Creation, table and index compression, file format management, new
    <code class="literal">INFORMATION_SCHEMA</code> tables, capacity tuning,
    multiple background I/O threads, multiple buffer pools, and group
    commit. For more information about these features, see
    <a class="xref" href="innodb-storage-engine.html#innodb-introduction-features" title="14.1.1 Features of the InnoDB Storage Engine">Section 14.1.1, “Features of the InnoDB Storage Engine”</a>.
  </p><p>
    For additional information about <code class="literal">InnoDB</code>
    enhancements and new features in MySQL 5.5, also refer
    to:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="xref" href="introduction.html#mysql-nutshell" title="1.4 What Is New in MySQL 5.5">Section 1.4, “What Is New in MySQL 5.5”</a>, which provides an overview of
        the features added in MySQL 5.5.
      </p></li><li class="listitem"><p>
        The
        <a class="ulink" href="http://dev.mysql.com/doc/relnotes/mysql/5.5/en/" target="_top">Release
        Notes</a>, which provide information about changes in each
        version.
</p></li></ul>
</div>
<h3><a name="idm140301497964192"></a>Additional Resources</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For <code class="literal">InnoDB</code>-related terms and definitions, see
        <a class="xref" href="glossary.html" title="MySQL Glossary">MySQL Glossary</a>.
      </p></li><li class="listitem"><p>
        A forum dedicated to the <code class="literal">InnoDB</code> storage
        engine is available here:
        <a class="ulink" href="http://forums.mysql.com/list.php?22" target="_top">MySQL
        Forums::InnoDB</a>.
      </p></li><li class="listitem"><p>
        <code class="literal">InnoDB</code> is published under the same GNU GPL
        License Version 2 (of June 1991) as MySQL. For more information
        on MySQL licensing, see
        <a class="ulink" href="http://www.mysql.com/company/legal/licensing/" target="_top">http://www.mysql.com/company/legal/licensing/</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-introduction-features"></a>14.1.1 Features of the InnoDB Storage Engine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497953552"></a><a class="indexterm" name="idm140301497952064"></a><p>
      InnoDB in MySQL 5.5 contains several important new features:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-create-index" title="14.13 InnoDB Fast Index Creation">Fast index creation: add
          or drop indexes without copying the data</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-compression" title="14.9 InnoDB Compressed Tables">Data compression: shrink
          tables, to significantly reduce storage and I/O</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats">New row format: fully
          off-page storage of long <code class="literal">BLOB</code>,
          <code class="literal">TEXT</code>, and <code class="literal">VARCHAR</code>
          columns</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-file-format" title="14.10 InnoDB File-Format Management">File format management:
          protects upward and downward compatibility</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema" title="14.16 InnoDB INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code>
          tables: information about compression and locking</a>
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html#innodb-performance" title="14.15 InnoDB Performance">Performance and scalability
          enhancements</a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-latching" title="14.15.3 InnoDB Mutex and Read/Write Lock Implementation">Section 14.15.3, “InnoDB Mutex and Read/Write Lock Implementation”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-use_sys_malloc" title="14.15.4 Configuring the Memory Allocator for InnoDB">Section 14.15.4, “Configuring the Memory Allocator for InnoDB”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-change_buffering" title="14.15.5 Configuring InnoDB Change Buffering">Section 14.15.5, “Configuring InnoDB Change Buffering”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.5.13.5 Adaptive Hash Indexes">Section 14.5.13.5, “Adaptive Hash Indexes”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.15.6 Configuring Thread Concurrency for InnoDB">Section 14.15.6, “Configuring Thread Concurrency for InnoDB”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="14.15.2.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 14.15.2.1, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.15.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.15.7, “Configuring the Number of Background InnoDB I/O Threads”</a>
            </p></li><li class="listitem"><p>
              Asynchronous I/O is supported on Linux systems. For
              additional information, see
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio</code></a>.
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="14.15.9 Configuring the InnoDB Master Thread I/O Rate">Section 14.15.9, “Configuring the InnoDB Master Thread I/O Rate”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.15.2.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.15.2.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="14.15.10 Configuring Spin Lock Polling">Section 14.15.10, “Configuring Spin Lock Polling”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.15.2.3 Making the Buffer Pool Scan Resistant">Section 14.15.2.3, “Making the Buffer Pool Scan Resistant”</a>
            </p></li><li class="listitem"><p>
              Improvements to crash recovery performance, as described
              in
              <a class="xref" href="optimization.html#optimizing-innodb-configuration-variables" title="8.5.8 Optimizing InnoDB Configuration Variables">Section 8.5.8, “Optimizing InnoDB Configuration Variables”</a>.
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-performance-schema" title="14.15.11 InnoDB Integration with MySQL Performance Schema">Section 14.15.11, “InnoDB Integration with MySQL Performance Schema”</a>
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-multiple-buffer-pools" title="14.15.2.4 Using Multiple Buffer Pool Instances">Section 14.15.2.4, “Using Multiple Buffer Pool Instances”</a>
            </p></li><li class="listitem"><p>
              An increased limit on concurrent data modifying
              transactions, as described in
              <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.5.12 InnoDB Multi-Versioning">Section 14.5.12, “InnoDB Multi-Versioning”</a>.
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-improved-purge-scheduling" title="14.15.13 Configuring InnoDB Purge Scheduling">Section 14.15.13, “Configuring InnoDB Purge Scheduling”</a>
</p></li></ul>
</div>
</li><li class="listitem"><p>
          Other changes for flexibility, ease of use and reliability:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The Barracuda File Format. See
              <a class="xref" href="innodb-storage-engine.html#innodb-file-format" title="14.10 InnoDB File-Format Management">Section 14.10, “InnoDB File-Format Management”</a>.
            </p></li><li class="listitem"><p>
              As of MySQL 5.5,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata"><code class="literal">innodb_stats_on_metadata</code></a>,
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>,
              and
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
              can be set at runtime using the
              <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET</code></a>
              statement.
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space" title="14.12.5 Reclaiming Disk Space with TRUNCATE TABLE">Section 14.12.5, “Reclaiming Disk Space with TRUNCATE TABLE”</a>
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> Strict Mode. For usage
              information, refer to the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>
              parameter documentation.
            </p></li><li class="listitem"><p>
              <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.15.14 Configuring Optimizer Statistics Parameters">Section 14.15.14, “Configuring Optimizer Statistics Parameters”</a>
            </p></li><li class="listitem"><p>
              More compact output for <code class="literal">SHOW ENGINE INNODB
              MUTEX</code>. For more information see,
              <a class="xref" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax">Section 13.7.5.16, “SHOW ENGINE Syntax”</a>.
            </p></li><li class="listitem"><p>
              <code class="literal">SHOW ENGINE INNODB STATUS</code> output
              displays counter information for the
              <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
              and
              <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
              global status variables, which can help you fine-tune the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>
              setting and evaluate the effectiveness of the read-ahead
              algorithm.
</p></li></ul>
</div>
</li></ul>
</div>
<h4><a name="idm140301497886880"></a>Upward and Downward Compatibility</h4>
<p>
      Note that the ability to use data compression and the new row
      format require the use of a new InnoDB file format called
      Barracuda. The previous file format, used by the built-in InnoDB in MySQL 5.1 and earlier, is now
      called Antelope and does not support these features, but does
      support the other features introduced with the InnoDB storage engine.
    </p><p>
      The InnoDB storage engine is upward compatible from standard InnoDB as
      built in to, and distributed with, MySQL. Existing databases can
      be used with the InnoDB Storage Engine for MySQL. The new parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> can help
      protect upward and downward compatibility between InnoDB versions
      and database files, allowing users to enable or disable use of new
      features that can only be used with certain versions of InnoDB.
    </p><p>
      InnoDB since version 5.0.21 has a safety feature that prevents it
      from opening tables that are in an unknown format. However, the
      system tablespace may contain references to new-format tables that
      confuse the built-in InnoDB in MySQL 5.1 and earlier. These references are cleared in a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      With previous versions of InnoDB, no error would be returned until
      you try to access a table that is in a format <span class="quote">“<span class="quote">too
      new</span>”</span> for the software. To provide early feedback, InnoDB
      1.1 checks the system tablespace before startup to ensure that the
      file format used in the database is supported by the storage
      engine. See
      <a class="xref" href="innodb-storage-engine.html#innodb-file-format-compatibility-checking" title="14.10.2.1 Compatibility Check When InnoDB Is Started">Section 14.10.2.1, “Compatibility Check When InnoDB Is Started”</a> for
      the details.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-default-se"></a>14.1.2 InnoDB as the Default MySQL Storage Engine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497878384"></a><a class="indexterm" name="idm140301497876928"></a><a class="indexterm" name="idm140301497875408"></a><p>
    MySQL has a well-earned reputation for being easy-to-use and
    delivering performance and scalability. In previous versions of
    MySQL, <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.3 The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> was the default storage
    engine. In our experience, most users never changed the default
    settings. With MySQL 5.5, <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
    becomes the default storage engine. Again, we expect most users will
    not change the default settings. But, because of
    <code class="literal">InnoDB</code>, the default settings deliver the benefits
    users expect from their RDBMS: <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>
    Transactions, <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">Referential
    Integrity</a>, and <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">Crash
    Recovery</a>. Let's explore how using <code class="literal">InnoDB</code>
    tables improves your life as a MySQL user, DBA, or developer.
</p>
<h4><a name="idm140301497866992"></a>Trends in Storage Engine Usage</h4>
<p>
    In the first years of MySQL growth, early web-based applications
    didn't push the limits of concurrency and availability. In recent
    years, hard drive and memory capacity and the performance/price
    ratio have all gone through the roof. Users pushing the performance
    boundaries of MySQL care a lot about reliability and crash recovery.
    MySQL databases are big, busy, robust, distributed, and important.
  </p><p>
    <code class="literal">InnoDB</code> addresses these top user priorities. The
    trend of storage engine usage has shifted in favor of the more
    scalable <code class="literal">InnoDB</code>. Thus MySQL 5.5 is the logical
    transition release to make <code class="literal">InnoDB</code> the default
    storage engine.
</p>
<h4><a name="idm140301497862720"></a>Consequences of InnoDB as Default MySQL Storage Engine</h4>
<p>
    Starting from MySQL 5.5.5, the default storage engine for new tables
    is <code class="literal">InnoDB</code>. This change applies to newly created
    tables that don't specify a storage engine with a clause such as
    <code class="literal">ENGINE=MyISAM</code>. Given this change of default
    behavior, MySQL 5.5 might be a logical point to evaluate whether
    your tables that do use <code class="literal">MyISAM</code> could benefit from
    switching to <code class="literal">InnoDB</code>.
  </p><p>
    The <code class="literal">mysql</code> and
    <code class="literal">information_schema</code> databases, that implement some
    of the MySQL internals, still use <code class="literal">MyISAM</code>. In
    particular, you cannot switch the grant tables to use
    <code class="literal">InnoDB</code>.
</p>
<h4><a name="idm140301497854992"></a>Benefits of InnoDB Tables</h4>
<p>
    If you use <code class="literal">MyISAM</code> tables but aren't tied to them
    for technical reasons, you'll find many things more convenient when
    you use <code class="literal">InnoDB</code> tables in MySQL 5.5:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If your server crashes because of a hardware or software issue,
        regardless of what was happening in the database at the time,
        you don't need to do anything special after restarting the
        database. <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
        automatically finalizes any changes that were committed before
        the time of the crash, and undoes any changes that were in
        process but not committed. Just restart and continue where you
        left off. This process is now much faster than in MySQL 5.1 and
        earlier.
      </p></li><li class="listitem"><p>
        The <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> caches table
        and index data as the data is accessed. Frequently used data is
        processed directly from memory. This cache applies to so many
        types of information, and speeds up processing so much, that
        dedicated database servers assign up to 80% of their physical
        memory to the <code class="literal">InnoDB</code> buffer pool.
      </p></li><li class="listitem"><p>
        If you split up related data into different tables, you can set
        up <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> that
        enforce <a class="link" href="glossary.html#glos_referential_integrity" title="referential integrity">referential
        integrity</a>. Update or delete data, and the related data in
        other tables is updated or deleted automatically. Try to insert
        data into a secondary table without corresponding data in the
        primary table, and the bad data gets kicked out automatically.
      </p></li><li class="listitem"><p>
        If data becomes corrupted on disk or in memory, a
        <a class="link" href="glossary.html#glos_checksum" title="checksum">checksum</a> mechanism alerts
        you to the bogus data before you use it.
      </p></li><li class="listitem"><p>
        When you design your database with appropriate
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns for
        each table, operations involving those columns are automatically
        optimized. It is very fast to reference the primary key columns
        in <code class="literal">WHERE</code> clauses, <code class="literal">ORDER BY</code>
        clauses, <code class="literal">GROUP BY</code> clauses, and
        <a class="link" href="glossary.html#glos_join" title="join">join</a> operations.
      </p></li><li class="listitem"><p>
        Inserts, updates, deletes are optimized by an automatic
        mechanism called <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
        buffering</a>. <code class="literal">InnoDB</code> not only allows
        concurrent read and write access to the same table, it caches
        changed data to streamline disk I/O.
      </p></li><li class="listitem"><p>
        Performance benefits are not limited to giant tables with
        long-running queries. When the same rows are accessed over and
        over from a table, a feature called the
        <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">Adaptive Hash
        Index</a> takes over to make these lookups even faster, as if
        they came out of a hash table.
</p></li></ul>
</div>
<h4><a name="idm140301497831568"></a>Best Practices for InnoDB Tables</h4>
<p>
    If you have been using <code class="literal">InnoDB</code> for a long time,
    you already know about features like transactions and foreign keys.
    If not, read about them throughout this chapter. To make a long
    story short:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Specify a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
        for every table using the most frequently queried column or
        columns, or
        an<a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
        value if there is no obvious primary key.
      </p></li><li class="listitem"><p>
        Embrace the idea of <a class="link" href="glossary.html#glos_join" title="join">joins</a>,
        where data is pulled from multiple tables based on identical ID
        values from those tables. For fast join performance, define
        <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign keys</a> on the join
        columns, and declare those columns with the same data type in
        each table. The foreign keys also propagate deletes or updates
        to all affected tables, and prevent insertion of data in a child
        table if the corresponding IDs are not present in the parent
        table.
      </p></li><li class="listitem"><p>
        Turn off <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a>.
        Committing hundreds of times a second puts a cap on performance
        (limited by the write speed of your storage device).
      </p></li><li class="listitem"><p>
        Group sets of related <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>
        operations into
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, by
        bracketing them with <code class="literal">START TRANSACTION</code> and
        <code class="literal">COMMIT</code> statements. While you don't want to
        commit too often, you also don't want to issue huge batches of
        <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, or
        <code class="literal">DELETE</code> statements that run for hours without
        committing.
      </p></li><li class="listitem"><p>
        Stop using <code class="literal">LOCK TABLE</code> statements.
        <code class="literal">InnoDB</code> can handle multiple sessions all
        reading and writing to the same table at once, without
        sacrificing reliability or high performance. To get exclusive
        write access to a set of rows, use the <code class="literal">SELECT ... FOR
        UPDATE</code> syntax to lock just the rows you intend to
        update.
      </p></li><li class="listitem"><p>
        Enable the <code class="literal">innodb_file_per_table</code> option to
        put the data and indexes for individual tables into separate
        files, instead of in a single giant
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
        This setting is required to use some of the other features, such
        as table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> and
        fast <a class="link" href="glossary.html#glos_truncate" title="truncate">truncation</a>.
      </p></li><li class="listitem"><p>
        Evaluate whether your data and access patterns benefit from the
        new <code class="literal">InnoDB</code> table
        <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> feature
        (<code class="literal">ROW_FORMAT=COMPRESSED</code>) on the
        <code class="literal">CREATE TABLE</code> statement. You can compress
        <code class="literal">InnoDB</code> tables without sacrificing read/write
        capability.
      </p></li><li class="listitem"><p>
        Run your server with the option
        <code class="literal">--sql_mode=NO_ENGINE_SUBSTITUTION</code> to prevent
        tables being created with a different storage engine if there is
        an issue with the one specified in the
        <code class="literal">ENGINE=</code> clause of <code class="literal">CREATE
        TABLE</code>.
</p></li></ul>
</div>
<h4><a name="idm140301497800144"></a>Recent Improvements for InnoDB Tables (from the Plugin Era)</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You can compress tables and associated indexes.
      </p></li><li class="listitem"><p>
        You can create and drop indexes with much less performance or
        availability impact than before.
      </p></li><li class="listitem"><p>
        Truncating a table is very fast, and can free up disk space for
        the operating system to reuse, rather than freeing up space
        within the system tablespace that only <code class="literal">InnoDB</code>
        could reuse.
      </p></li><li class="listitem"><p>
        The storage layout for table data is more efficient for BLOBs
        and long text fields.
      </p></li><li class="listitem"><p>
        You can monitor the internal workings of the storage engine by
        querying <code class="literal">INFORMATION_SCHEMA</code> tables.
      </p></li><li class="listitem"><p>
        You can monitor the performance details of the storage engine by
        querying <code class="literal">performance_schema</code> tables.
      </p></li><li class="listitem"><p>
        There are many performance improvements. In particular, crash
        recovery, the automatic process that makes all data consistent
        when the database is restarted, is fast and reliable (much
        faster than long-time <code class="literal">InnoDB</code> users are used
        to). The bigger the database, the more dramatic the speedup.
      </p><p>
        Most new performance features are automatic, or at most require
        setting a value for a configuration option. For details, see
        <a class="xref" href="innodb-storage-engine.html#innodb-performance" title="14.15 InnoDB Performance">Section 14.15, “InnoDB Performance”</a>. For
        <code class="literal">InnoDB</code>-specific tuning techniques you can
        apply in your application code, see
        <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>. Advanced users can review
        <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a>.
</p></li></ul>
</div>
<h4><a name="idm140301497786224"></a>Testing and Benchmarking with InnoDB as Default Storage Engine</h4>
<p>
    Even before completing your upgrade to MySQL 5.5, you can preview
    whether your database server or application works correctly with
    <code class="literal">InnoDB</code> as the default storage engine. To set up
    <code class="literal">InnoDB</code> as the default storage engine with an
    earlier MySQL release, either specify on the command line
    <code class="literal">--default-storage-engine=InnoDB</code>, or add to your
    <code class="literal">my.cnf</code> file
    <code class="literal">default-storage-engine=innodb</code> in the
    <code class="literal">[mysqld]</code> section, then restart the server.
  </p><p>
    Since changing the default storage engine only affects new tables as
    they are created, run all your application installation and setup
    steps to confirm that everything installs properly. Then exercise
    all the application features to make sure all the data loading,
    editing, and querying features work. If a table relies on some
    <code class="literal">MyISAM</code>-specific feature, you'll receive an error;
    add the <code class="literal">ENGINE=MyISAM</code> clause to the
    <code class="literal">CREATE TABLE</code> statement to avoid the error (for
    example, tables that rely on full-text search must be
    <code class="literal">MyISAM</code> tables rather than
    <code class="literal">InnoDB</code> ones).
  </p><p>
    If you did not make a deliberate decision about the storage engine,
    and you just want to preview how certain tables work when they're
    created under <code class="literal">InnoDB</code>, issue the command
    <code class="literal">ALTER TABLE table_name ENGINE=InnoDB;</code> for each
    table. Or, to run test queries and other statements without
    disturbing the original table, make a copy like so:
  </p><pre class="programlisting">
CREATE TABLE InnoDB_Table (...) ENGINE=InnoDB AS SELECT * FROM MyISAM_Table;
        </pre><p>
    Since there are so many performance enhancements in the
    <code class="literal">InnoDB</code> that is part of MySQL 5.5, to get a true
    idea of the performance with a full application under a realistic
    workload, install the real MySQL 5.5 and run benchmarks.
  </p><p>
    Test the full application lifecycle, from installation, through
    heavy usage, and server restart. Kill the server process while the
    database is busy to simulate a power failure, and verify that the
    data is recovered successfully when you restart the server.
  </p><p>
    Test any replication configurations, especially if you use different
    MySQL versions and options on the master and the slaves.
</p>
<h4><a name="idm140301497770448"></a>Verifying that InnoDB is the Default Storage Engine</h4>
<p>
    To know what the status of <code class="literal">InnoDB</code> is, whether
    you're doing what-if testing with an older MySQL or comprehensive
    testing with MySQL 5.5:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Issue the command <code class="literal">SHOW VARIABLES LIKE
        'have_innodb';</code> to confirm that
        <code class="literal">InnoDB</code> is available at all. If the result is
        <code class="literal">NO</code>, you have a mysqld binary that was
        compiled without <code class="literal">InnoDB</code> support and you need
        to get a different one. If the result is
        <code class="literal">DISABLED</code>, go back through your startup
        options and configuration file and get rid of any
        <code class="literal">skip-innodb</code> option.
      </p></li><li class="listitem"><p>
        Issue the command <code class="literal">SHOW ENGINES;</code> to see all
        the different MySQL storage engines. Look for
        <code class="literal">DEFAULT</code> in the <code class="literal">InnoDB</code>
        line.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-check-availability"></a>14.1.3 Checking InnoDB Availability</h3>

</div>

</div>

</div>
<p>
      To determine whether your server supports
      <code class="literal">InnoDB</code>, use the <a class="link" href="sql-syntax.html#show-engines" title="13.7.5.17 SHOW ENGINES Syntax"><code class="literal">SHOW
      ENGINES</code></a> statement. (Now that <code class="literal">InnoDB</code>
      is the default MySQL storage engine, only very specialized
      environments might not support it.)
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-turning-off"></a>14.1.4 Turning Off InnoDB</h3>

</div>

</div>

</div>
<p>
      Oracle recommends <code class="literal">InnoDB</code> as the preferred
      storage engine for typical database applications, from single-user
      wikis and blogs running on a local system, to high-end
      applications pushing the limits of performance. As of MySQL 5.5,
      <code class="literal">InnoDB</code> is the default storage engine for new
      tables.
    </p><p>
      If you do not want to use <code class="literal">InnoDB</code> tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Start the server with the
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
          option to disable the <code class="literal">InnoDB</code> storage
          engine.
        </p></li><li class="listitem"><p>
          Because the default storage engine is
          <code class="literal">InnoDB</code>, the server will not start unless
          you also use
          <a class="link" href="server-administration.html#sysvar_default_storage_engine"><code class="option">--default-storage-engine</code></a> to set
          the default to some other engine.
        </p></li><li class="listitem"><p>
          To prevent the server from crashing when the
          <a class="link" href="information-schema.html#innodb-i_s-tables" title="21.28 INFORMATION_SCHEMA Tables for InnoDB"><code class="literal">InnoDB</code>-related
          <code class="literal">information_schema</code> tables</a> are
          queried, also disable the plugins associated with those
          tables. Specify in the <code class="literal">[mysqld]</code> section of
          the MySQL configuration file:
        </p><pre class="programlisting">
loose-innodb-trx=0 
loose-innodb-locks=0 
loose-innodb-lock-waits=0 
loose-innodb-cmp=0 
loose-innodb-cmp-per-index=0
loose-innodb-cmp-per-index-reset=0
loose-innodb-cmp-reset=0 
loose-innodb-cmpmem=0 
loose-innodb-cmpmem-reset=0 
loose-innodb-buffer-page=0 
loose-innodb-buffer-page-lru=0 
loose-innodb-buffer-pool-stats=0 
</pre></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-introduction-obtaining"></a>14.1.5 Obtaining and Installing the InnoDB Storage Engine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497737696"></a><a class="indexterm" name="idm140301497736208"></a><p>
      Starting with MySQL 5.4.2, you do not need to do anything special
      to get or install the most up-to-date InnoDB storage engine. From
      that version forward, the InnoDB storage engine in the server is
      what was formerly known as the InnoDB Plugin. Earlier versions of
      MySQL required some extra build and configuration steps to get the
      Plugin-specific features such as fast index creation and table
      compression.
    </p><p>
      Report any bugs in the InnoDB storage engine using the
      <a class="ulink" href="http://support.oracle.com" target="_top">My Oracle Support
      site</a>. For general discussions about
      InnoDB Storage Engine for MySQL, see
      <a class="ulink" href="http://forums.mysql.com/list.php?22" target="_top">http://forums.mysql.com/list.php?22</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-introduction-version"></a>14.1.6 Viewing the InnoDB Storage Engine Version Number</h3>

</div>

</div>

</div>
<p>
      Up to MySQL version 5.5.30, InnoDB storage engine releases are numbered
      with version numbers independent of MySQL releases. Starting with
      MySQL 5.5.30, the use of independent version numbering for the
      InnoDB storage engine is discontinued in favor of MySQL server version
      numbering.
    </p><p>
      The following information describes the InnoDB storage engine
      independent version numbering scheme and how to view the version
      number for the InnoDB storage engine.
    </p><p>
      The initial release of the InnoDB storage engine is version 1.0, and it
      is designed to work with MySQL 5.1. Version 1.1 of the
      InnoDB storage engine is for MySQL 5.5 and up.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The first component of the InnoDB storage engine version number
          designates a major release level.
        </p></li><li class="listitem"><p>
          The second component corresponds to the MySQL release. The
          digit 0 corresponds to MySQL 5.1. The digit 1 corresponds to
          MySQL 5.5.
        </p></li><li class="listitem"><p>
          The third component indicates the specific release of the
          InnoDB storage engine (at a given major release level and for a
          specific MySQL release); only bug fixes and minor functional
          changes are introduced at this level.
</p></li></ul>
</div>
<p>
      Once you have installed the InnoDB storage engine, you can check its
      version number in three ways:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          In the error log, it is printed during startup.
        </p></li><li class="listitem"><p>
          <code class="code">SELECT * FROM information_schema.plugins;</code>
        </p></li><li class="listitem"><p>
          <code class="code">SELECT @@innodb_version;</code>
</p></li></ul>
</div>
<p>
      The InnoDB storage engine writes its version number to the error log,
      which can be helpful in diagnosis of errors:
    </p><pre class="screen">
091105 12:28:06 InnoDB Plugin 1.0.5 started; log sequence number 46509
</pre><p>
      Note that the <code class="literal">PLUGIN_VERSION</code> column in the
      table <code class="literal">INFORMATION_SCHEMA.PLUGINS</code> does not
      display the third component of the version number, only the first
      and second components, as in 1.0.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-introduction-restrictions"></a>14.1.7 Compatibility Considerations for Downgrade and Backup</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497715888"></a><p>
      <span class="strong"><strong> Because InnoDB 1.1 supports the
      <span class="quote">“<span class="quote">Barracuda</span>”</span> file format, with new on-disk data
      structures within both the database and log files, pay special
      attention to file format compatibility with respect to the
      following scenarios: </strong></span>
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Downgrading from MySQL 5.5 to the MySQL 5.1 or earlier
          (without the InnoDB Plugin enabled), or otherwise using
          earlier versions of MySQL with database files created by MySQL
          5.5 and higher.
        </p></li><li class="listitem"><p>
          Using <code class="literal">mysqldump</code>.
        </p></li><li class="listitem"><p>
          Using MySQL replication.
        </p></li><li class="listitem"><p>
          Using MySQL Enterprise Backup
</p></li></ul>
</div>
<p>
      <span class="strong"><strong>WARNING:</strong></span> Once you create any
      tables with the Barracuda file format, take care to avoid crashes
      and corruptions when using those files with an earlier version of
      MySQL. It is <span class="strong"><strong>strongly</strong></span>
      recommended that you use a <span class="quote">“<span class="quote">slow shutdown</span>”</span>
      (<code class="literal">SET GLOBAL innodb_fast_shutdown=0</code>) when
      stopping the MySQL server before downgrading to MySQL 5.1 or
      earlier. This ensures that the log files and other system
      information do not cause consistency issues or startup problems
      when using a prior version of MySQL.
    </p><p>
      <span class="strong"><strong>WARNING:</strong></span> If you dump a database
      containing compressed tables with <code class="literal">mysqldump</code>,
      the dump file may contain <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> statements that attempt to create compressed
      tables, or those using <code class="literal">ROW_FORMAT=DYNAMIC</code> in
      the new database. Therefore, be sure the new database is running
      the InnoDB storage engine, with the proper settings for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>, if you
      want to have the tables re-created as they exist in the original
      database. Typically, when the <code class="literal">mysqldump</code> file is
      loaded, MySQL and InnoDB ignore <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> options they do not recognize, and the table(s)
      are created in a format used by the running server.
    </p><p>
      <span class="strong"><strong>WARNING:</strong></span> If you use MySQL
      replication, ensure all slaves are configured with the
      InnoDB storage engine, with the same settings for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. If you do
      not do so, and you create tables that require the new Barracuda
      file format, replication errors may occur. If a slave MySQL server
      is running an older version of MySQL, it ignores the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> options to create a
      compressed table or one with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, and creates the table
      uncompressed, with <code class="literal">ROW_FORMAT=COMPACT</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-changes"></a>14.1.8 InnoDB Storage Engine Change History</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-changes-1x">14.1.8.1 Changes in InnoDB Storage Engine 1.x</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-changes-11">14.1.8.2 Changes in InnoDB Storage Engine 1.1 (April 13, 2010)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-changes-10x">14.1.8.3 Changes in InnoDB Plugin 1.0.x</a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-changes-1x"></a>14.1.8.1 Changes in InnoDB Storage Engine 1.x</h4>

</div>

</div>

</div>
<p>
      Since InnoDB 1.1 is tightly integrated with MySQL 5.5, for changes
      after the initial InnoDB 1.1 release, see the
      <a class="ulink" href="http://dev.mysql.com/doc/relnotes/mysql/5.5/en/" target="_top">MySQL 5.5 Release
      Notes</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-changes-11"></a>14.1.8.2 Changes in InnoDB Storage Engine 1.1 (April 13, 2010)</h4>

</div>

</div>

</div>
<p>
      For an overview of the changes, see
      <a class="ulink" href="http://dev.mysql.com/tech-resources/articles/introduction-to-mysql-55.html" target="_top">this
      introduction article for MySQL 5.5 with InnoDB 1.1</a>. The
      following is a condensed version of the change log.
    </p><p>
      Fix for Bug #52580: Crash in ha_innobase::open on executing INSERT
      with concurrent ALTER TABLE.
    </p><p>
      Change in MySQL Bug #51557 releases the mutex LOCK_open before
      ha_innobase::open(), causing racing condition for index
      translation table creation. Fix it by adding dict_sys mutex for
      the operation.
    </p><p>
      Add support for multiple buffer pools.
    </p><p>
      Fix Bug #26590: MySQL does not allow more than 1023 open
      transactions. Create additional rollback segments on startup.
      Reduce the upper limit of total rollback segments from 256 to 128.
      This is because we can't use the sign bit. It has not caused
      problems in the past because we only created one segment. InnoDB
      has always had the capability to use the additional rollback
      segments, therefore this patch is backward compatible. The only
      requirement to maintain backward compatibility has been to ensure
      that the additional segments are created after the double write
      buffer. This is to avoid breaking assumptions in the existing
      code.
    </p><p>
      Implement Performance Schema in InnoDB. Objects in four different
      modules in InnoDB have been performance instrumented, these
      modules are: mutexes, rwlocks, file I/O, and threads. We mostly
      preserved the existing APIs, but APIs would point to instrumented
      function wrappers if performance schema is defined. There are 4
      different defines that control the instrumentation of each module.
      The feature is off by default, and will be compiled in with a
      special build option, and require a configure option to turn it on
      when the server boots.
    </p><p>
      Implement the buf_pool_watch for DeleteBuffering in the page hash
      table. This serves two purposes. It allows multiple watches to be
      set at the same time (by multiple purge threads) and it removes a
      race condition when the read of a block completes about the time
      the buffer pool watch is being set.
    </p><p>
      Introduce a new mutex to protect flush_list. Redesign mtr_commit()
      in a way that log_sys mutex is not held while all mtr_memos are
      popped and is released just after the modified blocks are inserted
      into the flush_list. This should reduce contention on log_sys
      mutex.
    </p><p>
      Implement the global variable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>, with the
      following values:

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">none</code>: buffer nothing
          </p></li><li class="listitem"><p>
            <code class="literal">inserts</code>: buffer inserts (like InnoDB so
            far)
          </p></li><li class="listitem"><p>
            <code class="literal">deletes</code>: buffer delete-marks
          </p></li><li class="listitem"><p>
            <code class="literal">changes</code>: buffer inserts and delete-marks
          </p></li><li class="listitem"><p>
            <code class="literal">purges</code>: buffer delete-marks and deletes
          </p></li><li class="listitem"><p>
            <code class="literal">all</code>: buffer all operations (insert,
            delete-mark, delete)
</p></li></ul>
</div>
<p>

      The default is <code class="literal">all</code>. All values except
      <code class="literal">none</code> and <code class="literal">inserts</code> will make
      InnoDB write new-format records to the insert buffer, even for
      inserts.
    </p><p>
      Provide support for native AIO on Linux.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-changes-10x"></a>14.1.8.3 Changes in InnoDB Plugin 1.0.x</h4>

</div>

</div>

</div>
<p>
      The InnoDB 1.0.x releases that accompany MySQL 5.1 have their own
      change history. Changes up to InnoDB 1.0.8 are listed at
      <a class="ulink" href="http://dev.mysql.com/doc/innodb-plugin/1.0/en/innodb-changes.html" target="_top">http://dev.mysql.com/doc/innodb-plugin/1.0/en/innodb-changes.html</a>.
      Changes from InnoDB 1.0.9 and up are incorporated in the
      <a class="ulink" href="http://dev.mysql.com/doc/relnotes/mysql/5.1/en/" target="_top">MySQL 5.1 Release
      Notes</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-contrib"></a>14.1.9 Third-Party Software Contributions</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-contrib-google">14.1.9.1 Performance Patches from Google</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-contrib-percona">14.1.9.2 Multiple Background I/O Threads Patch from Percona</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-contrib-sun_microsystems">14.1.9.3 Performance Patches from Sun Microsystems</a></span></dt></dl>
</div>
<p>
    Oracle acknowledges that certain Third Party and Open Source
    software has been used to develop or is incorporated in the InnoDB
    storage engine. This appendix includes required third-party license
    information.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-contrib-google"></a>14.1.9.1 Performance Patches from Google</h4>
</div>
</div>
</div>
<p>
      Oracle gratefully acknowledges the following contributions from
      Google, Inc. to improve InnoDB performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Replacing InnoDB's use of Pthreads mutexes with calls to GCC
          atomic builtins, as discussed in
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-latching" title="14.15.3 InnoDB Mutex and Read/Write Lock Implementation">Section 14.15.3, “InnoDB Mutex and Read/Write Lock Implementation”</a>. This change
          means that InnoDB mutex and rw-lock operations take less CPU
          time, and improves throughput on those platforms where the
          atomic operations are available.
        </p></li><li class="listitem"><p>
          Controlling master thread <code class="literal">I/O</code> rate, as
          discussed in
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="14.15.9 Configuring the InnoDB Master Thread I/O Rate">Section 14.15.9, “Configuring the InnoDB Master Thread I/O Rate”</a>. The
          master thread in InnoDB is a thread that performs various
          tasks in the background. Historically, InnoDB has used a hard
          coded value as the total <code class="literal">I/O</code> capacity of
          the server. With this change, user can control the number of
          <code class="literal">I/O</code> operations that can be performed per
          second based on their own workload.
</p></li></ul>
</div>
<p>
      Changes from the Google contributions were incorporated in the
      following source code files: <code class="literal">btr0cur.c</code>,
      <code class="literal">btr0sea.c</code>, <code class="literal">buf0buf.c</code>,
      <code class="literal">buf0buf.ic</code>, <code class="literal">ha_innodb.cc</code>,
      <code class="literal">log0log.c</code>, <code class="literal">log0log.h</code>,
      <code class="literal">os0sync.h</code>, <code class="literal">row0sel.c</code>,
      <code class="literal">srv0srv.c</code>, <code class="literal">srv0srv.h</code>,
      <code class="literal">srv0start.c</code>, <code class="literal">sync0arr.c</code>,
      <code class="literal">sync0rw.c</code>, <code class="literal">sync0rw.h</code>,
      <code class="literal">sync0rw.ic</code>, <code class="literal">sync0sync.c</code>,
      <code class="literal">sync0sync.h</code>, <code class="literal">sync0sync.ic</code>,
      and <code class="literal">univ.i</code>.
    </p><p>
      These contributions are incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Google</code>, which are
      reproduced here.
    </p><pre class="programlisting">Copyright (c) 2008, 2009, Google Inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of the Google Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-contrib-percona"></a>14.1.9.2 Multiple Background I/O Threads Patch from Percona</h4>

</div>

</div>

</div>
<p>
      Oracle gratefully acknowledges the contribution of Percona, Inc.
      to improve InnoDB performance by implementing configurable
      background threads, as discussed in
      <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.15.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.15.7, “Configuring the Number of Background InnoDB I/O Threads”</a>. InnoDB
      uses background threads to service various types of I/O requests.
      The change provides another way to make InnoDB more scalable on
      high end systems.
    </p><p>
      Changes from the Percona, Inc. contribution were incorporated in
      the following source code files: <code class="literal">ha_innodb.cc</code>,
      <code class="literal">os0file.c</code>, <code class="literal">os0file.h</code>,
      <code class="literal">srv0srv.c</code>, <code class="literal">srv0srv.h</code>, and
      <code class="literal">srv0start.c</code>.
    </p><p>
      This contribution is incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Percona</code>, which
      are reproduced here.
    </p><pre class="programlisting">Copyright (c) 2008, 2009, Percona Inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of the Percona Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-contrib-sun_microsystems"></a>14.1.9.3 Performance Patches from Sun Microsystems</h4>

</div>

</div>

</div>
<p>
      Oracle gratefully acknowledges the following contributions from
      Sun Microsystems, Inc. to improve InnoDB performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Introducing the <code class="literal">PAUSE</code> instruction inside
          spin loops. This change increases performance in high
          concurrency, CPU-bound workloads.
        </p></li><li class="listitem"><p>
          Enabling inlining of functions and prefetch with Sun Studio.
</p></li></ul>
</div>
<p>
      Changes from the Sun Microsystems, Inc. contribution were
      incorporated in the following source code files:
      <code class="literal">univ.i</code>, <code class="literal">ut0ut.c</code>, and
      <code class="literal">ut0ut.h</code>.
    </p><p>
      This contribution is incorporated subject to the conditions
      contained in the file <code class="literal">COPYING.Sun_Microsystems</code>,
      which are reproduced here.
    </p><pre class="programlisting">Copyright (c) 2009, Sun Microsystems, Inc.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
      copyright notice, this list of conditions and the following
      disclaimer in the documentation and/or other materials
      provided with the distribution.
    * Neither the name of Sun Microsystems, Inc. nor the names of its
      contributors may be used to endorse or promote products
      derived from this software without specific prior written
      permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</pre>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-installation"></a>14.2 Installing the InnoDB Storage Engine</h2>

</div>

</div>

</div>
<p>
    When you use the InnoDB storage engine 1.1 and above, with MySQL 5.5 and
    above, you do not need to do anything special to install: everything
    comes configured as part of the MySQL source and binary
    distributions. This is a change from earlier releases of the InnoDB
    Plugin, where you were required to match up MySQL and InnoDB version
    numbers and update your build and configuration processes.
  </p><p>
    The InnoDB storage engine is included in the MySQL distribution, starting
    from MySQL 5.1.38. From MySQL 5.1.46 and up, this is the only
    download location for the InnoDB storage engine; it is not available from
    the InnoDB web site.
  </p><p>
    If you used any scripts or configuration files with the earlier
    InnoDB storage engine from the InnoDB web site, be aware that the filename
    of the shared library as supplied by MySQL is
    <code class="literal">ha_innodb_plugin.so</code> or
    <code class="literal">ha_innodb_plugin.dll</code>, as opposed to
    <code class="literal">ha_innodb.so</code> or <code class="literal">ha_innodb.dll</code>
    in the older Plugin downloaded from the InnoDB web site. You might
    need to change the applicable file names in your startup or
    configuration scripts.
  </p><p>
    Because the InnoDB storage engine has now replaced the built-in InnoDB,
    you no longer need to specify options like
    <code class="literal">--ignore-builtin-innodb</code> and
    <code class="literal">--plugin-load</code> during startup.
  </p><p>
    To take best advantage of current InnoDB features, we recommend
    specifying the following options in your configuration file:
  </p><pre class="programlisting">
innodb_file_per_table=1
innodb_file_format=barracuda
innodb_strict_mode=1
</pre><p>
    For information about these features, see
    <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a>,
    <a class="xref" href="innodb-storage-engine.html#innodb-file-format" title="14.10 InnoDB File-Format Management">Section 14.10, “InnoDB File-Format Management”</a>, and
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a>. You might need
    to continue to use the previous values for these parameters in some
    replication and similar configurations involving both new and older
    versions of MySQL.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-upgrading"></a>14.3 Upgrading the InnoDB Storage Engine</h2>

</div>

</div>

</div>
<p>
    Prior to MySQL 5.5, some upgrade scenarios involved upgrading the
    separate instance of InnoDB known as the InnoDB Plugin. In MySQL 5.5
    and higher, the features of the InnoDB Plugin have been folded back
    into built-in InnoDB, so the upgrade procedure for InnoDB is the
    same as the one for the MySQL server. For details, see
    <a class="xref" href="installing.html#upgrading" title="2.11.1 Upgrading MySQL">Section 2.11.1, “Upgrading MySQL”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-downgrading"></a>14.4 Downgrading the InnoDB Storage Engine</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497591488"></a><a class="indexterm" name="idm140301497590448"></a><a class="indexterm" name="idm140301497588960"></a><p>
    Prior to MySQL 5.5, some downgrade scenarios involved switching the
    separate instance of InnoDB known as the InnoDB Plugin back to the
    built-in InnoDB storage engine. In MySQL 5.5 and higher, the
    features of the InnoDB Plugin have been folded back into built-in
    InnoDB, so the downgrade procedure for InnoDB is the same as the one
    for the MySQL server. For details, see
    <a class="xref" href="installing.html#downgrading" title="2.11.2 Downgrading MySQL">Section 2.11.2, “Downgrading MySQL”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-concepts"></a>14.5 InnoDB Concepts and Architecture</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#mysql-acid">14.5.1 MySQL and the ACID Model</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transaction-model">14.5.2 The InnoDB Transaction Model and Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-lock-modes">14.5.3 InnoDB Lock Modes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-consistent-read">14.5.4 Consistent Nonlocking Reads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locking-reads">14.5.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-record-level-locks">14.5.6 InnoDB Record, Gap, and Next-Key Locks</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-next-key-locking">14.5.7 Avoiding the Phantom Problem Using Next-Key Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-locks-set">14.5.8 Locks Set by Different SQL Statements in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-implicit-commit">14.5.9 Implicit Transaction Commit and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlock-detection">14.5.10 Deadlock Detection and Rollback</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-deadlocks">14.5.11 How to Cope with Deadlocks</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multi-versioning">14.5.12 InnoDB Multi-Versioning</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-and-index">14.5.13 InnoDB Table and Index Structures</a></span></dt></dl>
</div>
<p>
    The information in this section provides background to help you get
    the most performance and functionality from using
    <code class="literal">InnoDB</code> tables. It is intended for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Anyone switching to MySQL from another database system, to
        explain what things might seem familiar and which might be
        all-new.
      </p></li><li class="listitem"><p>
        Anyone moving from <code class="literal">MyISAM</code> tables to
        <code class="literal">InnoDB</code>, now that <code class="literal">InnoDB</code> is
        the default MySQL storage engine.
      </p></li><li class="listitem"><p>
        Anyone considering their application architecture or software
        stack, to understand the design considerations, performance
        characteristics, and scalability of <code class="literal">InnoDB</code>
        tables at a detailed level.
</p></li></ul>
</div>
<p>
    In this section, you will learn:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        How <code class="literal">InnoDB</code> closely adheres to
        <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> principles.
      </p></li><li class="listitem"><p>
        How <code class="literal">InnoDB</code> implements
        <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, and how
        the inner workings of transactions compare with other database
        systems you might be familiar with.
      </p></li><li class="listitem"><p>
        How <code class="literal">InnoDB</code> implements
        <a class="link" href="glossary.html#glos_row_level_locking" title="row-level locking">row-level locking</a>
        to allow queries and DML statements to read and write the same
        table simultaneously.
      </p></li><li class="listitem"><p>
        How multi-version concurrency control
        (<a class="link" href="glossary.html#glos_mvcc" title="MVCC">MVCC</a>) keeps transactions from
        viewing or modifying each others' data before the appropriate
        time.
      </p></li><li class="listitem"><p>
        The physical layout of <code class="literal">InnoDB</code>-related objects
        on disk, such as <a class="link" href="glossary.html#glos_table" title="table">tables</a>,
        <a class="link" href="glossary.html#glos_index" title="index">indexes</a>,
        <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>,
        <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a>, and the
        <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="mysql-acid"></a>14.5.1 MySQL and the ACID Model</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497559888"></a><p>
      The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> model is a set of
      database design principles that emphasize aspects of reliability
      that are important for business data and mission-critical
      applications. MySQL includes components such as the
      <code class="literal">InnoDB</code> storage engine that adhere closely to
      the ACID model, so that data is not corrupted and results are not
      distorted by exceptional conditions such as software crashes and
      hardware malfunctions. When you rely on ACID-compliant features,
      you do not need to reinvent the wheel of consistency checking and
      crash recovery mechanisms. In cases where you have additional
      software safeguards, ultra-reliable hardware, or an application
      that can tolerate a small amount of data loss or inconsistency,
      you can adjust MySQL settings to trade some of the ACID
      reliability for greater performance or throughput.
    </p><p>
      The following sections discuss how MySQL features, in particular
      the <code class="literal">InnoDB</code> storage engine, interact with the
      categories of the ACID model:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong>A</strong></span>: atomicity.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>C</strong></span>: consistency.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>I:</strong></span>: isolation.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong>D</strong></span>: durability.
</p></li></ul>
</div>
<h4><a name="idm140301497548512"></a>Atomicity</h4>
<p>
      The <span class="bold"><strong>atomicity</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. Related
      MySQL features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Autocommit setting.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> statement.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
          statement.
        </p></li><li class="listitem"><p>
          Operational data from the
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idm140301497538336"></a>Consistency</h4>
<p>
      The <span class="bold"><strong>consistency</strong></span> aspect of the
      ACID model mainly involves internal <code class="literal">InnoDB</code>
      processing to protect data from crashes. Related MySQL features
      include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
</p></li></ul>
</div>
<h4><a name="idm140301497530576"></a>Isolation</h4>
<p>
      The <span class="bold"><strong>isolation</strong></span> aspect of the ACID
      model mainly involves <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, in
      particular the <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
      level</a> that applies to each transaction. Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_autocommit" title="autocommit">Autocommit</a> setting.
        </p></li><li class="listitem"><p>
          <code class="literal">SET ISOLATION LEVEL</code> statement.
        </p></li><li class="listitem"><p>
          The low-level details of <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_locking" title="locking">locking</a>. During
          performance tuning, you see these details through
          <code class="literal">INFORMATION_SCHEMA</code> tables.
</p></li></ul>
</div>
<h4><a name="idm140301497519696"></a>Durability</h4>
<p>
      The <span class="bold"><strong>durability</strong></span> aspect of the ACID
      model involves MySQL software features interacting with your
      particular hardware configuration. Because of the many
      possibilities depending on the capabilities of your CPU, network,
      and storage devices, this aspect is the most complicated to
      provide concrete guidelines for. (And those guidelines might take
      the form of buy <span class="quote">“<span class="quote">new hardware</span>”</span>.) Related MySQL
      features include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, turned on and off by the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a>
          configuration option.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit"><code class="literal">innodb_flush_log_at_trx_commit</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>.
        </p></li><li class="listitem"><p>
          Configuration option
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
        </p></li><li class="listitem"><p>
          Write buffer in a storage device, such as a disk drive, SSD,
          or RAID array.
        </p></li><li class="listitem"><p>
          Battery-backed cache in a storage device.
        </p></li><li class="listitem"><p>
          The operating system used to run MySQL, in particular its
          support for the <code class="literal">fsync()</code> system call.
        </p></li><li class="listitem"><p>
          Uninterruptible power supply (UPS) protecting the electrical
          power to all computer servers and storage devices that run
          MySQL servers and store MySQL data.
        </p></li><li class="listitem"><p>
          Your backup strategy, such as frequency and types of backups,
          and backup retention periods.
        </p></li><li class="listitem"><p>
          For distributed or hosted data applications, the particular
          characteristics of the data centers where the hardware for the
          MySQL servers is located, and network connections between the
          data centers.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-transaction-model"></a>14.5.2 The InnoDB Transaction Model and Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497499136"></a><a class="indexterm" name="idm140301497497648"></a><a class="indexterm" name="idm140301497496160"></a><a class="indexterm" name="idm140301497494672"></a><a class="indexterm" name="idm140301497493600"></a><p>
      To implement a large-scale, busy, or highly reliable database
      application, to port substantial code from a different database
      system, or to tune MySQL performance, you must understand the
      notions of <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>
      and <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> as they relate to
      the InnoDB storage engine.
    </p><p>
      In the <code class="literal">InnoDB</code> transaction model, the goal is to
      combine the best properties of a multi-versioning database with
      traditional two-phase locking. <code class="literal">InnoDB</code> does
      locking on the row level and runs queries as nonlocking consistent
      reads by default, in the style of Oracle. The lock information in
      <code class="literal">InnoDB</code> is stored so space-efficiently that lock
      escalation is not needed: Typically, several users are permitted
      to lock every row in <code class="literal">InnoDB</code> tables, or any
      random subset of the rows, without causing
      <code class="literal">InnoDB</code> memory exhaustion.
    </p><p>
      In <code class="literal">InnoDB</code>, all user activity occurs inside a
      transaction. If autocommit mode is enabled, each SQL statement
      forms a single transaction on its own. By default, MySQL starts
      the session for each new connection with autocommit enabled, so
      MySQL does a commit after each SQL statement if that statement did
      not return an error. If a statement returns an error, the commit
      or rollback behavior depends on the error. See
      <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.20.4 InnoDB Error Handling">Section 14.20.4, “InnoDB Error Handling”</a>.
    </p><p>
      A session that has autocommit enabled can perform a
      multiple-statement transaction by starting it with an explicit
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
      TRANSACTION</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a> statement
      and ending it with a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement. See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
    </p><p>
      If autocommit mode is disabled within a session with <code class="literal">SET
      autocommit = 0</code>, the session always has a transaction
      open. A <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement ends the current transaction and a new one starts.
    </p><p>
      A <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> means that the changes
      made in the current transaction are made permanent and become
      visible to other sessions. A
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
      statement, on the other hand, cancels all modifications made by
      the current transaction. Both
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> release
      all <code class="literal">InnoDB</code> locks that were set during the
      current transaction.
    </p><p>
      In terms of the SQL:1992 transaction
      <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation levels</a>, the
      default <code class="literal">InnoDB</code> level is
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>.
      <code class="literal">InnoDB</code> offers all four transaction isolation
      levels described by the SQL standard:
      <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
      <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>,
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>, and
      <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>.
    </p><p>
      A user can change the isolation level for a single session or for
      all subsequent connections with the <a class="link" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax"><code class="literal">SET
      TRANSACTION</code></a> statement. To set the server's default
      isolation level for all connections, use the
      <a class="link" href="server-administration.html#option_mysqld_transaction-isolation"><code class="option">--transaction-isolation</code></a> option on
      the command line or in an option file. For detailed information
      about isolation levels and level-setting syntax, see
      <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
    </p><a class="indexterm" name="idm140301497454512"></a><a class="indexterm" name="idm140301497453024"></a><a class="indexterm" name="idm140301497451536"></a><a class="indexterm" name="idm140301497450048"></a><a class="indexterm" name="idm140301497448560"></a><a class="indexterm" name="idm140301497447072"></a><a class="indexterm" name="idm140301497445584"></a><a class="indexterm" name="idm140301497444096"></a><p>
      In <a class="link" href="glossary.html#glos_row_level_locking" title="row-level locking">row-level
      locking</a>, <code class="literal">InnoDB</code> normally uses next-key
      locking. That means that besides index records,
      <code class="literal">InnoDB</code> can also lock the
      <a class="link" href="glossary.html#glos_gap" title="gap">gap</a> preceding an index record to
      block insertions by other sessions where the indexed values would
      be inserted in that gap within the tree data structure. A next-key
      lock refers to a lock that locks an index record and the gap
      before it. A gap lock refers to a lock that locks only the gap
      before some index record.
    </p><p>
      For more information about row-level locking, and the
      circumstances under which gap locking is disabled, see
      <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.5.6 InnoDB Record, Gap, and Next-Key Locks">Section 14.5.6, “InnoDB Record, Gap, and Next-Key Locks”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-lock-modes"></a>14.5.3 InnoDB Lock Modes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497435712"></a><a class="indexterm" name="idm140301497434224"></a><p>
      <code class="literal">InnoDB</code> implements standard row-level locking
      where there are two types of locks,
      <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
      (<em class="replaceable"><code>S</code></em>) locks</a> and
      <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
      (<em class="replaceable"><code>X</code></em>) locks</a>. For information about
      record, gap, and next-key lock types, see
      <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.5.6 InnoDB Record, Gap, and Next-Key Locks">Section 14.5.6, “InnoDB Record, Gap, and Next-Key Locks”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A <a class="link" href="glossary.html#glos_shared_lock" title="shared lock">shared
          (<em class="replaceable"><code>S</code></em>) lock</a> permits the
          transaction that holds the lock to read a row.
        </p></li><li class="listitem"><p>
          An <a class="link" href="glossary.html#glos_exclusive_lock" title="exclusive lock">exclusive
          (<em class="replaceable"><code>X</code></em>) lock</a> permits the
          transaction that holds the lock to update or delete a row.
</p></li></ul>
</div>
<p>
      If transaction <code class="literal">T1</code> holds a shared
      (<em class="replaceable"><code>S</code></em>) lock on row <code class="literal">r</code>,
      then requests from some distinct transaction <code class="literal">T2</code>
      for a lock on row <code class="literal">r</code> are handled as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A request by <code class="literal">T2</code> for an
          <em class="replaceable"><code>S</code></em> lock can be granted immediately.
          As a result, both <code class="literal">T1</code> and
          <code class="literal">T2</code> hold an <em class="replaceable"><code>S</code></em>
          lock on <code class="literal">r</code>.
        </p></li><li class="listitem"><p>
          A request by <code class="literal">T2</code> for an
          <em class="replaceable"><code>X</code></em> lock cannot be granted
          immediately.
</p></li></ul>
</div>
<p>
      If a transaction <code class="literal">T1</code> holds an exclusive
      (<em class="replaceable"><code>X</code></em>) lock on row <code class="literal">r</code>, a
      request from some distinct transaction <code class="literal">T2</code> for a
      lock of either type on <code class="literal">r</code> cannot be granted
      immediately. Instead, transaction <code class="literal">T2</code> has to
      wait for transaction <code class="literal">T1</code> to release its lock on
      row <code class="literal">r</code>.
</p>
<h4><a name="idm140301497407504"></a>Intention Locks</h4>
<p>
      Additionally, <code class="literal">InnoDB</code> supports
      <span class="emphasis"><em>multiple granularity locking</em></span> which permits
      coexistence of record locks and locks on entire tables. To make
      locking at multiple granularity levels practical, additional types
      of locks called <a class="link" href="glossary.html#glos_intention_lock" title="intention lock">intention
      locks</a> are used. Intention locks are table locks in
      <code class="literal">InnoDB</code> that indicate which type of lock (shared
      or exclusive) a transaction will require later for a row in that
      table. There are two types of intention locks used in
      <code class="literal">InnoDB</code> (assume that transaction
      <code class="literal">T</code> has requested a lock of the indicated type on
      table <code class="literal">t</code>):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_intention_shared_lock" title="intention shared lock">Intention
          shared</a> (<em class="replaceable"><code>IS</code></em>): Transaction
          <code class="literal">T</code> intends to set
          <em class="replaceable"><code>S</code></em> locks on individual rows in table
          <code class="literal">t</code>.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_intention_exclusive_lock" title="intention exclusive lock">Intention
          exclusive</a> (<em class="replaceable"><code>IX</code></em>): Transaction
          <code class="literal">T</code> intends to set
          <em class="replaceable"><code>X</code></em> locks on those rows.
</p></li></ul>
</div>
<p>
      For example, <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ...
      LOCK IN SHARE MODE</code></a> sets an <em class="replaceable"><code>IS</code></em>
      lock and <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a> sets an <em class="replaceable"><code>IX</code></em> lock.
    </p><p>
      The intention locking protocol is as follows:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Before a transaction can acquire an
          <em class="replaceable"><code>S</code></em> lock on a row in table
          <code class="literal">t</code>, it must first acquire an
          <em class="replaceable"><code>IS</code></em> or stronger lock on
          <code class="literal">t</code>.
        </p></li><li class="listitem"><p>
          Before a transaction can acquire an
          <em class="replaceable"><code>X</code></em> lock on a row, it must first
          acquire an <em class="replaceable"><code>IX</code></em> lock on
          <code class="literal">t</code>.
</p></li></ul>
</div>
<p>
      These rules can be conveniently summarized by means of the
      following <span class="emphasis"><em>lock type compatibility matrix</em></span>.
</p>
<div class="informaltable">
<table summary=' Compatibility matrix showing which combinations of lock
        types X, IX, S, and IS are allowed. Each cell in the matrix is
marked as either "Compatible" or "Conflict". ' border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col"> </th><th scope="col"><em class="replaceable"><code>X</code></em></th><th scope="col"><em class="replaceable"><code>IX</code></em></th><th scope="col"><em class="replaceable"><code>S</code></em></th><th scope="col"><em class="replaceable"><code>IS</code></em></th></tr></thead><tbody><tr><td scope="row"><em class="replaceable"><code>X</code></em></td><td>Conflict</td><td>Conflict</td><td>Conflict</td><td>Conflict</td></tr><tr><td scope="row"><em class="replaceable"><code>IX</code></em></td><td>Conflict</td><td>Compatible</td><td>Conflict</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>S</code></em></td><td>Conflict</td><td>Conflict</td><td>Compatible</td><td>Compatible</td></tr><tr><td scope="row"><em class="replaceable"><code>IS</code></em></td><td>Conflict</td><td>Compatible</td><td>Compatible</td><td>Compatible</td></tr></tbody></table>
</div>
<p>
      A lock is granted to a requesting transaction if it is compatible
      with existing locks, but not if it conflicts with existing locks.
      A transaction waits until the conflicting existing lock is
      released. If a lock request conflicts with an existing lock and
      cannot be granted because it would cause
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, an error occurs.
    </p><p>
      Thus, intention locks do not block anything except full table
      requests (for example, <code class="literal">LOCK TABLES ... WRITE</code>).
      The main purpose of <em class="replaceable"><code>IX</code></em> and
      <em class="replaceable"><code>IS</code></em> locks is to show that someone is
      locking a row, or going to lock a row in the table.
</p>
<h4><a name="idm140301497360096"></a>Deadlock Example</h4>
<p>
      The following example illustrates how an error can occur when a
      lock request would cause a deadlock. The example involves two
      clients, A and B.
    </p><p>
      First, client A creates a table containing one row, and then
      begins a transaction. Within the transaction, A obtains an
      <em class="replaceable"><code>S</code></em> lock on the row by selecting it in
      share mode:
    </p><pre class="programlisting">mysql&gt; <strong class="userinput"><code>CREATE TABLE t (i INT) ENGINE = InnoDB;</code></strong>
Query OK, 0 rows affected (1.07 sec)

mysql&gt; <strong class="userinput"><code>INSERT INTO t (i) VALUES(1);</code></strong>
Query OK, 1 row affected (0.09 sec)

mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>SELECT * FROM t WHERE i = 1 LOCK IN SHARE MODE;</code></strong>
+------+
| i    |
+------+
|    1 |
+------+
1 row in set (0.10 sec)</pre><p>
      Next, client B begins a transaction and attempts to delete the row
      from the table:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)

mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
</pre><p>
      The delete operation requires an <em class="replaceable"><code>X</code></em>
      lock. The lock cannot be granted because it is incompatible with
      the <em class="replaceable"><code>S</code></em> lock that client A holds, so the
      request goes on the queue of lock requests for the row and client
      B blocks.
    </p><p>
      Finally, client A also attempts to delete the row from the table:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>DELETE FROM t WHERE i = 1;</code></strong>
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
      Deadlock occurs here because client A needs an
      <em class="replaceable"><code>X</code></em> lock to delete the row. However, that
      lock request cannot be granted because client B already has a
      request for an <em class="replaceable"><code>X</code></em> lock and is waiting
      for client A to release its <em class="replaceable"><code>S</code></em> lock. Nor
      can the <em class="replaceable"><code>S</code></em> lock held by A be upgraded to
      an <em class="replaceable"><code>X</code></em> lock because of the prior request
      by B for an <em class="replaceable"><code>X</code></em> lock. As a result,
      <code class="literal">InnoDB</code> generates an error for one of the
      clients and releases its locks. The client returns this error:
    </p><pre class="programlisting">
ERROR 1213 (40001): Deadlock found when trying to get lock;
try restarting transaction
</pre><p>
      At that point, the lock request for the other client can be
      granted and it deletes the row from the table.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        If the <code class="literal">LATEST DETECTED DEADLOCK</code> section of
        InnoDB Monitor output includes a message stating,
        <span class="quote">“<span class="quote"><span class="errortext">TOO DEEP OR LONG SEARCH IN THE LOCK TABLE
        WAITS-FOR GRAPH, WE WILL ROLL BACK FOLLOWING
        TRANSACTION</span>,</span>”</span> this indicates that the number
        of transactions on the wait-for list has reached a limit of 200,
        which is defined by
        <code class="literal">LOCK_MAX_DEPTH_IN_DEADLOCK_CHECK</code>. A wait-for
        list that exceeds 200 transactions is treated as a deadlock and
        the transaction attempting to check the wait-for list is rolled
        back.
      </p><p>
        The same error may also occur if the locking thread must look at
        more than 1,000,000 locks owned by the transactions on the
        wait-for list. The limit of 1,000,000 locks is defined by
        <code class="literal">LOCK_MAX_N_STEPS_IN_DEADLOCK_CHECK</code>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-consistent-read"></a>14.5.4 Consistent Nonlocking Reads</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497336432"></a><a class="indexterm" name="idm140301497334976"></a><p>
      A <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>
      means that <code class="literal">InnoDB</code> uses multi-versioning to
      present to a query a snapshot of the database at a point in time.
      The query sees the changes made by transactions that committed
      before that point of time, and no changes made by later or
      uncommitted transactions. The exception to this rule is that the
      query sees the changes made by earlier statements within the same
      transaction. This exception causes the following anomaly: If you
      update some rows in a table, a
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> sees the latest version of
      the updated rows, but it might also see older versions of any
      rows. If other sessions simultaneously update the same table, the
      anomaly means that you might see the table in a state that never
      existed in the database.
    </p><p>
      If the transaction <a class="link" href="glossary.html#glos_isolation_level" title="isolation level">isolation
      level</a> is <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a>
      (the default level), all consistent reads within the same
      transaction read the snapshot established by the first such read
      in that transaction. You can get a fresher snapshot for your
      queries by committing the current transaction and after that
      issuing new queries.
    </p><p>
      With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
      level, each consistent read within a transaction sets and reads
      its own fresh snapshot.
    </p><p>
      Consistent read is the default mode in which
      <code class="literal">InnoDB</code> processes
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements in
      <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> and
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
      levels. A consistent read does not set any locks on the tables it
      accesses, and therefore other sessions are free to modify those
      tables at the same time a consistent read is being performed on
      the table.
    </p><p>
      Suppose that you are running in the default
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> isolation
      level. When you issue a consistent read (that is, an ordinary
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statement),
      <code class="literal">InnoDB</code> gives your transaction a timepoint
      according to which your query sees the database. If another
      transaction deletes a row and commits after your timepoint was
      assigned, you do not see the row as having been deleted. Inserts
      and updates are treated similarly.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The snapshot of the database state applies to
        <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statements within a
        transaction, not necessarily to
        <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements. If you insert or
        modify some rows and then commit that transaction, a
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> or
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statement issued from
        another concurrent <code class="literal">REPEATABLE READ</code>
        transaction could affect those just-committed rows, even though
        the session could not query them. If a transaction does update
        or delete rows committed by a different transaction, those
        changes do become visible to the current transaction. For
        example, you might encounter a situation like the following:
      </p><pre class="programlisting">
SELECT COUNT(c1) FROM t1 WHERE c1 = 'xyz'; -- Returns 0: no rows match.
DELETE FROM t1 WHERE c1 = 'xyz'; -- Deletes several rows recently committed by other transaction.

SELECT COUNT(c2) FROM t1 WHERE c2 = 'abc'; -- Returns 0: no rows match.
UPDATE t1 SET c2 = 'cba' WHERE c2 = 'abc'; -- Affects 10 rows: another txn just committed 10 rows with 'abc' values.
SELECT COUNT(c2) FROM t1 WHERE c2 = 'cba'; -- Returns 10: this txn can now see the rows it just updated.
</pre>
</div>
<p>
      You can advance your timepoint by committing your transaction and
      then doing another <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START TRANSACTION WITH
      CONSISTENT SNAPSHOT</code></a>.
    </p><p>
      This is called <em class="firstterm">multi-versioned concurrency
      control</em>.
    </p><p>
      In the following example, session A sees the row inserted by B
      only when B has committed the insert and A has committed as well,
      so that the timepoint is advanced past the commit of B.
    </p><pre class="programlisting">
             Session A              Session B

           SET autocommit=0;      SET autocommit=0;
time
|          SELECT * FROM t;
|          empty set
|                                 INSERT INTO t VALUES (1, 2);
|
v          SELECT * FROM t;
           empty set
                                  COMMIT;

           SELECT * FROM t;
           empty set

           COMMIT;

           SELECT * FROM t;
           ---------------------
           |    1    |    2    |
           ---------------------
           1 row in set
</pre><p>
      If you want to see the <span class="quote">“<span class="quote">freshest</span>”</span> state of the
      database, use either the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
      COMMITTED</code></a> isolation level or a
      <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking read</a>:
    </p><pre class="programlisting">
SELECT * FROM t LOCK IN SHARE MODE;
</pre><p>
      With <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation
      level, each consistent read within a transaction sets and reads
      its own fresh snapshot. With <code class="literal">LOCK IN SHARE
      MODE</code>, a locking read occurs instead: A
      <code class="literal">SELECT</code> blocks until the transaction containing
      the freshest rows ends (see
      <a class="xref" href="innodb-storage-engine.html#innodb-locking-reads" title="14.5.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)">Section 14.5.5, “Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)”</a>).
    </p><p>
      Consistent read does not work over certain DDL statements:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Consistent read does not work over <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP
          TABLE</code></a>, because MySQL cannot use a table that has
          been dropped and <code class="literal">InnoDB</code> destroys the table.
        </p></li><li class="listitem"><p>
          Consistent read does not work over <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER
          TABLE</code></a>, because that statement makes a temporary copy
          of the original table and deletes the original table when the
          temporary copy is built. When you reissue a consistent read
          within a transaction, rows in the new table are not visible
          because those rows did not exist when the transaction's
          snapshot was taken.
</p></li></ul>
</div>
<p>
      The type of read varies for selects in clauses like
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT INTO ...
      SELECT</code></a>, <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE
      ... (SELECT)</code></a>, and
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
      SELECT</code></a> that do not specify <code class="literal">FOR UPDATE</code>
      or <code class="literal">LOCK IN SHARE MODE</code>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          By default, <code class="literal">InnoDB</code> uses stronger locks and
          the <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> part acts like
          <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, where each
          consistent read, even within the same transaction, sets and
          reads its own fresh snapshot.
        </p></li><li class="listitem"><p>
          To use a consistent read in such cases, enable the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          option and set the isolation level of the transaction to
          <a class="link" href="sql-syntax.html#isolevel_read-uncommitted"><code class="literal">READ UNCOMMITTED</code></a>,
          <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>, or
          <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> (that is,
          anything other than
          <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>). In this
          case, no locks are set on rows read from the selected table.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-locking-reads"></a>14.5.5 Locking Reads (SELECT ... FOR UPDATE and SELECT ... LOCK IN SHARE MODE)</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497270160"></a><p>
      If you query data and then insert or update related data within
      the same transaction, the regular <code class="literal">SELECT</code>
      statement does not give enough protection. Other transactions can
      update or delete the same rows you just queried.
      <code class="literal">InnoDB</code> supports two types of
      <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking reads</a> that offer
      extra safety:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... LOCK IN
          SHARE MODE</code></a> sets a shared mode lock on any rows that
          are read. Other sessions can read the rows, but cannot modify
          them until your transaction commits. If any of these rows were
          changed by another transaction that has not yet committed,
          your query waits until that transaction ends and then uses the
          latest values.
        </p></li><li class="listitem"><p>
          For index records the search encounters,
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
          UPDATE</code></a> locks the rows and any associated index
          entries, the same as if you issued an
          <code class="literal">UPDATE</code> statement for those rows. Other
          transactions are blocked from updating those rows, from doing
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... LOCK IN
          SHARE MODE</code></a>, or from reading the data in certain
          transaction isolation levels. Consistent reads ignore any
          locks set on the records that exist in the read view. (Old
          versions of a record cannot be locked; they are reconstructed
          by applying <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> on
          an in-memory copy of the record.)
</p></li></ul>
</div>
<p>
      These clauses are primarily useful when dealing with
      tree-structured or graph-structured data, either in a single table
      or split across multiple tables. You traverse edges or tree
      branches from one place to another, while reserving the right to
      come back and change any of these <span class="quote">“<span class="quote">pointer</span>”</span> values.
    </p><p>
      All locks set by <code class="literal">LOCK IN SHARE MODE</code> and
      <code class="literal">FOR UPDATE</code> queries are released when the
      transaction is committed or rolled back.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        Locking of rows for update using <code class="literal">SELECT FOR
        UPDATE</code> only applies when autocommit is disabled
        (either by beginning transaction with
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
        TRANSACTION</code></a> or by setting
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> to 0. If autocommit
        is enabled, the rows matching the specification are not locked.
</p>
</div>
<h4><a name="idm140301497250352"></a>Usage Examples</h4>
<p>
      Suppose that you want to insert a new row into a table
      <code class="literal">child</code>, and make sure that the child row has a
      parent row in table <code class="literal">parent</code>. Your application
      code can ensure referential integrity throughout this sequence of
      operations.
    </p><p>
      First, use a consistent read to query the table
      <code class="literal">PARENT</code> and verify that the parent row exists.
      Can you safely insert the child row to table
      <code class="literal">CHILD</code>? No, because some other session could
      delete the parent row in the moment between your
      <code class="literal">SELECT</code> and your <code class="literal">INSERT</code>,
      without you being aware of it.
    </p><p>
      To avoid this potential issue, perform the
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> using <code class="literal">LOCK IN SHARE
      MODE</code>:
    </p><pre class="programlisting">
SELECT * FROM parent WHERE NAME = 'Jones' LOCK IN SHARE MODE;
</pre><p>
      After the <code class="literal">LOCK IN SHARE MODE</code> query returns the
      parent <code class="literal">'Jones'</code>, you can safely add the child
      record to the <code class="literal">CHILD</code> table and commit the
      transaction. Any transaction that tries to read or write to the
      applicable row in the <code class="literal">PARENT</code> table waits until
      you are finished, that is, the data in all tables is in a
      consistent state.
    </p><p>
      For another example, consider an integer counter field in a table
      <code class="literal">CHILD_CODES</code>, used to assign a unique identifier
      to each child added to table <code class="literal">CHILD</code>. Do not use
      either consistent read or a shared mode read to read the present
      value of the counter, because two users of the database could see
      the same value for the counter, and a duplicate-key error occurs
      if two transactions attempt to add rows with the same identifier
      to the <code class="literal">CHILD</code> table.
    </p><p>
      Here, <code class="literal">LOCK IN SHARE MODE</code> is not a good solution
      because if two users read the counter at the same time, at least
      one of them ends up in deadlock when it attempts to update the
      counter.
    </p><p>
      Here, <code class="literal">LOCK IN SHARE MODE</code> is not a good solution
      because if two users read the counter at the same time, at least
      one of them ends up in deadlock when it attempts to update the
      counter.
    </p><p>
      To implement reading and incrementing the counter, first perform a
      locking read of the counter using <code class="literal">FOR UPDATE</code>,
      and then increment the counter. For example:
    </p><pre class="programlisting">
SELECT counter_field FROM child_codes FOR UPDATE;
UPDATE child_codes SET counter_field = counter_field + 1;
</pre><p>
      A <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a> reads the latest available data, setting
      exclusive locks on each row it reads. Thus, it sets the same locks
      a searched SQL <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> would set on
      the rows.
    </p><p>
      The preceding description is merely an example of how
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a> works. In MySQL, the specific task of generating
      a unique identifier actually can be accomplished using only a
      single access to the table:
    </p><pre class="programlisting">
UPDATE child_codes SET counter_field = LAST_INSERT_ID(counter_field + 1);
SELECT LAST_INSERT_ID();
</pre><p>
      The <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> statement merely
      retrieves the identifier information (specific to the current
      connection). It does not access any table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-record-level-locks"></a>14.5.6 InnoDB Record, Gap, and Next-Key Locks</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497220672"></a><a class="indexterm" name="idm140301497219184"></a><a class="indexterm" name="idm140301497217696"></a><a class="indexterm" name="idm140301497216208"></a><a class="indexterm" name="idm140301497214720"></a><a class="indexterm" name="idm140301497213232"></a><a class="indexterm" name="idm140301497211744"></a><a class="indexterm" name="idm140301497210256"></a><p>
      <code class="literal">InnoDB</code> has several types of record-level locks
      including record locks, gap locks, and next-key locks. For
      information about shared locks, exclusive locks, and intention
      locks, see <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.5.3 InnoDB Lock Modes">Section 14.5.3, “InnoDB Lock Modes”</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Record lock: This is a lock on an index record.
        </p></li><li class="listitem"><p>
          Gap lock: This is a lock on a gap between index records, or a
          lock on the gap before the first or after the last index
          record.
        </p></li><li class="listitem"><p>
          Next-key lock: This is a combination of a record lock on the
          index record and a gap lock on the gap before the index
          record.
</p></li></ul>
</div>
<h4><a name="idm140301497203632"></a>Record Locks</h4>
<p>
      Record locks always lock index records, even if a table is defined
      with no indexes. For such cases, <code class="literal">InnoDB</code> creates
      a hidden clustered index and uses this index for record locking.
      See <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.5.13.2 Clustered and Secondary Indexes">Section 14.5.13.2, “Clustered and Secondary Indexes”</a>.
</p>
<h4><a name="idm140301497200784"></a>Next-key Locks</h4>
<p>
      By default, <code class="literal">InnoDB</code> operates in
      <a class="link" href="sql-syntax.html#isolevel_repeatable-read"><code class="literal">REPEATABLE READ</code></a> transaction
      isolation level and with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
      system variable disabled. In this case, <code class="literal">InnoDB</code>
      uses next-key locks for searches and index scans, which prevents
      phantom rows (see <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="14.5.7 Avoiding the Phantom Problem Using Next-Key Locking">Section 14.5.7, “Avoiding the Phantom Problem Using Next-Key Locking”</a>).
    </p><p>
      Next-key locking combines index-row locking with gap locking.
      <code class="literal">InnoDB</code> performs row-level locking in such a way
      that when it searches or scans a table index, it sets shared or
      exclusive locks on the index records it encounters. Thus, the
      row-level locks are actually index-record locks. In addition, a
      next-key lock on an index record also affects the
      <span class="quote">“<span class="quote">gap</span>”</span> before that index record. That is, a next-key
      lock is an index-record lock plus a gap lock on the gap preceding
      the index record. If one session has a shared or exclusive lock on
      record <code class="literal">R</code> in an index, another session cannot
      insert a new index record in the gap immediately before
      <code class="literal">R</code> in the index order.
    </p><p>
      Suppose that an index contains the values 10, 11, 13, and 20. The
      possible next-key locks for this index cover the following
      intervals, where <code class="literal">(</code> or <code class="literal">)</code>
      denote exclusion of the interval endpoint and <code class="literal">[</code>
      or <code class="literal">]</code> denote inclusion of the endpoint:
    </p><pre class="programlisting">
(negative infinity, 10]
(10, 11]
(11, 13]
(13, 20]
(20, positive infinity)
</pre><p>
      For the last interval, the next-key lock locks the gap above the
      largest value in the index and the <span class="quote">“<span class="quote">supremum</span>”</span>
      pseudo-record having a value higher than any value actually in the
      index. The supremum is not a real index record, so, in effect,
      this next-key lock locks only the gap following the largest index
      value.
</p>
<h4><a name="idm140301497185808"></a>Gap Locks</h4>
<p>
      The next-key locking example in the previous section shows that a
      gap might span a single index value, multiple index values, or
      even be empty.
    </p><p>
      Gap locking is not needed for statements that lock rows using a
      unique index to search for a unique row. (This does not include
      the case that the search condition includes only some columns of a
      multiple-column unique index; in that case, gap locking does
      occur.) For example, if the <code class="literal">id</code> column has a
      unique index, the following statement uses only an index-record
      lock for the row having <code class="literal">id</code> value 100 and it
      does not matter whether other sessions insert rows in the
      preceding gap:
    </p><pre class="programlisting">
SELECT * FROM child WHERE id = 100;
</pre><p>
      If <code class="literal">id</code> is not indexed or has a nonunique index,
      the statement does lock the preceding gap.
    </p><p>
      A type of gap lock called an insert intention gap lock is set by
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> operations prior to row
      insertion. This lock signals the intent to insert in such a way
      that multiple transactions inserting into the same index gap need
      not wait for each other if they are not inserting at the same
      position within the gap. Suppose that there are index records with
      values of 4 and 7. Separate transactions that attempt to insert
      values of 5 and 6 each lock the gap between 4 and 7 with insert
      intention locks prior to obtaining the exclusive lock on the
      inserted row, but do not block each other because the rows are
      nonconflicting.
    </p><p>
      It is also worth noting here that conflicting locks can be held on
      a gap by different transactions. For example, transaction A can
      hold a shared gap lock (gap S-lock) on a gap while transaction B
      holds an exclusive gap lock (gap X-lock) on the same gap. The
      reason conflicting gap locks are allowed is that if a record is
      purged from an index, the gap locks held on the record by
      different transactions must be merged.
    </p><p>
      Gap locks in <code class="literal">InnoDB</code> are <span class="quote">“<span class="quote">purely
      inhibitive</span>”</span>, which means they only stop other transactions
      from inserting to the gap. Thus, a gap X-lock has the same effect
      as a gap S-lock.
</p>
<h4><a name="idm140301497175504"></a>Disabling Gap Locking</h4>
<p>
      Gap locking can be disabled explicitly. This occurs if you change
      the transaction isolation level to <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
      COMMITTED</code></a> or enable the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
      system variable. Under these circumstances, gap locking is
      disabled for searches and index scans and is used only for
      foreign-key constraint checking and duplicate-key checking.
    </p><p>
      There are also other effects of using the
      <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> isolation level
      or enabling
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>:
      Record locks for nonmatching rows are released after MySQL has
      evaluated the <code class="literal">WHERE</code> condition. For
      <code class="literal">UPDATE</code> statements, <code class="literal">InnoDB</code>
      does a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, such that it returns
      the latest committed version to MySQL so that MySQL can determine
      whether the row matches the <code class="literal">WHERE</code> condition of
      the <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-next-key-locking"></a>14.5.7 Avoiding the Phantom Problem Using Next-Key Locking</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497162544"></a><a class="indexterm" name="idm140301497161504"></a><a class="indexterm" name="idm140301497160016"></a><a class="indexterm" name="idm140301497158528"></a><a class="indexterm" name="idm140301497157040"></a><a class="indexterm" name="idm140301497155552"></a><a class="indexterm" name="idm140301497154064"></a><a class="indexterm" name="idm140301497152576"></a><a class="indexterm" name="idm140301497151088"></a><p>
      The so-called <em class="firstterm">phantom</em> problem occurs within
      a transaction when the same query produces different sets of rows
      at different times. For example, if a
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> is executed twice, but
      returns a row the second time that was not returned the first
      time, the row is a <span class="quote">“<span class="quote">phantom</span>”</span> row.
    </p><p>
      Suppose that there is an index on the <code class="literal">id</code> column
      of the <code class="literal">child</code> table and that you want to read
      and lock all rows from the table having an identifier value larger
      than 100, with the intention of updating some column in the
      selected rows later:
    </p><pre class="programlisting">
SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;
</pre><p>
      The query scans the index starting from the first record where
      <code class="literal">id</code> is bigger than 100. Let the table contain
      rows having <code class="literal">id</code> values of 90 and 102. If the
      locks set on the index records in the scanned range do not lock
      out inserts made in the gaps (in this case, the gap between 90 and
      102), another session can insert a new row into the table with an
      <code class="literal">id</code> of 101. If you were to execute the same
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> within the same transaction,
      you would see a new row with an <code class="literal">id</code> of 101 (a
      <span class="quote">“<span class="quote">phantom</span>”</span>) in the result set returned by the query.
      If we regard a set of rows as a data item, the new phantom child
      would violate the isolation principle of transactions that a
      transaction should be able to run so that the data it has read
      does not change during the transaction.
    </p><p>
      To prevent phantoms, <code class="literal">InnoDB</code> uses an algorithm
      called <em class="firstterm">next-key locking</em> that combines
      index-row locking with gap locking. <code class="literal">InnoDB</code>
      performs row-level locking in such a way that when it searches or
      scans a table index, it sets shared or exclusive locks on the
      index records it encounters. Thus, the row-level locks are
      actually index-record locks. In addition, a next-key lock on an
      index record also affects the <span class="quote">“<span class="quote">gap</span>”</span> before that index
      record. That is, a next-key lock is an index-record lock plus a
      gap lock on the gap preceding the index record. If one session has
      a shared or exclusive lock on record <code class="literal">R</code> in an
      index, another session cannot insert a new index record in the gap
      immediately before <code class="literal">R</code> in the index order.
    </p><p>
      When <code class="literal">InnoDB</code> scans an index, it can also lock
      the gap after the last record in the index. Just that happens in
      the preceding example: To prevent any insert into the table where
      <code class="literal">id</code> would be bigger than 100, the locks set by
      <code class="literal">InnoDB</code> include a lock on the gap following
      <code class="literal">id</code> value 102.
    </p><p>
      You can use next-key locking to implement a uniqueness check in
      your application: If you read your data in share mode and do not
      see a duplicate for a row you are going to insert, then you can
      safely insert your row and know that the next-key lock set on the
      successor of your row during the read prevents anyone meanwhile
      inserting a duplicate for your row. Thus, the next-key locking
      enables you to <span class="quote">“<span class="quote">lock</span>”</span> the nonexistence of something
      in your table.
    </p><p>
      Gap locking can be disabled as discussed in
      <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.5.6 InnoDB Record, Gap, and Next-Key Locks">Section 14.5.6, “InnoDB Record, Gap, and Next-Key Locks”</a>. This may cause
      phantom problems because other sessions can insert new rows into
      the gaps when gap locking is disabled.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-locks-set"></a>14.5.8 Locks Set by Different SQL Statements in InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497126320"></a><p>
      A locking read, an <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or a
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> generally set record locks
      on every index record that is scanned in the processing of the SQL
      statement. It does not matter whether there are
      <code class="literal">WHERE</code> conditions in the statement that would
      exclude the row. <code class="literal">InnoDB</code> does not remember the
      exact <code class="literal">WHERE</code> condition, but only knows which
      index ranges were scanned. The locks are normally next-key locks
      that also block inserts into the <span class="quote">“<span class="quote">gap</span>”</span> immediately
      before the record. However, gap locking can be disabled
      explicitly, which causes next-key locking not to be used. For more
      information, see <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.5.6 InnoDB Record, Gap, and Next-Key Locks">Section 14.5.6, “InnoDB Record, Gap, and Next-Key Locks”</a>. The
      transaction isolation level also can affect which locks are set;
      see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
    </p><p>
      If a secondary index is used in a search and index record locks to
      be set are exclusive, <code class="literal">InnoDB</code> also retrieves the
      corresponding clustered index records and sets locks on them.
    </p><p>
      Differences between shared and exclusive locks are described in
      <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.5.3 InnoDB Lock Modes">Section 14.5.3, “InnoDB Lock Modes”</a>.
    </p><p>
      If you have no indexes suitable for your statement and MySQL must
      scan the entire table to process the statement, every row of the
      table becomes locked, which in turn blocks all inserts by other
      users to the table. It is important to create good indexes so that
      your queries do not unnecessarily scan many rows.
    </p><p>
      For <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FOR
      UPDATE</code></a> or <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT
      ... LOCK IN SHARE MODE</code></a>, locks are acquired for scanned
      rows, and expected to be released for rows that do not qualify for
      inclusion in the result set (for example, if they do not meet the
      criteria given in the <code class="literal">WHERE</code> clause). However,
      in some cases, rows might not be unlocked immediately because the
      relationship between a result row and its original source is lost
      during query execution. For example, in a
      <a class="link" href="sql-syntax.html#union" title="13.2.9.4 UNION Syntax"><code class="literal">UNION</code></a>, scanned (and locked) rows
      from a table might be inserted into a temporary table before
      evaluation whether they qualify for the result set. In this
      circumstance, the relationship of the rows in the temporary table
      to the rows in the original table is lost and the latter rows are
      not unlocked until the end of query execution.
    </p><p>
      <code class="literal">InnoDB</code> sets specific types of locks as follows.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ...
          FROM</code></a> is a consistent read, reading a snapshot of the
          database and setting no locks unless the transaction isolation
          level is set to
          <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>. For
          <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a> level, the
          search sets shared next-key locks on the index records it
          encounters.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
          LOCK IN SHARE MODE</code></a> sets shared next-key locks on all
          index records the search encounters.
        </p></li><li class="listitem"><p>
          For index records the search encounters,
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
          FOR UPDATE</code></a> blocks other sessions from doing
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT ... FROM ...
          LOCK IN SHARE MODE</code></a> or from reading in certain
          transaction isolation levels. Consistent reads will ignore any
          locks set on the records that exist in the read view.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE ... WHERE
          ...</code></a> sets an exclusive next-key lock on every record
          the search encounters.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE FROM ... WHERE
          ...</code></a> sets an exclusive next-key lock on every record
          the search encounters.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> sets an exclusive lock
          on the inserted row. This lock is an index-record lock, not a
          next-key lock (that is, there is no gap lock) and does not
          prevent other sessions from inserting into the gap before the
          inserted row.
        </p><p>
          Prior to inserting the row, a type of gap lock called an
          insertion intention gap lock is set. This lock signals the
          intent to insert in such a way that multiple transactions
          inserting into the same index gap need not wait for each other
          if they are not inserting at the same position within the gap.
          Suppose that there are index records with values of 4 and 7.
          Separate transactions that attempt to insert values of 5 and 6
          each lock the gap between 4 and 7 with insert intention locks
          prior to obtaining the exclusive lock on the inserted row, but
          do not block each other because the rows are nonconflicting.
        </p><p>
          If a duplicate-key error occurs, a shared lock on the
          duplicate index record is set. This use of a shared lock can
          result in deadlock should there be multiple sessions trying to
          insert the same row if another session already has an
          exclusive lock. This can occur if another session deletes the
          row. Suppose that an <code class="literal">InnoDB</code> table
          <code class="literal">t1</code> has the following structure:
        </p><pre class="programlisting">
CREATE TABLE t1 (i INT, PRIMARY KEY (i)) ENGINE = InnoDB;
</pre><p>
          Now suppose that three sessions perform the following
          operations in order:
        </p><p>
          Session 1:
        </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 2:
        </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 3:
        </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 1:
        </p><pre class="programlisting">
ROLLBACK;
</pre><p>
          The first operation by session 1 acquires an exclusive lock
          for the row. The operations by sessions 2 and 3 both result in
          a duplicate-key error and they both request a shared lock for
          the row. When session 1 rolls back, it releases its exclusive
          lock on the row and the queued shared lock requests for
          sessions 2 and 3 are granted. At this point, sessions 2 and 3
          deadlock: Neither can acquire an exclusive lock for the row
          because of the shared lock held by the other.
        </p><p>
          A similar situation occurs if the table already contains a row
          with key value 1 and three sessions perform the following
          operations in order:
        </p><p>
          Session 1:
        </p><pre class="programlisting">
START TRANSACTION;
DELETE FROM t1 WHERE i = 1;
</pre><p>
          Session 2:
        </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 3:
        </p><pre class="programlisting">
START TRANSACTION;
INSERT INTO t1 VALUES(1);
</pre><p>
          Session 1:
        </p><pre class="programlisting">
COMMIT;
</pre><p>
          The first operation by session 1 acquires an exclusive lock
          for the row. The operations by sessions 2 and 3 both result in
          a duplicate-key error and they both request a shared lock for
          the row. When session 1 commits, it releases its exclusive
          lock on the row and the queued shared lock requests for
          sessions 2 and 3 are granted. At this point, sessions 2 and 3
          deadlock: Neither can acquire an exclusive lock for the row
          because of the shared lock held by the other.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
          ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> in that an exclusive
          next-key lock rather than a shared lock is placed on the row
          to be updated when a duplicate-key error occurs.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a> is done like an
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> if there is no collision
          on a unique key. Otherwise, an exclusive next-key lock is
          placed on the row to be replaced.
        </p></li><li class="listitem"><p>
          <code class="literal">INSERT INTO T SELECT ... FROM S WHERE ...</code>
          sets an exclusive index record lock (without a gap lock) on
          each row inserted into <code class="literal">T</code>. If the
          transaction isolation level is <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a>, or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
          is enabled and the transaction isolation level is not
          <a class="link" href="sql-syntax.html#isolevel_serializable"><code class="literal">SERIALIZABLE</code></a>,
          <code class="literal">InnoDB</code> does the search on
          <code class="literal">S</code> as a consistent read (no locks).
          Otherwise, <code class="literal">InnoDB</code> sets shared next-key
          locks on rows from <code class="literal">S</code>.
          <code class="literal">InnoDB</code> has to set locks in the latter case:
          In roll-forward recovery from a backup, every SQL statement
          must be executed in exactly the same way it was done
          originally.
        </p><p>
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE ...
          SELECT ...</code></a> performs the
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> with shared next-key
          locks or as a consistent read, as for
          <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
          SELECT</code></a>.
        </p><p>
          When a <code class="literal">SELECT</code> is used in the constructs
          <code class="literal">REPLACE INTO t SELECT ... FROM s WHERE ...</code>
          or <code class="literal">UPDATE t ... WHERE col IN (SELECT ... FROM s
          ...)</code>, <code class="literal">InnoDB</code> sets shared next-key
          locks on rows from table <code class="literal">s</code>.
        </p></li><li class="listitem"><p>
          While initializing a previously specified
          <code class="literal">AUTO_INCREMENT</code> column on a table,
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column. In accessing the
          auto-increment counter, <code class="literal">InnoDB</code> uses a
          specific <code class="literal">AUTO-INC</code> table lock mode where the
          lock lasts only to the end of the current SQL statement, not
          to the end of the entire transaction. Other sessions cannot
          insert into the table while the <code class="literal">AUTO-INC</code>
          table lock is held; see
          <a class="xref" href="innodb-storage-engine.html#innodb-transaction-model" title="14.5.2 The InnoDB Transaction Model and Locking">Section 14.5.2, “The InnoDB Transaction Model and Locking”</a>.
        </p><p>
          <code class="literal">InnoDB</code> fetches the value of a previously
          initialized <code class="literal">AUTO_INCREMENT</code> column without
          setting any locks.
        </p></li><li class="listitem"><p>
          If a <code class="literal">FOREIGN KEY</code> constraint is defined on a
          table, any insert, update, or delete that requires the
          constraint condition to be checked sets shared record-level
          locks on the records that it looks at to check the constraint.
          <code class="literal">InnoDB</code> also sets these locks in the case
          where the constraint fails.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> sets table locks,
          but it is the higher MySQL layer above the
          <code class="literal">InnoDB</code> layer that sets these locks.
          <code class="literal">InnoDB</code> is aware of table locks if
          <code class="literal">innodb_table_locks = 1</code> (the default) and
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
          layer above <code class="literal">InnoDB</code> knows about row-level
          locks.
        </p><p>
          Otherwise, <code class="literal">InnoDB</code>'s automatic deadlock
          detection cannot detect deadlocks where such table locks are
          involved. Also, because in this case the higher MySQL layer
          does not know about row-level locks, it is possible to get a
          table lock on a table where another session currently has
          row-level locks. However, this does not endanger transaction
          integrity, as discussed in
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="14.5.10 Deadlock Detection and Rollback">Section 14.5.10, “Deadlock Detection and Rollback”</a>. See also
          <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.8.7 Limits on InnoDB Tables">Section 14.8.7, “Limits on InnoDB Tables”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-implicit-commit"></a>14.5.9 Implicit Transaction Commit and Rollback</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497028112"></a><p>
      By default, MySQL starts the session for each new connection with
      autocommit mode enabled, so MySQL does a commit after each SQL
      statement if that statement did not return an error. If a
      statement returns an error, the commit or rollback behavior
      depends on the error. See <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.20.4 InnoDB Error Handling">Section 14.20.4, “InnoDB Error Handling”</a>.
    </p><p>
      If a session that has autocommit disabled ends without explicitly
      committing the final transaction, MySQL rolls back that
      transaction.
    </p><p>
      Some statements implicitly end a transaction, as if you had done a
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> before executing the
      statement. For details, see <a class="xref" href="sql-syntax.html#implicit-commit" title="13.3.3 Statements That Cause an Implicit Commit">Section 13.3.3, “Statements That Cause an Implicit Commit”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-deadlock-detection"></a>14.5.10 Deadlock Detection and Rollback</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301497021008"></a><a class="indexterm" name="idm140301497019520"></a><a class="indexterm" name="idm140301497017616"></a><a class="indexterm" name="idm140301497016128"></a><p>
      <code class="literal">InnoDB</code> automatically detects transaction
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> and rolls back a
      transaction or transactions to break the deadlock.
      <code class="literal">InnoDB</code> tries to pick small transactions to roll
      back, where the size of a transaction is determined by the number
      of rows inserted, updated, or deleted.
    </p><p>
      <code class="literal">InnoDB</code> is aware of table locks if
      <code class="literal">innodb_table_locks = 1</code> (the default) and
      <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>, and the MySQL
      layer above it knows about row-level locks. Otherwise,
      <code class="literal">InnoDB</code> cannot detect deadlocks where a table
      lock set by a MySQL <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
      statement or a lock set by a storage engine other than
      <code class="literal">InnoDB</code> is involved. Resolve these situations by
      setting the value of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> system
      variable.
    </p><p>
      When <code class="literal">InnoDB</code> performs a complete rollback of a
      transaction, all locks set by the transaction are released.
      However, if just a single SQL statement is rolled back as a result
      of an error, some of the locks set by the statement may be
      preserved. This happens because <code class="literal">InnoDB</code> stores
      row locks in a format such that it cannot know afterward which
      lock was set by which statement.
    </p><p>
      If a <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> calls a stored function
      in a transaction, and a statement within the function fails, that
      statement rolls back. Furthermore, if
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is
      executed after that, the entire transaction rolls back.
    </p><p>
      For techniques to organize database operations to avoid deadlocks,
      see <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="14.5.11 How to Cope with Deadlocks">Section 14.5.11, “How to Cope with Deadlocks”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-deadlocks"></a>14.5.11 How to Cope with Deadlocks</h3>

</div>

</div>

</div>
<p>
      This section builds on the conceptual information about deadlocks
      in <a class="xref" href="innodb-storage-engine.html#innodb-deadlock-detection" title="14.5.10 Deadlock Detection and Rollback">Section 14.5.10, “Deadlock Detection and Rollback”</a>. It explains how to
      organize database operations to minimize deadlocks and the
      subsequent error handling required in applications.
    </p><p>
      <a class="link" href="glossary.html#glos_deadlock" title="deadlock">Deadlocks</a> are a classic
      problem in transactional databases, but they are not dangerous
      unless they are so frequent that you cannot run certain
      transactions at all. Normally, you must write your applications so
      that they are always prepared to re-issue a transaction if it gets
      rolled back because of a deadlock.
    </p><p>
      <code class="literal">InnoDB</code> uses automatic row-level locking. You
      can get deadlocks even in the case of transactions that just
      insert or delete a single row. That is because these operations
      are not really <span class="quote">“<span class="quote">atomic</span>”</span>; they automatically set locks
      on the (possibly several) index records of the row inserted or
      deleted.
    </p><p>
      You can cope with deadlocks and reduce the likelihood of their
      occurrence with the following techniques:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          At any time, issue the
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> command to determine the cause of the
          most recent deadlock. That can help you to tune your
          application to avoid deadlocks.
        </p></li><li class="listitem"><p>
          If frequent deadlock warnings cause concern, collect more
          extensive debugging information by enabling the the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
          configuration option. Information about each deadlock, not
          just the latest one, is recorded in the MySQL
          <a class="link" href="glossary.html#glos_error_log" title="error log">error log</a>. Disable this
          option when you are finished debugging.
        </p></li><li class="listitem"><p>
          Always be prepared to re-issue a transaction if it fails due
          to deadlock. Deadlocks are not dangerous. Just try again.
        </p></li><li class="listitem"><p>
          Keep transactions small and short in duration to make them
          less prone to collision.
        </p></li><li class="listitem"><p>
          Commit transactions immediately after making a set of related
          changes to make them less prone to collision. In particular,
          do not leave an interactive <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session
          open for a long time with an uncommitted transaction.
        </p></li><li class="listitem"><p>
          If you use <a class="link" href="glossary.html#glos_locking_read" title="locking read">locking
          reads</a> (<a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT
          ... FOR UPDATE</code></a> or <code class="literal">SELECT
          ... LOCK IN SHARE MODE</code>), try using a lower isolation
          level such as <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a>.
        </p></li><li class="listitem"><p>
          When modifying multiple tables within a transaction, or
          different sets of rows in the same table, do those operations
          in a consistent order each time. Then transactions form
          well-defined queues and do not deadlock. For example, organize
          database operations into functions within your application, or
          call stored routines, rather than coding multiple similar
          sequences of <code class="literal">INSERT</code>,
          <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>
          statements in different places.
        </p></li><li class="listitem"><p>
          Add well-chosen indexes to your tables. Then your queries need
          to scan fewer index records and consequently set fewer locks.
          Use <a class="link" href="sql-syntax.html#explain" title="13.8.2 EXPLAIN Syntax"><code class="literal">EXPLAIN
          SELECT</code></a> to determine which indexes the MySQL server
          regards as the most appropriate for your queries.
        </p></li><li class="listitem"><p>
          Use less locking. If you can afford to permit a
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> to return data from an
          old snapshot, do not add the clause <code class="literal">FOR
          UPDATE</code> or <code class="literal">LOCK IN SHARE MODE</code> to
          it. Using the <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ
          COMMITTED</code></a> isolation level is good here, because each
          consistent read within the same transaction reads from its own
          fresh snapshot.
        </p></li><li class="listitem"><p>
          If nothing else helps, serialize your transactions with
          table-level locks. The correct way to use
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> with transactional
          tables, such as <code class="literal">InnoDB</code> tables, is to begin
          a transaction with <code class="literal">SET autocommit = 0</code> (not
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a>) followed by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>, and to not call
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
          TABLES</code></a> until you commit the transaction explicitly.
          For example, if you need to write to table
          <code class="literal">t1</code> and read from table
          <code class="literal">t2</code>, you can do this:
        </p><pre class="programlisting">
SET autocommit=0;
LOCK TABLES t1 WRITE, t2 READ, ...;
<em class="replaceable"><code>... do something with tables t1 and t2 here ...</code></em>
COMMIT;
UNLOCK TABLES;
</pre><p>
          Table-level locks prevent concurrent updates to the table,
          avoiding deadlocks at the expense of less responsiveness for a
          busy system.
        </p></li><li class="listitem"><p>
          Another way to serialize transactions is to create an
          auxiliary <span class="quote">“<span class="quote">semaphore</span>”</span> table that contains just a
          single row. Have each transaction update that row before
          accessing other tables. In that way, all transactions happen
          in a serial fashion. Note that the <code class="literal">InnoDB</code>
          instant deadlock detection algorithm also works in this case,
          because the serializing lock is a row-level lock. With MySQL
          table-level locks, the timeout method must be used to resolve
          deadlocks.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-multi-versioning"></a>14.5.12 InnoDB Multi-Versioning</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496951744"></a><a class="indexterm" name="idm140301496950256"></a><p>
      <code class="literal">InnoDB</code> is a
      <a class="link" href="glossary.html#glos_mvcc" title="MVCC">multi-versioned storage engine</a>:
      it keeps information about old versions of changed rows, to
      support transactional features such as concurrency and
      <a class="link" href="glossary.html#glos_rollback" title="rollback">rollback</a>. This information is
      stored in the tablespace in a data structure called a
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>
      (after an analogous data structure in Oracle).
      <code class="literal">InnoDB</code> uses the information in the rollback
      segment to perform the undo operations needed in a transaction
      rollback. It also uses the information to build earlier versions
      of a row for a <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent
      read</a>.
</p>
<h4><a name="idm140301496943392"></a>Internal Details of Multi-Versioning</h4>
<p>
      Internally, <code class="literal">InnoDB</code> adds three fields to each
      row stored in the database. A 6-byte <code class="literal">DB_TRX_ID</code>
      field indicates the transaction identifier for the last
      transaction that inserted or updated the row. Also, a deletion is
      treated internally as an update where a special bit in the row is
      set to mark it as deleted. Each row also contains a 7-byte
      <code class="literal">DB_ROLL_PTR</code> field called the roll pointer. The
      roll pointer points to an undo log record written to the rollback
      segment. If the row was updated, the undo log record contains the
      information necessary to rebuild the content of the row before it
      was updated. A 6-byte <code class="literal">DB_ROW_ID</code> field contains
      a row ID that increases monotonically as new rows are inserted. If
      <code class="literal">InnoDB</code> generates a clustered index
      automatically, the index contains row ID values. Otherwise, the
      <code class="literal">DB_ROW_ID</code> column does not appear in any index.
    </p><p>
      Undo logs in the rollback segment are divided into insert and
      update undo logs. Insert undo logs are needed only in transaction
      rollback and can be discarded as soon as the transaction commits.
      Update undo logs are used also in consistent reads, but they can
      be discarded only after there is no transaction present for which
      <code class="literal">InnoDB</code> has assigned a snapshot that in a
      consistent read could need the information in the update undo log
      to build an earlier version of a database row.
</p>
<h4><a name="idm140301496935520"></a>Rollback Segments and Concurrent Transaction Limits</h4>
<p>
      The limit on concurrent data-modifying transactions was
      significantly increased in MySQL 5.5.4 by removing a bottleneck
      that resulted from a single InnoDB
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a> that
      supported a maximum of 1023 concurrent data-modifying
      transactions. The single rollback segment was divided into 128
      segments, each supporting up to 1023 transactions, creating a new
      limit of approximately 128K concurrent transactions.
    </p><p>
      Each transaction is assigned to one of the rollback segments, and
      remains tied to that rollback segment for the duration. The
      increased limit for concurrent data-modifying transactions
      improves both scalability (higher number of concurrent
      transactions) and performance (less contention when different
      transactions access the rollback segments).
</p>
<h4><a name="idm140301496932320"></a>Guidelines for Managing Rollback Segments</h4>
<p>
      Commit your transactions regularly, including those transactions
      that issue only consistent reads. Otherwise,
      <code class="literal">InnoDB</code> cannot discard data from the update undo
      logs, and the rollback segment may grow too big, filling up your
      tablespace.
    </p><p>
      The physical size of an undo log record in the rollback segment is
      typically smaller than the corresponding inserted or updated row.
      You can use this information to calculate the space needed for
      your rollback segment.
    </p><p>
      In the <code class="literal">InnoDB</code> multi-versioning scheme, a row is
      not physically removed from the database immediately when you
      delete it with an SQL statement. <code class="literal">InnoDB</code> only
      physically removes the corresponding row and its index records
      when it discards the update undo log record written for the
      deletion. This removal operation is called a
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a>, and it is quite fast,
      usually taking the same order of time as the SQL statement that
      did the deletion.
    </p><p>
      If you insert and delete rows in smallish batches at about the
      same rate in the table, the purge thread can start to lag behind
      and the table can grow bigger and bigger because of all the
      <span class="quote">“<span class="quote">dead</span>”</span> rows, making everything disk-bound and very
      slow. In such a case, throttle new row operations, and allocate
      more resources to the purge thread by tuning the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a> system
      variable. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a> for more
      information.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-and-index"></a>14.5.13 InnoDB Table and Index Structures</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-frm-file">14.5.13.1 Role of the .frm File for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-index-types">14.5.13.2 Clustered and Secondary Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-physical-structure">14.5.13.3 Physical Structure of an InnoDB Index</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-insert-buffering">14.5.13.4 Insert Buffering</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-adaptive-hash">14.5.13.5 Adaptive Hash Indexes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-physical-record">14.5.13.6 Physical Row Structure</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301496921920"></a><a class="indexterm" name="idm140301496920464"></a>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-frm-file"></a>14.5.13.1 Role of the .frm File for InnoDB Tables</h4>

</div>

</div>

</div>
<p>
        MySQL stores its data dictionary information for tables in
        <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm files</a> in database
        directories. Unlike other MySQL storage engines,
        <code class="literal">InnoDB</code> also encodes information about the
        table in its own internal data dictionary inside the tablespace.
        When MySQL drops a table or a database, it deletes one or more
        <code class="filename">.frm</code> files as well as the corresponding
        entries inside the <code class="literal">InnoDB</code> data dictionary.
        You cannot move <code class="literal">InnoDB</code> tables between
        databases simply by moving the <code class="filename">.frm</code> files.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-index-types"></a>14.5.13.2 Clustered and Secondary Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496911152"></a><a class="indexterm" name="idm140301496909696"></a><a class="indexterm" name="idm140301496908208"></a><a class="indexterm" name="idm140301496906720"></a><p>
        Every <code class="literal">InnoDB</code> table has a special index called
        the <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
        where the data for the rows is stored. Typically, the clustered
        index is synonymous with the
        <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>. To get the
        best performance from queries, inserts, and other database
        operations, you must understand how InnoDB uses the clustered
        index to optimize the most common lookup and DML operations for
        each table.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            When you define a <code class="literal">PRIMARY KEY</code> on your
            table, <code class="literal">InnoDB</code> uses it as the clustered
            index. Define a primary key for each table that you create.
            If there is no logical unique and non-null column or set of
            columns, add a new
            <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
            column, whose values are filled in automatically.
          </p></li><li class="listitem"><p>
            If you do not define a <code class="literal">PRIMARY KEY</code> for
            your table, MySQL locates the first
            <code class="literal">UNIQUE</code> index where all the key columns
            are <code class="literal">NOT NULL</code> and
            <code class="literal">InnoDB</code> uses it as the clustered index.
          </p></li><li class="listitem"><p>
            If the table has no <code class="literal">PRIMARY KEY</code> or
            suitable <code class="literal">UNIQUE</code> index,
            <code class="literal">InnoDB</code> internally generates a hidden
            clustered index on a synthetic column containing row ID
            values. The rows are ordered by the ID that
            <code class="literal">InnoDB</code> assigns to the rows in such a
            table. The row ID is a 6-byte field that increases
            monotonically as new rows are inserted. Thus, the rows
            ordered by the row ID are physically in insertion order.
</p></li></ul>
</div>
<h5><a name="idm140301496890432"></a>How the Clustered Index Speeds Up Queries</h5>
<p>
        Accessing a row through the clustered index is fast because the
        index search leads directly to the page with all the row data.
        If a table is large, the clustered index architecture often
        saves a disk I/O operation when compared to storage
        organizations that store row data using a different page from
        the index record. (For example, <code class="literal">MyISAM</code> uses
        one file for data rows and another for index records.)
</p>
<h5><a name="idm140301496888112"></a>How Secondary Indexes Relate to the Clustered Index</h5>
<p>
        All indexes other than the clustered index are known as
        <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        In <code class="literal">InnoDB</code>, each record in a secondary index
        contains the primary key columns for the row, as well as the
        columns specified for the secondary index.
        <code class="literal">InnoDB</code> uses this primary key value to search
        for the row in the clustered index.
      </p><p>
        If the primary key is long, the secondary indexes use more
        space, so it is advantageous to have a short primary key.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-physical-structure"></a>14.5.13.3 Physical Structure of an InnoDB Index</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496882336"></a><a class="indexterm" name="idm140301496880848"></a><a class="indexterm" name="idm140301496879360"></a><a class="indexterm" name="idm140301496878288"></a><p>
        All <code class="literal">InnoDB</code> indexes are
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-trees</a> where the index
        records are stored in the leaf pages of the tree. The default
        size of an index page is 16KB.
      </p><p>
        When new records are inserted into an <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>,
        <code class="literal">InnoDB</code> tries to leave 1/16 of the page free
        for future insertions and updates of the index records. If index
        records are inserted in a sequential order (ascending or
        descending), the resulting index pages are about 15/16 full. If
        records are inserted in a random order, the pages are from 1/2
        to 15/16 full. If the <a class="link" href="glossary.html#glos_fill_factor" title="fill factor">fill
        factor</a> of an index page drops below 1/2,
        <code class="literal">InnoDB</code> tries to contract the index tree to
        free the page.
      </p><p>
        Changing the <code class="literal">InnoDB</code> page size is not a
        supported operation and there is no guarantee that
        <code class="literal">InnoDB</code> will function normally with a page
        size other than 16KB. Problems compiling or running
        <code class="literal">InnoDB</code> may occur. In particular,
        <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda file
        format assumes that the page size is at most 16KB and uses
        14-bit pointers.
      </p><p>
        An instance using a particular <code class="literal">InnoDB</code> page
        size cannot use data files or log files from an instance that
        uses a different page size.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-insert-buffering"></a>14.5.13.4 Insert Buffering</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496864000"></a><a class="indexterm" name="idm140301496862512"></a><p>
        Database applications often insert new rows in the ascending
        order of the primary key. In this case, due to the layout of the
        clustered index in the same order as the primary key, insertions
        into an InnoDB table do not require random reads from a disk.
      </p><p>
        On the other hand, secondary indexes are usually nonunique, and
        insertions into secondary indexes happen in a relatively random
        order. In the same way, deletes and updates can affect data
        pages that are not adjacent in secondary indexes. This would
        cause a lot of random disk I/O operations without a special
        mechanism used in <code class="literal">InnoDB</code>.
      </p><p>
        When an index record is inserted, marked for deletion, or
        deleted from a nonunique secondary index,
        <code class="literal">InnoDB</code> checks whether the secondary index
        page is in the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a>. If that is the case, <code class="literal">InnoDB</code>
        applies the change directly to the index page. If the index page
        is not found in the buffer pool, <code class="literal">InnoDB</code>
        records the change in a special structure known as the
        <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a>. The
        insert buffer is kept small so that it fits entirely in the
        buffer pool, and changes can be applied very quickly. This
        process is known as <a class="link" href="glossary.html#glos_change_buffering" title="change buffering">change
        buffering</a>. (Formerly, it applied only to inserts and was
        called insert buffering. The data structure is still called the
        insert buffer.)
</p>
<h5><a name="idm140301496853344"></a>Disk I/O for Flushing the Insert Buffer</h5>
<p>
        Periodically, the insert buffer is merged into the secondary
        index trees in the database. Often, it is possible to merge
        several changes into the same page of the index tree, saving
        disk I/O operations. It has been measured that the insert buffer
        can speed up insertions into a table up to 15 times.
      </p><p>
        The insert buffer merging may continue to happen
        <span class="emphasis"><em>after</em></span> the transaction has been committed.
        In fact, it may continue to happen after a server shutdown and
        restart (see <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a>).
      </p><p>
        Insert buffer merging may take many hours when many secondary
        indexes must be updated and many rows have been inserted. During
        this time, disk I/O will be increased, which can cause
        significant slowdown on disk-bound queries. Another significant
        background I/O operation is the
        <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge thread</a> (see
        <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.5.12 InnoDB Multi-Versioning">Section 14.5.12, “InnoDB Multi-Versioning”</a>).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-adaptive-hash"></a>14.5.13.5 Adaptive Hash Indexes</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496846240"></a><a class="indexterm" name="idm140301496844752"></a><p>
        The feature known as the
        <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
        index</a> (AHI) lets <code class="literal">InnoDB</code> perform more
        like an in-memory database on systems with appropriate
        combinations of workload and ample memory for the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, without
        sacrificing any transactional features or reliability. This
        feature is enabled by the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>
        option, or turned off by the
        <code class="literal">--skip-innodb_adaptive_hash_index</code> at server
        startup.
      </p><p>
        Based on the observed pattern of searches, MySQL builds a hash
        index using a prefix of the index key. The prefix of the key can
        be any length, and it may be that only some of the values in the
        B-tree appear in the hash index. Hash indexes are built on
        demand for those pages of the index that are often accessed.
      </p><p>
        If a table fits almost entirely in main memory, a hash index can
        speed up queries by enabling direct lookup of any element,
        turning the index value into a sort of pointer.
        <code class="literal">InnoDB</code> has a mechanism that monitors index
        searches. If <code class="literal">InnoDB</code> notices that queries
        could benefit from building a hash index, it does so
        automatically.
      </p><p>
        With some <a class="link" href="glossary.html#glos_workload" title="workload">workloads</a>, the
        speedup from hash index lookups greatly outweighs the extra work
        to monitor index lookups and maintain the hash index structure.
        Sometimes, the read/write lock that guards access to the
        adaptive hash index can become a source of contention under
        heavy workloads, such as multiple concurrent joins. Queries with
        <code class="literal">LIKE</code> operators and <code class="literal">%</code>
        wildcards also tend not to benefit from the AHI. For workloads
        where the adaptive hash index is not needed, turning it off
        reduces unnecessary performance overhead. Because it is
        difficult to predict in advance whether this feature is
        appropriate for a particular system, consider running benchmarks
        with it both enabled and disabled, using a realistic workload.
      </p><p>
        The hash index is always built based on an existing
        <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index on the table.
        <code class="literal">InnoDB</code> can build a hash index on a prefix of
        any length of the key defined for the B-tree, depending on the
        pattern of searches that <code class="literal">InnoDB</code> observes for
        the B-tree index. A hash index can be partial, covering only
        those pages of the index that are often accessed.
      </p><p>
        You can monitor the use of the adaptive hash index and the
        contention for its use in the <code class="literal">SEMAPHORES</code>
        section of the output of the
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> command. If you see many threads waiting on an
        RW-latch created in <code class="filename">btr0sea.c</code>, then it
        might be useful to disable adaptive hash indexing.
      </p><p>
        For more information about the performance characteristics of
        hash indexes, see <a class="xref" href="optimization.html#index-btree-hash" title="8.3.8 Comparison of B-Tree and Hash Indexes">Section 8.3.8, “Comparison of B-Tree and Hash Indexes”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-physical-record"></a>14.5.13.6 Physical Row Structure</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496823184"></a><p>
        The physical row structure for an <code class="literal">InnoDB</code>
        table depends on the row format specified when the table was
        created. <code class="literal">InnoDB</code> uses the
        <code class="literal">COMPACT</code> format by default, but the
        <code class="literal">REDUNDANT</code> format is available to retain
        compatibility with older versions of MySQL. To check the row
        format of an <code class="literal">InnoDB</code> table, use
        <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a>. For example:
      </p><pre class="programlisting">mysql&gt; SHOW TABLE STATUS IN test1\G
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 16384
      Data_free: 0
 Auto_increment: 1
    Create_time: 2014-10-31 16:02:01
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment: 
1 row in set (0.00 sec)</pre><p>
        The <code class="literal">COMPACT</code> row format decreases row storage
        space by about 20% at the cost of increasing CPU use for some
        operations. If your workload is a typical one that is limited by
        cache hit rates and disk speed, <code class="literal">COMPACT</code>
        format is likely to be faster. If the workload is a rare case
        that is limited by CPU speed, compact format might be slower.
      </p><p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">REDUNDANT</code> row format have the following
        characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each index record contains a 6-byte header. The header is
            used to link together consecutive records, and also in
            row-level locking.
          </p></li><li class="listitem"><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a 6-byte
            transaction ID field and a 7-byte roll pointer field.
          </p></li><li class="listitem"><p>
            If no primary key was defined for a table, each clustered
            index record also contains a 6-byte row ID field.
          </p></li><li class="listitem"><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index.
          </p></li><li class="listitem"><p>
            A record contains a pointer to each field of the record. If
            the total length of the fields in a record is less than 128
            bytes, the pointer is one byte; otherwise, two bytes. The
            array of these pointers is called the record directory. The
            area where these pointers point is called the data part of
            the record.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length
            character columns such as
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li class="listitem"><p>
            An SQL <code class="literal">NULL</code> value reserves one or two
            bytes in the record directory. Besides that, an SQL
            <code class="literal">NULL</code> value reserves zero bytes in the
            data part of the record if stored in a variable length
            column. In a fixed-length column, it reserves the fixed
            length of the column in the data part of the record.
            Reserving the fixed space for <code class="literal">NULL</code> values
            enables an update of the column from <code class="literal">NULL</code>
            to a non-<code class="literal">NULL</code> value to be done in place
            without causing fragmentation of the index page.
</p></li></ul>
</div>
<p>
        Rows in <code class="literal">InnoDB</code> tables that use
        <code class="literal">COMPACT</code> row format have the following
        characteristics:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Each index record contains a 5-byte header that may be
            preceded by a variable-length header. The header is used to
            link together consecutive records, and also in row-level
            locking.
          </p></li><li class="listitem"><p>
            The variable-length part of the record header contains a bit
            vector for indicating <code class="literal">NULL</code> columns. If
            the number of columns in the index that can be
            <code class="literal">NULL</code> is <em class="replaceable"><code>N</code></em>, the
            bit vector occupies
            <code class="literal">CEILING(<em class="replaceable"><code>N</code></em>/8)</code>
            bytes. (For example, if there are anywhere from 9 to 15
            columns that can be <code class="literal">NULL</code>, the bit vector
            uses two bytes.) Columns that are <code class="literal">NULL</code> do
            not occupy space other than the bit in this vector. The
            variable-length part of the header also contains the lengths
            of variable-length columns. Each length takes one or two
            bytes, depending on the maximum length of the column. If all
            columns in the index are <code class="literal">NOT NULL</code> and
            have a fixed length, the record header has no
            variable-length part.
          </p></li><li class="listitem"><p>
            For each non-<code class="literal">NULL</code> variable-length field,
            the record header contains the length of the column in one
            or two bytes. Two bytes will only be needed if part of the
            column is stored externally in overflow pages or the maximum
            length exceeds 255 bytes and the actual length exceeds 127
            bytes. For an externally stored column, the 2-byte length
            indicates the length of the internally stored part plus the
            20-byte pointer to the externally stored part. The internal
            part is 768 bytes, so the length is 768+20. The 20-byte
            pointer stores the true length of the column.
          </p></li><li class="listitem"><p>
            The record header is followed by the data contents of the
            non-<code class="literal">NULL</code> columns.
          </p></li><li class="listitem"><p>
            Records in the clustered index contain fields for all
            user-defined columns. In addition, there is a 6-byte
            transaction ID field and a 7-byte roll pointer field.
          </p></li><li class="listitem"><p>
            If no primary key was defined for a table, each clustered
            index record also contains a 6-byte row ID field.
          </p></li><li class="listitem"><p>
            Each secondary index record also contains all the primary
            key fields defined for the clustered index key that are not
            in the secondary index. If any of these primary key fields
            are variable length, the record header for each secondary
            index will have a variable-length part to record their
            lengths, even if the secondary index is defined on
            fixed-length columns.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> stores fixed-length,
            fixed-width character columns such as
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(10)</code></a> in a fixed-length
            format. <code class="literal">InnoDB</code> does not truncate trailing
            spaces from <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns.
          </p></li><li class="listitem"><p>
            Internally, <code class="literal">InnoDB</code> attempts to store
            UTF-8
            <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">CHAR(<em class="replaceable"><code>N</code></em>)</code></a>
            columns in <em class="replaceable"><code>N</code></em> bytes by trimming
            trailing spaces. (With <code class="literal">REDUNDANT</code> row
            format, such columns occupy 3 ×
            <em class="replaceable"><code>N</code></em> bytes.) Reserving the minimum
            space <em class="replaceable"><code>N</code></em> in many cases enables
            column updates to be done in place without causing
            fragmentation of the index page.
</p></li></ul>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-configuration"></a>14.6 InnoDB Configuration</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496766528"></a><p>
    The first decisions to make about InnoDB configuration involve how
    to lay out InnoDB data files, and how much memory to allocate for
    the InnoDB storage engine. You record these choices either by
    recording them in a configuration file that MySQL reads at startup,
    or by specifying them as command-line options in a startup script.
    The full list of options, descriptions, and allowed parameter values
    is at <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a>.
</p>
<h3><a name="idm140301496763504"></a>Overview of InnoDB Tablespace and Log Files</h3>
<p>
    Two important disk-based resources managed by the
    <code class="literal">InnoDB</code> storage engine are its tablespace data
    files and its log files. If you specify no <code class="literal">InnoDB</code>
    configuration options, MySQL creates an auto-extending data file,
    slightly larger than 10MB, named <code class="filename">ibdata1</code> and
    two log files named <code class="filename">ib_logfile0</code> and
    <code class="filename">ib_logfile1</code> in the MySQL data directory. Their
    size is given by the size of the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
    variable. To get good performance, explicitly provide
    <code class="literal">InnoDB</code> parameters as discussed in the following
    examples. Naturally, edit the settings to suit your hardware and
    requirements.
  </p><p>
    The examples shown here are representative. See
    <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a> for additional information about
    <code class="literal">InnoDB</code>-related configuration parameters.
</p>
<h3><a name="idm140301496754416"></a>Considerations for Storage Devices</h3>
<p>
    In some cases, database performance improves if the data is not all
    placed on the same physical disk. Putting log files on a different
    disk from data is very often beneficial for performance. The example
    illustrates how to do this. It places the two data files on
    different disks and places the log files on the third disk.
    <code class="literal">InnoDB</code> fills the tablespace beginning with the
    first data file. You can also use raw disk partitions (raw devices)
    as <code class="literal">InnoDB</code> data files, which may speed up I/O. See
    <a class="xref" href="innodb-storage-engine.html#innodb-raw-devices" title="14.7.3 Using Raw Disk Partitions for the System Tablespace">Section 14.7.3, “Using Raw Disk Partitions for the System Tablespace”</a>.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
      <code class="literal">InnoDB</code> is a transaction-safe (ACID compliant)
      storage engine for MySQL that has commit, rollback, and
      crash-recovery capabilities to protect user data.
      <span class="bold"><strong>However, it cannot do so</strong></span> if the
      underlying operating system or hardware does not work as
      advertised. Many operating systems or disk subsystems may delay or
      reorder write operations to improve performance. On some operating
      systems, the very <code class="literal">fsync()</code> system call that
      should wait until all unwritten data for a file has been flushed
      might actually return before the data has been flushed to stable
      storage. Because of this, an operating system crash or a power
      outage may destroy recently committed data, or in the worst case,
      even corrupt the database because of write operations having been
      reordered. If data integrity is important to you, perform some
      <span class="quote">“<span class="quote">pull-the-plug</span>”</span> tests before using anything in
      production. On OS X 10.3 and up, <code class="literal">InnoDB</code> uses a
      special <code class="literal">fcntl()</code> file flush method. Under Linux,
      it is advisable to <span class="bold"><strong>disable the write-back
      cache</strong></span>.
    </p><p>
      On ATA/SATA disk drives, a command such <code class="literal">hdparm -W0
      /dev/hda</code> may work to disable the write-back cache.
      <span class="bold"><strong>Beware that some drives or disk controllers
      may be unable to disable the write-back cache.</strong></span>
    </p><p>
      With regard to <code class="literal">InnoDB</code> recovery capabilities
      that protect user data, <code class="literal">InnoDB</code> uses a file
      flush technique involving a structure called the
      <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite buffer</a>,
      which is enabled by default
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>). The
      doublewrite buffer adds safety to recovery following a crash or
      power outage, and improves performance on most varieties of Unix
      by reducing the need for <code class="literal">fsync()</code> operations. It
      is recommended that the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite</code></a> option remains
      enabled if you are concerned with data integrity or possible
      failures. For additional information about the doublewrite buffer,
      see <a class="xref" href="innodb-storage-engine.html#innodb-disk-management" title="14.12 InnoDB Disk I/O and File Space Management">Section 14.12, “InnoDB Disk I/O and File Space Management”</a>.
</p>
</div>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Caution
</div>
<a class="indexterm" name="idm140301496734560"></a><a class="indexterm" name="idm140301496733056"></a><p>
      If reliability is a consideration for your data, do not configure
      <code class="literal">InnoDB</code> to use data files or log files on NFS
      volumes. Potential problems vary according to OS and version of
      NFS, and include such issues as lack of protection from
      conflicting writes, and limitations on maximum file sizes.
</p>
</div>
<h3><a name="idm140301496730048"></a>Specifying the Location and Size for InnoDB Tablespace Files</h3>
<p>
    To set up the <code class="literal">InnoDB</code> tablespace files, use the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option in the
    <code class="literal">[mysqld]</code> section of the
    <code class="filename">my.cnf</code> option file. On Windows, you can use
    <code class="filename">my.ini</code> instead. The value of
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> should be a
    list of one or more data file specifications. If you name more than
    one data file, separate them by semicolon
    (<span class="quote">“<span class="quote"><code class="literal">;</code></span>”</span>) characters:
  </p><pre class="programlisting">
innodb_data_file_path=<em class="replaceable"><code>datafile_spec1</code></em>[;<em class="replaceable"><code>datafile_spec2</code></em>]...
</pre><p>
    For example, the following setting explicitly creates a minimally
    sized system tablespace:
  </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend
</pre><p>
    This setting configures a single data file, slightly larger than
    10MB, named <code class="filename">ibdata1</code> that is auto-extending. No
    location for the file is given, so by default,
    <code class="literal">InnoDB</code> creates it in the MySQL data directory.
  </p><p>
    Sizes are specified using <code class="literal">K</code>,
    <code class="literal">M</code>, or <code class="literal">G</code> suffix letters to
    indicate units of KB, MB, or GB.
  </p><p>
    A tablespace containing a fixed-size 50MB data file named
    <code class="filename">ibdata1</code> and a 50MB auto-extending file named
    <code class="filename">ibdata2</code> in the data directory can be configured
    like this:
  </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre><p>
    The full syntax for a data file specification includes the file
    name, its size, and several optional attributes:
  </p><pre class="programlisting">
<em class="replaceable"><code>file_name</code></em>:<em class="replaceable"><code>file_size</code></em>[:autoextend[:max:<em class="replaceable"><code>max_file_size</code></em>]]
</pre><p>
    The <code class="literal">autoextend</code> and <code class="literal">max</code>
    attributes can be used only for the last data file in the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> line.
  </p><p>
    If you specify the <code class="literal">autoextend</code> option for the last
    data file, <code class="literal">InnoDB</code> extends the data file if it
    runs out of free space in the tablespace. The increment is 8MB at a
    time by default. To modify the increment, change the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a> system
    variable.
  </p><p>
    If the disk becomes full, you might want to add another data file on
    another disk. For tablespace reconfiguration instructions, see
    <a class="xref" href="innodb-storage-engine.html#innodb-data-log-reconfiguration" title="14.7.2 Changing the Number or Size of InnoDB Log Files">Section 14.7.2, “Changing the Number or Size of InnoDB Log Files”</a>.
  </p><p>
    <code class="literal">InnoDB</code> is not aware of the file system maximum
    file size, so be cautious on file systems where the maximum file
    size is a small value such as 2GB. To specify a maximum size for an
    auto-extending data file, use the <code class="literal">max</code> attribute
    following the <code class="literal">autoextend</code> attribute. Use the
    <code class="literal">max</code> attribute only in cases where constraining
    disk usage is of critical importance, because exceeding the maximum
    size causes a fatal error, possibly including a crash. The following
    configuration permits <code class="filename">ibdata1</code> to grow up to a
    limit of 500MB:
  </p><pre class="programlisting">
[mysqld]
innodb_data_file_path=ibdata1:12M:autoextend:max:500M
</pre><p>
    <code class="literal">InnoDB</code> creates tablespace files in the MySQL data
    directory by default. To specify a location explicitly, use the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option. For
    example, to use two files named <code class="filename">ibdata1</code> and
    <code class="filename">ibdata2</code> but create them in the
    <code class="filename">/ibdata</code> directory, configure
    <code class="literal">InnoDB</code> like this:
  </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir = /ibdata
innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
      <code class="literal">InnoDB</code> does not create directories, so make
      sure that the <code class="filename">/ibdata</code> directory exists before
      you start the server. This is also true of any log file
      directories that you configure. Use the Unix or DOS
      <code class="literal">mkdir</code> command to create any necessary
      directories.
    </p><p>
      Make sure that the MySQL server has the proper access rights to
      create files in the data directory. More generally, the server
      must have access rights in any directory where it needs to create
      data files or log files.
</p>
</div>
<p>
    <code class="literal">InnoDB</code> forms the directory path for each data
    file by textually concatenating the value of
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to the data
    file name, adding a path name separator (slash or backslash) between
    values if necessary. If the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> option is not
    specified in <code class="filename">my.cnf</code> at all, the default value
    is the <span class="quote">“<span class="quote">dot</span>”</span> directory <code class="filename">./</code>, which
    means the MySQL data directory. (The MySQL server changes its
    current working directory to its data directory when it begins
    executing.)
  </p><p>
    If you specify <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a>
    as an empty string, you can specify absolute paths for the data
    files listed in the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> value. The
    following example is equivalent to the preceding one:
  </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir =
innodb_data_file_path=/ibdata/ibdata1:50M;/ibdata/ibdata2:50M:autoextend
</pre>
<h3><a name="idm140301496676384"></a>Specifying InnoDB Configuration Options</h3>
<p>
    <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
    small systems.</strong></span> Suppose that you have a computer with
    512MB RAM and one hard disk. The following example shows possible
    configuration parameters in <code class="filename">my.cnf</code> or
    <code class="filename">my.ini</code> for <code class="literal">InnoDB</code>, including
    the <code class="literal">autoextend</code> attribute. The example suits most
    users, both on Unix and Windows, who do not want to distribute
    <code class="literal">InnoDB</code> data files and log files onto several
    disks. It creates an auto-extending data file
    <code class="filename">ibdata1</code> and two <code class="literal">InnoDB</code> log
    files <code class="filename">ib_logfile0</code> and
    <code class="filename">ib_logfile1</code> in the MySQL data directory.
  </p><pre class="programlisting">
[mysqld]
# You can write your other MySQL server options here
# ...
# Data files must be able to hold your data and indexes.
# Make sure that you have enough free disk space.
innodb_data_file_path = ibdata1:12M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory
innodb_buffer_pool_size=256M
innodb_additional_mem_pool_size=20M
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=64M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
</pre><p>
    Note that data files must be less than 2GB in some file systems. The
    combined size of the log files must be less than 4GB. The combined
    size of data files must be at least slightly larger than 10MB.
</p>
<h3><a name="idm140301496664496"></a>Setting Up the InnoDB System Tablespace</h3>
<p>
    When you create an <code class="literal">InnoDB</code> system tablespace for
    the first time, it is best that you start the MySQL server from the
    command prompt. <code class="literal">InnoDB</code> then prints the
    information about the database creation to the screen, so you can
    see what is happening. For example, on Windows, if
    <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> is located in <code class="filename">C:\Program
    Files\MySQL\MySQL Server 5.5\bin</code>, you can
    start it like this:
  </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>"C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqld" --console</code></strong>
</pre><p>
    If you do not send server output to the screen, check the server's
    error log to see what <code class="literal">InnoDB</code> prints during the
    startup process.
</p>
<h3><a name="idm140301496657008"></a>Editing the MySQL Configuration File</h3>
<p>
    You can place <code class="literal">InnoDB</code> options in the
    <code class="literal">[mysqld]</code> group of any option file that your
    server reads when it starts. The locations for option files are
    described in <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>.
  </p><p>
    If you installed MySQL on Windows using the installation and
    configuration wizards, the option file will be the
    <code class="filename">my.ini</code> file located in your MySQL installation
    directory. See <a class="xref" href="installing.html#mysql-installer" title="2.3.3 Installing MySQL on Microsoft Windows Using MySQL Installer">Section 2.3.3, “Installing MySQL on Microsoft Windows Using MySQL Installer”</a>.
  </p><p>
    If your PC uses a boot loader where the <code class="filename">C:</code>
    drive is not the boot drive, your only option is to use the
    <code class="filename">my.ini</code> file in your Windows directory
    (typically <code class="filename">C:\WINDOWS</code>). You can use the
    <code class="literal">SET</code> command at the command prompt in a console
    window to print the value of <code class="literal">WINDIR</code>:
  </p><pre class="programlisting">
C:\&gt; <strong class="userinput"><code>SET WINDIR</code></strong>
windir=C:\WINDOWS
</pre><p>
    To make sure that <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> reads options only from
    a specific file, use the
    <a class="link" href="programs.html#option_general_defaults-file"><code class="option">--defaults-file</code></a> option as the first
    option on the command line when starting the server:
  </p><pre class="programlisting">
mysqld --defaults-file=<em class="replaceable"><code>your_path_to_my_cnf</code></em>
</pre><p>
    <span class="bold"><strong>Sample <code class="filename">my.cnf</code> file for
    large systems.</strong></span> Suppose that you have a Linux computer
    with 2GB RAM and three 60GB hard disks at directory paths
    <code class="filename">/</code>, <code class="filename">/dr2</code> and
    <code class="filename">/dr3</code>. The following example shows possible
    configuration parameters in <code class="filename">my.cnf</code> for
    <code class="literal">InnoDB</code>.
  </p><pre class="programlisting">
[mysqld]
# You can write your other MySQL server options here
# ...
innodb_data_home_dir =
#
# Data files must be able to hold your data and indexes
innodb_data_file_path = /db/ibdata1:2000M;/dr2/db/ibdata2:2000M:autoextend
#
# Set buffer pool size to 50-80% of your computer's memory,
# but make sure on Linux x86 total memory usage is &lt; 2GB
innodb_buffer_pool_size=1G
innodb_additional_mem_pool_size=20M
innodb_log_group_home_dir = /dr3/iblogs
#
# Set the log file size to about 25% of the buffer pool size
innodb_log_file_size=250M
innodb_log_buffer_size=8M
#
innodb_flush_log_at_trx_commit=1
innodb_lock_wait_timeout=50
#
# Uncomment the next line if you want to use it
#innodb_thread_concurrency=5
</pre>
<h3><a name="idm140301496633136"></a>Determining the Maximum Memory Allocation for InnoDB</h3>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
      On 32-bit GNU/Linux x86, be careful not to set memory usage too
      high. <code class="literal">glibc</code> may permit the process heap to grow
      over thread stacks, which crashes your server. It is a risk if the
      value of the following expression is close to or exceeds 2GB:
    </p><pre class="programlisting">
innodb_buffer_pool_size
+ key_buffer_size
+ max_connections*(sort_buffer_size+read_buffer_size+binlog_cache_size)
+ max_connections*2MB
</pre><p>
      Each thread uses a stack (often 2MB, but only 256KB in MySQL
      binaries provided by Oracle Corporation.) and in the worst case
      also uses <code class="literal">sort_buffer_size + read_buffer_size</code>
      additional memory.
</p>
</div>
<p>
    <span class="bold"><strong>Tuning other <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server
    parameters.</strong></span> The following values are typical and suit
    most users:
  </p><pre class="programlisting">
[mysqld]
skip-external-locking
max_connections=200
read_buffer_size=1M
sort_buffer_size=1M
#
# Set key_buffer to 5 - 50% of your RAM depending on how much
# you use MyISAM tables, but keep key_buffer_size + InnoDB
# buffer pool size &lt; 80% of your RAM
key_buffer_size=<em class="replaceable"><code>value</code></em>
</pre><p>
    On Linux, if the kernel is enabled for large page support,
    <code class="literal">InnoDB</code> can use large pages to allocate memory for
    its buffer pool and additional memory pool. See
    <a class="xref" href="optimization.html#large-page-support" title="8.11.4.2 Enabling Large Page Support">Section 8.11.4.2, “Enabling Large Page Support”</a>.
</p>
<h3><a name="idm140301496620976"></a>Turning Off InnoDB</h3>
<p>
    Oracle recommends InnoDB as the preferred storage engine for typical
    database applications, from single-user wikis and blogs running on a
    local system, to high-end applications pushing the limits of
    performance. In MySQL 5.5, InnoDB is the default
    storage engine for new tables.
  </p><p>
    If you do not want to use <code class="literal">InnoDB</code> tables, start
    the server with the
    <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a> or
    <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
    option to disable the <code class="literal">InnoDB</code> storage engine. In
    this case, because the default storage engine is
    <code class="literal">InnoDB</code>, the server will not start unless you also
    use <a class="link" href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> to set
    the default to some other engine.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-tablespace"></a>14.7 InnoDB Tablespace Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-resize-system-tablespace">14.7.1 Resizing the InnoDB System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-data-log-reconfiguration">14.7.2 Changing the Number or Size of InnoDB Log Files</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-raw-devices">14.7.3 Using Raw Disk Partitions for the System Tablespace</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-tablespaces">14.7.4 InnoDB File-Per-Table Tablespaces</a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-resize-system-tablespace"></a>14.7.1 Resizing the InnoDB System Tablespace</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496611360"></a><p>
      This section describes how to increase or decrease the size of the
      <code class="literal">InnoDB</code> system tablespace.
</p>
<h4><a name="idm140301496608688"></a>Increasing the Size of the InnoDB System Tablespace</h4>
<p>
      The easiest way to increase the size of the
      <code class="literal">InnoDB</code> system tablespace is to configure it
      from the beginning to be auto-extending. Specify the
      <code class="literal">autoextend</code> attribute for the last data file in
      the tablespace definition. Then <code class="literal">InnoDB</code>
      increases the size of that file automatically in 8MB increments
      when it runs out of space. The increment size can be changed by
      setting the value of the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
      system variable, which is measured in megabytes.
    </p><p>
      You can expand the system tablespace by a defined amount by adding
      another data file:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Shut down the MySQL server.
        </p></li><li class="listitem"><p>
          If the previous last data file is defined with the keyword
          <code class="literal">autoextend</code>, change its definition to use a
          fixed size, based on how large it has actually grown. Check
          the size of the data file, round it down to the closest
          multiple of 1024 × 1024 bytes (= 1MB), and specify this
          rounded size explicitly in
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li class="listitem"><p>
          Add a new data file to the end of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>,
          optionally making that file auto-extending. Only the last data
          file in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> can be
          specified as auto-extending.
        </p></li><li class="listitem"><p>
          Start the MySQL server again.
</p></li></ol>
</div>
<p>
      For example, this tablespace has just one auto-extending data file
      <code class="filename">ibdata1</code>:
    </p><pre class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:10M:autoextend
</pre><p>
      Suppose that this data file, over time, has grown to 988MB. Here
      is the configuration line after modifying the original data file
      to use a fixed size and adding a new auto-extending data file:
    </p><pre class="programlisting">
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
</pre><p>
      When you add a new data file to the system tablespace
      configuration, make sure that the filename does not refer to an
      existing file. <code class="literal">InnoDB</code> creates and initializes
      the file when you restart the server.
</p>
<h4><a name="idm140301496588144"></a>Decreasing the Size of the InnoDB System Tablespace</h4>
<p>
      Currently, you cannot remove a data file from the system
      tablespace. To decrease the system tablespace size, use this
      procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump all your
          <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p>
          Stop the server.
        </p></li><li class="listitem"><p>
          Remove all the existing tablespace files, including the
          <code class="filename">ibdata</code> and <code class="filename">ib_log</code>
          files. If you want to keep a backup copy of the information,
          then copy all the <code class="filename">ib*</code> files to another
          location before the removing the files in your MySQL
          installation.
        </p></li><li class="listitem"><p>
          Remove any <code class="filename">.frm</code> files for
          <code class="literal">InnoDB</code> tables.
        </p></li><li class="listitem"><p>
          Configure a new tablespace.
        </p></li><li class="listitem"><p>
          Restart the server.
        </p></li><li class="listitem"><p>
          Import the dump files.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-data-log-reconfiguration"></a>14.7.2 Changing the Number or Size of InnoDB Log Files</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496573088"></a><a class="indexterm" name="idm140301496571600"></a><p>
      To change the number or the size of your <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, perform the
      following steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          If <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
          set to 2, set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> to 1:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SET GLOBAL innodb_fast_shutdown = 1;</code></strong>
</pre></li><li class="listitem"><p>
          After ensuring that
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is not
          set to 2, stop the MySQL server and make sure that it shuts
          down without errors (to ensure that there is no information
          for outstanding transactions in the log).
        </p></li><li class="listitem"><p>
          Copy the old log files into a safe place in case something
          went wrong during the shutdown and you need them to recover
          the tablespace.
        </p></li><li class="listitem"><p>
          Delete the old log files from the log file directory.
        </p></li><li class="listitem"><p>
          Edit <code class="filename">my.cnf</code> to change the log file
          configuration.
        </p></li><li class="listitem"><p>
          Start the MySQL server again. <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> sees
          that no <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> log files exist at
          startup and creates new ones.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-raw-devices"></a>14.7.3 Using Raw Disk Partitions for the System Tablespace</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496552576"></a><a class="indexterm" name="idm140301496551120"></a><p>
      You can use raw disk partitions as data files in the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      This technique enables nonbuffered I/O on Windows and on some
      Linux and Unix systems without file system overhead. Perform tests
      with and without raw partitions to verify whether this change
      actually improves performance on your system.
    </p><p>
      When you use a raw disk partition, ensure that the user ID that
      runs the MySQL server has read and write privileges for that
      partition. For example, if you run the server as the
      <code class="literal">mysql</code> user, the partition must be readable and
      writeable by <code class="literal">mysql</code>. If you run the server with
      the <a class="link" href="server-administration.html#option_mysqld_memlock"><code class="option">--memlock</code></a> option, the server
      must be run as <code class="literal">root</code>, so the partition must be
      readable and writeable by <code class="literal">root</code>.
    </p><p>
      The procedures described below involve option file modification.
      For additional information, see <a class="xref" href="programs.html#option-files" title="4.2.6 Using Option Files">Section 4.2.6, “Using Option Files”</a>.
</p>
<h4><a name="idm140301496542032"></a>Allocating a Raw Disk Partition on Linux and Unix Systems</h4>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          When you create a new data file, specify the keyword
          <code class="literal">newraw</code> immediately after the data file size
          for the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option. The partition must be at least as large as the size
          that you specify. Note that 1MB in <code class="literal">InnoDB</code>
          is 1024 × 1024 bytes, whereas 1MB in disk specifications
          usually means 1,000,000 bytes.
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Gnewraw;/dev/hdd2:2Gnewraw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> notices the
          <code class="literal">newraw</code> keyword and initializes the new
          partition. However, do not create or change any
          <code class="literal">InnoDB</code> tables yet. Otherwise, when you next
          restart the server, <code class="literal">InnoDB</code> reinitializes
          the partition and your changes are lost. (As a safety measure
          <code class="literal">InnoDB</code> prevents users from modifying data
          when any partition with <code class="literal">newraw</code> is
          specified.)
        </p></li><li class="listitem"><p>
          After <code class="literal">InnoDB</code> has initialized the new
          partition, stop the server, change <code class="literal">newraw</code>
          in the data file specification to <code class="literal">raw</code>:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=/dev/hdd1:3Graw;/dev/hdd2:2Graw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> now permits
          changes to be made.
</p></li></ol>
</div>
<h4><a name="idm140301496524832"></a>Allocating a Raw Disk Partition on Windows</h4>
<p>
      On Windows systems, the same steps and accompanying guidelines
      described for Linux and Unix systems apply except that the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> setting
      differs slightly on Windows.
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          When you create a new data file, specify the keyword
          <code class="literal">newraw</code> immediately after the data file size
          for the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>
          option:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Gnewraw
</pre><p>
          The <code class="filename">//./</code> corresponds to the Windows
          syntax of <code class="filename">\\.\</code> for accessing physical
          drives. In the example above, <code class="literal">D:</code> is the
          drive letter of the partition.
        </p></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> notices the
          <code class="literal">newraw</code> keyword and initializes the new
          partition.
        </p></li><li class="listitem"><p>
          After <code class="literal">InnoDB</code> has initialized the new
          partition, stop the server, change <code class="literal">newraw</code>
          in the data file specification to <code class="literal">raw</code>:
        </p><pre class="programlisting">
[mysqld]
innodb_data_home_dir=
innodb_data_file_path=//./D::10Graw
</pre></li><li class="listitem"><p>
          Restart the server. <code class="literal">InnoDB</code> now permits
          changes to be made.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-multiple-tablespaces"></a>14.7.4 InnoDB File-Per-Table Tablespaces</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#tablespace-enabling">14.7.4.1 Enabling and Disabling File-Per-Table Tablespaces</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301496506048"></a><a class="indexterm" name="idm140301496504560"></a><a class="indexterm" name="idm140301496503488"></a><p>
      By default, all <code class="literal">InnoDB</code> tables and indexes are
      stored in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a>. As an alternative, you can store each
      <code class="literal">InnoDB</code> table and associated indexes in its own
      data file. This feature is called <span class="quote">“<span class="quote">file-per-table
      tablespaces</span>”</span> because each table has its own tablespace, and
      each tablespace has its own
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="literal">.ibd</code></a> data
      file. This feature is controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option.
</p>
<h4><a name="idm140301496496496"></a>Advantages of File-Per-Table Tablespaces</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You can reclaim disk space when truncating or dropping a table
          stored in a file-per-table tablepace. Truncating or dropping
          tables stored in the system tablespace creates free space
          internally in the system tablespace data files
          (<a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata files</a>) which
          can only be used for new <code class="literal">InnoDB</code> data.
        </p></li><li class="listitem"><p>
          The <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> operation is
          faster when run on tables stored in file-per-table tablepaces.
        </p></li><li class="listitem"><p>
          You can store specific tables on separate storage devices, for
          I/O optimization, space management, or backup purposes.
        </p></li><li class="listitem"><p>
          You can run <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> to
          compact or recreate a file-per-table tablespace. When you run
          an <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a>,
          <code class="literal">InnoDB</code> creates a new
          <code class="filename">.ibd</code> file with a temporary name, using
          only the space required to store actual data. When the
          optimization is complete, <code class="literal">InnoDB</code> removes
          the old <code class="filename">.ibd</code> file and replaces it with
          the new one. If the previous <code class="filename">.ibd</code> file
          grew significantly but the actual data only accounted for a
          portion of its size, running <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE
          TABLE</code></a> can reclaim the unused space.
        </p></li><li class="listitem"><p>
          You can move individual <code class="literal">InnoDB</code> tables
          rather than entire databases.
        </p></li><li class="listitem"><p>
          Tables created in file-per-table tablespaces use the
          <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format.
          The Barracuda file format enables features such as
          <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">compressed</a>
          and <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic</a> row
          formats. Tables created in the system tablespace cannot use
          these features. To take advantage of these features for an
          existing table, enable the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
          and run <code class="literal">ALTER TABLE <em class="replaceable"><code>t</code></em>
          ENGINE=INNODB</code> to place the table in a file-per-table
          tablespace. Before converting tables, refer to
          <a class="xref" href="innodb-storage-engine.html#converting-tables-to-innodb" title="14.8.4 Converting Tables from MyISAM to InnoDB">Section 14.8.4, “Converting Tables from MyISAM to InnoDB”</a>.
        </p></li><li class="listitem"><p>
          You can enable more efficient storage for tables with large
          <code class="literal">BLOB</code> or <code class="literal">TEXT</code> columns
          using the <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">dynamic row
          format</a>.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces may improve chances for a
          successful recovery and save time when a corruption occurs,
          when a server cannot be restarted, or when backup and binary
          logs are unavailable.
        </p></li><li class="listitem"><p>
          You can back up or restore individual tables quickly using the
          MySQL Enterprise Backup product, without interrupting the use
          of other <code class="literal">InnoDB</code> tables. This is beneficial
          if you have tables that require backup less frequently or on a
          different backup schedule. See
          <a class="ulink" href="http://dev.mysql.com/doc/mysql-enterprise-backup/3.12/en/backup-partial-options.html" target="_top">Partial Backup and Restore Options</a> for details.
        </p></li><li class="listitem"><p>
          File-per-table tablespaces are convenient for per-table status
          reporting when copying or backing up tables.
        </p></li><li class="listitem"><p>
          You can monitor table size at a file system level, without
          accessing MySQL.
        </p></li><li class="listitem"><p>
          Common Linux file systems do not permit concurrent writes to a
          single file when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a> is set to
          <code class="literal">O_DIRECT</code>. As a result, there are possible
          performance improvements when using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> in
          conjunction with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method"><code class="literal">innodb_flush_method</code></a>.
        </p></li><li class="listitem"><p>
          The system tablespace stores the data dictionary and undo
          logs, and has a 64TB size limit. By comparison, each
          file-per-table tablespace has a 64TB size limit, which
          provides you with room for growth. See
          <a class="xref" href="restrictions.html#table-size-limit" title="D.10.3 Limits on Table Size">Section D.10.3, “Limits on Table Size”</a> for related information.
</p></li></ul>
</div>
<h4><a name="idm140301496456048"></a>Potential Disadvantages of File-Per-Table Tablespaces</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          With file-per-table tablespaces, each table may have unused
          space, which can only be utilized by rows of the same table.
          This could lead to wasted space if not properly managed.
        </p></li><li class="listitem"><p>
          <code class="literal">fsync</code> operations must run on each open
          table rather than on a single file. Because there is a
          separate <code class="literal">fsync</code> operation for each file,
          write operations on multiple tables cannot be combined into a
          single I/O operation. This may require
          <code class="literal">InnoDB</code> to perform a higher total number of
          <code class="literal">fsync</code> operations.
        </p></li><li class="listitem"><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> must keep one open file handle per
          table, which may impact performance if you have numerous
          tables in file-per-table tablespaces.
        </p></li><li class="listitem"><p>
          More file descriptors are used.
        </p></li><li class="listitem"><p>
          If backward compatibility with MySQL 5.1 is a concern, be
          aware that enabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> means
          that an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation
          will move an <code class="literal">InnoDB</code> table from the system
          tablespace to an individual <code class="filename">.ibd</code> file in
          cases where <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          recreates the table (<code class="literal">ALTER OFFLINE</code>).
        </p><p>
          For example, when restructuring the clustered index for an
          <code class="literal">InnoDB</code> table, the table is re-created using
          the current setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. This
          behavior does not apply when adding or dropping
          <code class="literal">InnoDB</code> secondary indexes. When a secondary
          index is created without rebuilding the table, the index is
          stored in the same file as the table data, regardless of the
          current <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
          setting.
        </p></li><li class="listitem"><p>
          If many tables are growing there is potential for more
          fragmentation which can impede <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP
          TABLE</code></a> and table scan performance. However, when
          fragmentation is managed, having files in their own tablespace
          can improve performance.
        </p></li><li class="listitem"><p>
          The buffer pool is scanned when dropping a file-per-table
          tablespace, which can take several seconds for buffer pools
          that are tens of gigabytes in size. The scan is performed with
          a broad internal lock, which may delay other operations.
          Tables in the system tablespace are not affected.
        </p></li><li class="listitem"><p>
          The
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          variable, which defines increment size (in MB) for extending
          the size of an auto-extending shared tablespace file when it
          becomes full, does not apply to file-per-table tablespace
          files, which are auto-extending regardless of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>
          setting. The initial extensions are by small amounts, after
          which extensions occur in increments of 4MB.
</p></li></ul>
</div>
<h4><a name="idm140301496428208"></a>Enabling and Disabling File-Per-Table Tablespaces</h4>
<p>
      To enable file-per-table tablespaces, start the server with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a> option. For
      example, add a line to the <code class="literal">[mysqld]</code> section of
      <code class="filename">my.cnf</code>:
    </p><pre class="programlisting">
[mysqld]
innodb_file_per_table=1
</pre><p>
      With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      enabled, <code class="literal">InnoDB</code> stores each newly created table
      into its own
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.ibd</code> file
      in the database directory where the table belongs. This is similar
      to what the <code class="literal">MyISAM</code> storage engine does, but
      <code class="literal">MyISAM</code> divides the table into a
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code> data
      file and an
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code> index
      file. For <code class="literal">InnoDB</code>, the data and the indexes are
      stored together in the <code class="filename">.ibd</code> file. The
      <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code> file
      is still created as usual.
    </p><p>
      If you remove the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> line from
      <code class="filename">my.cnf</code> and restart the server, newly created
      <code class="literal">InnoDB</code> tables are created inside the shared
      tablespace files again.
    </p><p>
      To move a table from the system tablespace to its own tablespace,
      change the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      setting and rebuild the table:
    </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        <code class="literal">InnoDB</code> requires the shared tablespace to
        store its internal data dictionary and undo logs. The
        <code class="filename">.ibd</code> files alone are not sufficient for
        <code class="literal">InnoDB</code> to operate.
      </p><p>
        When a table is moved out of the system tablespace into its own
        <code class="filename">.ibd</code> file, the data files that make up the
        system tablespace remain the same size. The space formerly
        occupied by the table can be reused for new
        <code class="literal">InnoDB</code> data, but is not reclaimed for use by
        the operating system. When moving large
        <code class="literal">InnoDB</code> tables out of the system tablespace,
        where disk space is limited, you might prefer to turn on
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and then
        recreate the entire instance using the
        <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> command.
</p>
</div>
<h4><a name="idm140301496399488"></a>Portability Considerations for .ibd Files</h4>
<p>
      You cannot freely move <code class="filename">.ibd</code> files between
      database directories as you can with <code class="literal">MyISAM</code>
      table files. The table definition stored in the
      <code class="literal">InnoDB</code> shared tablespace includes the database
      name. The transaction IDs and log sequence numbers stored in the
      tablespace files also differ between databases.
    </p><p>
      To move an <code class="filename">.ibd</code> file and the associated table
      from one database to another, use a <a class="link" href="sql-syntax.html#rename-table" title="13.1.32 RENAME TABLE Syntax"><code class="literal">RENAME
      TABLE</code></a> statement:
    </p><pre class="programlisting">
RENAME TABLE <em class="replaceable"><code>db1.tbl_name</code></em> TO <em class="replaceable"><code>db2.tbl_name</code></em>;
</pre><a class="indexterm" name="idm140301496391904"></a><a class="indexterm" name="idm140301496390832"></a><p>
      

      If you have a <span class="quote">“<span class="quote">clean</span>”</span> backup of an
      <code class="filename">.ibd</code> file, you can restore it to the MySQL
      installation from which it originated as follows:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          The table must not have been dropped or truncated since you
          copied the <code class="filename">.ibd</code> file, because doing so
          changes the table ID stored inside the tablespace.
        </p></li><li class="listitem"><p>
          Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statement to delete the current <code class="filename">.ibd</code>
          file:
        </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> DISCARD TABLESPACE;
</pre></li><li class="listitem"><p>
          Copy the backup <code class="filename">.ibd</code> file to the proper
          database directory.
        </p></li><li class="listitem"><p>
          Issue this <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statement to tell <code class="literal">InnoDB</code> to use the new
          <code class="filename">.ibd</code> file for the table:
        </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> IMPORT TABLESPACE;
</pre></li></ol>
</div>
<p>
      In this context, a <span class="quote">“<span class="quote">clean</span>”</span> <code class="filename">.ibd</code>
      file backup is one for which the following requirements are
      satisfied:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          There are no uncommitted modifications by transactions in the
          <code class="filename">.ibd</code> file.
        </p></li><li class="listitem"><p>
          There are no unmerged insert buffer entries in the
          <code class="filename">.ibd</code> file.
        </p></li><li class="listitem"><p>
          Purge has removed all delete-marked index records from the
          <code class="filename">.ibd</code> file.
        </p></li><li class="listitem"><p>
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has flushed all modified pages of
          the <code class="filename">.ibd</code> file from the buffer pool to the
          file.
</p></li></ul>
</div>
<p>
      You can make a clean backup <code class="filename">.ibd</code> file using
      the following method:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Stop all activity from the <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server
          and commit all transactions.
        </p></li><li class="listitem"><p>
          Wait until <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW
          ENGINE INNODB STATUS</code></a> shows that there are no active
          transactions in the database, and the main thread status of
          <code class="literal">InnoDB</code> is <code class="literal">Waiting for server
          activity</code>. Then you can make a copy of the
          <code class="filename">.ibd</code> file.
</p></li></ol>
</div>
<p>
      Another method for making a clean copy of an
      <code class="filename">.ibd</code> file is to use the MySQL Enterprise
      Backup product:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Use MySQL Enterprise Backup to back up the
          <code class="literal">InnoDB</code> installation.
        </p></li><li class="listitem"><p>
          Start a second <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server on the backup
          and let it clean up the <code class="filename">.ibd</code> files in the
          backup.
</p></li></ol>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="tablespace-enabling"></a>14.7.4.1 Enabling and Disabling File-Per-Table Tablespaces</h4>

</div>

</div>

</div>
<p>
        To make file-per-table tablespaces the default for a MySQL
        server, start the server with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="option">--innodb_file_per_table</code></a>
        command-line option, or add this line to the
        <code class="literal">[mysqld]</code> section of
        <code class="filename">my.cnf</code>:
      </p><pre class="programlisting">
[mysqld]
innodb_file_per_table
</pre><p>
        You can also issue the command while the server is running:
      </p><pre class="programlisting">
SET GLOBAL innodb_file_per_table=1;
</pre><p>
        With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb-file-per-table</code></a>
        enabled, <code class="literal">InnoDB</code> stores each newly created
        table in its own
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.ibd</code>
        file in the appropriate database directory. Unlike the
        <code class="literal">MyISAM</code> storage engine, with its separate
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYD</code> and
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.MYI</code>
        files for indexes and data, <code class="literal">InnoDB</code> stores the
        data and the indexes together in a single
        <code class="filename">.ibd</code> file. The
        <code class="filename"><em class="replaceable"><code>tbl_name</code></em>.frm</code>
        file is still created as usual.
      </p><p>
        If you remove
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> from your
        startup options and restart the server, or turn it off with the
        <code class="literal">SET GLOBAL</code> command, <code class="literal">InnoDB</code>
        creates any new tables inside the system tablespace.
      </p><p>
        You can always read and write any <code class="literal">InnoDB</code>
        tables, regardless of the file-per-table setting.
      </p><p>
        To move a table from the system tablespace to its own
        tablespace, change the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> setting
        and rebuild the table:
      </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          <code class="literal">InnoDB</code> always needs the system tablespace
          because it puts its internal
          <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>
          and <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo logs</a> there. The
          <code class="filename">.ibd</code> files are not sufficient for
          <code class="literal">InnoDB</code> to operate.
        </p><p>
          When a table is moved out of the system tablespace into its
          own <code class="filename">.ibd</code> file, the data files that make
          up the system tablespace remain the same size. The space
          formerly occupied by the table can be reused for new
          <code class="literal">InnoDB</code> data, but is not reclaimed for use
          by the operating system. When moving large
          <code class="literal">InnoDB</code> tables out of the system tablespace,
          where disk space is limited, you might prefer to turn on
          <code class="literal">innodb_file_per_table</code> and then recreate the
          entire instance using the <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>
          command.
</p>
</div>

</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-tables"></a>14.8 InnoDB Table Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#using-innodb-tables">14.8.1 Creating InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-migration">14.8.2 Moving or Copying InnoDB Tables to Another Machine</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-transactions-with-different-apis">14.8.3 Grouping DML Operations with Transactions</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#converting-tables-to-innodb">14.8.4 Converting Tables from MyISAM to InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-handling">14.8.5 AUTO_INCREMENT Handling in InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-foreign-key-constraints">14.8.6 InnoDB and FOREIGN KEY Constraints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-restrictions">14.8.7 Limits on InnoDB Tables</a></span></dt></dl>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="using-innodb-tables"></a>14.8.1 Creating InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496314704"></a><p>
      To create an <code class="literal">InnoDB</code> table, specify an
      <code class="literal">ENGINE=InnoDB</code> option in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement:
    </p><pre class="programlisting">CREATE TABLE t1 (a INT, b CHAR (20), PRIMARY KEY (a)) ENGINE=InnoDB;</pre><p>
      An <code class="literal">InnoDB</code> table and its indexes can be created
      in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
      tablespace</a> or in a
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
      tablespace. When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is enabled,
      an <code class="literal">InnoDB</code> table is implicitly created in an
      individual file-per-table tablespace. Conversely, when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
      disabled, an <code class="literal">InnoDB</code> table is implicitly created
      in the system tablespace.
    </p><p>
      When you create an <code class="literal">InnoDB</code> table, MySQL creates
      a <a class="link" href="glossary.html#glos_frm_file" title=".frm file">.frm file</a> in a database
      directory under the MySQL data directory. For a table created in a
      file-per-table tablespace, an <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
      file</a> is also created. A table created in the system
      tablespace is created in the existing system tablespace
      <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">ibdata files</a>.
    </p><p>
      Internally, <code class="literal">InnoDB</code> adds an entry for each table
      to the <code class="literal">InnoDB</code> data dictionary. The entry
      includes the database name. For example, if table
      <code class="literal">t1</code> is created in the <code class="literal">test</code>
      database, the data dictionary entry is
      <code class="literal">'test/t1'</code>. This means you can create a table of
      the same name (<code class="literal">t1</code>) in a different database, and
      the table names do not collide inside <code class="literal">InnoDB</code>.
</p>
<h4><a name="idm140301496292912"></a>Viewing the Properties of InnoDB Tables</h4>
<p>
      To view the properties of <code class="literal">InnoDB</code> tables, issue
      a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement:
    </p><pre class="programlisting">mysql&gt; SHOW TABLE STATUS FROM test LIKE 't%' \G;
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 0
      Data_free: 41943040
 Auto_increment: NULL
    Create_time: 2015-03-16 16:42:17
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment: 
1 row in set (0.00 sec)</pre><p>
      In the status output, you see the
      <a class="link" href="glossary.html#glos_row_format" title="row format">Row format</a> property of
      table <code class="literal">t1</code> is <code class="literal">Compact</code>.
      Although that setting is fine for basic experimentation, consider
      using the
      <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">Dynamic</a></code>
      or
      <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">Compressed</a></code>
      row format to take advantage of <code class="literal">InnoDB</code> features
      such as table compression and off-page storage for long column
      values. Using these row formats requires that
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is enabled
      and that <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is
      set to <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>:
    </p><pre class="programlisting">SET GLOBAL innodb_file_per_table=1;
SET GLOBAL innodb_file_format=barracuda;
CREATE TABLE t3 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=DYNAMIC;
CREATE TABLE t4 (a INT, b CHAR (20), PRIMARY KEY (a)) ROW_FORMAT=COMPRESSED;</pre>
<h4><a name="idm140301496277440"></a>Defining a Primary Key for InnoDB Tables</h4>
<p>
      Always set up a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
      key</a> for each <code class="literal">InnoDB</code> table, specifying
      the column or columns that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Are referenced by the most important queries.
        </p></li><li class="listitem"><p>
          Are never left blank.
        </p></li><li class="listitem"><p>
          Never have duplicate values.
        </p></li><li class="listitem"><p>
          Rarely if ever change value once inserted.
</p></li></ul>
</div>
<p>
      For example, in a table containing information about people, you
      would not create a primary key on <code class="literal">(firstname,
      lastname)</code> because more than one person can have the same
      name, some people have blank last names, and sometimes people
      change their names. With so many constraints, often there is not
      an obvious set of columns to use as a primary key, so you create a
      new column with a numeric ID to serve as all or part of the
      primary key. You can declare an
      <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a> column
      so that ascending values are filled in automatically as rows are
      inserted:
    </p><pre class="programlisting">
-- The value of ID can act like a pointer between related items in different tables.
CREATE TABLE t5 (id INT AUTO_INCREMENT, b CHAR (20), PRIMARY KEY (id));
-- The primary key can consist of more than one column. Any autoinc column must come first.
CREATE TABLE t6 (id INT AUTO_INCREMENT, a INT, b CHAR (20), PRIMARY KEY (id,a));
</pre><p>
      Although the table works correctly without defining a primary key,
      the primary key is involved with many aspects of performance and
      is a crucial design aspect for any large or frequently used table.
      It is recommended that you always specify a primary key in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. If you
      create the table, load data, and then run
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add a primary key
      later, that operation is much slower than defining the primary key
      when creating the table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-migration"></a>14.8.2 Moving or Copying InnoDB Tables to Another Machine</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496262736"></a><p>
    This section describes techniques for moving or copying some or all
    <code class="literal">InnoDB</code> tables to a different server. For example,
    you might move an entire MySQL instance to a larger, faster server;
    you might clone an entire MySQL instance to a new replication slave
    server; you might copy individual tables to another server to
    develop and test an application, or to a data warehouse server to
    produce reports.
  </p><p>
    Techniques for moving or copying <code class="literal">InnoDB</code> tables
    include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-cold-backup" title="Copying Data Files (Cold Backup Method)">Copying Data Files (Cold Backup Method)</a>
      </p></li><li class="listitem"><p>
        <a class="xref" href="innodb-storage-engine.html#copy-tables-export-import" title="Export and Import (mysqldump)">Export and Import (mysqldump)</a>
</p></li></ul>
</div>
<h4><a name="idm140301496254224"></a>Using Lowercase Names for Cross-Platform Moving or Copying</h4>
<p>
    On Windows, <code class="literal">InnoDB</code> always stores database and
    table names internally in lowercase. To move databases in a binary
    format from Unix to Windows or from Windows to Unix, create all
    databases and tables using lowercase names. A convenient way to
    accomplish this is to add the following line to the
    <code class="literal">[mysqld]</code> section of your
    <code class="filename">my.cnf</code> or <code class="filename">my.ini</code> file
    before creating any databases or tables:
  </p><pre class="programlisting">
[mysqld]
lower_case_table_names=1
</pre>
<h4><a name="copy-tables-cold-backup"></a>Copying Data Files (Cold Backup Method)</h4>
<p>
    You can move an <code class="literal">InnoDB</code> database simply by copying
    all the relevant files listed under "Cold Backups" in
    <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="14.18 InnoDB Backup and Recovery">Section 14.18, “InnoDB Backup and Recovery”</a>.
  </p><p>
    Like <code class="literal">MyISAM</code> data files, <code class="literal">InnoDB</code>
    data and log files are binary-compatible on all platforms having the
    same floating-point number format. If the floating-point formats
    differ but you have not used <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">FLOAT</code></a> or
    <a class="link" href="data-types.html#floating-point-types" title="11.2.3 Floating-Point Types (Approximate Value) - FLOAT, DOUBLE"><code class="literal">DOUBLE</code></a> data types in your tables,
    then the procedure is the same: simply copy the relevant files.
</p>
<h4><a name="copy-tables-export-import"></a>Export and Import (mysqldump)</h4>
<p>
    You can use <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump your tables on one
    machine and then import the dump files on the other machine. Using
    this method, it does not matter whether the formats differ or if
    your tables contain floating-point data.
  </p><p>
    One way to increase the performance of this method is to switch off
    <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode when
    importing data, assuming that the tablespace has enough space for
    the big rollback segment that the import transactions generate. Do
    the commit only after importing a whole table or a segment of a
    table.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-transactions-with-different-apis"></a>14.8.3 Grouping DML Operations with Transactions</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496235632"></a><p>
      By default, connection to the MySQL server begins with
      <a class="link" href="glossary.html#glos_autocommit" title="autocommit">autocommit</a> mode enabled,
      which automatically commits every SQL statement as you execute it.
      This mode of operation might be unfamiliar if you have experience
      with other database systems, where it is standard practice to
      issue a sequence of <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> statements
      and commit them or roll them back all together.
    </p><p>
      To use multiple-statement
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, switch
      autocommit off with the SQL statement <code class="literal">SET autocommit =
      0</code> and end each transaction with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> as
      appropriate. To leave autocommit on, begin each transaction with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
      TRANSACTION</code></a> and end it with
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>. The
      following example shows two transactions. The first is committed;
      the second is rolled back.
    </p><pre class="programlisting">
shell&gt; <strong class="userinput"><code>mysql test</code></strong>

mysql&gt; <strong class="userinput"><code>CREATE TABLE customer (a INT, b CHAR (20), INDEX (a))</code></strong>
    -&gt; <strong class="userinput"><code>ENGINE=InnoDB;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do a transaction with autocommit turned on.</code></strong>
mysql&gt; <strong class="userinput"><code>START TRANSACTION;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (10, 'Heikki');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>COMMIT;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Do another transaction with autocommit turned off.</code></strong>
mysql&gt; <strong class="userinput"><code>SET autocommit=0;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (15, 'John');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>INSERT INTO customer VALUES (20, 'Paul');</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>DELETE FROM customer WHERE b = 'Heikki';</code></strong>
Query OK, 1 row affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>-- Now we undo those last 2 inserts and the delete.</code></strong>
mysql&gt; <strong class="userinput"><code>ROLLBACK;</code></strong>
Query OK, 0 rows affected (0.00 sec)
mysql&gt; <strong class="userinput"><code>SELECT * FROM customer;</code></strong>
+------+--------+
| a    | b      |
+------+--------+
|   10 | Heikki |
+------+--------+
1 row in set (0.00 sec)
mysql&gt;
</pre>
<h4><a name="idm140301496209200"></a>Transactions in Client-Side Languages</h4>
<p>
      In APIs such as PHP, Perl DBI, JDBC, ODBC, or the standard C call
      interface of MySQL, you can send transaction control statements
      such as <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> to the MySQL server
      as strings just like any other SQL statements such as
      <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> or
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>. Some APIs also offer
      separate special transaction commit and rollback functions or
      methods.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="converting-tables-to-innodb"></a>14.8.4 Converting Tables from MyISAM to InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301496202784"></a><a class="indexterm" name="idm140301496200864"></a><p>
    If you have existing tables, and applications that use them, that
    you want to convert to <code class="literal">InnoDB</code> for better
    reliability and scalability, use the following guidelines and tips.
    This section assumes most such tables were originally
    <code class="literal">MyISAM</code>, which was formerly the default.
</p>
<h4><a name="innodb-convert-memory-usage"></a>Reduce Memory Usage for MyISAM, Increase Memory Usage for InnoDB</h4>
<p>
    As you transition away from <code class="literal">MyISAM</code> tables, lower
    the value of the <a class="link" href="server-administration.html#sysvar_key_buffer_size"><code class="literal">key_buffer_size</code></a>
    configuration option to free memory no longer needed for caching
    results. Increase the value of the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
    configuration option, which performs a similar role of allocating
    cache memory for <code class="literal">InnoDB</code> tables. The
    <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
    pool</a> caches both table data and index data, so it does double
    duty in speeding up lookups for queries and keeping query results in
    memory for reuse.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Allocate as much memory to this option as you can afford, often
        up to 80% of physical memory on the server.
      </p></li><li class="listitem"><p>
        If the operating system runs short of memory for other processes
        and begins to swap, reduce the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
        Swapping is such an expensive operation that it drastically
        reduces the benefit of the cache memory.
      </p></li><li class="listitem"><p>
        If the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
        value is several gigabytes or higher, consider increasing the
        values of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>.
        Doing so helps on busy servers where many connections are
        reading data into the cache at the same time.
      </p></li><li class="listitem"><p>
        On a busy server, run benchmarks with the Query Cache turned
        off. The <code class="literal">InnoDB</code> buffer pool provides similar
        benefits, so the Query Cache might be tying up memory
        unnecessarily.
</p></li></ul>
</div>
<h4><a name="innodb-convert-transactions"></a>Watch Out for Too-Long Or Too-Short Transactions</h4>
<p>
    Because <code class="literal">MyISAM</code> tables do not support
    <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>, you might not
    have paid much attention to the
    <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit</code></a> configuration option and
    the <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
    <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
    statements. These keywords are important to allow multiple sessions
    to read and write <code class="literal">InnoDB</code> tables concurrently,
    providing substantial scalability benefits in write-heavy workloads.
  </p><p>
    While a transaction is open, the system keeps a snapshot of the data
    as seen at the beginning of the transaction, which can cause
    substantial overhead if the system inserts, updates, and deletes
    millions of rows while a stray transaction keeps running. Thus, take
    care to avoid transactions that run for too long:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If you are using a <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session for
        interactive experiments, always
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> (to finalize the changes)
        or <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        (to undo the changes) when finished. Close down interactive
        sessions rather than leaving them open for long periods, to
        avoid keeping transactions open for long periods by accident.
      </p></li><li class="listitem"><p>
        Make sure that any error handlers in your application also
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        incomplete changes or <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>
        completed changes.
      </p></li><li class="listitem"><p>
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> is a
        relatively expensive operation, because
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations are written to
        <code class="literal">InnoDB</code> tables prior to the
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, with the expectation that
        most changes will be committed successfully and rollbacks will
        be rare. When experimenting with large volumes of data, avoid
        making changes to large numbers of rows and then rolling back
        those changes.
      </p></li><li class="listitem"><p>
        When loading large volumes of data with a sequence of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, periodically
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> the results to avoid
        having transactions that last for hours. In typical load
        operations for data warehousing, if something goes wrong, you
        <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a> and start over
        from the beginning rather than doing a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>.
</p></li></ul>
</div>
<p>
    The preceding tips save memory and disk space that can be wasted
    during too-long transactions. When transactions are shorter than
    they should be, the problem is excessive I/O. With each
    <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>, MySQL makes sure each change
    is safely recorded to disk, which involves some I/O.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        For most operations on <code class="literal">InnoDB</code> tables, you
        should use the setting
        <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=0</code></a>. From an
        efficiency perspective, this avoids unnecessary I/O when you
        issue large numbers of consecutive
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
        <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements. From a safety
        perspective, this allows you to issue a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>
        statement to recover lost or garbled data if you make a mistake
        on the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> command line, or in an exception
        handler in your application.
      </p></li><li class="listitem"><p>
        The time when <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> is
        suitable for <code class="literal">InnoDB</code> tables is when running a
        sequence of queries for generating reports or analyzing
        statistics. In this situation, there is no I/O penalty related
        to <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, and
        <code class="literal">InnoDB</code> can
        <a class="ulink" href="http://dev.mysql.com/doc/refman/5.6/en/innodb-performance-ro-txn.html" target="_top">automatically optimize
        the read-only workload</a>.
      </p></li><li class="listitem"><p>
        If you make a series of related changes, finalize all those
        changes at once with a single
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> at the end. For example,
        if you insert related pieces of information into several tables,
        do a single <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> after making
        all the changes. Or if you run many consecutive
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, do a single
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> after all the data is
        loaded; if you are doing millions of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements, perhaps split
        up the huge transaction by issuing a
        <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> every ten thousand or
        hundred thousand records, so the transaction does not grow too
        large.
      </p></li><li class="listitem"><p>
        Remember that even a <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>
        statement opens a transaction, so after running some report or
        debugging queries in an interactive <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
        session, either issue a <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> or
        close the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> session.
</p></li></ul>
</div>
<h4><a name="innodb-convert-deadlock"></a>Don't Worry Too Much About Deadlocks</h4>
<p>
    You might see warning messages referring to <span class="quote">“<span class="quote">deadlocks</span>”</span>
    in the MySQL error log, or the output of
    <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
    STATUS</code></a>. Despite the scary-sounding name, a
    <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a> is not a serious issue
    for <code class="literal">InnoDB</code> tables, and often does not require any
    corrective action. When two transactions start modifying multiple
    tables, accessing the tables in a different order, they can reach a
    state where each transaction is waiting for the other and neither
    can proceed. MySQL immediately detects this condition and cancels
    (<a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a>) the
    <span class="quote">“<span class="quote">smaller</span>”</span> transaction, allowing the other to proceed.
  </p><p>
    Your applications do need error-handling logic to restart a
    transaction that is forcibly cancelled like this. When you re-issue
    the same SQL statements as before, the original timing issue no
    longer applies: either the other transaction has already finished
    and yours can proceed, or the other transaction is still in progress
    and your transaction waits until it finishes.
  </p><p>
    If deadlock warnings occur constantly, you might review the
    application code to reorder the SQL operations in a consistent way,
    or to shorten the transactions.
</p>
<h4><a name="innodb-convert-plan-storage"></a>Plan the Storage Layout</h4>
<p>
    To get the best performance from <code class="literal">InnoDB</code> tables,
    you can adjust a number of parameters related to storage layout.
  </p><p>
    When you convert <code class="literal">MyISAM</code> tables that are large,
    frequently accessed, and hold vital data, investigate and consider
    the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
    options, and the
    <a class="link" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats"><code class="literal">ROW_FORMAT</code> and
    <code class="literal">KEY_BLOCK_SIZE</code> clauses</a> of the
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement.
  </p><p>
    During your initial experiments, the most important setting is
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>. When this
    setting is enabled, new <code class="literal">InnoDB</code> tables are
    implicitly created in
    <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
    tablespaces. In contrast with the <code class="literal">InnoDB</code> system
    tablespace, file-per-table tablespaces allow disk space to be
    reclaimed by the operating system when a table is truncated or
    dropped. File-per-table tablespaces also support the
    <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format and
    associated features such as table compression and off-page storage
    for long variable-length columns. For more information, see
    <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.7.4 InnoDB File-Per-Table Tablespaces">Section 14.7.4, “InnoDB File-Per-Table Tablespaces”</a>.
</p>
<h4><a name="innodb-convert-convert"></a>Converting an Existing Table</h4>
<p>
    To convert a non-<code class="literal">InnoDB</code> table to use
    <code class="literal">InnoDB</code> use <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER
    TABLE</code></a>:
  </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>table_name</code></em> ENGINE=InnoDB;
</pre>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Important
</div>
<p>
      Do not convert MySQL system tables in the <code class="literal">mysql</code>
      database (such as <code class="literal">user</code> or
      <code class="literal">host</code>) to the <code class="literal">InnoDB</code> type.
      This is an unsupported operation. The system tables must always be
      of the <code class="literal">MyISAM</code> type.
</p>
</div>
<h4><a name="innodb-convert-clone"></a>Cloning the Structure of a Table</h4>
<p>
    You might make an InnoDB table that is a clone of a MyISAM table,
    rather than doing the <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
    conversion, to test the old and new table side-by-side before
    switching.
  </p><p>
    Create an empty <code class="literal">InnoDB</code> table with identical
    column and index definitions. Use <code class="literal">show create table
    <em class="replaceable"><code>table_name</code></em>\G</code> to see the full
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to use. Change
    the <code class="literal">ENGINE</code> clause to
    <code class="literal">ENGINE=INNODB</code>.
</p>
<h4><a name="innodb-convert-transfer"></a>Transferring Existing Data</h4>
<p>
    To transfer a large volume of data into an empty
    <code class="literal">InnoDB</code> table created as shown in the previous
    section, insert the rows with <code class="literal">INSERT INTO
    <em class="replaceable"><code>innodb_table</code></em> SELECT * FROM
    <em class="replaceable"><code>myisam_table</code></em> ORDER BY
    <em class="replaceable"><code>primary_key_columns</code></em></code>.
  </p><p>
    You can also create the indexes for the <code class="literal">InnoDB</code>
    table after inserting the data. Historically, creating new secondary
    indexes was a slow operation for InnoDB, but now you can create the
    indexes after the data is loaded with relatively little overhead
    from the index creation step.
  </p><p>
    If you have <code class="literal">UNIQUE</code> constraints on secondary keys,
    you can speed up a table import by turning off the uniqueness checks
    temporarily during the import operation:
  </p><pre class="programlisting">
SET unique_checks=0;
<em class="replaceable"><code>... import operation ...</code></em>
SET unique_checks=1;
</pre><p>
    For big tables, this saves disk I/O because
    <code class="literal">InnoDB</code> can use its
    <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a> to write
    secondary index records as a batch. Be certain that the data
    contains no duplicate keys.
    <a class="link" href="server-administration.html#sysvar_unique_checks"><code class="literal">unique_checks</code></a> permits but does not
    require storage engines to ignore duplicate keys.
  </p><p>
    To get better control over the insertion process, you might insert
    big tables in pieces:
  </p><pre class="programlisting">
INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey &gt; <em class="replaceable"><code>something</code></em> AND yourkey &lt;= <em class="replaceable"><code>somethingelse</code></em>;
</pre><p>
    After all records have been inserted, you can rename the tables.
  </p><p>
    During the conversion of big tables, increase the size of the
    <code class="literal">InnoDB</code> buffer pool to reduce disk I/O, to a
    maximum of 80% of physical memory. You can also increase the sizes
    of the <code class="literal">InnoDB</code> log files.
</p>
<h4><a name="innodb-convert-plan-storage-2"></a>Storage Requirements</h4>
<p>
    If you intend to make several temporary copies of your data in
    <code class="literal">InnoDB</code> tables during the conversion process, it
    is recommended that you create the tables in file-per-table
    tablespaces so that you can reclaim the disk space when you drop the
    tables. As mentioned previously, when the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    enabled, newly created <code class="literal">InnoDB</code> tables are
    implicitly created in file-per-table tablespaces.
  </p><p>
    Whether you convert the <code class="literal">MyISAM</code> table directly or
    create a cloned <code class="literal">InnoDB</code> table, make sure that you
    have sufficient disk space to hold both the old and new tables
    during the process. <code class="literal">InnoDB</code> tables require more
    disk space than <code class="literal">MyISAM</code> tables. If an
    <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation runs out of
    space, it starts a rollback, and that can take hours if it is
    disk-bound. For inserts, <code class="literal">InnoDB</code> uses the insert
    buffer to merge secondary index records to indexes in batches. That
    saves a lot of disk I/O. For rollback, no such mechanism is used,
    and the rollback can take 30 times longer than the insertion.
  </p><p>
    In the case of a runaway rollback, if you do not have valuable data
    in your database, it may be advisable to kill the database process
    rather than wait for millions of disk I/O operations to complete.
    For the complete procedure, see
    <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a>.
</p>
<h4><a name="innodb-convert-primary-key"></a>Carefully Choose a PRIMARY KEY for Each Table</h4>
<p>
    The <code class="literal">PRIMARY KEY</code> clause is a critical factor
    affecting the performance of MySQL queries and the space usage for
    tables and indexes. Perhaps you have phoned a financial institution
    where you are asked for an account number. If you do not have the
    number, you are asked for a dozen different pieces of information to
    <span class="quote">“<span class="quote">uniquely identify</span>”</span> yourself. The primary key is like
    that unique account number that lets you get straight down to
    business when querying or modifying the information in a table.
    Every row in the table must have a primary key value, and no two
    rows can have the same primary key value.
  </p><p>
    Here are some guidelines for the primary key, followed by more
    detailed explanations.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Declare a <code class="literal">PRIMARY KEY</code> for each table.
        Typically, it is the most important column that you refer to in
        <code class="literal">WHERE</code> clauses when looking up a single row.
      </p></li><li class="listitem"><p>
        Declare the <code class="literal">PRIMARY KEY</code> clause in the
        original <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement,
        rather than adding it later through an
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
      </p></li><li class="listitem"><p>
        Choose the column and its data type carefully. Prefer numeric
        columns over character or string ones.
      </p></li><li class="listitem"><p>
        Consider using an auto-increment column if there is not another
        stable, unique, non-null, numeric column to use.
      </p></li><li class="listitem"><p>
        An auto-increment column is also a good choice if there is any
        doubt whether the value of the primary key column could ever
        change. Changing the value of a primary key column is an
        expensive operation, possibly involving rearranging data within
        the table and within each secondary index.
</p></li></ul>
</div>
<p>
    Consider adding a <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
    key</a> to any table that does not already have one. Use the
    smallest practical numeric type based on the maximum projected size
    of the table. This can make each row slightly more compact, which
    can yield substantial space savings for large tables. The space
    savings are multiplied if the table has any
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
    because the primary key value is repeated in each secondary index
    entry. In addition to reducing data size on disk, a small primary
    key also lets more data fit into the
    <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, speeding up all
    kinds of operations and improving concurrency.
  </p><p>
    If the table already has a primary key on some longer column, such
    as a <code class="literal">VARCHAR</code>, consider adding a new unsigned
    <code class="literal">AUTO_INCREMENT</code> column and switching the primary
    key to that, even if that column is not referenced in queries. This
    design change can produce substantial space savings in the secondary
    indexes. You can designate the former primary key columns as
    <code class="literal">UNIQUE NOT NULL</code> to enforce the same constraints
    as the <code class="literal">PRIMARY KEY</code> clause, that is, to prevent
    duplicate or null values across all those columns.
  </p><p>
    If you spread related information across multiple tables, typically
    each table uses the same column for its primary key. For example, a
    personnel database might have several tables, each with a primary
    key of employee number. A sales database might have some tables with
    a primary key of customer number, and other tables with a primary
    key of order number. Because lookups using the primary key are very
    fast, you can construct efficient join queries for such tables.
  </p><p>
    If you leave the <code class="literal">PRIMARY KEY</code> clause out entirely,
    MySQL creates an invisible one for you. It is a 6-byte value that
    might be longer than you need, thus wasting space. Because it is
    hidden, you cannot refer to it in queries.
</p>
<h4><a name="innodb-convert-application-performance"></a>Application Performance Considerations</h4>
<p>
    The extra reliability and scalability features of
    <code class="literal">InnoDB</code> do require more disk storage than
    equivalent <code class="literal">MyISAM</code> tables. You might change the
    column and index definitions slightly, for better space utilization,
    reduced I/O and memory consumption when processing result sets, and
    better query optimization plans making efficient use of index
    lookups.
  </p><p>
    If you do set up a numeric ID column for the primary key, use that
    value to cross-reference with related values in any other tables,
    particularly for <a class="link" href="glossary.html#glos_join" title="join">join</a> queries. For
    example, rather than accepting a country name as input and doing
    queries searching for the same name, do one lookup to determine the
    country ID, then do other queries (or a single join query) to look
    up relevant information across several tables. Rather than storing a
    customer or catalog item number as a string of digits, potentially
    using up several bytes, convert it to a numeric ID for storing and
    querying. A 4-byte unsigned <a class="link" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT"><code class="literal">INT</code></a>
    column can index over 4 billion items (with the US meaning of
    billion: 1000 million). For the ranges of the different integer
    types, see <a class="xref" href="data-types.html#integer-types" title="11.2.1 Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT, MEDIUMINT, BIGINT">Section 11.2.1, “Integer Types (Exact Value) - INTEGER, INT, SMALLINT, TINYINT,
        MEDIUMINT, BIGINT”</a>.
</p>
<h4><a name="innodb-convert-understand-files"></a>Understand Files Associated with InnoDB Tables</h4>
<p>
    <code class="literal">InnoDB</code> files require more care and planning than
    <code class="literal">MyISAM</code> files do.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        You must not delete the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
        files</a> that represent the <code class="literal">InnoDB</code>
        <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      </p></li><li class="listitem"><p>
        Methods of copying or moving <code class="literal">InnoDB</code> tables to
        a different server are described in
        <a class="xref" href="innodb-storage-engine.html#innodb-migration" title="14.8.2 Moving or Copying InnoDB Tables to Another Machine">Section 14.8.2, “Moving or Copying InnoDB Tables to Another Machine”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-auto-increment-handling"></a>14.8.5 AUTO_INCREMENT Handling in InnoDB</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-traditional">14.8.5.1 Traditional InnoDB Auto-Increment Locking</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-auto-increment-configurable">14.8.5.2 Configurable InnoDB Auto-Increment Locking</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301496007024"></a><p>
      <code class="literal">InnoDB</code> provides an optimization that
      significantly improves scalability and performance of SQL
      statements that insert rows into tables with
      <code class="literal">AUTO_INCREMENT</code> columns. To use the
      <code class="literal">AUTO_INCREMENT</code> mechanism with an
      <code class="literal">InnoDB</code> table, an
      <code class="literal">AUTO_INCREMENT</code> column
      <em class="replaceable"><code>ai_col</code></em> must be defined as part of an
      index such that it is possible to perform the equivalent of an
      indexed <code class="literal">SELECT
      MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
      table to obtain the maximum column value. Typically, this is
      achieved by making the column the first column of some table
      index.
    </p><p>
      This section provides background information on the original
      (<span class="quote">“<span class="quote">traditional</span>”</span>) implementation of auto-increment
      locking in <code class="literal">InnoDB</code>, explains the configurable
      locking mechanism, documents the parameter for configuring the
      mechanism, and describes its behavior and interaction with
      replication.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-auto-increment-traditional"></a>14.8.5.1 Traditional InnoDB Auto-Increment Locking</h4>
</div>
</div>
</div>
<p>
        The original implementation of auto-increment handling in
        <code class="literal">InnoDB</code> uses the following strategy to prevent
        problems when using the binary log for statement-based
        replication or for certain recovery scenarios.
      </p><p>
        If you specify an <code class="literal">AUTO_INCREMENT</code> column for
        an <code class="literal">InnoDB</code> table, the table handle in the
        <code class="literal">InnoDB</code> data dictionary contains a special
        counter called the auto-increment counter that is used in
        assigning new values for the column. This counter is stored only
        in main memory, not on disk.
      </p><p>
        <code class="literal">InnoDB</code> uses the following algorithm to
        initialize the auto-increment counter for a table
        <code class="literal">t</code> that contains an
        <code class="literal">AUTO_INCREMENT</code> column named
        <code class="literal">ai_col</code>: After a server startup, for the first
        insert into a table <code class="literal">t</code>,
        <code class="literal">InnoDB</code> executes the equivalent of this
        statement:
      </p><pre class="programlisting">
SELECT MAX(ai_col) FROM t FOR UPDATE;
</pre><p>
        <code class="literal">InnoDB</code> increments the value retrieved by the
        statement and assigns it to the column and to the auto-increment
        counter for the table. By default, the value is incremented by
        one. This default can be overridden by the
        <a class="link" href="replication.html#sysvar_auto_increment_increment"><code class="literal">auto_increment_increment</code></a>
        configuration setting.
      </p><p>
        If the table is empty, <code class="literal">InnoDB</code> uses the value
        <code class="literal">1</code>. This default can be overridden by the
        <a class="link" href="replication.html#sysvar_auto_increment_offset"><code class="literal">auto_increment_offset</code></a>
        configuration setting.
      </p><p>
        If a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement
        examines the table <code class="literal">t</code> before the
        auto-increment counter is initialized, <code class="literal">InnoDB</code>
        initializes but does not increment the value and stores it for
        use by later inserts. This initialization uses a normal
        exclusive-locking read on the table and the lock lasts to the
        end of the transaction.
      </p><p>
        <code class="literal">InnoDB</code> follows the same procedure for
        initializing the auto-increment counter for a freshly created
        table.
      </p><p>
        After the auto-increment counter has been initialized, if you do
        not explicitly specify a value for an
        <code class="literal">AUTO_INCREMENT</code> column,
        <code class="literal">InnoDB</code> increments the counter and assigns the
        new value to the column. If you insert a row that explicitly
        specifies the column value, and the value is bigger than the
        current counter value, the counter is set to the specified
        column value.
      </p><p>
        If a user specifies <code class="literal">NULL</code> or
        <code class="literal">0</code> for the <code class="literal">AUTO_INCREMENT</code>
        column in an <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
        <code class="literal">InnoDB</code> treats the row as if the value was not
        specified and generates a new value for it.
      </p><p>
        The behavior of the auto-increment mechanism is not defined if
        you assign a negative value to the column, or if the value
        becomes bigger than the maximum integer that can be stored in
        the specified integer type.
      </p><p>
        When accessing the auto-increment counter,
        <code class="literal">InnoDB</code> uses a special table-level
        <code class="literal">AUTO-INC</code> lock that it keeps to the end of the
        current SQL statement, not to the end of the transaction. The
        special lock release strategy was introduced to improve
        concurrency for inserts into a table containing an
        <code class="literal">AUTO_INCREMENT</code> column. Nevertheless, two
        transactions cannot have the <code class="literal">AUTO-INC</code> lock on
        the same table simultaneously, which can have a performance
        impact if the <code class="literal">AUTO-INC</code> lock is held for a
        long time. That might be the case for a statement such as
        <code class="literal">INSERT INTO t1 ... SELECT ... FROM t2</code> that
        inserts all rows from one table into another.
      </p><p>
        <code class="literal">InnoDB</code> uses the in-memory auto-increment
        counter as long as the server runs. When the server is stopped
        and restarted, <code class="literal">InnoDB</code> reinitializes the
        counter for each table for the first
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> to the table, as described
        earlier.
      </p><p>
        A server restart also cancels the effect of the
        <code class="literal">AUTO_INCREMENT = <em class="replaceable"><code>N</code></em></code>
        table option in <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
        <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, which you
        can use with <code class="literal">InnoDB</code> tables to set the initial
        counter value or alter the current counter value.
      </p><p>
        You may see gaps in the sequence of values assigned to the
        <code class="literal">AUTO_INCREMENT</code> column if you roll back
        transactions that have generated numbers using the counter.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-auto-increment-configurable"></a>14.8.5.2 Configurable InnoDB Auto-Increment Locking</h4>

</div>

</div>

</div>
<p>
        As described in the previous section, <code class="literal">InnoDB</code>
        uses a special lock called the table-level
        <code class="literal">AUTO-INC</code> lock for inserts into tables with
        <code class="literal">AUTO_INCREMENT</code> columns. This lock is normally
        held to the end of the statement (not to the end of the
        transaction), to ensure that auto-increment numbers are assigned
        in a predictable and repeatable order for a given sequence of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements.
      </p><p>
        In the case of statement-based replication, this means that when
        an SQL statement is replicated on a slave server, the same
        values are used for the auto-increment column as on the master
        server. The result of execution of multiple
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements is
        deterministic, and the slave reproduces the same data as on the
        master. If auto-increment values generated by multiple
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements were
        interleaved, the result of two concurrent
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements would be
        nondeterministic, and could not reliably be propagated to a
        slave server using statement-based replication.
      </p><p>
        To make this clear, consider an example that uses this table:
      </p><pre class="programlisting">
CREATE TABLE t1 (
  c1 INT(11) NOT NULL AUTO_INCREMENT,
  c2 VARCHAR(10) DEFAULT NULL,
  PRIMARY KEY (c1)
) ENGINE=InnoDB;
</pre><p>
        Suppose that there are two transactions running, each inserting
        rows into a table with an <code class="literal">AUTO_INCREMENT</code>
        column. One transaction is using an
        <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
        SELECT</code></a> statement that inserts 1000 rows, and another
        is using a simple <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>
        statement that inserts one row:
      </p><pre class="programlisting">
Tx1: INSERT INTO t1 (c2) SELECT 1000 rows from another table ...
Tx2: INSERT INTO t1 (c2) VALUES ('xxx');
</pre><p>
        <code class="literal">InnoDB</code> cannot tell in advance how many rows
        will be retrieved from the <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a>
        in the <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx1,
        and it assigns the auto-increment values one at a time as the
        statement proceeds. With a table-level lock, held to the end of
        the statement, only one <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>
        statement referring to table <code class="literal">t1</code> can execute
        at a time, and the generation of auto-increment numbers by
        different statements is not interleaved. The auto-increment
        value generated by the Tx1
        <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
        SELECT</code></a> statement will be consecutive, and the (single)
        auto-increment value used by the
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement in Tx2 will
        either be smaller or larger than all those used for Tx1,
        depending on which statement executes first.
      </p><p>
        As long as the SQL statements execute in the same order when
        replayed from the binary log (when using statement-based
        replication, or in recovery scenarios), the results will be the
        same as they were when Tx1 and Tx2 first ran. Thus, table-level
        locks held until the end of a statement make
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements using
        auto-increment safe for use with statement-based replication.
        However, those locks limit concurrency and scalability when
        multiple transactions are executing insert statements at the
        same time.
      </p><p>
        In the preceding example, if there were no table-level lock, the
        value of the auto-increment column used for the
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> in Tx2 depends on
        precisely when the statement executes. If the
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx2 executes while the
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> of Tx1 is running (rather
        than before it starts or after it completes), the specific
        auto-increment values assigned by the two
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements are
        nondeterministic, and may vary from run to run.
      </p><p>
        <code class="literal">InnoDB</code> can avoid using the table-level
        <code class="literal">AUTO-INC</code> lock for a class of
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
        number of rows is known in advance, and still preserve
        deterministic execution and safety for statement-based
        replication. Further, if you are not using the binary log to
        replay SQL statements as part of recovery or replication, you
        can entirely eliminate use of the table-level
        <code class="literal">AUTO-INC</code> lock for even greater concurrency
        and performance, at the cost of permitting gaps in
        auto-increment numbers assigned by a statement and potentially
        having the numbers assigned by concurrently executing statements
        interleaved.
      </p><p>
        For <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
        number of rows to be inserted is known at the beginning of
        processing the statement, <code class="literal">InnoDB</code> quickly
        allocates the required number of auto-increment values without
        taking any lock, but only if there is no concurrent session
        already holding the table-level <code class="literal">AUTO-INC</code> lock
        (because that other statement will be allocating auto-increment
        values one-by-one as it proceeds). More precisely, such an
        <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statement obtains
        auto-increment values under the control of a mutex (a
        light-weight lock) that is <span class="emphasis"><em>not</em></span> held until
        the statement completes, but only for the duration of the
        allocation process.
      </p><p>
        This new locking scheme enables much greater scalability, but it
        does introduce some subtle differences in how auto-increment
        values are assigned compared to the original mechanism. To
        describe the way auto-increment works in
        <code class="literal">InnoDB</code>, the following discussion defines some
        terms, and explains how <code class="literal">InnoDB</code> behaves using
        different settings of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        configuration parameter, which you can set at server startup.
        Additional considerations are described following the
        explanation of auto-increment locking behavior.
      </p><p>
        First, some definitions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements
          </p><p>
            All statements that generate new rows in a table, including
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>, <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a>.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Simple inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted can
            be determined in advance (when the statement is initially
            processed). This includes single-row and multiple-row
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> and
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE</code></a> statements that do
            not have a nested subquery, but not
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Bulk inserts</span>”</span>
          </p><p>
            Statements for which the number of rows to be inserted (and
            the number of required auto-increment values) is not known
            in advance. This includes
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a> statements, but not plain
            <code class="literal">INSERT</code>. <code class="literal">InnoDB</code> will
            assign new values for the <code class="literal">AUTO_INCREMENT</code>
            column one at a time as each row is processed.
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Mixed-mode inserts</span>”</span>
          </p><p>
            These are <span class="quote">“<span class="quote">simple insert</span>”</span> statements that
            specify the auto-increment value for some (but not all) of
            the new rows. An example follows, where
            <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            Another type of <span class="quote">“<span class="quote">mixed-mode insert</span>”</span> is
            <a class="link" href="sql-syntax.html#insert-on-duplicate" title="13.2.5.3 INSERT ... ON DUPLICATE KEY UPDATE Syntax"><code class="literal">INSERT
            ... ON DUPLICATE KEY UPDATE</code></a>, which in the worst
            case is in effect an <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>
            followed by a <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, where
            the allocated value for the
            <code class="literal">AUTO_INCREMENT</code> column may or may not be
            used during the update phase.
</p></li></ul>
</div>
<p>
        There are three possible settings for the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
        parameter:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">innodb_autoinc_lock_mode = 0</code>
            (<span class="quote">“<span class="quote">traditional</span>”</span> lock mode)
          </p><p>
            This lock mode provides the same behavior as before
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            existed. For all
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements, a special table-level
            <code class="literal">AUTO-INC</code> lock is obtained and held to the
            end of the statement. This assures that the auto-increment
            values assigned by any given statement are consecutive.
          </p><p>
            This lock mode is provided for:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
                Backward compatibility.
              </p></li><li class="listitem"><p>
                Performance testing.
              </p></li><li class="listitem"><p>
                Working around issues with <span class="quote">“<span class="quote">mixed-mode
                inserts</span>”</span>, due to the possible differences in
                semantics described later.
</p></li></ul>
</div>
</li><li class="listitem"><p>
            <code class="literal">innodb_autoinc_lock_mode = 1</code>
            (<span class="quote">“<span class="quote">consecutive</span>”</span> lock mode)
          </p><p>
            This is the default lock mode. In this mode, <span class="quote">“<span class="quote">bulk
            inserts</span>”</span> use the special <code class="literal">AUTO-INC</code>
            table-level lock and hold it until the end of the statement.
            This applies to all
            <a class="link" href="sql-syntax.html#insert-select" title="13.2.5.1 INSERT ... SELECT Syntax"><code class="literal">INSERT ...
            SELECT</code></a>,
            <a class="link" href="sql-syntax.html#replace" title="13.2.8 REPLACE Syntax"><code class="literal">REPLACE ...
            SELECT</code></a>, and <a class="link" href="sql-syntax.html#load-data" title="13.2.6 LOAD DATA INFILE Syntax"><code class="literal">LOAD
            DATA</code></a> statements. Only one statement holding the
            <code class="literal">AUTO-INC</code> lock can execute at a time.
          </p><p>
            With this lock mode, <span class="quote">“<span class="quote">simple inserts</span>”</span> (only)
            use a new locking model where a light-weight mutex is used
            during the allocation of auto-increment values, and no
            table-level <code class="literal">AUTO-INC</code> lock is used, unless
            an <code class="literal">AUTO-INC</code> lock is held by another
            transaction. If another transaction does hold an
            <code class="literal">AUTO-INC</code> lock, a <span class="quote">“<span class="quote">simple
            insert</span>”</span> waits for the <code class="literal">AUTO-INC</code>
            lock, as if it too were a <span class="quote">“<span class="quote">bulk insert</span>”</span>.
          </p><p>
            This lock mode ensures that, in the presence of
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> statements where the
            number of rows is not known in advance (and where
            auto-increment numbers are assigned as the statement
            progresses), all auto-increment values assigned by any
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement are consecutive, and operations are safe for
            statement-based replication.
          </p><p>
            Simply put, the important impact of this lock mode is
            significantly better scalability. This mode is safe for use
            with statement-based replication. Further, as with
            <span class="quote">“<span class="quote">traditional</span>”</span> lock mode, auto-increment numbers
            assigned by any given statement are
            <span class="emphasis"><em>consecutive</em></span>. In this mode, there is
            <span class="emphasis"><em>no change</em></span> in semantics compared to
            <span class="quote">“<span class="quote">traditional</span>”</span> mode for any statement that uses
            auto-increment, with one important exception.
          </p><p>
            The exception is for <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>,
            where the user provides explicit values for an
            <code class="literal">AUTO_INCREMENT</code> column for some, but not
            all, rows in a multiple-row <span class="quote">“<span class="quote">simple insert</span>”</span>.
            For such inserts, <code class="literal">InnoDB</code> will allocate
            more auto-increment values than the number of rows to be
            inserted. However, all values automatically assigned are
            consecutively generated (and thus higher than) the
            auto-increment value generated by the most recently executed
            previous statement. <span class="quote">“<span class="quote">Excess</span>”</span> numbers are lost.
          </p></li><li class="listitem"><p>
            <code class="literal">innodb_autoinc_lock_mode = 2</code>
            (<span class="quote">“<span class="quote">interleaved</span>”</span> lock mode)
          </p><p>
            In this lock mode, no
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements use the table-level <code class="literal">AUTO-INC</code>
            lock, and multiple statements can execute at the same time.
            This is the fastest and most scalable lock mode, but it is
            <span class="emphasis"><em>not safe</em></span> when using statement-based
            replication or recovery scenarios when SQL statements are
            replayed from the binary log.
          </p><p>
            In this lock mode, auto-increment values are guaranteed to
            be unique and monotonically increasing across all
            concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements. However, because multiple statements can be
            generating numbers at the same time (that is, allocation of
            numbers is <span class="emphasis"><em>interleaved</em></span> across
            statements), the values generated for the rows inserted by
            any given statement may not be consecutive.
          </p><p>
            If the only statements executing are <span class="quote">“<span class="quote">simple
            inserts</span>”</span> where the number of rows to be inserted is
            known ahead of time, there will be no gaps in the numbers
            generated for a single statement, except for
            <span class="quote">“<span class="quote">mixed-mode inserts</span>”</span>. However, when <span class="quote">“<span class="quote">bulk
            inserts</span>”</span> are executed, there may be gaps in the
            auto-increment values assigned by any given statement.
</p></li></ul>
</div>
<p>
        The auto-increment locking modes provided by
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> have
        several usage implications:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Using auto-increment with replication
          </p><p>
            If you are using statement-based replication, set
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> to
            0 or 1 and use the same value on the master and its slaves.
            Auto-increment values are not ensured to be the same on the
            slaves as on the master if you use
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a> =
            2 (<span class="quote">“<span class="quote">interleaved</span>”</span>) or configurations where the
            master and slaves do not use the same lock mode.
          </p><p>
            If you are using row-based or mixed-format replication, all
            of the auto-increment lock modes are safe, since row-based
            replication is not sensitive to the order of execution of
            the SQL statements (and the mixed format uses row-based
            replication for any statements that are unsafe for
            statement-based replication).
          </p></li><li class="listitem"><p>
            <span class="quote">“<span class="quote">Lost</span>”</span> auto-increment values and sequence gaps
          </p><p>
            In all lock modes (0, 1, and 2), if a transaction that
            generated auto-increment values rolls back, those
            auto-increment values are <span class="quote">“<span class="quote">lost</span>”</span>. Once a value
            is generated for an auto-increment column, it cannot be
            rolled back, whether or not the
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statement is completed, and whether or not the containing
            transaction is rolled back. Such lost values are not reused.
            Thus, there may be gaps in the values stored in an
            <code class="literal">AUTO_INCREMENT</code> column of a table.
          </p></li><li class="listitem"><p>
            Gaps in auto-increment values for <span class="quote">“<span class="quote">bulk
            inserts</span>”</span>
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>) or 1
            (<span class="quote">“<span class="quote">consecutive</span>”</span>), the auto-increment values
            generated by any given statement will be consecutive,
            without gaps, because the table-level
            <code class="literal">AUTO-INC</code> lock is held until the end of
            the statement, and only one such statement can execute at a
            time.
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), there may be gaps in
            the auto-increment values generated by <span class="quote">“<span class="quote">bulk
            inserts,</span>”</span> but only if there are concurrently
            executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements.
          </p><p>
            For lock modes 1 or 2, gaps may occur between successive
            statements because for bulk inserts the exact number of
            auto-increment values required by each statement may not be
            known and overestimation is possible.
          </p></li><li class="listitem"><p>
            Auto-increment values assigned by <span class="quote">“<span class="quote">mixed-mode
            inserts</span>”</span>
          </p><p>
            Consider a <span class="quote">“<span class="quote">mixed-mode insert,</span>”</span> where a
            <span class="quote">“<span class="quote">simple insert</span>”</span> specifies the auto-increment
            value for some (but not all) resulting rows. Such a
            statement will behave differently in lock modes 0, 1, and 2.
            For example, assume <code class="literal">c1</code> is an
            <code class="literal">AUTO_INCREMENT</code> column of table
            <code class="literal">t1</code>, and that the most recent
            automatically generated sequence number is 100. Consider the
            following <span class="quote">“<span class="quote">mixed-mode insert</span>”</span> statement:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 0 (<span class="quote">“<span class="quote">traditional</span>”</span>), the four new rows
            will be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            The next available auto-increment value will be 103 because
            the auto-increment values are allocated one at a time, not
            all at once at the beginning of statement execution. This
            result is true whether or not there are concurrently
            executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>), the four new rows
            will also be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
| 101 | b    |
|   5 | c    |
| 102 | d    |
+-----+------+
</pre><p>
            However, in this case, the next available auto-increment
            value will be 105, not 103 because four auto-increment
            values are allocated at the time the statement is processed,
            but only two are used. This result is true whether or not
            there are concurrently executing
            <span class="quote">“<span class="quote"><a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>-like</span>”</span>
            statements (of any type).
          </p><p>
            With
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            set to mode 2 (<span class="quote">“<span class="quote">interleaved</span>”</span>), the four new
            rows will be:
          </p><pre class="programlisting">
+-----+------+
| c1  | c2   |
+-----+------+
|   1 | a    |
|   <em class="replaceable"><code>x</code></em> | b    |
|   5 | c    |
|   <em class="replaceable"><code>y</code></em> | d    |
+-----+------+
</pre><p>
            The values of <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> will be unique and larger than
            any previously generated rows. However, the specific values
            of <em class="replaceable"><code>x</code></em> and
            <em class="replaceable"><code>y</code></em> will depend on the number of
            auto-increment values generated by concurrently executing
            statements.
          </p><p>
            Finally, consider the following statement, issued when the
            most-recently generated sequence number was the value 4:
          </p><pre class="programlisting">
INSERT INTO t1 (c1,c2) VALUES (1,'a'), (NULL,'b'), (5,'c'), (NULL,'d');
</pre><p>
            With any
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode</code></a>
            setting, this statement will generate a duplicate-key error
            23000 (<code class="literal">Can't write; duplicate key in
            table</code>) because 5 will be allocated for the row
            <code class="literal">(NULL, 'b')</code> and insertion of the row
            <code class="literal">(5, 'c')</code> will fail.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-foreign-key-constraints"></a>14.8.6 InnoDB and FOREIGN KEY Constraints</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495775264"></a><a class="indexterm" name="idm140301495773776"></a><a class="indexterm" name="idm140301495772288"></a><p>
      This section describes differences in the InnoDB storage
      engine's handling of foreign keys as compared with that of
      the MySQL Server.
</p>
<h4><a name="idm140301495770240"></a>Foreign Key Definitions</h4>
<p>
      Foreign key definitions for <code class="literal">InnoDB</code> tables are
      subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> permits a foreign key to reference
          any index column or group of columns. However, in the
          referenced table, there must be an index where the referenced
          columns are listed as the <span class="emphasis"><em>first</em></span> columns
          in the same order.
        </p></li><li class="listitem"><p>
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not currently support
          foreign keys for tables with user-defined partitioning. This
          means that no user-partitioned <code class="literal">InnoDB</code> table
          may contain foreign key references or columns referenced by
          foreign keys.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> allows a foreign key constraint to
          reference a non-unique key. <span class="emphasis"><em>This is an
          <code class="literal">InnoDB</code> extension to standard
          SQL.</em></span>
</p></li></ul>
</div>
<h4><a name="idm140301495760160"></a>Referential Actions</h4>
<p>
      Referential actions for foreign keys of <code class="literal">InnoDB</code>
      tables are subject to the following conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          While <code class="literal">SET DEFAULT</code> is allowed by the MySQL
          Server, it is rejected as invalid by
          <code class="literal">InnoDB</code>. <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          statements using this clause are not allowed for InnoDB
          tables.
        </p></li><li class="listitem"><p>
          If there are several rows in the parent table that have the
          same referenced key value, <code class="literal">InnoDB</code> acts in
          foreign key checks as if the other parent rows with the same
          key value do not exist. For example, if you have defined a
          <code class="literal">RESTRICT</code> type constraint, and there is a
          child row with several parent rows, <code class="literal">InnoDB</code>
          does not permit the deletion of any of those parent rows.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> performs cascading operations
          through a depth-first algorithm, based on records in the
          indexes corresponding to the foreign key constraints.
        </p></li><li class="listitem"><p>
          If <code class="literal">ON UPDATE CASCADE</code> or <code class="literal">ON UPDATE
          SET NULL</code> recurses to update the <span class="emphasis"><em>same
          table</em></span> it has previously updated during the cascade,
          it acts like <code class="literal">RESTRICT</code>. This means that you
          cannot use self-referential <code class="literal">ON UPDATE
          CASCADE</code> or <code class="literal">ON UPDATE SET NULL</code>
          operations. This is to prevent infinite loops resulting from
          cascaded updates. A self-referential <code class="literal">ON DELETE SET
          NULL</code>, on the other hand, is possible, as is a
          self-referential <code class="literal">ON DELETE CASCADE</code>.
          Cascading operations may not be nested more than 15 levels
          deep.
        </p></li><li class="listitem"><p>
          Like MySQL in general, in an SQL statement that inserts,
          deletes, or updates many rows, <code class="literal">InnoDB</code>
          checks <code class="literal">UNIQUE</code> and <code class="literal">FOREIGN
          KEY</code> constraints row-by-row. When performing foreign
          key checks, <code class="literal">InnoDB</code> sets shared row-level
          locks on child or parent records it has to look at.
          <code class="literal">InnoDB</code> checks foreign key constraints
          immediately; the check is not deferred to transaction commit.
          According to the SQL standard, the default behavior should be
          deferred checking. That is, constraints are only checked after
          the <span class="emphasis"><em>entire SQL statement</em></span> has been
          processed. Until <code class="literal">InnoDB</code> implements deferred
          constraint checking, some things will be impossible, such as
          deleting a record that refers to itself using a foreign key.
</p></li></ul>
</div>
<h4><a name="idm140301495735200"></a>Foreign Key Usage and Error Information</h4>
<p>
      You can obtain general information about foreign keys and their
      usage from querying the
      <a class="link" href="information-schema.html#key-column-usage-table" title="21.10 The INFORMATION_SCHEMA KEY_COLUMN_USAGE Table"><code class="literal">INFORMATION_SCHEMA.KEY_COLUMN_USAGE</code></a>
      table. See also <a class="xref" href="sql-syntax.html#create-table-foreign-keys" title="13.1.17.3 Using FOREIGN KEY Constraints">Section 13.1.17.3, “Using FOREIGN KEY Constraints”</a>.
    </p><p>
      In addition to <a class="link" href="sql-syntax.html#show-errors" title="13.7.5.18 SHOW ERRORS Syntax"><code class="literal">SHOW ERRORS</code></a>, in the
      event of a foreign key error involving <code class="literal">InnoDB</code>
      tables (usually Error 150 in the MySQL Server), you can obtain a
      detailed explanation of the most recent <code class="literal">InnoDB</code>
      foreign key error by checking the output of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-restrictions"></a>14.8.7 Limits on InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495725488"></a><a class="indexterm" name="idm140301495724000"></a><a class="indexterm" name="idm140301495722512"></a>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Do <span class="emphasis"><em>not</em></span> convert MySQL system tables in the
        <code class="literal">mysql</code> database from <code class="literal">MyISAM</code>
        to <code class="literal">InnoDB</code> tables. This is an unsupported
        operation. If you do this, MySQL does not restart until you
        restore the old system tables from a backup or re-generate them
        with the <a class="link" href="programs.html#mysql-install-db" title="4.4.3 mysql_install_db — Initialize MySQL Data Directory"><span class="command"><strong>mysql_install_db</strong></span></a> program.
</p>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        <a class="indexterm" name="idm140301495714768"></a>

        <a class="indexterm" name="idm140301495713312"></a>

        It is not a good idea to configure <code class="literal">InnoDB</code> to
        use data files or log files on NFS volumes. Otherwise, the files
        might be locked by other processes and become unavailable for
        use by MySQL.
</p>
</div>
<h4><a name="idm140301495710656"></a>Maximums and Minimums</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          A table can contain a maximum of 1000 columns.
        </p></li><li class="listitem"><p>
          A table can contain a maximum of 64
          <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
        </p></li><li class="listitem"><p>
          By default, an index key for a single-column index can be up
          to 767 bytes. The same length limit applies to any index key
          prefix. See <a class="xref" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax">Section 13.1.13, “CREATE INDEX Syntax”</a>. For example, you
          might hit this limit with a
          <a class="link" href="glossary.html#glos_column_prefix" title="column prefix">column prefix</a> index
          of more than 255 characters on a <code class="literal">TEXT</code> or
          <code class="literal">VARCHAR</code> column, assuming a UTF-8 character
          set and the maximum of 3 bytes for each character. When the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a>
          configuration option is enabled, this length limit is raised
          to 3072 bytes, for <code class="literal">InnoDB</code> tables that use
          the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats.
        </p><p>
          If you specify an index prefix length that is greater than the
          allowed maximum value, the length is silently reduced to the
          maximum length. In MySQL 5.6 and later, specifying an index
          prefix length greater than the maximum length produces an
          error.
        </p><p>
          When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix"><code class="literal">innodb_large_prefix</code></a> is
          enabled, attempting to create an index prefix with a key
          length greater than 3072 for a <code class="literal">REDUNDANT</code> or
          <code class="literal">COMPACT</code> table causes an
          <a class="link" href="error-handling.html#error_er_index_column_too_long"><code class="literal">ER_INDEX_COLUMN_TOO_LONG</code></a>
          error.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> internal maximum key length is
          3500 bytes, but MySQL itself restricts this to 3072 bytes.
          This limit applies to the length of the combined index key in
          a multi-column index.
        </p></li><li class="listitem"><p>
          The maximum row length, except for variable-length columns
          (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
          <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than
          half of a database page. That is, the maximum row length is
          about 8000 bytes. <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a>
          columns must be less than 4GB, and the total row length,
          including <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
          <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
          4GB.
        </p><p>
          If a row is less than half a page long, all of it is stored
          locally within the page. If it exceeds half a page,
          variable-length columns are chosen for external off-page
          storage until the row fits within half a page, as described in
          <a class="xref" href="innodb-storage-engine.html#innodb-file-space" title="14.12.2 File Space Management">Section 14.12.2, “File Space Management”</a>.
        </p><p>
          The row size for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns
          that are chosen for external off-page storage should not
          exceed 10% of the combined <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo
          log</a> file size. If the row size exceeds 10% of the
          combined redo log file size, <code class="literal">InnoDB</code> could
          overwrite the most recent checkpoint which may result in lost
          data during crash recovery. (Bug#69477).
        </p></li><li class="listitem"><p>
          Although <code class="literal">InnoDB</code> supports row sizes larger
          than 65,535 bytes internally, MySQL itself imposes a row-size
          limit of 65,535 for the combined size of all columns:
        </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</code></strong>
    -&gt; <strong class="userinput"><code>f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</code></strong>
ERROR 1118 (42000): Row size too large. The maximum row size for the
used table type, not counting BLOBs, is 65535. You have to change some
columns to TEXT or BLOBs
</pre><p>
          See <a class="xref" href="restrictions.html#column-count-limit" title="D.10.4 Limits on Table Column Count and Row Size">Section D.10.4, “Limits on Table Column Count and Row Size”</a>.
        </p></li><li class="listitem"><p>
          On some older operating systems, files must be less than 2GB.
          This is not a limitation of <code class="literal">InnoDB</code> itself,
          but if you require a large tablespace, you will need to
          configure it using several smaller data files rather than one
          large data file.
        </p></li><li class="listitem"><p>
          

          The combined size of the <code class="literal">InnoDB</code> log files
          must be less than 4GB.
        </p></li><li class="listitem"><p>
          The minimum tablespace size is slightly larger than 10MB. The
          maximum tablespace size is four billion database pages (64TB).
          This is also the maximum size for a table.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140301495660736"></a>

          <a class="indexterm" name="idm140301495659248"></a>

          The default database page size in <code class="literal">InnoDB</code> is
          16KB.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Changing the page size is not a supported operation and
            there is no guarantee that
            <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> will function normally
            with a page size other than 16KB. Problems compiling or
            running InnoDB may occur. In particular,
            <code class="literal">ROW_FORMAT=COMPRESSED</code> in the Barracuda
            file format assumes that the page size is at most 16KB and
            uses 14-bit pointers.
          </p><p>
            A version of <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> built for
            one page size cannot use data files or log files from a
            version built for a different page size. This limitation
            could affect restore or downgrade operations using data from
            MySQL 5.6, which does support page sizes other than 16KB.
</p>
</div>
</li></ul>
</div>
<h4><a name="idm140301495651504"></a>Index Types</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables do not support
          <code class="literal">FULLTEXT</code> indexes.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> tables support spatial data types,
          but not indexes on them.
</p></li></ul>
</div>
<h4><a name="idm140301495645824"></a>Restrictions on InnoDB Tables</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> determines index
          cardinality (as displayed in the
          <code class="literal">Cardinality</code> column of
          <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a> output) by doing
          <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a> to each
          of the index trees and updating index cardinality estimates
          accordingly. Because these are only estimates, repeated runs
          of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> could produce
          different numbers. This makes <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> fast on <code class="literal">InnoDB</code> tables but
          not 100% accurate because it does not take all rows into
          account.
        </p><p>
          You can change the number of random dives by modifying the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
          system variable.
        </p><p>
          MySQL uses index cardinality estimates only in join
          optimization. If some join is not optimized in the right way,
          you can try using <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>. In the few cases that
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> does not produce
          values good enough for your particular tables, you can use
          <code class="literal">FORCE INDEX</code> with your queries to force the
          use of a particular index, or set the
          <a class="link" href="server-administration.html#sysvar_max_seeks_for_key"><code class="literal">max_seeks_for_key</code></a> system
          variable to ensure that MySQL prefers index lookups over table
          scans. See <a class="xref" href="server-administration.html#server-system-variables" title="5.1.4 Server System Variables">Section 5.1.4, “Server System Variables”</a>, and
          <a class="xref" href="error-handling.html#optimizer-issues" title="B.5.6 Optimizer-Related Issues">Section B.5.6, “Optimizer-Related Issues”</a>.
        </p></li><li class="listitem"><p>
          If statements or transactions are running on a table and
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is run on the
          same table followed by a second <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> operation, the second
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> operation is
          blocked until the statements or transactions are completed.
          This behaviour occurs because <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a> marks the currently loaded table definition as
          obsolete when <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> is
          finished running. New statements or transactions (including a
          second <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> statement)
          must load the new table definition into the table cache, which
          cannot occur until currently running statements or
          transactions are completed and the old table definition is
          purged. Loading multiple concurrent table definitions is not
          supported.
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> does not give
          accurate <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> on
          <code class="literal">InnoDB</code> tables, except for the physical size
          reserved by the table. The row count is only a rough estimate
          used in SQL optimization.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> does not keep an internal count of
          rows in a table because concurrent transactions might
          <span class="quote">“<span class="quote">see</span>”</span> different numbers of rows at the same time.
          To process a <code class="literal">SELECT COUNT(*) FROM t</code>
          statement, <code class="literal">InnoDB</code> scans an index of the
          table, which takes some time if the index is not entirely in
          the buffer pool. If your table does not change often, using
          the MySQL query cache is a good solution. To get a fast count,
          you have to use a counter table you create yourself and let
          your application update it according to the inserts and
          deletes it does. If an approximate row count is sufficient,
          <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> can be used.
          See <a class="ulink" href="http://dev.mysql.com/doc/refman/5.1/en/innodb-tuning.html" target="_top">InnoDB Performance Tuning Tips</a>.
        </p></li><li class="listitem"><p>
          On Windows, <code class="literal">InnoDB</code> always stores database
          and table names internally in lowercase. To move databases in
          a binary format from Unix to Windows or from Windows to Unix,
          create all databases and tables using lowercase names.
        </p></li><li class="listitem"><p>
          An <code class="literal">AUTO_INCREMENT</code> column
          <em class="replaceable"><code>ai_col</code></em> must be defined as part of
          an index such that it is possible to perform the equivalent of
          an indexed <code class="literal">SELECT
          MAX(<em class="replaceable"><code>ai_col</code></em>)</code> lookup on the
          table to obtain the maximum column value. Typically, this is
          achieved by making the column the first column of some table
          index.
        </p></li><li class="listitem"><p>
          <code class="literal">InnoDB</code> sets an exclusive lock on the end of
          the index associated with the
          <code class="literal">AUTO_INCREMENT</code> column while initializing a
          previously specified <code class="literal">AUTO_INCREMENT</code> column
          on a table.
        </p><p>
          With
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=0</code></a>,
          <code class="literal">InnoDB</code> uses a special
          <code class="literal">AUTO-INC</code> table lock mode where the lock is
          obtained and held to the end of the current SQL statement
          while accessing the auto-increment counter. Other clients
          cannot insert into the table while the
          <code class="literal">AUTO-INC</code> table lock is held. The same
          behavior occurs for <span class="quote">“<span class="quote">bulk inserts</span>”</span> with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=1</code></a>.
          Table-level <code class="literal">AUTO-INC</code> locks are not used
          with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode"><code class="literal">innodb_autoinc_lock_mode=2</code></a>.
          For more information, See
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="14.8.5 AUTO_INCREMENT Handling in InnoDB">Section 14.8.5, “AUTO_INCREMENT Handling in InnoDB”</a>.
        </p></li><li class="listitem"><p>
          When you restart the MySQL server, <code class="literal">InnoDB</code>
          may reuse an old value that was generated for an
          <code class="literal">AUTO_INCREMENT</code> column but never stored
          (that is, a value that was generated during an old transaction
          that was rolled back).
        </p></li><li class="listitem"><p>
          When an <code class="literal">AUTO_INCREMENT</code> integer column runs
          out of values, a subsequent <code class="literal">INSERT</code>
          operation returns a duplicate-key error. This is general MySQL
          behavior, similar to how <code class="literal">MyISAM</code> works.
        </p></li><li class="listitem"><p>
          <code class="literal">DELETE FROM
          <em class="replaceable"><code>tbl_name</code></em></code> does not
          regenerate the table but instead deletes all rows, one by one.
        </p></li><li class="listitem"><p>
          Under some conditions, <code class="literal">TRUNCATE
          <em class="replaceable"><code>tbl_name</code></em></code> for an
          <code class="literal">InnoDB</code> table is mapped to <code class="literal">DELETE
          FROM <em class="replaceable"><code>tbl_name</code></em></code>. See
          <a class="xref" href="sql-syntax.html#truncate-table" title="13.1.33 TRUNCATE TABLE Syntax">Section 13.1.33, “TRUNCATE TABLE Syntax”</a>.
        </p></li><li class="listitem"><p>
          Currently, cascaded foreign key actions do not activate
          triggers.
        </p></li><li class="listitem"><p>
          You cannot create a table with a column name that matches the
          name of an internal InnoDB column (including
          <code class="literal">DB_ROW_ID</code>, <code class="literal">DB_TRX_ID</code>,
          <code class="literal">DB_ROLL_PTR</code>, and
          <code class="literal">DB_MIX_ID</code>). The server reports error 1005
          and refers to error −1 in the error message. This
          restriction applies only to use of the names in uppercase.
</p></li></ul>
</div>
<h4><a name="idm140301495570912"></a>Locking and Transactions</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> acquires two locks
          on each table if <code class="literal">innodb_table_locks=1</code> (the
          default). In addition to a table lock on the MySQL layer, it
          also acquires an <code class="literal">InnoDB</code> table lock.
          Versions of MySQL before 4.1.2 did not acquire
          <code class="literal">InnoDB</code> table locks; the old behavior can be
          selected by setting <code class="literal">innodb_table_locks=0</code>.
          If no <code class="literal">InnoDB</code> table lock is acquired,
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> completes even if
          some records of the tables are being locked by other
          transactions.
        </p><p>
          As of MySQL 5.5.3,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks=0</code></a> has no
          effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It still has an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p>
          All <code class="literal">InnoDB</code> locks held by a transaction are
          released when the transaction is committed or aborted. Thus,
          it does not make much sense to invoke
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a> on
          <code class="literal">InnoDB</code> tables in
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit=1</code></a> mode because the
          acquired <code class="literal">InnoDB</code> table locks would be
          released immediately.
        </p></li><li class="listitem"><p>
          You cannot lock additional tables in the middle of a
          transaction because <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          performs an implicit <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a> and
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">UNLOCK
          TABLES</code></a>.
        </p></li><li class="listitem"><p>
          The limit of 1023 concurrent data-modifying transactions has
          been raised in MySQL 5.5 and above. The limit is now 128 *
          1023 concurrent transactions that generate undo records. You
          can remove any workarounds that require changing the proper
          structure of your transactions, such as committing more
          frequently.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-compression"></a>14.9 InnoDB Compressed Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-background">14.9.1 Overview of Table Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-usage">14.9.2 Enabling Compression for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning">14.9.3 Tuning Compression for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-tuning-monitoring">14.9.4 Monitoring Compression at Runtime</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-internals">14.9.5 How Compression Works for InnoDB Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-compression-syntax-warnings">14.9.6 SQL Compression Syntax Warnings and Errors</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301495542704"></a><a class="indexterm" name="idm140301495541664"></a><p>
    By using the SQL syntax and InnoDB configuration options for
    <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>, you can create
    tables where the data is stored in compressed form. Compression can
    help to improve both raw performance and scalability. The
    compression means less data is transferred between disk and memory,
    and takes up less space on disk and in memory. The benefits are
    amplified for tables with
    <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>,
    because index data is compressed also. Compression can be especially
    important for <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> storage devices,
    because they tend to have lower capacity than
    <a class="link" href="glossary.html#glos_hdd" title="HDD">HDD</a> devices.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-background"></a>14.9.1 Overview of Table Compression</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140301495535024"></a><p>
      Because processors and cache memories have increased in speed more
      than disk storage devices, many workloads are
      <a class="link" href="glossary.html#glos_disk_bound" title="disk-bound">disk-bound</a>. Data
      <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> enables
      smaller database size, reduced I/O, and improved throughput, at
      the small cost of increased CPU utilization. Compression is
      especially valuable for read-intensive applications, on systems
      with enough RAM to keep frequently used data in memory.
    </p><p>
      An InnoDB table created with
      <code class="literal">ROW_FORMAT=COMPRESSED</code> can use a smaller
      <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> on disk than the
      usual 16KB default. Smaller pages require less I/O to read from
      and write to disk, which is especially valuable for
      <a class="link" href="glossary.html#glos_ssd" title="SSD">SSD</a> devices.
    </p><p>
      The page size is specified through the
      <code class="literal">KEY_BLOCK_SIZE</code> parameter. The different page
      size means the table must be in its own <code class="literal">.ibd</code>
      file rather than in the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>,
      which requires enabling the
      <code class="literal">innodb_file_per_table</code> option. The level of
      compression is the same regardless of the
      <code class="literal">KEY_BLOCK_SIZE</code> value. As you specify smaller
      values for <code class="literal">KEY_BLOCK_SIZE</code>, you get the I/O
      benefits of increasingly smaller pages. But if you specify a value
      that is too small, there is additional overhead to reorganize the
      pages when data values cannot be compressed enough to fit multiple
      rows in each page. There is a hard limit on how small
      <code class="literal">KEY_BLOCK_SIZE</code> can be for a table, based on the
      lengths of the key columns for each of its indexes. Specify a
      value that is too small, and the <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement fails.
    </p><p>
      In the buffer pool, the compressed data is held in small pages,
      with a page size based on the <code class="literal">KEY_BLOCK_SIZE</code>
      value. For extracting or updating the column values, MySQL also
      creates a 16KB page in the buffer pool with the uncompressed data.
      Within the buffer pool, any updates to the uncompressed page are
      also re-written back to the equivalent compressed page. You might
      need to size your buffer pool to accommodate the additional data
      of both compressed and uncompressed pages, although the
      uncompressed pages are
      <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer pool
      when space is needed, and then uncompressed again on the next
      access.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-usage"></a>14.9.2 Enabling Compression for a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495515200"></a><a class="indexterm" name="idm140301495513712"></a><a class="indexterm" name="idm140301495512640"></a><a class="indexterm" name="idm140301495511152"></a><a class="indexterm" name="idm140301495509664"></a><a class="indexterm" name="idm140301495508176"></a><a class="indexterm" name="idm140301495507104"></a><a class="indexterm" name="idm140301495506032"></a><p>
      Before creating a compressed table, make sure the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option is enabled, and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> is set to
      <code class="literal">Barracuda</code>. You can set these parameters in the
      MySQL <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
      file</a> <code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>, or with the <code class="literal">SET</code>
      statement without shutting down the MySQL server.
    </p><p>
      To enable compression for a table, you use the clauses
      <code class="literal">ROW_FORMAT=COMPRESSED</code>,
      <code class="literal">KEY_BLOCK_SIZE</code>, or both in a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement.
    </p><p>
      To create a compressed table, you might use statements like these:
    </p><pre class="programlisting">
SET GLOBAL innodb_file_per_table=1;
SET GLOBAL innodb_file_format=Barracuda;
CREATE TABLE t1
 (c1 INT PRIMARY KEY) 
 ROW_FORMAT=COMPRESSED 
 KEY_BLOCK_SIZE=8;
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you specify <code class="literal">ROW_FORMAT=COMPRESSED</code>, you
          can omit <code class="literal">KEY_BLOCK_SIZE</code>; the default
          compressed page size of 8KB is used.
        </p></li><li class="listitem"><p>
          If you specify <code class="literal">KEY_BLOCK_SIZE</code>, you can omit
          <code class="literal">ROW_FORMAT=COMPRESSED</code>; compression is
          enabled automatically.
        </p></li><li class="listitem"><p>
          To determine the best value for
          <code class="literal">KEY_BLOCK_SIZE</code>, typically you create
          several copies of the same table with different values for
          this clause, then measure the size of the resulting
          <code class="literal">.ibd</code> files and see how well each performs
          with a realistic
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
        </p></li><li class="listitem"><p>
          For additional performance-related configuration options, see
          <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="14.9.3 Tuning Compression for InnoDB Tables">Section 14.9.3, “Tuning Compression for InnoDB Tables”</a>.
</p></li></ul>
</div>
<p>
      The default uncompressed size of InnoDB data
      <a class="link" href="glossary.html#glos_page" title="page">pages</a> is 16KB. Depending on the
      combination of option values, MySQL uses a page size of 1KB, 2KB,
      4KB, 8KB, or 16KB for the <code class="literal">.ibd</code> file of the
      table. The actual compression algorithm is not affected by the
      <code class="literal">KEY_BLOCK_SIZE</code> value; the value determines how
      large each compressed chunk is, which in turn affects how many
      rows can be packed into each compressed page.
    </p><p>
      Setting <code class="literal">KEY_BLOCK_SIZE=16</code> typically does not
      result in much compression, since the normal InnoDB
      <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a> is 16KB. This
      setting may still be useful for tables with many long
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> or
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such values
      often do compress well, and might therefore require fewer
      <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a> as
      described in <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals" title="14.9.5 How Compression Works for InnoDB Tables">Section 14.9.5, “How Compression Works for InnoDB Tables”</a>.
    </p><p>
      All indexes of a table (including the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>) are
      compressed using the same page size, as specified in the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. Table
      attributes such as <code class="literal">ROW_FORMAT</code> and
      <code class="literal">KEY_BLOCK_SIZE</code> are not part of the
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> syntax, and are
      ignored if they are specified (although you see them in the output
      of the <code class="literal">SHOW CREATE TABLE</code> statement).
</p>
<h4><a name="idm140301495464032"></a>Restrictions on Compressed Tables</h4>
<p>
      Because MySQL versions prior to 5.1 cannot process compressed
      tables, using compression requires specifying the configuration
      parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format=Barracuda</code></a>, to
      avoid accidentally introducing compatibility issues.
    </p><p>
      Table compression is also not available for the InnoDB
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The system tablespace (space 0, the <code class="literal">ibdata*</code>
      files) can contain user data, but it also contains internal system
      information, and therefore is never compressed. Thus, compression
      applies only to tables (and indexes) stored in their own
      tablespaces, that is, created with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option
      enabled.
    </p><p>
      Compression applies to an entire table and all its associated
      indexes, not to individual rows, despite the clause name
      <code class="literal">ROW_FORMAT</code>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-tuning"></a>14.9.3 Tuning Compression for InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495455312"></a><a class="indexterm" name="idm140301495453824"></a><p>
      Most often, the internal optimizations described in
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage" title="InnoDB Data Storage and Compression">InnoDB Data Storage and Compression</a> ensure that
      the system runs well with compressed data. However, because the
      efficiency of compression depends on the nature of your data, you
      can make decisions that affect the performance of compressed
      tables:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Which tables to compress.
        </p></li><li class="listitem"><p>
          What compressed page size to use.
        </p></li><li class="listitem"><p>
          Whether to adjust the size of the buffer pool based on
          run-time performance characteristics, such as the amount of
          time the system spends compressing and uncompressing data.
          Whether the workload is more like a
          <a class="link" href="glossary.html#glos_data_warehouse" title="data warehouse">data warehouse</a>
          (primarily queries) or an
          <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> system (mix of queries
          and <a class="link" href="glossary.html#glos_dml" title="DML">DML</a>).
        </p></li><li class="listitem"><p>
          If the system performs DML operations on compressed tables,
          and the way the data is distributed leads to expensive
          <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
          failures</a> at runtime, you might adjust additional
          advanced configuration options.
</p></li></ul>
</div>
<p>
      Use the guidelines in this section to help make those
      architectural and configuration choices. When you are ready to
      conduct long-term testing and put compressed tables into
      production, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning-monitoring" title="14.9.4 Monitoring Compression at Runtime">Section 14.9.4, “Monitoring Compression at Runtime”</a> for ways to
      verify the effectiveness of those choices under real-world
      conditions.
</p>
<h4><a name="innodb-compression-tuning-when"></a>When to Use Compression</h4>
<p>
      In general, compression works best on tables that include a
      reasonable number of character string columns and where the data
      is read far more often than it is written. Because there are no
      guaranteed ways to predict whether or not compression benefits a
      particular situation, always test with a specific
      <a class="link" href="glossary.html#glos_workload" title="workload">workload</a> and data set running
      on a representative configuration. Consider the following factors
      when deciding which tables to compress.
</p>
<h4><a name="innodb-compression-tuning-when-data"></a>Data Characteristics and Compression</h4>
<a class="indexterm" name="idm140301495437328"></a><p>
      A key determinant of the efficiency of compression in reducing the
      size of data files is the nature of the data itself. Recall that
      compression works by identifying repeated strings of bytes in a
      block of data. Completely randomized data is the worst case.
      Typical data often has repeated values, and so compresses
      effectively. Character strings often compress well, whether
      defined in <code class="literal">CHAR</code>, <code class="literal">VARCHAR</code>,
      <code class="literal">TEXT</code> or <code class="literal">BLOB</code> columns. On the
      other hand, tables containing mostly binary data (integers or
      floating point numbers) or data that is previously compressed (for
      example <acronym class="acronym">JPEG</acronym> or <acronym class="acronym">PNG</acronym> images)
      may not generally compress well, significantly or at all.
    </p><p>
      You choose whether to turn on compression for each InnoDB table. A
      table and all of its indexes use the same (compressed)
      <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>. It might be that
      the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a>
      (clustered) index, which contains the data for all columns of a
      table, compresses more effectively than the secondary indexes. For
      those cases where there are long rows, the use of compression
      might result in long column values being stored
      <span class="quote">“<span class="quote">off-page</span>”</span>, as discussed in
      <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.11.3 DYNAMIC and COMPRESSED Row Formats">Section 14.11.3, “DYNAMIC and COMPRESSED Row Formats”</a>. Those overflow pages
      may compress well. Given these considerations, for many
      applications, some tables compress more effectively than others,
      and you might find that your workload performs best only with a
      subset of tables compressed.
    </p><p>
      To determine whether or not to compress a particular table,
      conduct experiments. You can get a rough estimate of how
      efficiently your data can be compressed by using a utility that
      implements LZ77 compression (such as <code class="literal">gzip</code> or
      WinZip) on a copy of the <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd
      file</a> for an uncompressed table. You can expect less
      compression from a MySQL compressed table than from file-based
      compression tools, because MySQL compresses data in chunks based
      on the <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, 16KB by
      default. In addition to user data, the page format includes some
      internal system data that is not compressed. File-based
      compression utilities can examine much larger chunks of data, and
      so might find more repeated strings in a huge file than MySQL can
      find in an individual page.
    </p><p>
      Another way to test compression on a specific table is to copy
      some data from your uncompressed table to a similar, compressed
      table (having all the same indexes) and look at the size of the
      resulting <code class="literal">.ibd</code> file. For example:
    </p><pre class="programlisting">
use test;
set global innodb_file_per_table=1;
set global innodb_file_format=Barracuda;
set global autocommit=0;

-- Create an uncompressed table with a million or two rows.
create table big_table as select * from information_schema.columns;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
insert into big_table select * from big_table;
commit;
alter table big_table add id int unsigned not null primary key auto_increment;

show create table big_table\G

select count(id) from big_table;

-- Check how much space is needed for the uncompressed table.
\! ls -l data/test/big_table.ibd

create table key_block_size_4 like big_table;
alter table key_block_size_4 key_block_size=4 row_format=compressed;

insert into key_block_size_4 select * from big_table;
commit;

-- Check how much space is needed for a compressed table
-- with particular compression settings.
\! ls -l data/test/key_block_size_4.ibd
</pre><p>
      This experiment produced the following numbers, which of course
      could vary considerably depending on your table structure and
      data:
    </p><pre class="programlisting">
-rw-rw----  1 cirrus  staff  310378496 Jan  9 13:44 data/test/big_table.ibd
-rw-rw----  1 cirrus  staff  83886080 Jan  9 15:10 data/test/key_block_size_4.ibd
</pre><p>
      To see whether compression is efficient for your particular
      <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>, use a MySQL
      instance with no other compressed tables and run queries against
      the <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
      table. For exmaple, you examine the ratio of successful
      compression operations to overall compression operations. (In the
      <code class="literal">INNODB_CMP</code> table, compare
      <code class="literal">COMPRESS_OPS</code> to
      <code class="literal">COMPRESS_OPS_OK</code>. See
      <a class="link" href="innodb-storage-engine.html#innodb-information-schema-innodb_cmp" title="14.16.1.1 INNODB_CMP and INNODB_CMP_RESET"><code class="literal">INNODB_CMP</code></a>
      for more information.) If a high percentage of compression
      operations complete successfully, the table might be a good
      candidate for compression.
</p>
<h4><a name="innodb-compression-application"></a>Compression and Application and Schema Design</h4>
<a class="indexterm" name="idm140301495410912"></a><p>
      Decide whether to compress data in your application or in the
      table; do not use both types of compression for the same data.
      When you compress the data in the application and store the
      results in a compressed table, extra space savings are extremely
      unlikely, and the double compression just wastes CPU cycles.
</p>
<h4><a name="innodb-compression-in-database"></a>Compressing in the Database</h4>
<p>
      The InnoDB table compression is automatic and applies to all
      columns and index values. The columns can still be tested with
      operators such as <code class="literal">LIKE</code>, and sort operations can
      still use indexes even when the index values are compressed.
      Because indexes are often a significant fraction of the total size
      of a database, compression could result in significant savings in
      storage, I/O or processor time. The compression and decompression
      operations happen on the database server, which likely is a
      powerful system that is sized to handle the expected load.
</p>
<h4><a name="innodb-compression-in-application"></a>Compressing in the Application</h4>
<p>
      If you compress data such as text in your application, before it
      is inserted into the database, You might save overhead for data
      that does not compress well by compressing some columns and not
      others. This approach uses CPU cycles for compression and
      uncompression on the client machine rather than the database
      server, which might be appropriate for a distributed application
      with many clients, or where the client machine has spare CPU
      cycles.
</p>
<h4><a name="innodb-compression-hybrid"></a>Hybrid Approach</h4>
<p>
      Of course, it is possible to combine these approaches. For some
      applications, it may be appropriate to use some compressed tables
      and some uncompressed tables. It may be best to externally
      compress some data (and store it in uncompressed InnoDB tables)
      and allow InnoDB to compress (some of) the other tables in the
      application. As always, up-front design and real-life testing are
      valuable in reaching the right decision.
</p>
<h4><a name="innodb-compression-tuning-when-workload"></a>Workload Characteristics and Compression</h4>
<a class="indexterm" name="idm140301495399984"></a><p>
      In addition to choosing which tables to compress (and the page
      size), the workload is another key determinant of performance. If
      the application is dominated by reads, rather than updates, fewer
      pages need to be reorganized and recompressed after the index page
      runs out of room for the per-page <span class="quote">“<span class="quote">modification log</span>”</span>
      that InnoDB maintains for compressed data. If the updates
      predominantly change non-indexed columns or those containing
      <code class="literal">BLOB</code>s or large strings that happen to be stored
      <span class="quote">“<span class="quote">off-page</span>”</span>, the overhead of compression may be
      acceptable. If the only changes to a table are
      <code class="literal">INSERT</code>s that use a monotonically increasing
      primary key, and there are few secondary indexes, there is little
      need to reorganize and recompress index pages. Since InnoDB can
      <span class="quote">“<span class="quote">delete-mark</span>”</span> and delete rows on compressed pages
      <span class="quote">“<span class="quote">in place</span>”</span> by modifying uncompressed data,
      <code class="literal">DELETE</code> operations on a table are relatively
      efficient.
    </p><p>
      For some environments, the time it takes to load data can be as
      important as run-time retrieval. Especially in data warehouse
      environments, many tables may be read-only or read-mostly. In
      those cases, it might or might not be acceptable to pay the price
      of compression in terms of increased load time, unless the
      resulting savings in fewer disk reads or in storage cost is
      significant.
    </p><p>
      Fundamentally, compression works best when the CPU time is
      available for compressing and uncompressing data. Thus, if your
      workload is I/O bound, rather than CPU-bound, you might find that
      compression can improve overall performance. When you test your
      application performance with different compression configurations,
      test on a platform similar to the planned configuration of the
      production system.
</p>
<h4><a name="innodb-compression-tuning-when-config"></a>Configuration Characteristics and Compression</h4>
<a class="indexterm" name="idm140301495389920"></a><p>
      Reading and writing database
      <a class="link" href="glossary.html#glos_page" title="page">pages</a> from and to disk is the
      slowest aspect of system performance. Compression attempts to
      reduce I/O by using CPU time to compress and uncompress data, and
      is most effective when I/O is a relatively scarce resource
      compared to processor cycles.
    </p><p>
      This is often especially the case when running in a multi-user
      environment with fast, multi-core CPUs. When a page of a
      compressed table is in memory, InnoDB often uses an additional 16K
      in the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> for an
      uncompressed copy of the page. The adaptive LRU algorithm in the
      InnoDB storage engine attempts to balance the use of memory between
      compressed and uncompressed pages to take into account whether the
      workload is running in an I/O-bound or CPU-bound manner. Still, a
      configuration with more memory dedicated to the InnoDB buffer pool
      tends to run better when using compressed tables than a
      configuration where memory is highly constrained.
</p>
<h4><a name="innodb-compression-tuning-when-size"></a>Choosing the Compressed Page Size</h4>
<a class="indexterm" name="idm140301495383760"></a><a class="indexterm" name="idm140301495382272"></a><a class="indexterm" name="idm140301495380784"></a><a class="indexterm" name="idm140301495379296"></a><p>
      The optimal setting of the compressed page size depends on the
      type and distribution of data that the table and its indexes
      contain. The compressed page size should always be bigger than the
      maximum record size, or operations may fail as noted in
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-internals-storage-btree" title="Compression of B-Tree Pages">Compression of B-Tree Pages</a>.
    </p><p>
      Setting the compressed page size too large wastes some space, but
      the pages do not have to be compressed as often. If the compressed
      page size is set too small, inserts or updates may require
      time-consuming recompression, and the B-tree nodes may have to be
      split more frequently, leading to bigger data files and less
      efficient indexing.
    </p><p>
      Typically, you set the compressed page size to 8K or 4K bytes.
      Given that the maximum row size for an InnoDB table is around 8K,
      <code class="literal">KEY_BLOCK_SIZE=8</code> is usually a safe choice.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-tuning-monitoring"></a>14.9.4 Monitoring Compression at Runtime</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495372496"></a><p>
      Overall application performance, CPU and I/O utilization and the
      size of disk files are good indicators of how effective
      compression is for your application. This section builds on the
      performance tuning advice from
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-tuning" title="14.9.3 Tuning Compression for InnoDB Tables">Section 14.9.3, “Tuning Compression for InnoDB Tables”</a>, and shows how to find
      problems that might not turn up during initial testing.
    </p><p>
      To dig deeper into performance considerations for compressed
      tables, you can monitor compression performance at runtime using
      the <a class="link" href="glossary.html#glos_information_schema" title="INFORMATION_SCHEMA">Information
      Schema</a> tables described in
      <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-examples-compression" title="Example 14.1 Using the Compression Information Schema Tables">Example 14.1, “Using the Compression Information Schema Tables”</a>.
      These tables reflect the internal use of memory and the rates of
      compression used overall.
    </p><p>
      The <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> table reports
      information about compression activity for each compressed page
      size (<code class="literal">KEY_BLOCK_SIZE</code>) in use. The information
      in these tables is system-wide: it summarizes the compression
      statistics across all compressed tables in your database. You can
      use this data to help decide whether or not to compress a table by
      examining these tables when no other compressed tables are being
      accessed. It involves relatively low overhead on the server, so
      you might query it periodically on a production server to check
      the overall efficiency of the compression feature.
    </p><p>
      The key statistics to consider are the number of, and amount of
      time spent performing, compression and uncompression operations.
      Since InnoDB must split B-tree nodes when they are too full to
      contain the compressed data following a modification, compare the
      number of <span class="quote">“<span class="quote">successful</span>”</span> compression operations with
      the number of such operations overall. Based on the information in
      the <code class="literal">INNODB_CMP</code> tables and overall application
      performance and hardware resource utilization, you might make
      changes in your hardware configuration, adjust the size of the
      InnoDB buffer pool, choose a different page size, or select a
      different set of tables to compress.
    </p><p>
      If the amount of CPU time required for compressing and
      uncompressing is high, changing to faster CPUs, or those with more
      cores, can help improve performance with the same data,
      application workload and set of compressed tables. Increasing the
      size of the InnoDB buffer pool might also help performance, so
      that more uncompressed pages can stay in memory, reducing the need
      to uncompress pages that exist in memory only in compressed form.
    </p><p>
      A large number of compression operations overall (compared to the
      number of <code class="literal">INSERT</code>, <code class="literal">UPDATE</code> and
      <code class="literal">DELETE</code> operations in your application and the
      size of the database) could indicate that some of your compressed
      tables are being updated too heavily for effective compression. If
      so, choose a larger page size, or be more selective about which
      tables you compress.
    </p><p>
      If the number of <span class="quote">“<span class="quote">successful</span>”</span> compression operations
      (<code class="literal">COMPRESS_OPS_OK</code>) is a high percentage of the
      total number of compression operations
      (<code class="literal">COMPRESS_OPS</code>), then the system is likely
      performing well. If the ratio is low, then InnoDB is reorganizing,
      recompressing, and splitting B-tree nodes more often than is
      desirable. In this case, avoid compressing some tables, or
      increase <code class="literal">KEY_BLOCK_SIZE</code> for some of the
      compressed tables. You might turn off compression for tables that
      cause the number of <span class="quote">“<span class="quote">compression failures</span>”</span> in your
      application to be more than 1% or 2% of the total. (Such a failure
      ratio might be acceptable during a temporary operation such as a
      data load).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-internals"></a>14.9.5 How Compression Works for InnoDB Tables</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301495352752"></a><p>
      This section describes some internal implementation details about
      <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> for InnoDB
      tables. The information presented here may be helpful in tuning
      for performance, but is not necessary to know for basic use of
      compression.
</p>
<h4><a name="innodb-compression-internals-algorithms"></a>Compression Algorithms</h4>
<a class="indexterm" name="idm140301495348544"></a><p>
      Some operating systems implement compression at the file system
      level. Files are typically divided into fixed-size blocks that are
      compressed into variable-size blocks, which easily leads into
      fragmentation. Every time something inside a block is modified,
      the whole block is recompressed before it is written to disk.
      These properties make this compression technique unsuitable for
      use in an update-intensive database system.
    </p><p>
      InnoDB implements compression with the help of the well-known
      <a class="ulink" href="http://www.zlib.net/" target="_top">zlib library</a>, which
      implements the LZ77 compression algorithm. This compression
      algorithm is mature, robust, and efficient in both CPU utilization
      and in reduction of data size. The algorithm is
      <span class="quote">“<span class="quote">lossless</span>”</span>, so that the original uncompressed data
      can always be reconstructed from the compressed form. LZ77
      compression works by finding sequences of data that are repeated
      within the data to be compressed. The patterns of values in your
      data determine how well it compresses, but typical user data often
      compresses by 50% or more.
    </p><p>
      Unlike compression performed by an application, or compression
      features of some other database management systems, InnoDB
      compression applies both to user data and to indexes. In many
      cases, indexes can constitute 40-50% or more of the total database
      size, so this difference is significant. When compression is
      working well for a data set, the size of the InnoDB data files
      (the <code class="literal">.idb</code> files) is 25% to 50% of the
      uncompressed size or possibly smaller. Depending on the
      <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>, this smaller
      database can in turn lead to a reduction in I/O, and an increase
      in throughput, at a modest cost in terms of increased CPU
      utilization.
</p>
<h4><a name="innodb-compression-internals-storage"></a>InnoDB Data Storage and Compression</h4>
<a class="indexterm" name="idm140301495340256"></a><p>
      All user data in InnoDB tables is stored in pages comprising a
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree</a> index (the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>). In
      some other database systems, this type of index is called an
      <span class="quote">“<span class="quote">index-organized table</span>”</span>. Each row in the index node
      contains the values of the (user-specified or system-generated)
      <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> and all the
      other columns of the table.
    </p><p>
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">Secondary indexes</a> in
      InnoDB tables are also B-trees, containing pairs of values: the
      index key and a pointer to a row in the clustered index. The
      pointer is in fact the value of the primary key of the table,
      which is used to access the clustered index if columns other than
      the index key and primary key are required. Secondary index
      records must always fit on a single B-tree page.
    </p><p>
      The compression of B-tree nodes (of both clustered and secondary
      indexes) is handled differently from compression of
      <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a> used to
      store long <code class="literal">VARCHAR</code>, <code class="literal">BLOB</code>, or
      <code class="literal">TEXT</code> columns, as explained in the following
      sections.
</p>
<h4><a name="innodb-compression-internals-storage-btree"></a>Compression of B-Tree Pages</h4>
<a class="indexterm" name="idm140301495328704"></a><p>
      Because they are frequently updated, B-tree pages require special
      treatment. It is important to minimize the number of times B-tree
      nodes are split, as well as to minimize the need to uncompress and
      recompress their content.
    </p><p>
      One technique InnoDB uses is to maintain some system information
      in the B-tree node in uncompressed form, thus facilitating certain
      in-place updates. For example, this allows rows to be
      delete-marked and deleted without any compression operation.
    </p><p>
      In addition, InnoDB attempts to avoid unnecessary uncompression
      and recompression of index pages when they are changed. Within
      each B-tree page, the system keeps an uncompressed
      <span class="quote">“<span class="quote">modification log</span>”</span> to record changes made to the
      page. Updates and inserts of small records may be written to this
      modification log without requiring the entire page to be
      completely reconstructed.
    </p><p>
      When the space for the modification log runs out, InnoDB
      uncompresses the page, applies the changes and recompresses the
      page. If recompression fails (a situation known as a
      <a class="link" href="glossary.html#glos_compression_failure" title="compression failure">compression
      failure</a>), the B-tree nodes are split and the process is
      repeated until the update or insert succeeds.
    </p><p>
      Generally, InnoDB requires that each B-tree page can accommodate
      at least two records. For compressed tables, this requirement has
      been relaxed. Leaf pages of B-tree nodes (whether of the primary
      key or secondary indexes) only need to accommodate one record, but
      that record must fit in uncompressed form, in the per-page
      modification log. Starting with InnoDB storage engine version 1.0.2, and
      if <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
      <code class="literal">ON</code>, the InnoDB storage engine checks the maximum row
      size during <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>. If the row does not
      fit, the following error message is issued: <code class="literal">ERROR HY000:
      Too big row</code>.
    </p><p>
      If you create a table when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is OFF, and a
      subsequent <code class="literal">INSERT</code> or <code class="literal">UPDATE</code>
      statement attempts to create an index entry that does not fit in
      the size of the compressed page, the operation fails with
      <code class="literal">ERROR 42000: Row size too large</code>. (This error
      message does not name the index for which the record is too large,
      or mention the length of the index record or the maximum record
      size on that particular index page.) To solve this problem,
      rebuild the table with <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      and select a larger compressed page size
      (<code class="literal">KEY_BLOCK_SIZE</code>), shorten any column prefix
      indexes, or disable compression entirely with
      <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPACT</code>.
</p>
<h4><a name="innodb-compression-internals-storage-blobs"></a>Compressing BLOB, VARCHAR, and TEXT Columns</h4>
<a class="indexterm" name="idm140301495307968"></a><a class="indexterm" name="idm140301495306480"></a><a class="indexterm" name="idm140301495304992"></a><a class="indexterm" name="idm140301495303504"></a><p>
      In an InnoDB table, <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns that are not part of
      the primary key may be stored on separately allocated
      <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a>. We refer
      to these columns as <a class="link" href="glossary.html#glos_off_page_column" title="off-page column">off-page
      columns</a>. Their values are stored on singly-linked lists of
      overflow pages.
    </p><p>
      For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
      <code class="literal">ROW_FORMAT=COMPRESSED</code>, the values of
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>, or
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a> columns may be stored fully
      off-page, depending on their length and the length of the entire
      row. For columns that are stored off-page, the clustered index
      record only contains 20-byte pointers to the overflow pages, one
      per column. Whether any columns are stored off-page depends on the
      page size and the total size of the row. When the row is too long
      to fit entirely within the page of the clustered index, MySQL
      chooses the longest columns for off-page storage until the row
      fits on the clustered index page. As noted above, if a row does
      not fit by itself on a compressed page, an error occurs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        For tables created in <code class="literal">ROW_FORMAT=DYNAMIC</code> or
        <code class="literal">ROW_FORMAT=COMPRESSED</code>,
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
        <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than
        or equal to 40 bytes are always stored in-line.
</p>
</div>
<p>
      Tables created in older versions of InnoDB use the
      <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> file format, which
      supports only <code class="literal">ROW_FORMAT=REDUNDANT</code> and
      <code class="literal">ROW_FORMAT=COMPACT</code>. In these formats, MySQL
      stores the first 768 bytes of <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns in the clustered index
      record along with the primary key. The 768-byte prefix is followed
      by a 20-byte pointer to the overflow pages that contain the rest
      of the column value.
    </p><p>
      When a table is in <code class="literal">COMPRESSED</code> format, all data
      written to overflow pages is compressed <span class="quote">“<span class="quote">as is</span>”</span>; that
      is, InnoDB applies the zlib compression algorithm to the entire
      data item. Other than the data, compressed overflow pages contain
      an uncompressed header and trailer comprising a page checksum and
      a link to the next overflow page, among other things. Therefore,
      very significant storage savings can be obtained for longer
      <code class="literal">BLOB</code>, <code class="literal">TEXT</code>, or
      <code class="literal">VARCHAR</code> columns if the data is highly
      compressible, as is often the case with text data. Image data,
      such as <code class="literal">JPEG</code>, is typically already compressed
      and so does not benefit much from being stored in a compressed
      table; the double compression can waste CPU cycles for little or
      no space savings.
    </p><p>
      The overflow pages are of the same size as other pages. A row
      containing ten columns stored off-page occupies ten overflow
      pages, even if the total length of the columns is only 8K bytes.
      In an uncompressed table, ten uncompressed overflow pages occupy
      160K bytes. In a compressed table with an 8K page size, they
      occupy only 80K bytes. Thus, it is often more efficient to use
      compressed table format for tables with long column values.
    </p><p>
      Using a 16K compressed page size can reduce storage and I/O costs
      for <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>, or
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, because such data
      often compress well, and might therefore require fewer overflow
      pages, even though the B-tree nodes themselves take as many pages
      as in the uncompressed form.
</p>
<h4><a name="innodb-compression-internals-pool"></a>Compression and the InnoDB Buffer Pool</h4>
<a class="indexterm" name="idm140301495266448"></a><a class="indexterm" name="idm140301495264944"></a><p>
      In a compressed InnoDB table, every compressed page (whether 1K,
      2K, 4K or 8K) corresponds to an uncompressed page of 16K bytes. To
      access the data in a page, InnoDB reads the compressed page from
      disk if it is not already in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, then
      uncompresses the page to its original form. This section describes
      how InnoDB manages the buffer pool with respect to pages of
      compressed tables.
    </p><p>
      To minimize I/O and to reduce the need to uncompress a page, at
      times the buffer pool contains both the compressed and
      uncompressed form of a database page. To make room for other
      required database pages, InnoDB may
      <a class="link" href="glossary.html#glos_eviction" title="eviction">evict</a> from the buffer pool an
      uncompressed page, while leaving the compressed page in memory.
      Or, if a page has not been accessed in a while, the compressed
      form of the page might be written to disk, to free space for other
      data. Thus, at any given time, the buffer pool might contain both
      the compressed and uncompressed forms of the page, or only the
      compressed form of the page, or neither.
    </p><p>
      InnoDB keeps track of which pages to keep in memory and which to
      evict using a least-recently-used
      (<a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>) list, so that
      <a class="link" href="glossary.html#glos_hot" title="hot">hot</a> (frequently accessed) data
      tends to stay in memory. When compressed tables are accessed,
      MySQL uses an adaptive LRU algorithm to achieve an appropriate
      balance of compressed and uncompressed pages in memory. This
      adaptive algorithm is sensitive to whether the system is running
      in an <a class="link" href="glossary.html#glos_io_bound" title="I/O-bound">I/O-bound</a> or
      <a class="link" href="glossary.html#glos_cpu_bound" title="CPU-bound">CPU-bound</a> manner. The goal
      is to avoid spending too much processing time uncompressing pages
      when the CPU is busy, and to avoid doing excess I/O when the CPU
      has spare cycles that can be used for uncompressing compressed
      pages (that may already be in memory). When the system is
      I/O-bound, the algorithm prefers to evict the uncompressed copy of
      a page rather than both copies, to make more room for other disk
      pages to become memory resident. When the system is CPU-bound,
      MySQL prefers to evict both the compressed and uncompressed page,
      so that more memory can be used for <span class="quote">“<span class="quote">hot</span>”</span> pages and
      reducing the need to uncompress data in memory only in compressed
      form.
</p>
<h4><a name="innodb-compression-internals-log"></a>Compression and the InnoDB Redo Log Files</h4>
<a class="indexterm" name="idm140301495252832"></a><p>
      Before a compressed page is written to a
      <a class="link" href="glossary.html#glos_data_files" title="data files">data file</a>, MySQL writes a
      copy of the page to the redo log (if it has been recompressed
      since the last time it was written to the database). This is done
      to ensure that redo logs are usable for
      <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>, even in
      the unlikely case that the <code class="literal">zlib</code> library is
      upgraded and that change introduces a compatibility problem with
      the compressed data. Therefore, some increase in the size of
      <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>, or a need for more
      frequent <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoints</a>, can
      be expected when using compression. The amount of increase in the
      log file size or checkpoint frequency depends on the number of
      times compressed pages are modified in a way that requires
      reorganization and recompression.
    </p><p>
      Note that compressed tables use a different file format for the
      redo log and the per-table tablespaces than in MySQL 5.1 and
      earlier. The <a class="link" href="glossary.html#glos_mysql_enterprise_backup" title="MySQL Enterprise Backup">MySQL
      Enterprise Backup</a> product supports this latest
      <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format for
      compressed InnoDB tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-compression-syntax-warnings"></a>14.9.6 SQL Compression Syntax Warnings and Errors</h3>

</div>

</div>

</div>
<p>
      Specifying <code class="literal">ROW_FORMAT=COMPRESSED</code> or
      <code class="literal">KEY_BLOCK_SIZE</code> in <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statements produces the following warnings if the Barracuda file
      format is not enabled. You can view them with the <code class="literal">SHOW
      WARNINGS</code> statement.
</p>
<div class="informaltable">
<table summary="Warning level, error code, and message text for messages
        that could be generated when using compression features
        requiring the Barracuda file format." border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Level</th><th scope="col">Code</th><th scope="col">Message</th></tr></thead><tbody><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal">InnoDB: KEY_BLOCK_SIZE requires
              innodb_file_per_table.</code></td></tr><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal">InnoDB: KEY_BLOCK_SIZE requires innodb_file_format=1</code></td></tr><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal">InnoDB: ignoring
              KEY_BLOCK_SIZE=<em class="replaceable"><code>4</code></em>.</code></td></tr><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal">InnoDB: ROW_FORMAT=COMPRESSED requires
innodb_file_per_table.</code></td></tr><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal">InnoDB: assuming ROW_FORMAT=COMPACT.</code></td></tr></tbody></table>
</div>
<p>
      Notes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          By default, these messages are only warnings, not errors, and
          the table is created without compression, as if the options
          were not specified.
        </p></li><li class="listitem"><p>
          When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
          enabled, MySQL generates an error, not a warning, for these
          cases. The table is not created if the current configuration
          does not permit using compressed tables.
</p></li></ul>
</div>
<p>
      The <span class="quote">“<span class="quote">non-strict</span>”</span> behavior lets you import a
      <code class="literal">mysqldump</code> file into a database that does not
      support compressed tables, even if the source database contained
      compressed tables. In that case, MySQL creates the table in
      <code class="literal">ROW_FORMAT=COMPACT</code> instead of preventing the
      operation.
    </p><p>
      To import the dump file into a new database, and have the tables
      re-created as they exist in the original database, ensure the
      server has the proper settings for the configuration parameters
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>.
    </p><p>
      The attribute <code class="literal">KEY_BLOCK_SIZE</code> is permitted only
      when <code class="literal">ROW_FORMAT</code> is specified as
      <code class="literal">COMPRESSED</code> or is omitted. Specifying a
      <code class="literal">KEY_BLOCK_SIZE</code> with any other
      <code class="literal">ROW_FORMAT</code> generates a warning that you can
      view with <code class="literal">SHOW WARNINGS</code>. However, the table is
      non-compressed; the specified <code class="literal">KEY_BLOCK_SIZE</code> is
      ignored).
</p>
<div class="informaltable">
<table summary=" Warning level, error code, and message text for
        messages that could be generated when using conflicting clauses
        for InnoDB table compression. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Level</th><th scope="col">Code</th><th scope="col">Message</th></tr></thead><tbody><tr><td scope="row">Warning</td><td>1478</td><td><code class="literal"> InnoDB: ignoring KEY_BLOCK_SIZE=<em class="replaceable"><code>n</code></em>
unless ROW_FORMAT=COMPRESSED. </code></td></tr></tbody></table>
</div>
<p>
      If you are running with
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> enabled, the
      combination of a <code class="literal">KEY_BLOCK_SIZE</code> with any
      <code class="literal">ROW_FORMAT</code> other than
      <code class="literal">COMPRESSED</code> generates an error, not a warning,
      and the table is not created.
    </p><p>
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-options-table" title="Table 14.2 Meaning of CREATE TABLE and ALTER TABLE options">Table 14.2, “Meaning of CREATE TABLE and ALTER TABLE options”</a>
      summarizes how the various options on <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
      TABLE</code></a> and <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> are
      handled.
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-options-table"></a><p class="title"><b>Table 14.2 Meaning of CREATE TABLE and ALTER TABLE options</b></p>
<div class="table-contents">
<table summary="Meaning of CREATE TABLE and ALTER TABLE options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Option</th><th scope="col">Usage</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row"><code class="literal">ROW_FORMAT=​REDUNDANT</code></td><td>Storage format used prior to MySQL 5.0.3</td><td>Less efficient than <code class="literal">ROW_FORMAT=COMPACT</code>; for backward
              compatibility</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​COMPACT</code></td><td>Default storage format since MySQL 5.0.3</td><td>Stores a prefix of 768 bytes of long column values in the clustered
              index page, with the remaining bytes stored in an overflow
              page</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​DYNAMIC</code></td><td>Available only with
              <code class="literal">innodb_file​_format=Barracuda</code></td><td>Store values within the clustered index page if they fit; if not, stores
              only a 20-byte pointer to an overflow page (no prefix)</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=​COMPRESSED</code></td><td>Available only with
              <code class="literal">innodb_file​_format=Barracuda</code></td><td>Compresses the table and indexes using zlib to default compressed page
              size of 8K bytes; implies
              <code class="literal">ROW_FORMAT=DYNAMIC</code></td></tr><tr><td scope="row"><code class="literal">KEY_BLOCK_​SIZE=<em class="replaceable"><code>n</code></em></code></td><td>Available only with
              <code class="literal">innodb_file​_format=Barracuda</code></td><td>Specifies compressed page size of 1, 2, 4, 8 or 16 kilobytes; implies
              <code class="literal">ROW_FORMAT=DYNAMIC</code> and
<code class="literal">ROW_FORMAT=COMPRESSED</code></td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      <a class="xref" href="innodb-storage-engine.html#innodb-compression-create-and-alter-errors-table" title="Table 14.3 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF">Table 14.3, “CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF”</a>
      summarizes error conditions that occur with certain combinations
      of configuration parameters and options on the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements, and how the
      options appear in the output of <code class="literal">SHOW TABLE
      STATUS</code>.
    </p><p>
      When <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
      <code class="literal">OFF</code>, InnoDB creates or alters the table, but
      ignores certain settings as shown below. You can see the warning
      messages in the MySQL error log. When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode"><code class="literal">innodb_strict_mode</code></a> is
      <code class="literal">ON</code>, these specified combinations of options
      generate errors, and the table is not created or altered. To see
      the full description of the error condition, issue the
      <code class="literal">SHOW ERRORS</code> statement: example:

</p><pre class="screen">
mysql&gt; <strong class="userinput"><code>CREATE TABLE x (id INT PRIMARY KEY, c INT)
</code></strong>
-&gt; <strong class="userinput"><code>ENGINE=INNODB KEY_BLOCK_SIZE=33333;
</code></strong>
ERROR 1005 (HY000): Can't create table 'test.x' (errno: 1478)

mysql&gt; <strong class="userinput"><code>SHOW ERRORS;</code></strong>
+-------+------+-------------------------------------------+ 
| Level | Code | Message                                   | 
+-------+------+-------------------------------------------+ 
| Error | 1478 | InnoDB: invalid KEY_BLOCK_SIZE=33333.     | 
| Error | 1005 | Can't create table 'test.x' (errno: 1478) | 
+-------+------+-------------------------------------------+ 

2 rows in set (0.00 sec)
</pre><p>
</p>
<div class="table">
<a name="innodb-compression-create-and-alter-errors-table"></a><p class="title"><b>Table 14.3 CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF</b></p>
<div class="table-contents">
<table summary="CREATE/ALTER TABLE Warnings and Errors when InnoDB Strict Mode is OFF" border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Syntax</th><th scope="col">Warning or Error Condition</th><th scope="col">Resulting <code class="literal">ROW_FORMAT</code>, as shown in <code class="literal">SHOW TABLE
              STATUS</code></th></tr></thead><tbody><tr><td scope="row"><code class="literal">ROW_FORMAT=REDUNDANT</code></td><td>None</td><td><code class="literal">REDUNDANT</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPACT</code></td><td>None</td><td><code class="literal">COMPACT</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> or
              <code class="literal">ROW_FORMAT=DYNAMIC</code> or
              <code class="literal">KEY_BLOCK_SIZE</code> is specified</td><td>Ignored unless both
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a><code class="literal">=Barracuda</code>
              and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
              are enabled</td><td><code class="literal">COMPACT</code></td></tr><tr><td scope="row">Invalid <code class="literal">KEY_BLOCK_SIZE</code> is specified (not 1, 2, 4, 8
              or 16)</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td>the requested one, or <code class="literal">COMPACT</code> by default</td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT=COMPRESSED</code> and valid
              <code class="literal">KEY_BLOCK_SIZE</code> are specified</td><td>None; <code class="literal">KEY_BLOCK_SIZE</code> specified is used, not the 8K
              default</td><td><code class="literal">COMPRESSED</code></td></tr><tr><td scope="row"><code class="literal">KEY_BLOCK_SIZE</code> is specified with
              <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>
              or <code class="literal">DYNAMIC</code> row format</td><td><code class="literal">KEY_BLOCK_SIZE</code> is ignored</td><td><code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code> or
              <code class="literal">DYNAMIC</code></td></tr><tr><td scope="row"><code class="literal">ROW_FORMAT</code> is not one of
              <code class="literal">REDUNDANT</code>, <code class="literal">COMPACT</code>,
              <code class="literal">DYNAMIC</code> or
              <code class="literal">COMPRESSED</code></td><td>Ignored if recognized by the MySQL parser. Otherwise, an error is
issued.</td><td><code class="literal">COMPACT</code> or N/A</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      When <code class="literal">innodb_strict_mode</code> is
      <code class="literal">ON</code>, the InnoDB storage engine rejects invalid
      <code class="literal">ROW_FORMAT</code> or <code class="literal">KEY_BLOCK_SIZE</code>
      parameters. For compatibility with earlier versions of MySQL,
      strict mode is not enabled by default; instead, MySQL issues
      warnings (not errors) for ignored invalid parameters.
    </p><p>
      Note that it is not possible to see the chosen
      <code class="literal">KEY_BLOCK_SIZE</code> using <code class="literal">SHOW TABLE
      STATUS</code>. The statement <code class="literal">SHOW CREATE
      TABLE</code> displays the <code class="literal">KEY_BLOCK_SIZE</code>
      (even if it was ignored when creating the table). The real
      compressed page size of the table cannot be displayed by MySQL.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-file-format"></a>14.10 InnoDB File-Format Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-enabling">14.10.1 Enabling File Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility">14.10.2 Verifying File Format Compatibility</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-identifying">14.10.3 Identifying the File Format in Use</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-downgrading">14.10.4 Downgrading the File Format</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301495102176"></a><a class="indexterm" name="idm140301495101136"></a><a class="indexterm" name="idm140301495100064"></a><a class="indexterm" name="idm140301495098992"></a><p>
    As <code class="literal">InnoDB</code> evolves, data file formats that are not
    compatible with prior versions of <code class="literal">InnoDB</code> are
    sometimes required to support new features. To to help manage
    compatibility in upgrade and downgrade situations, and systems that
    run different versions of MySQL, <code class="literal">InnoDB</code> uses
    named file formats. <code class="literal">InnoDB</code> currently supports two
    named file formats, <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>
    and <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a> is the original
        <code class="literal">InnoDB</code> file format, which previously did not
        have a name. It supports
        <a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a> and
        <a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a> row
        formats for <code class="literal">InnoDB</code> tables and is the default
        file format in MySQL 5.5 to ensure maximum compatibility with
        earlier MySQL versions that do not support the Barracuda file
        format.
      </p></li><li class="listitem"><p>
        <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> is the newest
        file format. In addition to supporting
        <a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a> and
        <a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a> row
        formats, Barracuda supports
        <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a> and
        <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
        formats for <code class="literal">InnoDB</code> tables. The features
        associated with
        <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a> and
        <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a> row
        formats include compressed tables (see
        <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats">Section 14.11, “InnoDB Row Storage and Row Formats”</a>) and off-page storage for
        long column data (see <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats">Section 14.11, “InnoDB Row Storage and Row Formats”</a>).
</p></li></ul>
</div>
<p>
    This section discusses enabling file formats for new
    <code class="literal">InnoDB</code> tables, verifying compatibility of
    different file formats between MySQL releases, identifying the file
    format in use, and downgrading the file format.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-enabling"></a>14.10.1 Enabling File Formats</h3>
</div>
</div>
</div>
<p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
      configuration parameter defines the file format to use for new
      <code class="literal">InnoDB</code> tables that are created in
      <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file_per_table</a>
      tablespaces. Therefore, to use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> parameter,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
      enabled.
    </p><p>
      To create new tables that take advantage of features supported by
      the <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format,
      including table compression (see
      <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats">Section 14.11, “InnoDB Row Storage and Row Formats”</a>) and off-page storage for long
      column data (see <a class="xref" href="innodb-storage-engine.html#innodb-row-format" title="14.11 InnoDB Row Storage and Row Formats">Section 14.11, “InnoDB Row Storage and Row Formats”</a>), set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to
      <code class="literal">Barracuda</code>. You must also specify
      <code class="literal">ROW_FORMAT=COMPRESSED</code> or
      <code class="literal">ROW_FORMAT=DYNAMIC</code> when creating the table.
    </p><p>
      To preclude the use of features supported by the Barracuda file
      that make your database inaccessible to the built-in
      <code class="literal">InnoDB</code> in MySQL 5.1 and prior releases, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to
      <code class="literal">Antelope</code>. Alternatively, you can disable
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> to have new
      tables created in the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The system tablespace is stored in the original Antelope file
      format.
    </p><p>
      You can set the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> on the command
      line when you start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a>, or in the option
      file (<code class="filename">my.cnf</code> on Unix,
      <code class="filename">my.ini</code> on Windows). You can also change it
      dynamically with the <code class="literal">SET GLOBAL</code> statement.
    </p><pre class="programlisting">mysql&gt; SET GLOBAL innodb_file_format=BARRACUDA;
Query OK, 0 rows affected (0.00 sec)</pre><p>
      Be aware that <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      operations that recreate <code class="literal">InnoDB</code> tables use the
      current <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a>
      setting.
    </p><p>
      Although Oracle recommends using the Barracuda format for new
      tables where practical, in MySQL 5.5 the default file format is
      <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>, for maximum
      compatibility with replication configurations containing earlier
      MySQL releases.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-compatibility"></a>14.10.2 Verifying File Format Compatibility</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility-checking">14.10.2.1 Compatibility Check When InnoDB Is Started</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-format-compatibility-checking-table-access">14.10.2.2 Compatibility Check When a Table Is Opened</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301495045552"></a><p>
      InnoDB incorporates several checks to guard against the possible
      crashes and data corruptions that might occur if you run an older
      release of the MySQL server on InnoDB data files using the new
      Barracuda file format. These checks take place when the server is
      started, and when you first access a table. This section describes
      these checks, how you can control them, and error and warning
      conditions that might arise.
</p>
<h4><a name="idm140301495043616"></a>Backward Compatibility</h4>
<p>
      Considerations of backward compatibility only apply when using a
      recent version of InnoDB (the InnoDB Plugin, or MySQL 5.5 and
      higher with InnoDB) alongside an older one (MySQL 5.1 or earlier,
      with the built-in InnoDB rather than the InnoDB Plugin). To
      minimize the chance of compatibility issues, you can standardize
      on the InnoDB Plugin for all your MySQL 5.1 and earlier database
      servers.
    </p><p>
      In general, a newer version of InnoDB may create a table or index
      that cannot safely be read or written with a prior version of
      InnoDB without risk of crashes, hangs, wrong results or
      corruptions. MySQL 5.5 and higher with InnoDB includes a mechanism
      to guard against these conditions, and to help preserve
      compatibility among database files and versions of InnoDB. This
      mechanism lets you take advantage of some new features of an
      InnoDB release (such as performance improvements and bug fixes),
      and still preserve the option of using your database with a prior
      version of InnoDB, by preventing accidental use of new features
      that create downward-incompatible disk files.
    </p><p>
      If a version of InnoDB supports a particular file format (whether
      or not that format is the default), you can query and update any
      table that requires that format or an earlier format. Only the
      creation of new tables using new features is limited based on the
      particular file format enabled. Conversely, if a tablespace
      contains a table or index that uses a file format that is not
      supported by the currently running software, it cannot be accessed
      at all, even for read access.
    </p><p>
      The only way to <span class="quote">“<span class="quote">downgrade</span>”</span> an InnoDB tablespace to
      the earlier Antelope file format is to copy the data to a new
      table, in a tablespace that uses the earlier format. This can be
      done with the <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement, as described in
      <a class="xref" href="innodb-storage-engine.html#innodb-file-format-downgrading" title="14.10.4 Downgrading the File Format">Section 14.10.4, “Downgrading the File Format”</a>.
    </p><p>
      The easiest way to determine the file format of an existing InnoDB
      tablespace is to examine the properties of the table it contains,
      using the <code class="literal">SHOW TABLE STATUS</code> command or querying
      the table <code class="literal">INFORMATION_SCHEMA.TABLES</code>. If the
      <code class="literal">Row_format</code> of the table is reported as
      <code class="literal">'Compressed'</code> or <code class="literal">'Dynamic'</code>,
      the tablespace containing the table uses the Barracuda format.
      Otherwise, it uses the prior InnoDB file format, Antelope.
</p>
<h4><a name="idm140301495032560"></a>Internal Details</h4>
<p>
      Every InnoDB file-per-table tablespace (represented by a
      <code class="literal">*.ibd</code> file) file is labeled with a file format
      identifier. The system tablespace (represented by the
      <code class="literal">ibdata</code> files) is tagged with the
      <span class="quote">“<span class="quote">highest</span>”</span> file format in use in a group of InnoDB
      database files, and this tag is checked when the files are opened.
    </p><p>
      Creating a compressed table, or a table with
      <code class="literal">ROW_FORMAT=DYNAMIC</code>, updates the file header for
      the corresponding <code class="literal">.ibd</code> file and the table type
      in the InnoDB data dictionary with the identifier for the
      Barracuda file format. From that point forward, the table cannot
      be used with a version of InnoDB that does not support this new
      file format. To protect against anomalous behavior, InnoDB version
      5.0.21 and later performs a compatibility check when the table is
      opened. (In many cases, the <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> statement recreates a table and thus changes its
      properties. The special case of adding or dropping indexes without
      rebuilding the table is described in
      <a class="xref" href="innodb-storage-engine.html#innodb-create-index" title="14.13 InnoDB Fast Index Creation">Section 14.13, “InnoDB Fast Index Creation”</a>.)
</p>
<h4><a name="idm140301495024912"></a>Definition of ib-file set</h4>
<p>
      To avoid confusion, for the purposes of this discussion we define
      the term <span class="quote">“<span class="quote">ib-file set</span>”</span> to mean the set of operating
      system files that InnoDB manages as a unit. The ib-file set
      includes the following files:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The system tablespace (one or more <code class="literal">ibdata</code>
          files) that contain internal system information (including
          internal catalogs and undo information) and may include user
          data and indexes.
        </p></li><li class="listitem"><p>
          Zero or more single-table tablespaces (also called <span class="quote">“<span class="quote">file
          per table</span>”</span> files, named <code class="literal">*.ibd</code>
          files).
        </p></li><li class="listitem"><p>
          InnoDB log files; usually two, <code class="literal">ib_logfile0</code>
          and <code class="literal">ib_logfile1</code>. Used for crash recovery
          and in backups.
</p></li></ul>
</div>
<p>
      An <span class="quote">“<span class="quote">ib-file set</span>”</span> does not include the corresponding
      <code class="literal">.frm</code> files that contain metadata about InnoDB
      tables. The <code class="literal">.frm</code> files are created and managed
      by MySQL, and can sometimes get out of sync with the internal
      metadata in InnoDB.
    </p><p>
      Multiple tables, even from more than one database, can be stored
      in a single <span class="quote">“<span class="quote">ib-file set</span>”</span>. (In MySQL, a
      <span class="quote">“<span class="quote">database</span>”</span> is a logical collection of tables, what
      other systems refer to as a <span class="quote">“<span class="quote">schema</span>”</span> or
      <span class="quote">“<span class="quote">catalog</span>”</span>.)
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-file-format-compatibility-checking"></a>14.10.2.1 Compatibility Check When InnoDB Is Started</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140301495010672"></a><a class="indexterm" name="idm140301495009584"></a><p>
        To prevent possible crashes or data corruptions when InnoDB
        opens an ib-file set, it checks that it can fully support the
        file formats in use within the ib-file set. If the system is
        restarted following a crash, or a <span class="quote">“<span class="quote">fast shutdown</span>”</span>
        (i.e., <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> is
        greater than zero), there may be on-disk data structures (such
        as redo or undo entries, or doublewrite pages) that are in a
        <span class="quote">“<span class="quote">too-new</span>”</span> format for the current software. During
        the recovery process, serious damage can be done to your data
        files if these data structures are accessed. The startup check
        of the file format occurs before any recovery process begins,
        thereby preventing consistency issues with the new tables or
        startup problems for the MySQL server.
      </p><p>
        Beginning with version InnoDB 1.0.1, the system tablespace
        records an identifier or tag for the <span class="quote">“<span class="quote">highest</span>”</span> file
        format used by any table in any of the tablespaces that is part
        of the ib-file set. Checks against this file format tag are
        controlled by the configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>, which
        is <code class="literal">ON</code> by default.
      </p><p>
        If the file format tag in the system tablespace is newer or
        higher than the highest version supported by the particular
        currently executing software and if
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        <code class="literal">ON</code>, the following error is issued when the
        server is started:
      </p><pre class="programlisting">
InnoDB: Error: the system tablespace is in a
file format that this version doesn't support
</pre><p>
        You can also set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> to a file
        format name. Doing so prevents InnoDB from starting if the
        current software does not support the file format specified. It
        also sets the <span class="quote">“<span class="quote">high water mark</span>”</span> to the value you
        specify. The ability to set
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> will
        be useful (with future releases of InnoDB) if you manually
        <span class="quote">“<span class="quote">downgrade</span>”</span> all of the tables in an ib-file set (as
        described in <a class="xref" href="innodb-storage-engine.html#innodb-downgrading" title="14.4 Downgrading the InnoDB Storage Engine">Section 14.4, “Downgrading the InnoDB Storage Engine”</a>). You can then
        rely on the file format check at startup if you subsequently use
        an older version of InnoDB to access the ib-file set.
      </p><p>
        In some limited circumstances, you might want to start the
        server and use an ib-file set that is in a new file format that
        is not supported by the software you are using. If you set the
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>, InnoDB opens the database, but issues
        this warning message in the error log:
      </p><pre class="programlisting">
InnoDB: Warning: the system tablespace is in a
file format that this version doesn't support
</pre>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
          This is a dangerous setting, as it permits the recovery
          process to run, possibly corrupting your database if the
          previous shutdown was a crash or <span class="quote">“<span class="quote">fast shutdown</span>”</span>.
          You should only set
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
          <code class="literal">OFF</code> if you are sure that the previous
          shutdown was done with
          <code class="literal">innodb_fast_shutdown=0</code>, so that essentially
          no recovery process occurs.
</p>
</div>
<p>
        The parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a>
        affects only what happens when a database is opened, not
        subsequently. Conversely, the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> (which
        enables a specific format) only determines whether or not a new
        table can be created in the enabled format and has no effect on
        whether or not a database can be opened.
      </p><p>
        The file format tag is a <span class="quote">“<span class="quote">high water mark</span>”</span>, and as
        such it is increased after the server is started, if a table in
        a <span class="quote">“<span class="quote">higher</span>”</span> format is created or an existing table
        is accessed for read or write (assuming its format is
        supported). If you access an existing table in a format higher
        than the format the running software supports, the system
        tablespace tag is not updated, but table-level compatibility
        checking applies (and an error is issued), as described in
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format-compatibility-checking-table-access" title="14.10.2.2 Compatibility Check When a Table Is Opened">Section 14.10.2.2, “Compatibility Check When a Table Is Opened”</a>.
        Any time the high water mark is updated, the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> is
        updated as well, so the command <code class="literal">SELECT
        @@innodb_file_format_check;</code> displays the name of the
        latest file format known to be used by tables in the currently
        open ib-file set and supported by the currently executing
        software.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-file-format-compatibility-checking-table-access"></a>14.10.2.2 Compatibility Check When a Table Is Opened</h4>

</div>

</div>

</div>
<p>
        When a table is first accessed, InnoDB (including some releases
        prior to InnoDB 1.0) checks that the file format of the
        tablespace in which the table is stored is fully supported. This
        check prevents crashes or corruptions that would otherwise occur
        when tables using a <span class="quote">“<span class="quote">too new</span>”</span> data structure are
        encountered.
      </p><p>
        All tables using any file format supported by a release can be
        read or written (assuming the user has sufficient privileges).
        The setting of the system configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> can prevent
        creating a new table that uses a specific file format, even if
        the file format is supported by a given release. Such a setting
        might be used to preserve backward compatibility, but it does
        not prevent accessing any table that uses a supported format.
      </p><p>
        Versions of MySQL older than 5.0.21 cannot reliably use database
        files created by newer versions if a new file format was used
        when a table was created. To prevent various error conditions or
        corruptions, InnoDB checks file format compatibility when it
        opens a file (for example, upon first access to a table). If the
        currently running version of InnoDB does not support the file
        format identified by the table type in the InnoDB data
        dictionary, MySQL reports the following error:
      </p><pre class="programlisting">
ERROR 1146 (42S02): Table '<em class="replaceable"><code>test</code></em>.<em class="replaceable"><code>t1</code></em>' doesn't exist
</pre><p>
        InnoDB also writes a message to the error log:
      </p><pre class="programlisting">
InnoDB: table <em class="replaceable"><code>test</code></em>/<em class="replaceable"><code>t1</code></em>: unknown table type <em class="replaceable"><code>33</code></em>
</pre><p>
        The table type should be equal to the tablespace flags, which
        contains the file format version as discussed in
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format-identifying" title="14.10.3 Identifying the File Format in Use">Section 14.10.3, “Identifying the File Format in Use”</a>.
      </p><p>
        Versions of InnoDB prior to MySQL 4.1 did not include table
        format identifiers in the database files, and versions prior to
        MySQL 5.0.21 did not include a table format compatibility check.
        Therefore, there is no way to ensure proper operations if a
        table in a newer file format is used with versions of InnoDB
        prior to 5.0.21.
      </p><p>
        The file format management capability in InnoDB 1.0 and higher
        (tablespace tagging and run-time checks) allows InnoDB to verify
        as soon as possible that the running version of software can
        properly process the tables existing in the database.
      </p><p>
        If you permit InnoDB to open a database containing files in a
        format it does not support (by setting the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
        <code class="literal">OFF</code>), the table-level checking described in
        this section still applies.
      </p><p>
        Users are <span class="emphasis"><em>strongly</em></span> urged not to use
        database files that contain Barracuda file format tables with
        releases of InnoDB older than the MySQL 5.1 with the InnoDB
        Plugin. It is possible to <span class="quote">“<span class="quote">downgrade</span>”</span> such tables
        to the Antelope format with the procedure described in
        <a class="xref" href="innodb-storage-engine.html#innodb-file-format-downgrading" title="14.10.4 Downgrading the File Format">Section 14.10.4, “Downgrading the File Format”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-identifying"></a>14.10.3 Identifying the File Format in Use</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494957984"></a><a class="indexterm" name="idm140301494956496"></a><p>
      If you enable a different <a class="link" href="glossary.html#glos_file_format" title="file format">file
      format</a> using the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      option, the change only applies to newly created tables. Also,
      when you create a new table, the tablespace containing the table
      is tagged with the <span class="quote">“<span class="quote">earliest</span>”</span> or
      <span class="quote">“<span class="quote">simplest</span>”</span> file format that is required to support
      the table's features. For example, if you enable the
      <code class="literal">Barracuda</code> file format, and create a new table
      that does not use the Dynamic or Compressed row format, the new
      tablespace that contains the table is tagged as using the
      <code class="literal">Antelope</code> file format .
    </p><p>
      It is easy to identify the file format used by a given table. The
      table uses the <code class="literal">Antelope</code> file format if the row
      format reported by <code class="literal">SHOW TABLE STATUS</code> is either
      <code class="literal">Compact</code> or <code class="literal">Redundant</code>. The
      table uses the <code class="literal">Barracuda</code> file format if the row
      format reported by <code class="literal">SHOW TABLE STATUS</code> is either
      <code class="literal">Compressed</code> or <code class="literal">Dynamic</code>.
    </p><pre class="programlisting">
mysql&gt; SHOW TABLE STATUS\G
*************************** 1. row ***************************
           Name: t1
         Engine: InnoDB
        Version: 10
     Row_format: Compact
           Rows: 0
 Avg_row_length: 0
    Data_length: 16384
Max_data_length: 0
   Index_length: 16384
      Data_free: 0
 Auto_increment: 1
    Create_time: 2014-11-03 13:32:10
    Update_time: NULL
     Check_time: NULL
      Collation: latin1_swedish_ci
       Checksum: NULL
 Create_options: 
        Comment: 
1 row in set (0.00 sec)
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-format-downgrading"></a>14.10.4 Downgrading the File Format</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494940320"></a><p>
      Each InnoDB tablespace file (with a name matching
      <code class="literal">*.ibd</code>) is tagged with the file format used to
      create its table and indexes. The way to downgrade the tablespace
      is to re-create the table and its indexes. The easiest way to
      recreate a table and its indexes is to use the command:
    </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>t</code></em> ROW_FORMAT=<em class="replaceable"><code>COMPACT</code></em>;
</pre><p>
      on each table that you want to downgrade. The
      <code class="literal">COMPACT</code> row format uses the file format
      Antelope. It was introduced in MySQL 5.0.3.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-row-format"></a>14.11 InnoDB Row Storage and Row Formats</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-overview">14.11.1 Overview of InnoDB Row Storage</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-specification">14.11.2 Specifying the Row Format for a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-dynamic">14.11.3 DYNAMIC and COMPRESSED Row Formats</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-row-format-antelope">14.11.4 COMPACT and REDUNDANT Row Formats</a></span></dt></dl>
</div>
<p>
    This section discusses how certain InnoDB features, such as table
    <a class="link" href="glossary.html#glos_compression" title="compression">compression</a> and off-page
    storage of long columns, are controlled by the
    <code class="literal">ROW_FORMAT</code> clause of the
    <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement. It discusses
    considerations for choosing the right row format and compatibility
    of row formats between MySQL releases.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-overview"></a>14.11.1 Overview of InnoDB Row Storage</h3>
</div>
</div>
</div>
<p>
      The storage for rows and associated columns affects performance
      for queries and DML operations. As more rows fit into a single
      disk <a class="link" href="glossary.html#glos_page" title="page">page</a>, queries and index
      lookups can work faster, less cache memory is required in the
      InnoDB buffer pool, and less I/O is required to write out updated
      values for the numeric and short string columns.
    </p><p>
      The data in each InnoDB table is divided into
      <a class="link" href="glossary.html#glos_page" title="page">pages</a>. The pages that make up
      each table are arranged in a tree data structure called a
      <a class="link" href="glossary.html#glos_b_tree" title="B-tree">B-tree index</a>. Table data
      and <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>
      both use this type of structure. The B-tree index that represents
      an entire table is known as the
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>, which
      is organized according to the
      <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary key</a> columns. The
      nodes of the index data structure contain the values of all the
      columns in that row (for the clustered index) or the index columns
      and the primary key columns (for secondary indexes).
    </p><p>
      Variable-length columns are an exception to this rule. Columns
      such as <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>
      that are too long to fit on a B-tree page are stored on separately
      allocated disk pages called
      <a class="link" href="glossary.html#glos_overflow_page" title="overflow page">overflow pages</a>. We call
      such columns <a class="link" href="glossary.html#glos_off_page_column" title="off-page column">off-page
      columns</a>. The values of these columns are stored in
      singly-linked lists of overflow pages, and each such column has
      its own list of one or more overflow pages. In some cases, all or
      a prefix of the long column value is stored in the B-tree, to
      avoid wasting storage and eliminating the need to read a separate
      page.
    </p><p>
      The <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a> file format
      provides a new option (<code class="literal">KEY_BLOCK_SIZE</code>) to
      control how much column data is stored in the clustered index, and
      how much is placed on overflow pages.
    </p><p>
      The next section describes the clauses you can use with the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements to control
      how these variable-length columns are represented:
      <code class="literal">ROW_FORMAT</code> and
      <code class="literal">KEY_BLOCK_SIZE</code>. To use these clauses, you might
      also need to change the settings for the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      options.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-specification"></a>14.11.2 Specifying the Row Format for a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494905920"></a><a class="indexterm" name="idm140301494904432"></a><p>
      You specify the row format for a table with the
      <code class="literal">ROW_FORMAT</code> clause of the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> and
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements. For
      example:
    </p><pre class="programlisting">
CREATE TABLE t1 (f1 int unsigned) ROW_FORMAT=DYNAMIC ENGINE=INNODB;
    </pre><p>
      <code class="literal">InnoDB</code> <code class="literal">ROW_FORMAT</code> options
      include <a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a>,
      <a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a>,
      <a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a>, and
      <a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a>. For
      <code class="literal">InnoDB</code> tables, rows are stored in
      <code class="literal">COMPACT</code> format
      (<code class="literal">ROW_FORMAT=COMPACT</code>) by default. Refer to the
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> documentation for
      additional information about the <code class="literal">ROW_FORMAT</code>
      table option.
    </p><p>
      The physical row structure for <code class="literal">InnoDB</code> tables is
      dependant on the <code class="literal">ROW_FORMAT</code> that you specify.
      See <a class="xref" href="innodb-storage-engine.html#innodb-physical-record" title="14.5.13.6 Physical Row Structure">Section 14.5.13.6, “Physical Row Structure”</a> for more information.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-dynamic"></a>14.11.3 DYNAMIC and COMPRESSED Row Formats</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494884528"></a><a class="indexterm" name="idm140301494883072"></a><a class="indexterm" name="idm140301494882000"></a><a class="indexterm" name="idm140301494880512"></a><a class="indexterm" name="idm140301494879440"></a><p>
      This section discusses the <code class="literal">DYNAMIC</code> and
      <code class="literal">COMPRESSED</code> row formats for InnoDB tables. You
      can only create these kinds of tables when the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format</code></a> configuration
      option is set to <code class="literal">Barracuda</code>. (The Barracuda file
      format also allows the <code class="literal">COMPACT</code> and
      <code class="literal">REDUNDANT</code> row formats.)
    </p><p>
      When a table is created with <code class="literal">ROW_FORMAT=DYNAMIC</code>
      or <code class="literal">ROW_FORMAT=COMPRESSED</code>, long column values
      are stored fully off-page, and the clustered index record contains
      only a 20-byte pointer to the overflow page.
    </p><p>
      Whether any columns are stored off-page depends on the page size
      and the total size of the row. When the row is too long, InnoDB
      chooses the longest columns for off-page storage until the
      clustered index record fits on the B-tree page.
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> columns that are less than or
      equal to 40 bytes are always stored in-line.
    </p><p>
      The <code class="literal">DYNAMIC</code> row format maintains the efficiency
      of storing the entire row in the index node if it fits (as do the
      <code class="literal">COMPACT</code> and <code class="literal">REDUNDANT</code>
      formats), but this new format avoids the problem of filling B-tree
      nodes with a large number of data bytes of long columns. The
      <code class="literal">DYNAMIC</code> format is based on the idea that if a
      portion of a long data value is stored off-page, it is usually
      most efficient to store all of the value off-page. With
      <code class="literal">DYNAMIC</code> format, shorter columns are likely to
      remain in the B-tree node, minimizing the number of overflow pages
      needed for any given row.
    </p><p>
      The <code class="literal">COMPRESSED</code> row format uses similar internal
      details for off-page storage as the <code class="literal">DYNAMIC</code> row
      format, with additional storage and performance considerations
      from the table and index data being compressed and using smaller
      page sizes. With the <code class="literal">COMPRESSED</code> row format, the
      option <code class="literal">KEY_BLOCK_SIZE</code> controls how much column
      data is stored in the clustered index, and how much is placed on
      overflow pages. For full details about the
      <code class="literal">COMPRESSED</code> row format, see
      <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.9 InnoDB Compressed Tables">Section 14.9, “InnoDB Compressed Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-row-format-antelope"></a>14.11.4 COMPACT and REDUNDANT Row Formats</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494856816"></a><a class="indexterm" name="idm140301494855328"></a><a class="indexterm" name="idm140301494854256"></a><a class="indexterm" name="idm140301494852768"></a><a class="indexterm" name="idm140301494851696"></a><p>
      Early versions of InnoDB used an unnamed file format (now called
      <a class="link" href="glossary.html#glos_antelope" title="Antelope">Antelope</a>) for database files.
      With that file format, tables are defined with
      <code class="literal">ROW_FORMAT=COMPACT</code> or
      <code class="literal">ROW_FORMAT=REDUNDANT</code>. InnoDB stores up to the
      first 768 bytes of variable-length columns (such as
      <code class="literal">BLOB</code> and <code class="literal">VARCHAR</code>) in the
      index record within the B-tree node, with the remainder stored on
      the overflow pages.
    </p><p>
      To preserve compatibility with those prior versions, tables
      created with the newest InnoDB default to the
      <code class="literal">COMPACT</code> row format. See
      <a class="xref" href="innodb-storage-engine.html#innodb-row-format-dynamic" title="14.11.3 DYNAMIC and COMPRESSED Row Formats">Section 14.11.3, “DYNAMIC and COMPRESSED Row Formats”</a> for information about
      the newer <code class="literal">DYNAMIC</code> and
      <code class="literal">COMPRESSED</code> row formats.
    </p><p>
      With the Antelope file format, if the value of a column is 768
      bytes or less, no overflow page is needed, and some savings in I/O
      may result, since the value is in the B-tree node. This works well
      for relatively short <code class="literal">BLOB</code>s, but may cause
      B-tree nodes to fill with data rather than key values, reducing
      their efficiency. Tables with many <code class="literal">BLOB</code> columns
      could cause B-tree nodes to become too full of data, and contain
      too few rows, making the entire index less efficient than if the
      rows were shorter or if the column values were stored off-page.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-disk-management"></a>14.12 InnoDB Disk I/O and File Space Management</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-disk-io">14.12.1 InnoDB Disk I/O</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-space">14.12.2 File Space Management</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-checkpoints">14.12.3 InnoDB Checkpoints</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-file-defragmenting">14.12.4 Defragmenting a Table</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-truncate-table-reclaim-space">14.12.5 Reclaiming Disk Space with TRUNCATE TABLE</a></span></dt></dl>
</div>
<p>
    As a DBA, you must manage disk I/O to keep the I/O subsystem from
    becoming saturated, and manage disk space to avoid filling up
    storage devices. The <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> design
    model requires a certain amount of I/O that might seem redundant,
    but helps to ensure data reliability. Within these constraints,
    <code class="literal">InnoDB</code> tries to optimize the database work and
    the organization of disk files to minimize the amount of disk I/O.
    Sometimes, I/O is postponed until the database is not busy, or until
    everything needs to be brought to a consistent state, such as during
    a database restart after a <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast
    shutdown</a>.
  </p><p>
    This section discusses the main considerations for I/O and disk
    space with the default kind of MySQL tables (also known as
    <code class="literal">InnoDB</code> tables):
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Controlling the amount of background I/O used to improve query
        performance.
      </p></li><li class="listitem"><p>
        Enabling or disabling features that provide extra durability at
        the expense of additional I/O.
      </p></li><li class="listitem"><p>
        Organizing tables into many small files, a few larger files, or
        a combination of both.
      </p></li><li class="listitem"><p>
        Balancing the size of redo log files against the I/O activity
        that occurs when the log files become full.
      </p></li><li class="listitem"><p>
        How to reorganize a table for optimal query performance.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-disk-io"></a>14.12.1 InnoDB Disk I/O</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494826816"></a><p>
      <code class="literal">InnoDB</code> uses asynchronous disk I/O where
      possible, by creating a number of threads to handle I/O
      operations, while permitting other database operations to proceed
      while the I/O is still in progress. On Linux and Windows
      platforms, InnoDB uses the available OS and library functions to
      perform <span class="quote">“<span class="quote">native</span>”</span> asynchronous I/O. On other
      platforms, InnoDB still uses I/O threads, but the threads may
      actually wait for I/O requests to complete; this technique is
      known as <span class="quote">“<span class="quote">simulated</span>”</span> asynchronous I/O.
</p>
<h4><a name="idm140301494822864"></a>Read-Ahead</h4>
<p>
      If InnoDB can determine there is a high probability that data
      might be needed soon, it performs read-ahead operations to bring
      that data into the buffer pool so that it is available in memory.
      Making a few large read requests for contiguous data can be more
      efficient than making several small, spread-out requests. There
      are two read-ahead heuristics in InnoDB:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          In sequential read-ahead, if <code class="literal">InnoDB</code> notices
          that the access pattern to a segment in the tablespace is
          sequential, it posts in advance a batch of reads of database
          pages to the I/O system.
        </p></li><li class="listitem"><p>
          In random read-ahead, if <code class="literal">InnoDB</code> notices
          that some area in a tablespace seems to be in the process of
          being fully read into the buffer pool, it posts the remaining
          reads to the I/O system.
</p></li></ul>
</div>
<h4><a name="idm140301494817552"></a>Doublewrite Buffer</h4>
<a class="indexterm" name="idm140301494816864"></a><a class="indexterm" name="idm140301494815792"></a><p>
      <code class="literal">InnoDB</code> uses a novel file flush technique
      involving a structure called the
      <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite buffer</a>,
      which is enabled by default
      (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="literal">innodb_doublewrite=ON</code></a>). It adds
      safety to recovery following a crash or power outage, and improves
      performance on most varieties of Unix by reducing the need for
      <code class="literal">fsync()</code> operations.
    </p><p>
      Before writing pages to a data file, <code class="literal">InnoDB</code>
      first writes them to a contiguous tablespace area called the
      doublewrite buffer. Only after the write and the flush to the
      doublewrite buffer has completed does <code class="literal">InnoDB</code>
      write the pages to their proper positions in the data file. If
      there is an operating system, storage subsystem, or
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash in the middle of a page
      write (causing a <a class="link" href="glossary.html#glos_torn_page" title="torn page">torn page</a>
      condition), <code class="literal">InnoDB</code> can later find a good copy
      of the page from the doublewrite buffer during recovery.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-space"></a>14.12.2 File Space Management</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494801840"></a><p>
      The data files that you define in the configuration file form the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>.
      The files are logically concatenated to form the tablespace. There
      is no striping in use. Currently, you cannot define where within
      the tablespace your tables are allocated. In a newly created
      tablespace, <code class="literal">InnoDB</code> allocates space starting
      from the first data file.
    </p><p>
      To avoid the issues that come with storing all tables and indexes
      inside the system tablespace, you can turn on the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      configuration option, which stores each newly created table in a
      separate tablespace file (with extension <code class="literal">.ibd</code>).
      For tables stored this way, there is less fragmentation within the
      disk file, and when the table is truncated, the space is returned
      to the operating system rather than still being reserved by InnoDB
      within the system tablespace.
</p>
<h4><a name="idm140301494794480"></a>Pages, Extents, Segments, and Tablespaces</h4>
<p>
      Each tablespace consists of database pages with a default size of
      16KB. The pages are grouped into extents of size 1MB (64
      consecutive pages). The <span class="quote">“<span class="quote">files</span>”</span> inside a tablespace
      are called <a class="link" href="glossary.html#glos_segment" title="segment">segments</a> in
      <code class="literal">InnoDB</code>. (These segments are different from the
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a>,
      which actually contains many tablespace segments.)
    </p><p>
      When a segment grows inside the tablespace,
      <code class="literal">InnoDB</code> allocates the first 32 pages to it one
      at a time. After that, <code class="literal">InnoDB</code> starts to
      allocate whole extents to the segment. <code class="literal">InnoDB</code>
      can add up to 4 extents at a time to a large segment to ensure
      good sequentiality of data.
    </p><p>
      Two segments are allocated for each index in
      <code class="literal">InnoDB</code>. One is for nonleaf nodes of the B-tree,
      the other is for the leaf nodes. Keeping the leaf nodes contiguous
      on disk enables better sequential I/O operations, because these
      leaf nodes contain the actual table data.
    </p><p>
      Some pages in the tablespace contain bitmaps of other pages, and
      therefore a few extents in an <code class="literal">InnoDB</code> tablespace
      cannot be allocated to segments as a whole, but only as individual
      pages.
    </p><p>
      When you ask for available free space in the tablespace by issuing
      a <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> statement,
      <code class="literal">InnoDB</code> reports the extents that are definitely
      free in the tablespace. <code class="literal">InnoDB</code> always reserves
      some extents for cleanup and other internal purposes; these
      reserved extents are not included in the free space.
    </p><p>
      When you delete data from a table, <code class="literal">InnoDB</code>
      contracts the corresponding B-tree indexes. Whether the freed
      space becomes available for other users depends on whether the
      pattern of deletes frees individual pages or extents to the
      tablespace. Dropping a table or deleting all rows from it is
      guaranteed to release the space to other users, but remember that
      deleted rows are physically removed only by the
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, which happens
      automatically some time after they are no longer needed for
      transaction rollbacks or consistent reads. (See
      <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.5.12 InnoDB Multi-Versioning">Section 14.5.12, “InnoDB Multi-Versioning”</a>.)
    </p><a class="indexterm" name="idm140301494778112"></a><a class="indexterm" name="idm140301494776624"></a><a class="indexterm" name="idm140301494775136"></a><p>
      To see information about the tablespace, use the Tablespace
      Monitor. See <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.17 InnoDB Monitors">Section 14.17, “InnoDB Monitors”</a>.
</p>
<h4><a name="idm140301494772496"></a>How Pages Relate to Table Rows</h4>
<p>
      The maximum row length, except for variable-length columns
      (<a class="link" href="data-types.html#binary-varbinary" title="11.4.2 The BINARY and VARBINARY Types"><code class="literal">VARBINARY</code></a>,
      <a class="link" href="data-types.html#char" title="11.4.1 The CHAR and VARCHAR Types"><code class="literal">VARCHAR</code></a>,
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a>), is slightly less than half
      of a database page. That is, the maximum row length is about 8000
      bytes. <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGBLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">LONGTEXT</code></a> columns
      must be less than 4GB, and the total row length, including
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">BLOB</code></a> and
      <a class="link" href="data-types.html#blob" title="11.4.3 The BLOB and TEXT Types"><code class="literal">TEXT</code></a> columns, must be less than
      4GB.
    </p><p>
      If a row is less than half a page long, all of it is stored
      locally within the page. If it exceeds half a page,
      variable-length columns are chosen for external off-page storage
      until the row fits within half a page. For a column chosen for
      off-page storage, <code class="literal">InnoDB</code> stores the first 768
      bytes locally in the row, and the rest externally into overflow
      pages. Each such column has its own list of overflow pages. The
      768-byte prefix is accompanied by a 20-byte value that stores the
      true length of the column and points into the overflow list where
      the rest of the value is stored.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-checkpoints"></a>14.12.3 InnoDB Checkpoints</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494757424"></a><p>
      Making your <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a> very
      large may reduce disk I/O during
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpointing</a>. It often
      makes sense to set the total size of the log files as large as the
      buffer pool or even larger. Although in the past large log files
      could make crash recovery take excessive time, starting with MySQL
      5.5, performance enhancements to crash recovery make it possible
      to use large log files with fast startup after a crash. (Strictly
      speaking, this performance improvement is available for MySQL 5.1
      with the InnoDB Plugin 1.0.7 and higher. It is with MySQL 5.5 that
      this improvement is available in the default InnoDB storage
      engine.)
</p>
<h4><a name="idm140301494751840"></a>How Checkpoint Processing Works</h4>
<p>
      <code class="literal">InnoDB</code> implements a
      <a class="link" href="glossary.html#glos_checkpoint" title="checkpoint">checkpoint</a> mechanism known
      as <a class="link" href="glossary.html#glos_fuzzy_checkpointing" title="fuzzy checkpointing">fuzzy
      checkpointing</a>. <code class="literal">InnoDB</code> flushes modified
      database pages from the buffer pool in small batches. There is no
      need to flush the buffer pool in one single batch, which would
      disrupt processing of user SQL statements during the checkpointing
      process.
    </p><p>
      During <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>,
      <code class="literal">InnoDB</code> looks for a checkpoint label written to
      the log files. It knows that all modifications to the database
      before the label are present in the disk image of the database.
      Then <code class="literal">InnoDB</code> scans the log files forward from
      the checkpoint, applying the logged modifications to the database.
    </p><p>
      <code class="literal">InnoDB</code> writes to its log files on a rotating
      basis. It also writes checkpoint information to the first log file
      at each checkpoint. All committed modifications that make the
      database pages in the buffer pool different from the images on
      disk must be available in the log files in case
      <code class="literal">InnoDB</code> has to do a recovery. This means that
      when <code class="literal">InnoDB</code> starts to reuse a log file, it has
      to make sure that the database page images on disk contain the
      modifications logged in the log file that
      <code class="literal">InnoDB</code> is going to reuse. In other words,
      <code class="literal">InnoDB</code> must create a checkpoint and this often
      involves flushing of modified database pages to disk.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-file-defragmenting"></a>14.12.4 Defragmenting a Table</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494737632"></a><a class="indexterm" name="idm140301494735728"></a><p>
      Random insertions into or deletions from a secondary index can
      cause the index to become fragmented. Fragmentation means that the
      physical ordering of the index pages on the disk is not close to
      the index ordering of the records on the pages, or that there are
      many unused pages in the 64-page blocks that were allocated to the
      index.
    </p><p>
      One symptom of fragmentation is that a table takes more space than
      it <span class="quote">“<span class="quote">should</span>”</span> take. How much that is exactly, is
      difficult to determine. All <code class="literal">InnoDB</code> data and
      indexes are stored in B-trees, and their
      <a class="link" href="glossary.html#glos_fill_factor" title="fill factor">fill factor</a> may vary from
      50% to 100%. Another symptom of fragmentation is that a table scan
      such as this takes more time than it <span class="quote">“<span class="quote">should</span>”</span> take:
    </p><pre class="programlisting">
SELECT COUNT(*) FROM t WHERE <em class="replaceable"><code>non_indexed_column</code></em> &lt;&gt; 12345;
</pre><p>
      The preceding query requires MySQL to perform a full table scan,
      the slowest type of query for a large table.
    </p><p>
      To speed up index scans, you can periodically perform a
      <span class="quote">“<span class="quote">null</span>”</span> <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      operation, which causes MySQL to rebuild the table:
    </p><pre class="programlisting">
ALTER TABLE <em class="replaceable"><code>tbl_name</code></em> ENGINE=INNODB
</pre><p>
      Another way to perform a defragmentation operation is to use
      <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> to dump the table to a text file,
      drop the table, and reload it from the dump file.
    </p><p>
      If the insertions into an index are always ascending and records
      are deleted only from the end, the <code class="literal">InnoDB</code>
      filespace management algorithm guarantees that fragmentation in
      the index does not occur.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-truncate-table-reclaim-space"></a>14.12.5 Reclaiming Disk Space with TRUNCATE TABLE</h3>

</div>

</div>

</div>
<p>
      To reclaim operating system disk space when
      <a class="link" href="glossary.html#glos_truncate" title="truncate">truncating</a> an
      <code class="literal">InnoDB</code> table, the table must be stored in its
      own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a> file. For a table to
      be stored in its own <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file">.ibd</a>
      file, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must
      enabled when the table is created. Additionally, there cannot be a
      <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign key</a> constraint
      between the table being truncated and other tables, otherwise the
      <code class="literal">TRUNCATE TABLE</code> operation fails. This is a
      change from previous behavior, which would transform the
      <code class="literal">TRUNCATE</code> operation to a
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation that removes all
      rows and triggers <code class="literal">ON DELETE</code> operations on child
      tables. A foreign key constraint between two columns in the same
      table, however, is permitted.
    </p><p>
      When a table is truncated, it is dropped and re-created in a new
      <code class="filename">.ibd</code> file (previous versions of
      <code class="literal">InnoDB</code> would keep the existing
      <code class="filename">.idb</code> file), and the freed space is returned
      to the operating system. This is in contrast to truncating
      <code class="literal">InnoDB</code> tables that are stored within the
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>
      (tables created when
      <code class="literal">innodb_file_per_table=OFF</code>), where only
      <code class="literal">InnoDB</code> can use the freed space after the table
      is truncated.
    </p><p>
      The ability to truncate tables and return disk space to the
      operating system also means that
      <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backups</a> can
      be smaller. Truncating tables that are stored in the system
      tablespace (tables created when
      <code class="literal">innodb_file_per_table=OFF</code>) leaves blocks of
      unused space in the system tablespace.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-create-index"></a>14.13 InnoDB Fast Index Creation</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-overview">14.13.1 Overview of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-examples">14.13.2 Examples of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-implementation">14.13.3 Implementation Details of Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-concurrency">14.13.4 Concurrency Considerations for Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-recovery">14.13.5 How Crash Recovery Works with Fast Index Creation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-create-index-limitations">14.13.6 Limitations of Fast Index Creation</a></span></dt></dl>
</div>
<p>
    In MySQL 5.5 and higher, or in MySQL 5.1 with the InnoDB Plugin,
    creating and dropping <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary
    indexes</a> does not copy the contents of the entire table,
    making this operation much more efficient than with prior releases.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-overview"></a>14.13.1 Overview of Fast Index Creation</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140301494697056"></a><a class="indexterm" name="idm140301494695984"></a><a class="indexterm" name="idm140301494694912"></a><p>
      With MySQL 5.5 and higher, or MySQL 5.1 with the InnoDB Plugin,
      creating and dropping
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a> for
      InnoDB tables is much faster than before. Historically, adding or
      dropping an index on a table with existing data could be very
      slow. The <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> and
      <a class="link" href="sql-syntax.html#drop-index" title="13.1.24 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> statements worked by
      creating a new, empty table defined with the requested set of
      indexes, then copying the existing rows to the new table
      one-by-one, updating the indexes as the rows are inserted. After
      all rows from the original table were copied, the old table was
      dropped and the copy was renamed with the name of the original
      table.
    </p><p>
      The performance speedup for fast index creation applies to
      secondary indexes, not to the primary key index. The rows of an
      InnoDB table are stored in a
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
      organized based on the <a class="link" href="glossary.html#glos_primary_key" title="primary key">primary
      key</a>, forming what some database systems call an
      <span class="quote">“<span class="quote">index-organized table</span>”</span>. Because the table structure
      is so closely tied to the primary key, redefining the primary key
      still requires copying the data.
    </p><p>
      This new mechanism also means that you can generally speed the
      overall process of creating and loading an indexed table by
      creating the table with only the clustered index, and adding the
      secondary indexes after the data is loaded.
    </p><p>
      Although no syntax changes are required in the
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a class="link" href="sql-syntax.html#drop-index" title="13.1.24 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a> commands, some factors
      affect the performance, space usage, and semantics of this
      operation (see <a class="xref" href="innodb-storage-engine.html#innodb-create-index-limitations" title="14.13.6 Limitations of Fast Index Creation">Section 14.13.6, “Limitations of Fast Index Creation”</a>).
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-examples"></a>14.13.2 Examples of Fast Index Creation</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494677392"></a><p>
      It is possible to create multiple indexes on a table with one
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement. This is
      relatively efficient, because the clustered index of the table
      needs to be scanned only once (although the data is sorted
      separately for each new index). For example:
    </p><pre class="programlisting">
CREATE TABLE T1(A INT PRIMARY KEY, B INT, C CHAR(1)) ENGINE=InnoDB;
INSERT INTO T1 VALUES (1,2,'a'), (2,3,'b'), (3,2,'c'), (4,3,'d'), (5,2,'e');
COMMIT;
ALTER TABLE T1 ADD INDEX (B), ADD UNIQUE INDEX (C);
</pre><p>
      The above statements create table <code class="literal">T1</code> with the
      clustered index (primary key) on column <code class="literal">A</code>,
      insert several rows, and then build two new indexes on columns
      <code class="literal">B</code> and <code class="literal">C</code>. If there were many
      rows inserted into <code class="literal">T1</code> before the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement, this
      approach is much more efficient than creating all the secondary
      indexes before loading the data.
    </p><p>
      You can also create the indexes one at a time, but then the
      clustered index of the table is scanned (as well as sorted) once
      for each <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement.
      Thus, the following statements are not as efficient as the
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement above, even
      though neither requires recreating the clustered index for table
      <code class="literal">T1</code>.
    </p><pre class="programlisting">
CREATE INDEX B ON T1 (B);
CREATE UNIQUE INDEX C ON T1 (C);
</pre><p>
      Dropping InnoDB secondary indexes also does not require any
      copying of table data. You can equally quickly drop multiple
      indexes with a single <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement or multiple <a class="link" href="sql-syntax.html#drop-index" title="13.1.24 DROP INDEX Syntax"><code class="literal">DROP INDEX</code></a>
      statements:
    </p><pre class="programlisting">
ALTER TABLE T1 DROP INDEX B, DROP INDEX C;
</pre><p>
      or:
    </p><pre class="programlisting">
DROP INDEX B ON T1;
DROP INDEX C ON T1;
</pre><p>
      Restructuring the clustered index in InnoDB always requires
      copying the data in the table. For example, if you create a table
      without a primary key, InnoDB chooses one for you, which may be
      the first <code class="literal">UNIQUE</code> key defined on <code class="literal">NOT
      NULL</code> columns, or a system-generated key. Defining a
      <code class="literal">PRIMARY KEY</code> later causes the data to be copied,
      as in the following example:
    </p><pre class="programlisting">CREATE TABLE T2 (A INT, B INT) ENGINE=InnoDB;
INSERT INTO T2 VALUES (NULL, 1);
ALTER TABLE T2 ADD PRIMARY KEY (B);
</pre><p>
      When you create a <code class="literal">UNIQUE</code> or <code class="literal">PRIMARY
      KEY</code> index, InnoDB must do some extra work. For
      <code class="literal">UNIQUE</code> indexes, InnoDB checks that the table
      contains no duplicate values for the key. For a <code class="literal">PRIMARY
      KEY</code> index, InnoDB also checks that none of the
      <code class="literal">PRIMARY KEY</code> columns contains a
      <code class="literal">NULL</code>. It is best to define the primary key when
      you create a table, so you need not rebuild the table later.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-implementation"></a>14.13.3 Implementation Details of Fast Index Creation</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494645888"></a><a class="indexterm" name="idm140301494644400"></a><a class="indexterm" name="idm140301494642912"></a><p>
      InnoDB has two types of indexes: the clustered index and secondary
      indexes. Since the clustered index contains the data values in its
      B-tree nodes, adding or dropping a clustered index does involve
      copying the data, and creating a new copy of the table. A
      secondary index, however, contains only the index key and the
      value of the primary key. This type of index can be created or
      dropped without copying the data in the clustered index. Because
      each secondary index contains copies of the primary key values
      (used to access the clustered index when needed), when you change
      the definition of the primary key, all secondary indexes are
      recreated as well.
    </p><p>
      Dropping a secondary index is simple. Only the internal InnoDB
      system tables and the MySQL data dictionary tables are updated to
      reflect the fact that the index no longer exists. InnoDB returns
      the storage used for the index to the tablespace that contained
      it, so that new indexes or additional table rows can use the
      space.
    </p><p>
      To add a secondary index to an existing table, InnoDB scans the
      table, and sorts the rows using memory buffers and temporary files
      in order by the values of the secondary index key columns. The
      B-tree is then built in key-value order, which is more efficient
      than inserting rows into an index in random order. Because the
      B-tree nodes are split when they fill, building the index in this
      way results in a higher fill-factor for the index, making it more
      efficient for subsequent access.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-concurrency"></a>14.13.4 Concurrency Considerations for Fast Index Creation</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494636512"></a><p>
      While an InnoDB secondary index is being created or dropped, the
      table is locked in shared mode. Any writes to the table are
      blocked, but the data in the table can be read. When you alter the
      clustered index of a table, the table is locked in exclusive mode,
      because the data must be copied. Thus, during the creation of a
      new clustered index, all operations on the table are blocked.
    </p><p>
      A <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement for an InnoDB
      table always waits for currently executing transactions that are
      accessing the table to commit or roll back.
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements that
      redefine an InnoDB primary key wait for all
      <code class="literal">SELECT</code> statements that access the table to
      complete, or their containing transactions to commit. No
      transactions whose execution spans the creation of the index can
      be accessing the table, because the original table is dropped when
      the clustered index is restructured.
    </p><p>
      Once a <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> or
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement that creates
      an InnoDB secondary index begins executing, queries can access the
      table for read access, but cannot update the table. If an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement is changing
      the clustered index for an InnoDB table, all queries wait until
      the operation completes.
    </p><p>
      A newly-created InnoDB secondary index contains only the committed
      data in the table at the time the <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE
      INDEX</code></a> or <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
      statement begins to execute. It does not contain any uncommitted
      values, old versions of values, or values marked for deletion but
      not yet removed from the old index.
    </p><p>
      Because a newly-created index contains only information about data
      current at the time the index was created, queries that need to
      see data that was deleted or changed before the index was created
      cannot use the index. The only queries that could be affected by
      this limitation are those executing in transactions that began
      before the creation of the index was begun. For such queries,
      unpredictable results could occur. Newer queries can use the
      index.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-recovery"></a>14.13.5 How Crash Recovery Works with Fast Index Creation</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494617488"></a><p>
      Although no data is lost if the server crashes while an
      <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement is executing,
      the <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
      process is different for
      <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered indexes</a> and
      <a class="link" href="glossary.html#glos_secondary_index" title="secondary index">secondary indexes</a>.
    </p><p>
      If the server crashes while creating an InnoDB secondary index,
      upon recovery, MySQL drops any partially created indexes. You must
      re-run the <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> or
      <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statement.
    </p><p>
      When a crash occurs during the creation of an InnoDB clustered
      index, recovery is more complicated, because the data in the table
      must be copied to an entirely new clustered index. Remember that
      all InnoDB tables are stored as clustered indexes. In the
      following discussion, we use the word table and clustered index
      interchangeably.
    </p><p>
      MySQL creates the new clustered index by copying the existing data
      from the original InnoDB table to a temporary table that has the
      desired index structure. Once the data is completely copied to
      this temporary table, the original table is renamed with a
      different temporary table name. The temporary table comprising the
      new clustered index is renamed with the name of the original
      table, and the original table is dropped from the database.
    </p><p>
      If a system crash occurs while creating a new clustered index, no
      data is lost, but you must complete the recovery process using the
      temporary tables that exist during the process. Since it is rare
      to re-create a clustered index or re-define primary keys on large
      tables, or to encounter a system crash during this operation, this
      manual does not provide information on recovering from this
      scenario. Contact MySQL support.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-create-index-limitations"></a>14.13.6 Limitations of Fast Index Creation</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494601872"></a><a class="indexterm" name="idm140301494600384"></a><a class="indexterm" name="idm140301494598896"></a><p>
      Take the following considerations into account when creating or
      dropping InnoDB indexes:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          During index creation, files are written to the temporary
          directory (<code class="literal">$TMPDIR</code> on Unix,
          <code class="literal">%TEMP%</code> on Windows, or the value of the
          <a class="link" href="server-administration.html#sysvar_tmpdir"><code class="literal">--tmpdir</code></a> configuration
          variable). Each temporary file is large enough to hold one
          column that makes up the new index, and each one is removed as
          soon as it is merged into the final index.
        </p></li><li class="listitem"><p>
          An <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statement that
          contains <code class="literal">DROP INDEX</code> and <code class="literal">ADD
          INDEX</code> clauses that both name the same index uses a
          table copy, not Fast Index Creation.
        </p></li><li class="listitem"><p>
          The table is copied, rather than using Fast Index Creation
          when you create an index on a <code class="literal">TEMPORARY
          TABLE</code>. This has been reported as MySQL Bug #39833.
        </p></li><li class="listitem"><p>
          To avoid consistency issues between the InnoDB data dictionary
          and the MySQL data dictionary, the table is copied, rather
          than using Fast Index Creation when you use the <code class="literal">ALTER
          TABLE ... RENAME COLUMN</code> syntax.
        </p></li><li class="listitem"><p>
          The statement <code class="literal">ALTER IGNORE TABLE
          <em class="replaceable"><code>t</code></em> ADD UNIQUE INDEX</code> does
          not delete duplicate rows. This has been reported as MySQL Bug
          #40344. The <code class="literal">IGNORE</code> keyword is ignored. If
          any duplicate rows exist, the operation fails with the
          following error message:
        </p><pre class="programlisting">
ERROR 23000: Duplicate entry '<em class="replaceable"><code>347</code></em>' for key '<em class="replaceable"><code>pl</code></em>'
</pre></li><li class="listitem"><p>
          As noted above, a newly-created index contains only
          information about data current at the time the index was
          created. Therefore, you should not run queries in a
          transaction that might use a secondary index that did not
          exist at the beginning of the transaction. There is no way for
          InnoDB to access <span class="quote">“<span class="quote">old</span>”</span> data that is consistent
          with the rest of the data read by the transaction. See the
          discussion of locking in
          <a class="xref" href="innodb-storage-engine.html#innodb-create-index-concurrency" title="14.13.4 Concurrency Considerations for Fast Index Creation">Section 14.13.4, “Concurrency Considerations for Fast Index Creation”</a>.
        </p><p>
          Prior to InnoDB storage engine 1.0.4, unexpected results could occur
          if a query attempts to use an index created after the start of
          the transaction containing the query. If an old transaction
          attempts to access a <span class="quote">“<span class="quote">too new</span>”</span> index,
          InnoDB storage engine 1.0.4 and later reports an error:
        </p><pre class="programlisting">
ERROR HY000: Table definition has changed, please retry transaction
</pre><p>
          As the error message suggests, committing (or rolling back)
          the transaction, and restarting it, cures the problem.
        </p></li><li class="listitem"><p>
          InnoDB storage engine 1.0.2 introduces some improvements in error
          handling when users attempt to drop indexes. See
          <a class="xref" href="innodb-storage-engine.html#innodb-error-codes" title="14.20.5 InnoDB Error Codes">Section 14.20.5, “InnoDB Error Codes”</a> for information related
          to errors <code class="literal">1025</code>, <code class="literal">1553</code>,
          and <code class="literal">42000</code>.
        </p></li><li class="listitem"><p>
          MySQL 5.5 does not support efficient creation or dropping of
          <code class="literal">FOREIGN KEY</code> constraints. Therefore, if you
          use <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> to add or
          remove a <code class="literal">REFERENCES</code> constraint, the child
          table is copied, rather than using Fast Index Creation.

          



          
        </p></li><li class="listitem"><p>
          <a class="link" href="sql-syntax.html#optimize-table" title="13.7.2.4 OPTIMIZE TABLE Syntax"><code class="literal">OPTIMIZE TABLE</code></a> for an
          <code class="literal">InnoDB</code> table is mapped to an
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> operation to
          rebuild the table and update index statistics and free unused
          space in the clustered index. This operation does not use fast
          index creation. Secondary indexes are not created as
          efficiently because keys are inserted in the order they
          appeared in the primary key.
</p></li></ul>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-parameters"></a>14.14 InnoDB Startup Options and System Variables</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140301494559936"></a><a class="indexterm" name="idm140301494558464"></a><p>
      This section describes the <code class="literal">InnoDB</code>-related
      command options and system variables.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          System variables that are true or false can be enabled at
          server startup by naming them, or disabled by using a
          <code class="literal">--skip-</code> prefix. For example, to enable or
          disable <code class="literal">InnoDB</code> checksums, you can use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="option">--innodb_checksums</code></a> or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="option">--skip-innodb_checksums</code></a>
          on the command line, or
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="literal">innodb_checksums</code></a> or
          <code class="literal">skip-innodb_checksums</code> in an option file.
        </p></li><li class="listitem"><p>
          System variables that take a numeric value can be specified as
          <code class="option">--<em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          on the command line or as
          <code class="literal"><em class="replaceable"><code>var_name</code></em>=<em class="replaceable"><code>value</code></em></code>
          in option files.
        </p></li><li class="listitem"><p>
          Many system variables can be changed at runtime (see
          <a class="xref" href="server-administration.html#dynamic-system-variables" title="5.1.5.2 Dynamic System Variables">Section 5.1.5.2, “Dynamic System Variables”</a>).
        </p></li><li class="listitem"><p>
          For information about <code class="literal">GLOBAL</code> and
          <code class="literal">SESSION</code> variable scope modifiers, refer to
          the
          <a class="link" href="sql-syntax.html#set-statement" title="13.7.4 SET Syntax"><code class="literal">SET</code></a>
          statement documentation.
        </p></li><li class="listitem"><p>
          Certain options control the locations and layout of the
          <code class="literal">InnoDB</code> data files.
          <a class="xref" href="innodb-storage-engine.html#innodb-configuration" title="14.6 InnoDB Configuration">Section 14.6, “InnoDB Configuration”</a> explains how to use
          these options.
        </p></li><li class="listitem"><p>
          Some options, which you might not use initially, help tune
          <code class="literal">InnoDB</code> performance characteristics based on
          machine capacity and your database
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
        </p></li><li class="listitem"><p>
          For more information on specifying options and system
          variables, see <a class="xref" href="programs.html#program-options" title="4.2.3 Specifying Program Options">Section 4.2.3, “Specifying Program Options”</a>.
</p></li></ul>
</div>
<div class="table">
<a name="idm140301494534320"></a><p class="title"><b>Table 14.4 <code class="literal">InnoDB</code> Option/Variable
Reference</b></p>
<div class="table-contents">
<table summary="InnoDB Option/Variable
Reference" border="1"><colgroup><col class="name"><col class="cmd-line"><col class="option_file"><col class="system_var"><col class="status_var"><col class="var_scope"><col class="dynamic"></colgroup><thead><tr><th scope="col">Name</th><th scope="col">Cmd-Line</th><th scope="col">Option File</th><th scope="col">System Var</th><th scope="col">Status Var</th><th scope="col">Var Scope</th><th scope="col">Dynamic</th></tr></thead><tbody><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_foreign_key_checks">foreign_key_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Varies</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_have_innodb">have_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb">ignore-builtin-innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"> - <span class="emphasis"><em>Variable</em></span>: <a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb">innodb</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_data">Innodb_buffer_pool_bytes_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_bytes_dirty">Innodb_buffer_pool_bytes_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_data">Innodb_buffer_pool_pages_data</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_dirty">Innodb_buffer_pool_pages_dirty</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_flushed">Innodb_buffer_pool_pages_flushed</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_free">Innodb_buffer_pool_pages_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_latched">Innodb_buffer_pool_pages_latched</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_misc">Innodb_buffer_pool_pages_misc</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_pages_total">Innodb_buffer_pool_pages_total</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead">Innodb_buffer_pool_read_ahead</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted">Innodb_buffer_pool_read_ahead_evicted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_requests">Innodb_buffer_pool_read_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_reads">Innodb_buffer_pool_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_wait_free">Innodb_buffer_pool_wait_free</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_write_requests">Innodb_buffer_pool_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums">innodb_checksums</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs">Innodb_data_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_fsyncs">Innodb_data_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_reads">Innodb_data_pending_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_pending_writes">Innodb_data_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_read">Innodb_data_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_reads">Innodb_data_reads</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_writes">Innodb_data_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_data_written">Innodb_data_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_pages_written">Innodb_dblwr_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_dblwr_writes">Innodb_dblwr_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format">innodb_file_format</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Varies</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_have_atomic_builtins">Innodb_have_atomic_builtins</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_waits">Innodb_log_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_write_requests">Innodb_log_write_requests</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_log_writes">Innodb_log_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_mirrored_log_groups">innodb_mirrored_log_groups</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_fsyncs">Innodb_os_log_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_fsyncs">Innodb_os_log_pending_fsyncs</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_pending_writes">Innodb_os_log_pending_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_os_log_written">Innodb_os_log_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_page_size">Innodb_page_size</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_created">Innodb_pages_created</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_read">Innodb_pages_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_pages_written">Innodb_pages_written</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_current_waits">Innodb_row_lock_current_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time">Innodb_row_lock_time</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_avg">Innodb_row_lock_time_avg</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_time_max">Innodb_row_lock_time_max</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_row_lock_waits">Innodb_row_lock_waits</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_deleted">Innodb_rows_deleted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_inserted">Innodb_rows_inserted</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_read">Innodb_rows_read</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_rows_updated">Innodb_rows_updated</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file">innodb-status-file</a></td><td>Yes</td><td>Yes</td><td> </td><td> </td><td> </td><td> </td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa">innodb_support_xa</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Both</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#statvar_Innodb_truncated_status_writes">Innodb_truncated_status_writes</a></td><td> </td><td> </td><td> </td><td>Yes</td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_version">innodb_version</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>No</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_timed_mutexes">timed_mutexes</a></td><td>Yes</td><td>Yes</td><td>Yes</td><td> </td><td>Global</td><td>Yes</td></tr><tr><td scope="row"><a class="link" href="server-administration.html#sysvar_unique_checks">unique_checks</a></td><td> </td><td> </td><td>Yes</td><td> </td><td>Varies</td><td>Yes</td></tr></tbody></table>
</div>

</div>
<br class="table-break">
<h3><a name="idm140301494157472"></a>InnoDB Command Options</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="option_mysqld_ignore-builtin-innodb"></a>
          <a class="indexterm" name="idm140301494155568"></a>

          <a class="indexterm" name="idm140301494154112"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.5.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.1, this option caused the server to behave as if
          the built-in <code class="literal">InnoDB</code> were not present, which
          enabled <code class="literal">InnoDB Plugin</code> to be used instead.
          In MySQL 5.5, <code class="literal">InnoDB</code> is the
          default storage engine and <code class="literal">InnoDB Plugin</code> is
          not used, so this option has no effect. As of MySQL 5.5.22, it
          is deprecated and its use results in a warning.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb"></a>
          <a class="indexterm" name="idm140301494128128"></a>

          <a class="indexterm" name="idm140301494126672"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb[=<em class="replaceable"><code>value</code></em>]</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb[=value]</code></td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">FORCE</code></td></tr></tbody></table>
</div>
<p>
          Controls loading of the <code class="literal">InnoDB</code> storage
          engine, if the server was compiled with
          <code class="literal">InnoDB</code> support. This option has a tristate
          format, with possible values of <code class="literal">OFF</code>,
          <code class="literal">ON</code>, or <code class="literal">FORCE</code>. See
          <a class="xref" href="server-administration.html#server-plugin-loading" title="5.1.8.1 Installing and Uninstalling Plugins">Section 5.1.8.1, “Installing and Uninstalling Plugins”</a>.
        </p><p>
          To disable <code class="literal">InnoDB</code>, use
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb=OFF</code></a>
          or
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>.
          In this case, because the default storage engine is
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>, the server will not start
          unless you also use
          <a class="link" href="server-administration.html#option_mysqld_default-storage-engine"><code class="option">--default-storage-engine</code></a> to set
          the default to some other engine.
        </p></li><li class="listitem"><p><a name="option_mysqld_innodb-status-file"></a>
          <a class="indexterm" name="idm140301494095376"></a>

          <a class="indexterm" name="idm140301494093920"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file"><code class="option">--innodb-status-file</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb-status-file" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-status-file</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Controls whether <code class="literal">InnoDB</code> creates a file
          named
          <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
          in the MySQL data directory. If enabled,
          <code class="literal">InnoDB</code> periodically writes the output of
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> to this file.
        </p><p>
          By default, the file is not created. To create it, start
          <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file"><code class="option">--innodb-status-file=1</code></a> option.
          The file is deleted during normal shutdown.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140301494071376"></a>

          <a class="indexterm" name="idm140301494069888"></a>

          <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--skip-innodb</code></a>
        </p><p>
          Disable the <code class="literal">InnoDB</code> storage engine. See the
          description of <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb"><code class="option">--innodb</code></a>.
</p></li></ul>
</div>
<h3><a name="idm140301494065008"></a>InnoDB System Variables</h3>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="sysvar_ignore_builtin_innodb"></a>
          <a class="indexterm" name="idm140301494063040"></a>

          <a class="indexterm" name="idm140301494062000"></a>

          <code class="literal">ignore_builtin_innodb</code>
</p>
<div class="informaltable">
<table summary="Options for ignore-builtin-innodb" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Deprecated</strong></span></td><td colspan="3">5.5.22</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--ignore-builtin-innodb</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_ignore_builtin_innodb">ignore_builtin_innodb</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr></tbody></table>
</div>
<p>
          See the description of
          <a class="link" href="innodb-storage-engine.html#option_mysqld_ignore-builtin-innodb"><code class="option">--ignore-builtin-innodb</code></a> under
          <span class="quote">“<span class="quote"><code class="literal">InnoDB</code> Command Options</span>”</span>
          earlier in this section.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_flushing"></a>
          <a class="indexterm" name="idm140301494037424"></a>

          <a class="indexterm" name="idm140301494036320"></a>

          <code class="literal">innodb_adaptive_flushing</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_flushing" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_flushing=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing">innodb_adaptive_flushing</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140301494014992"></a><p>
          Specifies whether to dynamically adjust the rate of flushing
          <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> in the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> based on
          the workload. Adjusting the flush rate dynamically is intended
          to avoid bursts of I/O activity. This setting is enabled by
          default. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.15.2.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.15.2.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_adaptive_hash_index"></a>
          <a class="indexterm" name="idm140301494008288"></a>

          <a class="indexterm" name="idm140301494007184"></a>

          <code class="literal">innodb_adaptive_hash_index</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_adaptive_hash_index" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_adaptive_hash_index=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index">innodb_adaptive_hash_index</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          index</a> is enabled or disabled. It may be desirable,
          depending on your workload, to dynamically enable or disable
          <a class="link" href="glossary.html#glos_adaptive_hash_index" title="adaptive hash index">adaptive hash
          indexing</a> to improve query performance. Because the
          adaptive hash index may not be useful for all workloads,
          conduct benchmarks with it both enabled and disabled, using
          realistic workloads. See
          <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.5.13.5 Adaptive Hash Indexes">Section 14.5.13.5, “Adaptive Hash Indexes”</a> for details.
        </p><p>
          This variable is enabled by default. As of MySQL 5.5, You can
          modify this parameter using the <code class="literal">SET GLOBAL</code>
          statement, without restarting the server. Changing the setting
          requires the <code class="literal">SUPER</code> privilege. You can also
          use <code class="option">--skip-innodb_adaptive_hash_index</code> at
          server startup to disable it.
        </p><p>
          Disabling the adaptive hash index empties the hash table
          immediately. Normal operations can continue while the hash
          table is emptied, and executing queries that were using the
          hash table access the index B-trees directly instead. When the
          adaptive hash index is re-enabled, the hash table is populated
          again during normal operation.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_additional_mem_pool_size"></a>
          <a class="indexterm" name="idm140301493977504"></a>

          <a class="indexterm" name="idm140301493976400"></a>

          <code class="literal">innodb_additional_mem_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_additional_mem_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_additional_mem_pool_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size">innodb_additional_mem_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2097152</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of a memory pool <code class="literal">InnoDB</code>
          uses to store <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data
          dictionary</a> information and other internal data
          structures. The more tables you have in your application, the
          more memory you need to allocate here. If
          <code class="literal">InnoDB</code> runs out of memory in this pool, it
          starts to allocate memory from the operating system and writes
          warning messages to the MySQL error log. The default value is
          8MB.
        </p><p>
          This variable relates to the <code class="literal">InnoDB</code>
          internal memory allocator, which is unused if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
          enabled.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoextend_increment"></a>
          <a class="indexterm" name="idm140301493943792"></a>

          <a class="indexterm" name="idm140301493942688"></a>

          <code class="literal">innodb_autoextend_increment</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoextend_increment" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoextend_increment=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment">innodb_autoextend_increment</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          The increment size (in MB) for extending the size of an
          auto-extending <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> file when it becomes full. The default value
          is 8. This variable does not affect the per-table tablespace
          files that are created if you use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=1</code></a>.
          Those files are auto-extending regardless of the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoextend_increment"><code class="literal">innodb_autoextend_increment</code></a>.
          The initial extensions are by small amounts, after which
          extensions occur in increments of 4MB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_autoinc_lock_mode"></a>
          <a class="indexterm" name="idm140301493911600"></a>

          <a class="indexterm" name="idm140301493910496"></a>

          <code class="literal">innodb_autoinc_lock_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_autoinc_lock_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_autoinc_lock_mode=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_autoinc_lock_mode">innodb_autoinc_lock_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_lock_mode" title="lock mode">lock mode</a> to use for
          generating
          <a class="link" href="glossary.html#glos_auto_increment" title="auto-increment">auto-increment</a>
          values. The permissible values are 0, 1, or 2, for
          <span class="quote">“<span class="quote">traditional</span>”</span>, <span class="quote">“<span class="quote">consecutive</span>”</span>, or
          <span class="quote">“<span class="quote">interleaved</span>”</span> lock mode, respectively.
          <a class="xref" href="innodb-storage-engine.html#innodb-auto-increment-handling" title="14.8.5 AUTO_INCREMENT Handling in InnoDB">Section 14.8.5, “AUTO_INCREMENT Handling in InnoDB”</a>, describes
          the characteristics of these modes.
        </p><p>
          This variable has a default of 1 (<span class="quote">“<span class="quote">consecutive</span>”</span>
          lock mode).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_instances"></a>
          <a class="indexterm" name="idm140301493877264"></a>

          <a class="indexterm" name="idm140301493876160"></a>

          <code class="literal">innodb_buffer_pool_instances</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_instances" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_instances=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances">innodb_buffer_pool_instances</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of regions that the
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> buffer pool is divided
          into. For systems with buffer pools in the multi-gigabyte
          range, dividing the buffer pool into separate instances can
          improve concurrency, by reducing contention as different
          threads read and write to cached pages. Each page that is
          stored in or read from the buffer pool is assigned to one of
          the buffer pool instances randomly, using a hashing function.
          Each buffer pool manages its own free lists, flush lists,
          LRUs, and all other data structures connected to a buffer
          pool, and is protected by its own buffer pool mutex.
        </p><p>
          This option takes effect only when you set the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> to a
          size of 1GB or more. The total size you specify is divided
          among all the buffer pools. For best efficiency, specify a
          combination of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>
          so that each buffer pool instance is at least 1GB.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_buffer_pool_size"></a>
          <a class="indexterm" name="idm140301493840624"></a>

          <a class="indexterm" name="idm140301493839584"></a>

          <code class="literal">innodb_buffer_pool_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_buffer_pool_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_buffer_pool_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size">innodb_buffer_pool_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">134217728</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, the
          memory area where <code class="literal">InnoDB</code> caches table and
          index data. The default value is 128MB. The maximum value
          depends on the CPU architecture; the maximum is 4294967295
          (2<sup>32</sup>-1) on 32-bit systems and
          18446744073709551615 (2<sup>64</sup>-1) on
          64-bit systems. On 32-bit systems, the CPU architecture and
          operating system may impose a lower practical maximum size
          than the stated maximum. When the size of the buffer pool is
          greater than 1GB, setting
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
          to a value greater than 1 can improve the scalability on a
          busy server.
        </p><p>
          The larger you set this value, the less disk I/O is needed to
          access the same data in tables more than once. On a dedicated
          database server, you might set this to up to 80% of the
          machine physical memory size. Be prepared to scale back this
          value if these other issues occur:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Competition for physical memory might cause paging in the
              operating system.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code> reserves additional memory for
              buffers and control structures, so that the total
              allocated space is approximately 10% greater than the
              specified size.
            </p></li><li class="listitem"><p>
              The address space must be contiguous, which can be an
              issue on Windows systems with DLLs that load at specific
              addresses.
            </p></li><li class="listitem"><p>
              The time to initialize the buffer pool is roughly
              proportional to its size. On large installations, this
              initialization time might be significant. For example, on
              a modern Linux x86_64 server, initialization of a 10GB
              buffer pool takes approximately 6 seconds. See
              <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
</p></li></ul>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_change_buffering"></a>
          <a class="indexterm" name="idm140301493791136"></a>

          <a class="indexterm" name="idm140301493790096"></a>

          <code class="literal">innodb_change_buffering</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_change_buffering" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_change_buffering=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering">innodb_change_buffering</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.5.3)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">inserts</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">inserts</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr><tr><td scope="row" rowspan="8"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">all</code></td></tr><tr><td scope="row" rowspan="6" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">inserts</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">deletes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">purges</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">changes</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">all</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">none</code></td></tr></tbody></table>
</div>
<p>
          Whether <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> performs change
          buffering, an optimization that delays write operations to
          secondary indexes so that the I/O operations can be performed
          sequentially. The permitted values are
          <code class="literal">inserts</code> (buffer insert operations),
          <code class="literal">deletes</code> (buffer delete operations; strictly
          speaking, the writes that mark index records for later
          deletion during a purge operation), <code class="literal">changes</code>
          (buffer insert and delete-marking operations),
          <code class="literal">purges</code> (buffer purge operations, the writes
          when deleted index entries are finally garbage-collected),
          <code class="literal">all</code> (buffer insert, delete-marking, and
          purge operations) and <code class="literal">none</code> (do not buffer
          any operations). The default is <code class="literal">all</code>. For
          details, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-change_buffering" title="14.15.5 Configuring InnoDB Change Buffering">Section 14.15.5, “Configuring InnoDB Change Buffering”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_checksums"></a>
          <a class="indexterm" name="idm140301493739840"></a>

          <a class="indexterm" name="idm140301493738832"></a>

          <code class="literal">innodb_checksums</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_checksums" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_checksums</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums">innodb_checksums</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> can use checksum validation on all
          pages read from the disk to ensure extra fault tolerance
          against broken hardware or data files. This validation is
          enabled by default. However, under some rare circumstances
          (such as when running benchmarks) this extra safety feature is
          unneeded and can be disabled with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_checksums"><code class="option">--skip-innodb-checksums</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_commit_concurrency"></a>
          <a class="indexterm" name="idm140301493713984"></a>

          <a class="indexterm" name="idm140301493712880"></a>

          <a class="indexterm" name="idm140301493711424"></a>

          <code class="literal">innodb_commit_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_commit_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_commit_concurrency=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency">innodb_commit_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that
          can <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> at the same
          time. A value of 0 (the default) permits any number of
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to commit
          simultaneously.
        </p><p>
          The value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_commit_concurrency"><code class="literal">innodb_commit_concurrency</code></a>
          cannot be changed at runtime from zero to nonzero or vice
          versa. The value can be changed from one nonzero value to
          another.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_concurrency_tickets"></a>
          <a class="indexterm" name="idm140301493679456"></a>

          <a class="indexterm" name="idm140301493678352"></a>

          <a class="indexterm" name="idm140301493676896"></a>

          <code class="literal">innodb_concurrency_tickets</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_concurrency_tickets" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_concurrency_tickets=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets">innodb_concurrency_tickets</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">500</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          Determines the number of
          <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> that can enter
          <code class="literal">InnoDB</code> concurrently. A thread is placed in
          a queue when it tries to enter <code class="literal">InnoDB</code> if
          the number of threads has already reached the concurrency
          limit. When a thread is permitted to enter
          <code class="literal">InnoDB</code>, it is given a number of <span class="quote">“<span class="quote">free
          tickets</span>”</span> equal to the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
          and the thread can enter and leave <code class="literal">InnoDB</code>
          freely until it has used up its tickets. After that point, the
          thread again becomes subject to the concurrency check (and
          possible queuing) the next time it tries to enter
          <code class="literal">InnoDB</code>. The default value is 500.
        </p><p>
          With a small <code class="literal">innodb_concurrency_tickets</code>
          value, small transactions that only need to process a few rows
          compete fairly with larger transactions that process many
          rows. The disadvantage of a small
          <code class="literal">innodb_concurrency_tickets</code> value is that
          large transactions must loop through the queue many times
          before they can complete, which extends the length of time
          required to complete their task.
        </p><p>
          With a large <code class="literal">innodb_concurrency_tickets</code>
          value, large transactions spend less time waiting for a
          position at the end of the queue (controlled by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>)
          and more time retrieving rows. Large transactions also require
          fewer trips through the queue to complete their task. The
          disadvantage of a large
          <code class="literal">innodb_concurrency_tickets</code> value is that
          too many large transactions running at the same time can
          starve smaller transactions by making them wait a longer time
          before executing.
        </p><p>
          With a non-zero
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
          value, you may need to adjust the
          <code class="literal">innodb_concurrency_tickets</code> value up or down
          to find the optimal balance between larger and smaller
          transactions. The <code class="literal">SHOW ENGINE INNODB STATUS</code>
          report shows the number of tickets remaining for an executing
          transaction in its current pass through the queue. This data
          may also be obtained from the
          <code class="literal">TRX_CONCURRENCY_TICKETS</code> column of the
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a>
          table.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.15.6 Configuring Thread Concurrency for InnoDB">Section 14.15.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_file_path"></a>
          <a class="indexterm" name="idm140301493630128"></a>

          <a class="indexterm" name="idm140301493629088"></a>

          <code class="literal">innodb_data_file_path</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_file_path" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_file_path=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path">innodb_data_file_path</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ibdata1:10M:autoextend</code></td></tr></tbody></table>
</div>
<p>
          The paths to individual <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a> and their
          sizes. The full directory path to each data file is formed by
          concatenating
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> to each
          path specified here. The file sizes are specified KB, MB or GB
          (1024MB) by appending <code class="literal">K</code>,
          <code class="literal">M</code> or <code class="literal">G</code> to the size
          value. If specifying data file size in kilobytes (KB), do so
          in multiples of 1024. Otherwise, KB values are rounded off to
          nearest megabyte (MB) boundary. The sum of the sizes of the
          files must be at least slightly larger than 10MB. If you do
          not specify
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>, the
          default behavior is to create a single auto-extending data
          file, slightly larger than 10MB, named
          <code class="filename">ibdata1</code>. The size limit of individual
          files is determined by your operating system. You can set the
          file size to more than 4GB on those operating systems that
          support big files. You can also
          <a class="link" href="innodb-storage-engine.html#innodb-raw-devices" title="14.7.3 Using Raw Disk Partitions for the System Tablespace">use raw disk partitions as
          data files</a>. For detailed information on configuring
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a> files, see
          <a class="xref" href="innodb-storage-engine.html#innodb-configuration" title="14.6 InnoDB Configuration">Section 14.6, “InnoDB Configuration”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_data_home_dir"></a>
          <a class="indexterm" name="idm140301493595392"></a>

          <a class="indexterm" name="idm140301493594352"></a>

          <code class="literal">innodb_data_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_data_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_data_home_dir=path</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir">innodb_data_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr></tbody></table>
</div>
<p>
          The common part of the directory path for all
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting does not affect the location
          of <a class="link" href="glossary.html#glos_file_per_table" title="file-per-table">file-per-table</a>
          tablespaces when
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          enabled. The default value is the MySQL
          <code class="filename">data</code> directory. If you specify the value
          as an empty string, you can use absolute file paths in
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_doublewrite"></a>
          <a class="indexterm" name="idm140301493566960"></a>

          <a class="indexterm" name="idm140301493565920"></a>

          <code class="literal">innodb_doublewrite</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_doublewrite" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb-doublewrite</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite">innodb_doublewrite</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          If this variable is enabled (the default),
          <code class="literal">InnoDB</code> stores all data twice, first to the
          <a class="link" href="glossary.html#glos_doublewrite_buffer" title="doublewrite buffer">doublewrite
          buffer</a>, and then to the actual
          <a class="link" href="glossary.html#glos_data_files" title="data files">data files</a>. This
          variable can be turned off with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_doublewrite"><code class="option">--skip-innodb_doublewrite</code></a>
          for benchmarks or cases when top performance is needed rather
          than concern for data integrity or possible failures.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_fast_shutdown"></a>
          <a class="indexterm" name="idm140301493539424"></a>

          <a class="indexterm" name="idm140301493538368"></a>

          <code class="literal">innodb_fast_shutdown</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_fast_shutdown" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_fast_shutdown[=#]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown">innodb_fast_shutdown</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          The <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_shutdown" title="shutdown">shutdown</a> mode. If the
          value is 0, <code class="literal">InnoDB</code> does a
          <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>, a
          full <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> and an insert
          buffer merge before shutting down. If the value is 1 (the
          default), <code class="literal">InnoDB</code> skips these operations at
          shutdown, a process known as a
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. If
          the value is 2, <code class="literal">InnoDB</code> flushes its logs and
          shuts down cold, as if MySQL had crashed; no committed
          transactions are lost, but the
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          operation makes the next startup take longer.
        </p><p>
          The slow shutdown can take minutes, or even hours in extreme
          cases where substantial amounts of data are still buffered.
          Use the slow shutdown technique before upgrading or
          downgrading between MySQL major releases, so that all data
          files are fully prepared in case the upgrade process updates
          the file format.
        </p><p>
          Use <code class="literal">innodb_fast_shutdown=2</code> in emergency or
          troubleshooting situations, to get the absolute fastest
          shutdown if data is at risk of corruption.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format"></a>
          <a class="indexterm" name="idm140301493500480"></a>

          <a class="indexterm" name="idm140301493499440"></a>

          <a class="indexterm" name="idm140301493497952"></a>

          <a class="indexterm" name="idm140301493496880"></a>

          <code class="literal">innodb_file_format</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format">innodb_file_format</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.5.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> to use
          for new <code class="literal">InnoDB</code> tables. Currently,
          <code class="literal">Antelope</code> and <code class="literal">Barracuda</code>
          are supported. This applies only for tables that have their
          own <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, so for
          it to have an effect,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> must be
          enabled. The <a class="link" href="glossary.html#glos_barracuda" title="Barracuda">Barracuda</a>
          file format is required for certain <code class="literal">InnoDB</code>
          features such as table
          <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>.
        </p><p>
          Be aware that <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operations that recreate <code class="literal">InnoDB</code> tables
          (<code class="literal">ALTER OFFLINE</code>) will use the current
          <code class="literal">innodb_file_format</code> setting (the conditions
          outlined above still apply).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_format_check"></a>
          <a class="indexterm" name="idm140301493448608"></a>

          <a class="indexterm" name="idm140301493447504"></a>

          <code class="literal">innodb_file_format_check</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_check" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_check=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&lt;= 5.5.4)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable (&gt;= 5.5.5)</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check">innodb_file_format_check</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (5.5.0)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.1, &lt;= 5.5.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Barracuda</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.5)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          As of MySQL 5.5.5, this variable can be set to 1 or 0 at
          server startup to enable or disable whether
          <code class="literal">InnoDB</code> checks the
          <a class="link" href="glossary.html#glos_file_format" title="file format">file format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the tag is checked and is
          higher than that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to the
          file format tag.
        </p><p>
          Before MySQL 5.5.5, this variable can be set to 1 or 0 at
          server startup to enable or disable whether
          <code class="literal">InnoDB</code> checks the file format tag in the
          shared tablespace. If the tag is checked and is higher than
          that supported by the current version of
          <code class="literal">InnoDB</code>, an error occurs and
          <code class="literal">InnoDB</code> does not start. If the tag is not
          higher, <code class="literal">InnoDB</code> sets the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_check"><code class="literal">innodb_file_format_check</code></a> to
          the file format tag, which is the value seen at runtime.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            Despite the default value sometimes being displayed as
            <code class="literal">ON</code> or <code class="literal">OFF</code>, always use
            the numeric values 1 or 0 to turn this option on or off in
            your configuration file or command line.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_file_format_max"></a>
          <a class="indexterm" name="idm140301493390592"></a>

          <a class="indexterm" name="idm140301493389552"></a>

          <code class="literal">innodb_file_format_max</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_format_max" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.5</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_format_max=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max">innodb_file_format_max</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" rowspan="2" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">Antelope</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">Barracuda</code></td></tr></tbody></table>
</div>
<p>
          At server startup, <code class="literal">InnoDB</code> sets the value of
          this variable to the <a class="link" href="glossary.html#glos_file_format" title="file format">file
          format</a> tag in the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> (for example, <code class="literal">Antelope</code> or
          <code class="literal">Barracuda</code>). If the server creates or opens
          a table with a <span class="quote">“<span class="quote">higher</span>”</span> file format, it sets the
          value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format_max"><code class="literal">innodb_file_format_max</code></a> to
          that format.
        </p><p>
          This variable was added in MySQL 5.5.5.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_file_per_table"></a>
          <a class="indexterm" name="idm140301493354544"></a>

          <a class="indexterm" name="idm140301493353504"></a>

          <code class="literal">innodb_file_per_table</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_file_per_table" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_file_per_table</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table">innodb_file_per_table</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&lt;= 5.5.6)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.7)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_file_per_table</code> is disabled,
          <code class="literal">InnoDB</code> stores the data for all tables and
          indexes in the <a class="link" href="glossary.html#glos_ibdata_file" title="ibdata file">ibdata
          files</a> that make up the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>. This setting reduces the performance
          overhead of filesystem operations for operations such as
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> or
          <a class="link" href="sql-syntax.html#truncate-table" title="13.1.33 TRUNCATE TABLE Syntax"><code class="literal">TRUNCATE TABLE</code></a>. It is most
          appropriate for a server environment where entire storage
          devices are devoted to MySQL data. Because the system
          tablespace never shrinks, and is shared across all databases
          in an <a class="link" href="glossary.html#glos_instance" title="instance">instance</a>, avoid
          loading huge amounts of temporary data on a space-constrained
          system when <code class="literal">innodb_file_per_table=OFF</code>. Set
          up a separate instance in such cases, so that you can drop the
          entire instance to reclaim the space.
        </p><p>
          When <code class="literal">innodb_file_per_table</code> is enabled,
          <code class="literal">InnoDB</code> stores data and indexes for each
          newly created table in a separate
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          file</a>, rather than in the system tablespace. The storage
          for these <code class="literal">InnoDB</code> tables is reclaimed when
          the tables are dropped or truncated. This setting enables
          several other <code class="literal">InnoDB</code> features, such as
          table <a class="link" href="glossary.html#glos_compression" title="compression">compression</a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-multiple-tablespaces" title="14.7.4 InnoDB File-Per-Table Tablespaces">Section 14.7.4, “InnoDB File-Per-Table Tablespaces”</a> for details
          about such features as well as advantages and disadvantages of
          using file-per-table tablespaces.
        </p><p>
          Be aware that enabling
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> also
          means that an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          operation will move <code class="literal">InnoDB</code> table from the
          system tablespace to an individual <code class="filename">.ibd</code>
          file in cases where <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          recreates the table (<code class="literal">ALTER OFFLINE</code>).
        </p><p>
          In MySQL 5.5 and higher, the configuration parameter
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> is
          dynamic, and can be set <code class="literal">ON</code> or
          <code class="literal">OFF</code> using <code class="literal">SET GLOBAL</code>.
          Previously, the only way to set this parameter was in the
          MySQL <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
          file</a> (<code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code>), and changing it required
          shutting down and restarting the server.
        </p><p>
          Dynamically changing the value of this parameter requires the
          <code class="literal">SUPER</code> privilege and immediately affects the
          operation of all connections.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_flush_log_at_trx_commit"></a>
          <a class="indexterm" name="idm140301493296352"></a>

          <a class="indexterm" name="idm140301493295248"></a>

          <code class="literal">innodb_flush_log_at_trx_commit</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_log_at_trx_commit" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_log_at_trx_commit[=#]</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">2</code></td></tr></tbody></table>
</div>
<p>
          Controls the balance between strict
          <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a> compliance for
          <a class="link" href="glossary.html#glos_commit" title="commit">commit</a> operations, and
          higher performance that is possible when commit-related I/O
          operations are rearranged and done in batches. You can achieve
          better performance by changing the default value, but then you
          can lose up to a second of transactions in a crash.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The default value of 1 is required for full ACID
              compliance. With this value, the contents of the
              <code class="literal">InnoDB</code>
              <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> are
              written out to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
              file</a> at each transaction commit and the log file is
              <a class="link" href="glossary.html#glos_flush" title="flush">flushed</a> to disk.
            </p></li><li class="listitem"><p>
              With a value of 0, the contents of the
              <code class="literal">InnoDB</code> log buffer are written to the
              log file approximately once per second and the log file is
              flushed to disk. No writes from the log buffer to the log
              file are performed at transaction commit. Once-per-second
              flushing is not 100% guaranteed to happen every second,
              due to process scheduling issues. Because the flush to
              disk operation only occurs approximately once per second,
              you can lose up to a second of transactions with any
              <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process crash.
            </p></li><li class="listitem"><p>
              With a value of 2, the contents of the
              <code class="literal">InnoDB</code> log buffer are written to the
              log file after each transaction commit and the log file is
              flushed to disk approximately once per second.
              Once-per-second flushing is not 100% guaranteed to happen
              every second, due to process scheduling issues. Because
              the flush to disk operation only occurs approximately once
              per second, you can lose up to a second of transactions in
              an operating system crash or a power outage.
            </p></li><li class="listitem"><p>
              <code class="literal">InnoDB</code>'s
              <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
              works regardless of the value. Transactions are either
              applied entirely or erased entirely.
</p></li></ul>
</div>
<p>
          For the greatest possible durability and consistency in a
          replication setup using <code class="literal">InnoDB</code> with
          transactions, use
          <code class="literal">innodb_flush_log_at_trx_commit=1</code> and
          <code class="literal">sync_binlog=1</code> in your master server
          <code class="filename">my.cnf</code> file.
</p>
<div class="caution" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Caution
</div>
<p>
            Many operating systems and some disk hardware fool the
            flush-to-disk operation. They may tell
            <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> that the flush has taken place,
            even though it has not. Then the durability of transactions
            is not guaranteed even with the setting 1, and in the worst
            case a power outage can even corrupt
            <code class="literal">InnoDB</code> data. Using a battery-backed disk
            cache in the SCSI disk controller or in the disk itself
            speeds up file flushes, and makes the operation safer. You
            can also try using the Unix command
            <span class="command"><strong>hdparm</strong></span> to disable the caching of disk
            writes in hardware caches, or use some other command
            specific to the hardware vendor.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_flush_method"></a>
          <a class="indexterm" name="idm140301493244464"></a>

          <a class="indexterm" name="idm140301493243424"></a>

          <code class="literal">innodb_flush_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_flush_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_flush_method=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_flush_method">innodb_flush_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span> (Windows)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">async_unbuffered</code></td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span> (Unix)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">string</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">fsync</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">fsync</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DSYNC</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">O_DIRECT</code></td></tr></tbody></table>
</div>
<p>
          Defines the method used to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data to the
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a> and <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a>, which can affect I/O throughput. This variable
          is only configurable on Unix and Linux systems. On Windows
          systems, the flush method is always
          <code class="literal">async_unbuffered</code> and cannot be changed.
        </p><p>
          The <code class="literal">innodb_flush_method</code> options include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <code class="literal">fsync</code>: <code class="literal">InnoDB</code> uses
              the <code class="literal">fsync()</code> system call to flush both
              the data and log files. <code class="literal">fsync</code> is the
              default setting.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DSYNC</code>: <code class="literal">InnoDB</code> uses
              <code class="literal">O_SYNC</code> to open and flush the log files,
              and <code class="literal">fsync()</code> to flush the data files.
              <code class="literal">InnoDB</code> does not use
              <code class="literal">O_DSYNC</code> directly because there have
              been problems with it on many varieties of Unix.
            </p></li><li class="listitem"><p>
              <code class="literal">O_DIRECT</code>: <code class="literal">InnoDB</code>
              uses <code class="literal">O_DIRECT</code> (or
              <code class="literal">directio()</code> on Solaris) to open the data
              files, and uses <code class="literal">fsync()</code> to flush both
              the data and log files. This option is available on some
              GNU/Linux versions, FreeBSD, and Solaris.
</p></li></ul>
</div>
<p>
          How each settings affects performance depends on hardware
          configuration and workload. Benchmark your particular
          configuration to decide which setting to use, or whether to
          keep the default setting. Examine the
          <a class="link" href="server-administration.html#statvar_Innodb_data_fsyncs"><code class="literal">Innodb_data_fsyncs</code></a> status
          variable to see the overall number of
          <code class="literal">fsync()</code> calls for each setting. The mix of
          read and write operations in your workload can affect how a
          setting performs. For example, on a system with a hardware
          RAID controller and battery-backed write cache,
          <code class="literal">O_DIRECT</code> can help to avoid double buffering
          between the <code class="literal">InnoDB</code> buffer pool and the
          operating system's file system cache. On some systems where
          <code class="literal">InnoDB</code> data and log files are located on a
          SAN, the default value or <code class="literal">O_DSYNC</code> might be
          faster for a read-heavy workload with mostly
          <code class="literal">SELECT</code> statements. Always test this
          parameter with hardware and workload that reflect your
          production environment. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p><p>
          Prior to MySQL 5.1.24, the default
          <code class="literal">innodb_flush_method</code> option was named
          <code class="literal">fdatasync</code>. When
          <code class="literal">fdatasync</code> was <code class="literal"></code>
          specified, <code class="literal">InnoDB</code> used the
          <code class="literal">fsync()</code> system call to flush both the data
          and log files. To avoid confusing the
          <code class="literal">fdatasync</code> option name with the
          <code class="literal">fdatasync()</code> system call, the option name
          was changed to <code class="literal">fsync</code> in MySQL 5.1.24.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_load_corrupted"></a>
          <a class="indexterm" name="idm140301493174464"></a>

          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted"><code class="literal">innodb_force_load_corrupted</code></a>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_load_corrupted" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.18</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_load_corrupted</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_load_corrupted">innodb_force_load_corrupted</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Lets InnoDB load tables at startup that are marked as
          corrupted. Use only during troubleshooting, to recover data
          that is otherwise inaccessible. When troubleshooting is
          complete, turn this setting back off and restart the server.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_force_recovery"></a>
          <a class="indexterm" name="idm140301493149312"></a>

          <a class="indexterm" name="idm140301493148272"></a>

          <code class="literal">innodb_force_recovery</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_force_recovery" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_force_recovery=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery">innodb_force_recovery</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          mode, typically only changed in serious troubleshooting
          situations. Possible values are from 0 to 6. For the meanings
          of these values and important information about
          <code class="literal">innodb_force_recovery</code>, see
          <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a>.
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
            Only set this variable to a value greater than 0 in an
            emergency situation, so that you can start
            <code class="literal">InnoDB</code> and dump your tables. As a safety
            measure, <code class="literal">InnoDB</code> prevents
            <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
            <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
            <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
            <code class="literal">innodb_force_recovery</code> is greater than 0.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_io_capacity"></a>
          <a class="indexterm" name="idm140301493111680"></a>

          <a class="indexterm" name="idm140301493110640"></a>

          <code class="literal">innodb_io_capacity</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_io_capacity" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_io_capacity=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity">innodb_io_capacity</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">200</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
          parameter sets an upper limit on the I/O activity performed by
          the <code class="literal">InnoDB</code> background tasks, such as
          <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> pages from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> and
          merging data from the
          <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a>. The
          default value is 200. For busy systems capable of higher I/O
          rates, you can set a higher value at server startup, to help
          the server handle the background maintenance work associated
          with a high rate of row changes. For systems with individual
          5400 RPM or 7200 RPM drives, you might lower the value to the
          former default of <code class="literal">100</code>.
        </p><p>
          The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit
          is a total limit for all buffer pool instances. When dirty
          pages are flushed, the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> limit is
          divided equally among buffer pool instances.
        </p><p>
          This parameter should be set to approximately the number of
          I/O operations that the system can perform per second.
          Ideally, keep this setting as low as practical, but not so low
          that these background activities fall behind. If the value is
          too high, data is removed from the buffer pool and insert
          buffer too quickly to provide significant benefit from the
          caching.
        </p><p>
          The value represents an estimated proportion of the I/O
          operations per second (IOPS) available to older-generation
          disk drives that could perform about 100 IOPS. The current
          default of 200 reflects that modern storage devices are
          capable of much higher I/O rates.
        </p><p>
          In general, you can increase the value as a function of the
          number of drives used for <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          I/O, particularly fast drives capable of high numbers of IOPS.
          For example, systems that use multiple disks or solid-state
          disks for <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> are likely to
          benefit from the ability to control this parameter.
        </p><p>
          Although you can specify a very high number, in practice such
          large values have little if any benefit; for example, a value
          of one million would be considered very high.
        </p><p>
          You can set the <code class="literal">innodb_io_capacity</code> value to
          any number 100 or greater, and the default value is
          <code class="literal">200</code>. You can set the value of this
          parameter in the MySQL option file (<code class="literal">my.cnf</code>
          or <code class="literal">my.ini</code>) or change it dynamically with
          the <code class="literal">SET GLOBAL</code> command, which requires the
          <code class="literal">SUPER</code> privilege.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_io_rate" title="14.15.9 Configuring the InnoDB Master Thread I/O Rate">Section 14.15.9, “Configuring the InnoDB Master Thread I/O Rate”</a> for
          more guidelines about this option. For general information
          about <code class="literal">InnoDB</code> I/O performance, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_large_prefix"></a>
          <a class="indexterm" name="idm140301493051360"></a>

          <a class="indexterm" name="idm140301493050320"></a>

          <code class="literal">innodb_large_prefix</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_large_prefix" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.14</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_large_prefix</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_large_prefix">innodb_large_prefix</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enable this option to allow index key prefixes longer than 767
          bytes (up to 3072 bytes), for <code class="literal">InnoDB</code> tables
          that use the
          <code class="literal"><a class="link" href="glossary.html#glos_dynamic_row_format" title="dynamic row format">DYNAMIC</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compressed_row_format" title="compressed row format">COMPRESSED</a></code>
          row formats. (Creating such tables also requires the option
          values
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_format"><code class="literal">innodb_file_format=barracuda</code></a>
          and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table=true</code></a>.)
          See <a class="xref" href="innodb-storage-engine.html#innodb-restrictions" title="14.8.7 Limits on InnoDB Tables">Section 14.8.7, “Limits on InnoDB Tables”</a> for the relevant
          maximums associated with index key prefixes under various
          settings.
        </p><p>
          For tables using the
          <code class="literal"><a class="link" href="glossary.html#glos_redundant_row_format" title="redundant row format">REDUNDANT</a></code>
          and
          <code class="literal"><a class="link" href="glossary.html#glos_compact_row_format" title="compact row format">COMPACT</a></code>
          row formats, this option does not affect the allowed key
          prefix length. It does introduce a new error possibility. When
          this setting is enabled, attempting to create an index prefix
          with a key length greater than 3072 for a
          <code class="literal">REDUNDANT</code> or <code class="literal">COMPACT</code>
          table causes an
          <a class="link" href="error-handling.html#error_er_index_column_too_long"><code class="literal">ER_INDEX_COLUMN_TOO_LONG</code></a>
          error.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_lock_wait_timeout"></a>
          <a class="indexterm" name="idm140301493012848"></a>

          <a class="indexterm" name="idm140301493011744"></a>

          <code class="literal">innodb_lock_wait_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_lock_wait_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_lock_wait_timeout=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout">innodb_lock_wait_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">50</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1073741824</code></td></tr></tbody></table>
</div>
<p>
          The length of time in seconds an <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a> waits for
          a <a class="link" href="glossary.html#glos_row_lock" title="row lock">row lock</a> before giving
          up. The default value is 50 seconds. A transaction that tries
          to access a row that is locked by another
          <code class="literal">InnoDB</code> transaction waits at most this many
          seconds for write access to the row before issuing the
          following error:
        </p><pre class="programlisting">
ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
</pre><p>
          When a lock wait timeout occurs, the current statement is
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a> (not the
          entire transaction). To have the entire transaction roll back,
          start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option. See also <a class="xref" href="innodb-storage-engine.html#innodb-error-handling" title="14.20.4 InnoDB Error Handling">Section 14.20.4, “InnoDB Error Handling”</a>.
        </p><p>
          You might decrease this value for highly interactive
          applications or <a class="link" href="glossary.html#glos_oltp" title="OLTP">OLTP</a> systems,
          to display user feedback quickly or put the update into a
          queue for processing later. You might increase this value for
          long-running back-end operations, such as a transform step in
          a data warehouse that waits for other large insert or update
          operations to finish.
        </p><p>
          <code class="literal">innodb_lock_wait_timeout</code> applies to
          <code class="literal">InnoDB</code> row locks only. A MySQL
          <a class="link" href="glossary.html#glos_table_lock" title="table lock">table lock</a> does not
          happen inside <code class="literal">InnoDB</code> and this timeout does
          not apply to waits for table locks.
        </p><p>
          The lock wait timeout value does not apply to
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a>, because
          <code class="literal">InnoDB</code> detects them immediately and rolls
          back one of the deadlocked transactions.
        </p><p>
          As of MySQL 5.5,
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a> can
          be set at runtime with the <code class="literal">SET GLOBAL</code> or
          <code class="literal">SET SESSION</code> statement. Changing the
          <code class="literal">GLOBAL</code> setting requires the
          <code class="literal">SUPER</code> privilege and affects the operation
          of all clients that subsequently connect. Any client can
          change the <code class="literal">SESSION</code> setting for
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>,
          which affects only that client.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_locks_unsafe_for_binlog"></a>
          <a class="indexterm" name="idm140301492963200"></a>

          <a class="indexterm" name="idm140301492962096"></a>

          <code class="literal">innodb_locks_unsafe_for_binlog</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_locks_unsafe_for_binlog" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_locks_unsafe_for_binlog</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog">innodb_locks_unsafe_for_binlog</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140301492940752"></a><a class="indexterm" name="idm140301492939264"></a><a class="indexterm" name="idm140301492937776"></a><a class="indexterm" name="idm140301492936288"></a><a class="indexterm" name="idm140301492934800"></a><a class="indexterm" name="idm140301492933312"></a><a class="indexterm" name="idm140301492931824"></a><a class="indexterm" name="idm140301492930336"></a><a class="indexterm" name="idm140301492928848"></a><a class="indexterm" name="idm140301492927360"></a><p>
          This variable affects how <code class="literal">InnoDB</code> uses gap
          locking for searches and index scans. Normally,
          <code class="literal">InnoDB</code> uses an algorithm called
          <em class="firstterm">next-key locking</em> that combines
          index-row locking with gap locking. <code class="literal">InnoDB</code>
          performs row-level locking in such a way that when it searches
          or scans a table index, it sets shared or exclusive locks on
          the index records it encounters. Thus, the row-level locks are
          actually index-record locks. In addition, a next-key lock on
          an index record also affects the <span class="quote">“<span class="quote">gap</span>”</span> before
          that index record. That is, a next-key lock is an index-record
          lock plus a gap lock on the gap preceding the index record. If
          one session has a shared or exclusive lock on record
          <code class="literal">R</code> in an index, another session cannot
          insert a new index record in the gap immediately before
          <code class="literal">R</code> in the index order. See
          <a class="xref" href="innodb-storage-engine.html#innodb-record-level-locks" title="14.5.6 InnoDB Record, Gap, and Next-Key Locks">Section 14.5.6, “InnoDB Record, Gap, and Next-Key Locks”</a>.
        </p><p>
          By default, the value of
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is 0
          (disabled), which means that gap locking is enabled:
          <code class="literal">InnoDB</code> uses next-key locks for searches and
          index scans. To enable the variable, set it to 1. This causes
          gap locking to be disabled: <code class="literal">InnoDB</code> uses
          only index-record locks for searches and index scans.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code>
          does not disable the use of gap locking for foreign-key
          constraint checking or duplicate-key checking.
        </p><p>
          The effect of enabling
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is similar
          to but not identical to setting the transaction isolation
          level to <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Enabling
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              is a global setting and affects all sessions, whereas the
              isolation level can be set globally for all sessions, or
              individually per session.
            </p></li><li class="listitem"><p>
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>
              can be set only at server startup, whereas the isolation
              level can be set at startup or changed at runtime.
</p></li></ul>
</div>
<p>
          <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a> therefore
          offers finer and more flexible control than
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_locks_unsafe_for_binlog"><code class="literal">innodb_locks_unsafe_for_binlog</code></a>.
          For additional details about the effect of isolation level on
          gap locking, see <a class="xref" href="sql-syntax.html#set-transaction" title="13.3.6 SET TRANSACTION Syntax">Section 13.3.6, “SET TRANSACTION Syntax”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> may
          cause phantom problems because other sessions can insert new
          rows into the gaps when gap locking is disabled. Suppose that
          there is an index on the <code class="literal">id</code> column of the
          <code class="literal">child</code> table and that you want to read and
          lock all rows from the table having an identifier value larger
          than 100, with the intention of updating some column in the
          selected rows later:
        </p><pre class="programlisting">
SELECT * FROM child WHERE id &gt; 100 FOR UPDATE;
</pre><p>
          The query scans the index starting from the first record where
          <code class="literal">id</code> is greater than 100. If the locks set on
          the index records in that range do not lock out inserts made
          in the gaps, another session can insert a new row into the
          table. Consequently, if you were to execute the same
          <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> again within the same
          transaction, you would see a new row in the result set
          returned by the query. This also means that if new items are
          added to the database, <code class="literal">InnoDB</code> does not
          guarantee serializability. Therefore, if
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is enabled,
          <code class="literal">InnoDB</code> guarantees at most an isolation
          level of <a class="link" href="sql-syntax.html#isolevel_read-committed"><code class="literal">READ COMMITTED</code></a>.
          (Conflict serializability is still guaranteed.) For additional
          information about phantoms, see
          <a class="xref" href="innodb-storage-engine.html#innodb-next-key-locking" title="14.5.7 Avoiding the Phantom Problem Using Next-Key Locking">Section 14.5.7, “Avoiding the Phantom Problem Using Next-Key Locking”</a>.
        </p><p>
          Enabling <code class="literal">innodb_locks_unsafe_for_binlog</code> has
          additional effects:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
              <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statements,
              <code class="literal">InnoDB</code> holds locks only for rows that
              it updates or deletes. Record locks for nonmatching rows
              are released after MySQL has evaluated the
              <code class="literal">WHERE</code> condition. This greatly reduces
              the probability of deadlocks, but they can still happen.
            </p></li><li class="listitem"><p>
              For <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> statements, if a
              row is already locked, <code class="literal">InnoDB</code> performs
              a <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the
              latest committed version to MySQL so that MySQL can
              determine whether the row matches the
              <code class="literal">WHERE</code> condition of the
              <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>. If the row matches
              (must be updated), MySQL reads the row again and this time
              <code class="literal">InnoDB</code> either locks it or waits for a
              lock on it.
</p></li></ul>
</div>
<p>
          Consider the following example, beginning with this table:
        </p><pre class="programlisting">
CREATE TABLE t (a INT NOT NULL, b INT) ENGINE = InnoDB;
INSERT INTO t VALUES (1,2),(2,3),(3,2),(4,3),(5,2);
COMMIT;
</pre><p>
          In this case, table has no indexes, so searches and index
          scans use the hidden clustered index for record locking (see
          <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.5.13.2 Clustered and Secondary Indexes">Section 14.5.13.2, “Clustered and Secondary Indexes”</a>).
        </p><p>
          Suppose that one client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> using these statements:
        </p><pre class="programlisting">
SET autocommit = 0;
UPDATE t SET b = 5 WHERE b = 3;
</pre><p>
          Suppose also that a second client performs an
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> by executing these
          statements following those of the first client:
        </p><pre class="programlisting">
SET autocommit = 0;
UPDATE t SET b = 4 WHERE b = 2;
</pre><p>
          As <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> executes each
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, it first acquires an
          exclusive lock for each row, and then determines whether to
          modify it. If <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> does not
          modify the row and
          <code class="literal">innodb_locks_unsafe_for_binlog</code> is enabled,
          it releases the lock. Otherwise,
          <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> retains the lock until the
          end of the transaction. This affects transaction processing as
          follows.
        </p><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          disabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and does not release any of them:
        </p><pre class="programlisting">
x-lock(1,2); retain x-lock
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); retain x-lock
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); retain x-lock
</pre><p>
          The second <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> blocks as
          soon as it tries to acquire any locks (because first update
          has retained locks on all rows), and does not proceed until
          the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> commits or
          rolls back:
        </p><pre class="programlisting">
x-lock(1,2); block and wait for first UPDATE to commit or roll back
</pre><p>
          If <code class="literal">innodb_locks_unsafe_for_binlog</code> is
          enabled, the first <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>
          acquires x-locks and releases those for rows that it does not
          modify:
        </p><pre class="programlisting">
x-lock(1,2); unlock(1,2)
x-lock(2,3); update(2,3) to (2,5); retain x-lock
x-lock(3,2); unlock(3,2)
x-lock(4,3); update(4,3) to (4,5); retain x-lock
x-lock(5,2); unlock(5,2)
</pre><p>
          For the second <code class="literal">UPDATE</code>,
          <code class="literal">InnoDB</code> does a
          <span class="quote">“<span class="quote">semi-consistent</span>”</span> read, returning the latest
          committed version of each row to MySQL so that MySQL can
          determine whether the row matches the <code class="literal">WHERE</code>
          condition of the <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>:
        </p><pre class="programlisting">
x-lock(1,2); update(1,2) to (1,4); retain x-lock
x-lock(2,3); unlock(2,3)
x-lock(3,2); update(3,2) to (3,4); retain x-lock
x-lock(4,3); unlock(4,3)
x-lock(5,2); update(5,2) to (5,4); retain x-lock
</pre></li><li class="listitem"><p><a name="sysvar_innodb_log_buffer_size"></a>
          <a class="indexterm" name="idm140301492850272"></a>

          <a class="indexterm" name="idm140301492849232"></a>

          <code class="literal">innodb_log_buffer_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_buffer_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_buffer_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_buffer_size">innodb_log_buffer_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8388608</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">262144</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of the buffer that <code class="literal">InnoDB</code>
          uses to write to the <a class="link" href="glossary.html#glos_log_file" title="log file">log
          files</a> on disk. The default value is 8MB. A large
          <a class="link" href="glossary.html#glos_log_buffer" title="log buffer">log buffer</a> enables
          large <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> to
          run without a need to write the log to disk before the
          transactions <a class="link" href="glossary.html#glos_commit" title="commit">commit</a>. Thus,
          if you have transactions that update, insert, or delete many
          rows, making the log buffer larger saves disk I/O. For general
          I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_file_size"></a>
          <a class="indexterm" name="idm140301492816720"></a>

          <a class="indexterm" name="idm140301492815680"></a>

          <code class="literal">innodb_log_file_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_file_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_file_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size">innodb_log_file_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">5242880</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1048576</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4GB / innodb_log_files_in_group</code></td></tr></tbody></table>
</div>
<p>
          The size in bytes of each <a class="link" href="glossary.html#glos_log_file" title="log file">log
          file</a> in a <a class="link" href="glossary.html#glos_log_group" title="log group">log
          group</a>. The combined size of log files
          (<code class="literal">innodb_log_file_size</code> *
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>)
          cannot exceed a maximum value that is slightly less than 4GB.
          A pair of 2047 MB log files, for example, would allow you to
          approach the range limit but not exceed it. The default value
          is 5MB. Sensible values range from 1MB to
          1/<em class="replaceable"><code>N</code></em>-th of the size of the buffer
          pool, where <em class="replaceable"><code>N</code></em> is the number of log
          files in the group. The larger the value, the less checkpoint
          flush activity is needed in the buffer pool, saving disk I/O.
          Larger log files also make
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>
          slower, although improvements to recovery performance in MySQL
          5.5 and higher make the log file size less of a consideration.
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_files_in_group"></a>
          <a class="indexterm" name="idm140301492781376"></a>

          <a class="indexterm" name="idm140301492780272"></a>

          <code class="literal">innodb_log_files_in_group</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_files_in_group" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_files_in_group=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group">innodb_log_files_in_group</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">2</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">100</code></td></tr></tbody></table>
</div>
<p>
          The number of <a class="link" href="glossary.html#glos_log_file" title="log file">log files</a>
          in the <a class="link" href="glossary.html#glos_log_group" title="log group">log group</a>.
          <code class="literal">InnoDB</code> writes to the files in a circular
          fashion. The default (and recommended) value is 2. The
          location of these files is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir"><code class="literal">innodb_log_group_home_dir</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_log_group_home_dir"></a>
          <a class="indexterm" name="idm140301492749136"></a>

          <a class="indexterm" name="idm140301492748032"></a>

          <code class="literal">innodb_log_group_home_dir</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_log_group_home_dir" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_log_group_home_dir=path</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_group_home_dir">innodb_log_group_home_dir</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">directory name</code></td></tr></tbody></table>
</div>
<p>
          The directory path to the <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> files, whose
          number is specified by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_files_in_group"><code class="literal">innodb_log_files_in_group</code></a>. If
          you do not specify any <code class="literal">InnoDB</code> log
          variables, the default is to create two files named
          <code class="filename">ib_logfile0</code> and
          <code class="filename">ib_logfile1</code> in the MySQL data directory.
          Their size is given by the size of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_log_file_size"><code class="literal">innodb_log_file_size</code></a> system
          variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_dirty_pages_pct"></a>
          <a class="indexterm" name="idm140301492720880"></a>

          <a class="indexterm" name="idm140301492719776"></a>

          <code class="literal">innodb_max_dirty_pages_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_dirty_pages_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_dirty_pages_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct">innodb_max_dirty_pages_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">numeric</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">75</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">99</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to
          <a class="link" href="glossary.html#glos_flush" title="flush">flush</a> data from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> so that
          the percentage of <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty
          pages</a> does not exceed this value. Specify an integer in
          the range from 0 to 99. The default value is 75.
        </p><p>
          For additional information about this variable, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-adaptive_flushing" title="14.15.2.2 Configuring the Rate of InnoDB Buffer Pool Flushing">Section 14.15.2.2, “Configuring the Rate of InnoDB Buffer Pool Flushing”</a>. For
          general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_max_purge_lag"></a>
          <a class="indexterm" name="idm140301492687232"></a>

          <a class="indexterm" name="idm140301492686192"></a>

          <code class="literal">innodb_max_purge_lag</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_max_purge_lag" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_max_purge_lag=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag">innodb_max_purge_lag</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable controls how to delay
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations are lagging
          (see <a class="xref" href="innodb-storage-engine.html#innodb-multi-versioning" title="14.5.12 InnoDB Multi-Versioning">Section 14.5.12, “InnoDB Multi-Versioning”</a>). The default
          value is 0 (no delays).
        </p><p>
          The <code class="literal">InnoDB</code> transaction system maintains a
          list of transactions that have index records delete-marked by
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a> or
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations. The length
          of this list represents the
          <em class="replaceable"><code>purge_lag</code></em> value. When
          <em class="replaceable"><code>purge_lag</code></em> exceeds
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>, each
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
          <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, and
          <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operation is delayed by
          ((<em class="replaceable"><code>purge_lag</code></em>/<a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_purge_lag"><code class="literal">innodb_max_purge_lag</code></a>)×10)−5
          milliseconds. The delay is computed in the beginning of a
          purge batch, every ten seconds. The operations are not delayed
          if purge cannot run because of an old
          <a class="link" href="glossary.html#glos_consistent_read" title="consistent read">consistent read</a>
          view that could see the rows to be purged.
        </p><p>
          A typical setting for a problematic workload might be 1
          million, assuming that transactions are small, only 100 bytes
          in size, and it is permissible to have 100MB of unpurged
          <code class="literal">InnoDB</code> table rows.
        </p><p>
          The lag value is displayed as the history list length in the
          <code class="literal">TRANSACTIONS</code> section of InnoDB Monitor
          output. For example, if the output includes the following
          lines, the lag value is 20:
        </p><pre class="programlisting">
------------
TRANSACTIONS
------------
Trx id counter 0 290328385
Purge done for trx's n:o &lt; 0 290315608 undo n:o &lt; 0 17
History list length 20
</pre><p>
          For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_mirrored_log_groups"></a>
          <a class="indexterm" name="idm140301492636224"></a>

          <a class="indexterm" name="idm140301492635120"></a>

          <code class="literal">innodb_mirrored_log_groups</code>
        </p><p>
          Has no effect.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_pct"></a>
          <a class="indexterm" name="idm140301492631248"></a>

          <a class="indexterm" name="idm140301492630208"></a>

          <code class="literal">innodb_old_blocks_pct</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_pct" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_pct=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct">innodb_old_blocks_pct</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">37</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">5</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">95</code></td></tr></tbody></table>
</div>
<p>
          Specifies the approximate percentage of the
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> used for
          the old block <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a>. The
          range of values is 5 to 95. The default value is 37 (that is,
          3/8 of the pool). See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.15.2.3 Making the Buffer Pool Scan Resistant">Section 14.15.2.3, “Making the Buffer Pool Scan Resistant”</a> for
          more information. See <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a> for
          information about buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_old_blocks_time"></a>
          <a class="indexterm" name="idm140301492596992"></a>

          <a class="indexterm" name="idm140301492595952"></a>

          <code class="literal">innodb_old_blocks_time</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_old_blocks_time" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_old_blocks_time=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time">innodb_old_blocks_time</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**32-1</code></td></tr></tbody></table>
</div>
<p>
          Non-zero values protect against the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> being
          filled up by data that is referenced only for a brief period,
          such as during a <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full
          table scan</a>. Increasing this value offers more
          protection against full table scans interfering with data
          cached in the buffer pool.
        </p><p>
          Specifies how long in milliseconds (ms) a block inserted into
          the old <a class="link" href="glossary.html#glos_sublist" title="sublist">sublist</a> must stay
          there after its first access before it can be moved to the new
          sublist. If the value is 0, a block inserted into the old
          sublist moves immediately to the new sublist the first time it
          is accessed, no matter how soon after insertion the access
          occurs. If the value is greater than 0, blocks remain in the
          old sublist until an access occurs at least that many ms after
          the first access. For example, a value of 1000 causes blocks
          to stay in the old sublist for 1 second after the first access
          before they become eligible to move to the new sublist.
        </p><p>
          This variable is often used in combination with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-midpoint_insertion" title="14.15.2.3 Making the Buffer Pool Scan Resistant">Section 14.15.2.3, “Making the Buffer Pool Scan Resistant”</a> for
          more information. See <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a> for
          information about buffer pool management, such as the
          <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a> algorithm and
          <a class="link" href="glossary.html#glos_eviction" title="eviction">eviction</a> policies.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_open_files"></a>
          <a class="indexterm" name="idm140301492559856"></a>

          <a class="indexterm" name="idm140301492558816"></a>

          <code class="literal">innodb_open_files</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_open_files" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_open_files=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_open_files">innodb_open_files</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">300</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">10</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          This variable is relevant only if you use multiple
          <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>. It
          specifies the maximum number of
          <a class="link" href="glossary.html#glos_ibd_file" title=".ibd file"><code class="filename">.ibd</code>
          files</a> that MySQL can keep open at one time. The minimum
          value is 10. The default value is 300.
        </p><p>
          The file descriptors used for <code class="filename">.ibd</code> files
          are for <code class="literal">InnoDB</code> tables only. They are
          independent of those specified by the
          <a class="link" href="server-administration.html#option_mysqld_open-files-limit"><code class="option">--open-files-limit</code></a> server
          option, and do not affect the operation of the table cache.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_print_all_deadlocks"></a>
          <a class="indexterm" name="idm140301492525408"></a>

          <a class="indexterm" name="idm140301492524304"></a>

          <code class="literal">innodb_print_all_deadlocks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_print_all_deadlocks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.30</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_print_all_deadlocks=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks">innodb_print_all_deadlocks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<a class="indexterm" name="idm140301492501104"></a><p>
          When this option is enabled, information about all
          <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlocks</a> in
          <code class="literal">InnoDB</code> user transactions is recorded in the
          <code class="literal">mysqld</code> <a class="link" href="server-administration.html#error-log" title="5.2.2 The Error Log">error
          log</a>. Otherwise, you see information about only the last
          deadlock, using the <code class="literal">SHOW ENGINE INNODB
          STATUS</code> command. An occasional
          <code class="literal">InnoDB</code> deadlock is not necessarily an
          issue, because <code class="literal">InnoDB</code> detects the condition
          immediately, and rolls back one of the transactions
          automatically. You might use this option to troubleshoot why
          deadlocks are happening if an application does not have
          appropriate error-handling logic to detect the rollback and
          retry its operation. A large number of deadlocks might
          indicate the need to restructure transactions that issue
          <a class="link" href="glossary.html#glos_dml" title="DML">DML</a> or <code class="literal">SELECT ... FOR
          UPDATE</code> statements for multiple tables, so that each
          transaction accesses the tables in the same order, thus
          avoiding the deadlock condition.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_batch_size"></a>
          <a class="indexterm" name="idm140301492490896"></a>

          <a class="indexterm" name="idm140301492489856"></a>

          <code class="literal">innodb_purge_batch_size</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_batch_size" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_batch_size=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size">innodb_purge_batch_size</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">20</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">5000</code></td></tr></tbody></table>
</div>
<p>
          The granularity of changes, expressed in units of
          <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> records, that
          trigger a <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation,
          flushing the changed <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
          pool</a> blocks to disk. This option is intended for tuning
          performance in combination with the setting
          <code class="literal">innodb_purge_threads=<em class="replaceable"><code>n</code></em></code>,
          and typical users do not need to modify it.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_purge_threads"></a>
          <a class="indexterm" name="idm140301492456784"></a>

          <a class="indexterm" name="idm140301492455744"></a>

          <code class="literal">innodb_purge_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_purge_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_purge_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads">innodb_purge_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.4)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr></tbody></table>
</div>
<p>
          The number of background threads devoted to the InnoDB
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation. Currently,
          can only be 0 (the default) or 1. The default value of 0
          signifies that the purge operation is performed as part of the
          <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>.
          Running the purge operation in its own thread can reduce
          internal contention within InnoDB, improving scalability.
          Currently, the performance gain might be minimal because the
          background thread might encounter different kinds of
          contention than before. This feature primarily lays the
          groundwork for future performance work.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_random_read_ahead"></a>
          <a class="indexterm" name="idm140301492423968"></a>

          <code class="literal">innodb_random_read_ahead</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_random_read_ahead" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.16</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_random_read_ahead=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead">innodb_random_read_ahead</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          Enables the random
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> technique
          for optimizing <code class="literal">InnoDB</code> I/O. Random
          read-ahead functionality was removed from the <code class="literal">InnoDB
          Plugin</code> (version 1.0.4) and was therefore not
          included in MySQL 5.5.0 when <code class="literal">InnoDB Plugin</code>
          became the <span class="quote">“<span class="quote">built-in</span>”</span> version of
          <code class="literal">InnoDB</code>. Random read-ahead was reintroduced
          in MySQL 5.1.59 and 5.5.16 and higher along with the
          <code class="literal">innodb_random_read_ahead</code> configuration
          option, which is disabled by default.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="14.15.2.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 14.15.2.1, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a> for
          details about the performance considerations for the different
          types of read-ahead requests. For general I/O tuning advice,
          see <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_ahead_threshold"></a>
          <a class="indexterm" name="idm140301492392464"></a>

          <a class="indexterm" name="idm140301492391360"></a>

          <code class="literal">innodb_read_ahead_threshold</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_ahead_threshold" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_ahead_threshold=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold">innodb_read_ahead_threshold</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">56</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          Controls the sensitivity of linear
          <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> that
          <code class="literal">InnoDB</code> uses to prefetch pages into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>. If
          <code class="literal">InnoDB</code> reads at least
          <code class="literal">innodb_read_ahead_threshold</code> pages
          sequentially from an <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>
          (64 pages), it initiates an asynchronous read for the entire
          following extent. The permissible range of values is 0 to 64.
          The default is 56: <code class="literal">InnoDB</code> must read at
          least 56 pages sequentially from an extent to initiate an
          asynchronous read for the following extent.
        </p><p>
          Knowing how many pages are read through this read-ahead
          mechanism, and how many of them are evicted from the buffer
          pool without ever being accessed, can be useful to help
          fine-tune the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
          parameter. As of MySQL 5.5,
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output displays counter information
          from the
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
          and
          <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
          global status variables. These variables indicate the number
          of pages brought into the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> by
          read-ahead requests, and the number of such pages
          <a class="link" href="glossary.html#glos_eviction" title="eviction">evicted</a> from the buffer
          pool without ever being accessed respectively. These counters
          provide global values since the last server restart.
        </p><p>
          <code class="literal">SHOW ENGINE INNODB STATUS</code> also shows the
          rate at which the read-ahead pages are read in and the rate at
          which such pages are evicted without being accessed. The
          per-second averages are based on the statistics collected
          since the last invocation of <code class="literal">SHOW ENGINE INNODB
          STATUS</code> and are displayed in the <code class="literal">BUFFER POOL
          AND MEMORY</code> section of the output.
        </p><p>
          See <a class="xref" href="innodb-storage-engine.html#innodb-performance-read_ahead" title="14.15.2.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)">Section 14.15.2.1, “Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)”</a> for more
          information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_read_io_threads"></a>
          <a class="indexterm" name="idm140301492345456"></a>

          <a class="indexterm" name="idm140301492344416"></a>

          <code class="literal">innodb_read_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_read_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_read_io_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads">innodb_read_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for read operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for write threads is
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.15.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.15.7, “Configuring the Number of Background InnoDB I/O Threads”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <code class="literal">innodb_read_io_threads</code>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and the Linux <code class="literal">aio-max-nr</code> setting can
            exceed system limits. Ideally, increase the
            <code class="literal">aio-max-nr</code> setting; as a workaround, you
            might reduce the settings for one or both of the MySQL
            configuration options.
</p>
</div>
</li><li class="listitem"><p><a name="sysvar_innodb_replication_delay"></a>
          <a class="indexterm" name="idm140301492308960"></a>

          <a class="indexterm" name="idm140301492307856"></a>

          <code class="literal">innodb_replication_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_replication_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_replication_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_replication_delay">innodb_replication_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The replication thread delay (in ms) on a slave server if
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
          reached.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_on_timeout"></a>
          <a class="indexterm" name="idm140301492279152"></a>

          <a class="indexterm" name="idm140301492278048"></a>

          <code class="literal">innodb_rollback_on_timeout</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_on_timeout" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_on_timeout</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout">innodb_rollback_on_timeout</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          In MySQL 5.5, <code class="literal">InnoDB</code>
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rolls back</a> only the last
          statement on a transaction timeout by default. If
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a> is
          specified, a transaction timeout causes
          <code class="literal">InnoDB</code> to abort and roll back the entire
          transaction (the same behavior as in MySQL 4.1).
        </p></li><li class="listitem"><p><a name="sysvar_innodb_rollback_segments"></a>
          <a class="indexterm" name="idm140301492251696"></a>

          <a class="indexterm" name="idm140301492250592"></a>

          <code class="literal">innodb_rollback_segments</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_rollback_segments" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.11</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_rollback_segments=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_segments">innodb_rollback_segments</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">128</code></td></tr></tbody></table>
</div>
<p>
          Defines how many of the
          <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segments</a>
          in the <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a> are used for InnoDB
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>. You
          might reduce this value from its default of 128 if a smaller
          number of rollback segments performs better for your workload.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_spin_wait_delay"></a>
          <a class="indexterm" name="idm140301492218800"></a>

          <a class="indexterm" name="idm140301492217760"></a>

          <code class="literal">innodb_spin_wait_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_spin_wait_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_spin_wait_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay">innodb_spin_wait_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">6</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The maximum delay between polls for a
          <a class="link" href="glossary.html#glos_spin" title="spin">spin</a> lock. The low-level
          implementation of this mechanism varies depending on the
          combination of hardware and operating system, so the delay
          does not correspond to a fixed time interval. The default
          value is 6. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-spin_lock_polling" title="14.15.10 Configuring Spin Lock Polling">Section 14.15.10, “Configuring Spin Lock Polling”</a> for
          more information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_method"></a>
          <a class="indexterm" name="idm140301492188384"></a>

          <a class="indexterm" name="idm140301492187344"></a>

          <code class="literal">innodb_stats_method</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_method" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.10</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_method=name</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_method">innodb_stats_method</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="5"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">enumeration</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" rowspan="3" valign="top"><span class="bold"><strong>Valid Values</strong></span></td><td colspan="2"><code class="literal">nulls_equal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_unequal</code></td></tr><tr><td scope="row" colspan="2"><code class="literal">nulls_ignored</code></td></tr></tbody></table>
</div>
<p>
          How the server treats <code class="literal">NULL</code> values when
          collecting <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>
          about the distribution of index values for
          <code class="literal">InnoDB</code> tables. This variable has three
          possible values, <code class="literal">nulls_equal</code>,
          <code class="literal">nulls_unequal</code>, and
          <code class="literal">nulls_ignored</code>. For
          <code class="literal">nulls_equal</code>, all <code class="literal">NULL</code>
          index values are considered equal and form a single value
          group that has a size equal to the number of
          <code class="literal">NULL</code> values. For
          <code class="literal">nulls_unequal</code>, <code class="literal">NULL</code>
          values are considered unequal, and each
          <code class="literal">NULL</code> forms a distinct value group of size
          1. For <code class="literal">nulls_ignored</code>,
          <code class="literal">NULL</code> values are ignored.
        </p><p>
          The method that is used for generating table statistics
          influences how the optimizer chooses indexes for query
          execution, as described in
          <a class="xref" href="optimization.html#myisam-index-statistics" title="8.3.7 InnoDB and MyISAM Index Statistics Collection">Section 8.3.7, “InnoDB and MyISAM Index Statistics Collection”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_on_metadata"></a>
          <a class="indexterm" name="idm140301492145264"></a>

          <a class="indexterm" name="idm140301492144160"></a>

          <code class="literal">innodb_stats_on_metadata</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_on_metadata" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_on_metadata</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_on_metadata">innodb_stats_on_metadata</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          When this variable is enabled (which is the default, as before
          the variable was created), <code class="literal">InnoDB</code> updates
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> when
          metadata statements such as <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
          STATUS</code></a> or <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>
          are run, or when accessing the
          <code class="literal">INFORMATION_SCHEMA</code> tables
          <a class="link" href="information-schema.html#tables-table" title="21.21 The INFORMATION_SCHEMA TABLES Table"><code class="literal">TABLES</code></a> or
          <a class="link" href="information-schema.html#statistics-table" title="21.20 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">STATISTICS</code></a>. (These updates are
          similar to what happens for <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
          TABLE</code></a>.) When disabled, <code class="literal">InnoDB</code>
          does not update statistics during these operations. Disabling
          this variable can improve access speed for schemas that have a
          large number of tables or indexes. It can also improve the
          stability of
          <a class="link" href="glossary.html#glos_query_execution_plan" title="query execution plan">execution
          plans</a> for queries that involve
          <code class="literal">InnoDB</code> tables.
        </p><p>
          To change the setting, issue the statement <code class="literal">SET GLOBAL
          innodb_stats_on_metadata=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code> (or
          <code class="literal">1</code> or <code class="literal">0</code>). Changing this
          setting requires the <code class="literal">SUPER</code> privilege and
          immediately affects the operation of all connections.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_stats_sample_pages"></a>
          <a class="indexterm" name="idm140301492102112"></a>

          <a class="indexterm" name="idm140301492101008"></a>

          <code class="literal">innodb_stats_sample_pages</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_stats_sample_pages" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_stats_sample_pages=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages">innodb_stats_sample_pages</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">8</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">2**64-1</code></td></tr></tbody></table>
</div>
<p>
          The number of index pages to sample for index distribution
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> such as are
          calculated by <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
          The default value is 8. For additional information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.15.14 Configuring Optimizer Statistics Parameters">Section 14.15.14, “Configuring Optimizer Statistics Parameters”</a>.
        </p><p>
          Setting a high value for
          <code class="literal">innodb_stats_sample_pages</code> could result in
          lengthy <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a> execution
          time. To estimate the number of database pages accessed by
          <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>, see
          <a class="xref" href="innodb-storage-engine.html#innodb-analyze-table-complexity" title="14.15.15 Estimating ANALYZE TABLE Complexity for InnoDB Tables">Section 14.15.15, “Estimating ANALYZE TABLE Complexity for InnoDB Tables”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_strict_mode"></a>
          <a class="indexterm" name="idm140301492066304"></a>

          <a class="indexterm" name="idm140301492065264"></a>

          <code class="literal">innodb_strict_mode</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_strict_mode" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_strict_mode=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_strict_mode">innodb_strict_mode</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">OFF</code></td></tr></tbody></table>
</div>
<p>
          When <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, <code class="literal">InnoDB</code> returns
          errors rather than warnings for certain conditions. The
          default value is <code class="literal">OFF</code>.
        </p><p>
          <a class="link" href="glossary.html#glos_strict_mode" title="strict mode">Strict mode</a> helps
          guard against ignored typos and syntax errors in SQL, or other
          unintended consequences of various combinations of operational
          modes and SQL statements. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, <code class="literal">InnoDB</code> raises error
          conditions in certain cases, rather than issuing a warning and
          processing the specified statement (perhaps with unintended
          behavior). This is analogous to
          <a class="link" href="server-administration.html#sql-mode" title="5.1.7 Server SQL Modes"><code class="literal">sql_mode</code></a> in
          MySQL, which controls what SQL syntax MySQL accepts, and
          determines whether it silently ignores errors, or validates
          input syntax and data values.
        </p><p>
          The <code class="literal">innodb_strict_mode</code> setting affects the
          handling of syntax errors for <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE
          TABLE</code></a>, <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>
          and <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements.
          <code class="literal">innodb_strict_mode</code> also enables a record
          size check, so that an <code class="literal">INSERT</code> or
          <code class="literal">UPDATE</code> never fails due to the record being
          too large for the selected page size.
        </p><p>
          Oracle recommends enabling
          <code class="literal">innodb_strict_mode</code> when using
          <code class="literal">ROW_FORMAT</code> and
          <code class="literal">KEY_BLOCK_SIZE</code> clauses on
          <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>, and
          <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a> statements. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">OFF</code>, <code class="literal">InnoDB</code> ignores
          conflicting clauses and creates the table or index, with only
          a warning in the message log. The resulting table might have
          different behavior than you intended, such as having no
          compression when you tried to create a compressed table. When
          <code class="literal">innodb_strict_mode</code> is
          <code class="literal">ON</code>, such problems generate an immediate
          error and the table or index is not created, avoiding a
          troubleshooting session later.
        </p><p>
          You can turn <code class="literal">innodb_strict_mode</code>
          <code class="literal">ON</code> or <code class="literal">OFF</code> on the command
          line when you start <code class="literal">mysqld</code>, or in the
          <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
          file</a> <code class="filename">my.cnf</code> or
          <code class="filename">my.ini</code>. You can also enable or disable
          <code class="literal">innodb_strict_mode</code> at runtime with the
          statement <code class="literal">SET [GLOBAL|SESSION]
          innodb_strict_mode=<em class="replaceable"><code>mode</code></em></code>,
          where <code class="literal"><em class="replaceable"><code>mode</code></em></code> is
          either <code class="literal">ON</code> or <code class="literal">OFF</code>.
          Changing the <code class="literal">GLOBAL</code> setting requires the
          <code class="literal">SUPER</code> privilege and affects the operation
          of all clients that subsequently connect. Any client can
          change the <code class="literal">SESSION</code> setting for
          <code class="literal">innodb_strict_mode</code>, and the setting affects
          only that client.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_support_xa"></a>
          <a class="indexterm" name="idm140301492004208"></a>

          <a class="indexterm" name="idm140301492003168"></a>

          <a class="indexterm" name="idm140301492001680"></a>

          <code class="literal">innodb_support_xa</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_support_xa" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_support_xa</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_support_xa">innodb_support_xa</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          Enables <code class="literal">InnoDB</code> support for two-phase commit
          in <a class="link" href="glossary.html#glos_xa" title="XA">XA</a> transactions, causing an
          extra disk flush for transaction preparation. This setting is
          the default. The XA mechanism is used internally and is
          essential for any server that has its binary log turned on and
          is accepting changes to its data from more than one thread. If
          you turn it off, transactions can be written to the binary log
          in a different order from the one in which the live database
          is committing them. This can produce different data when the
          binary log is replayed in disaster recovery or on a
          replication slave. Do not turn it off on a replication master
          server unless you have an unusual setup where only one thread
          is able to change data.
        </p><p>
          For a server that is accepting data changes from only one
          thread, it is safe and recommended to turn off this option to
          improve performance for <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a>
          tables. For example, you can turn it off on replication slaves
          where only the replication SQL thread is changing data.
        </p><p>
          You can also turn off this option if you do not need it for
          safe binary logging or replication, and you also do not use an
          external XA transaction manager.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_sync_spin_loops"></a>
          <a class="indexterm" name="idm140301491974240"></a>

          <a class="indexterm" name="idm140301491973200"></a>

          <code class="literal">innodb_sync_spin_loops</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_sync_spin_loops" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_sync_spin_loops=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_sync_spin_loops">innodb_sync_spin_loops</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">30</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr></tbody></table>
</div>
<p>
          The number of times a thread waits for an
          <code class="literal">InnoDB</code> mutex to be freed before the thread
          is suspended. The default value is 30.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_table_locks"></a>
          <a class="indexterm" name="idm140301491945008"></a>

          <a class="indexterm" name="idm140301491943968"></a>

          <code class="literal">innodb_table_locks</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_table_locks" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_table_locks</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks">innodb_table_locks</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global, Session</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">TRUE</code></td></tr></tbody></table>
</div>
<p>
          If <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>,
          <code class="literal">InnoDB</code> honors <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK
          TABLES</code></a>; MySQL does not return from <code class="literal">LOCK
          TABLES ... WRITE</code> until all other threads have
          released all their locks to the table. The default value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks</code></a> is 1,
          which means that <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES</code></a>
          causes InnoDB to lock a table internally if
          <a class="link" href="server-administration.html#sysvar_autocommit"><code class="literal">autocommit = 0</code></a>.
        </p><p>
          As of MySQL 5.5.3, <a class="link" href="innodb-storage-engine.html#sysvar_innodb_table_locks"><code class="literal">innodb_table_locks =
          0</code></a> has no effect for tables locked explicitly with
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a>. It still has an effect for tables locked for
          read or write by
          <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES ...
          WRITE</code></a> implicitly (for example, through triggers) or
          by <a class="link" href="sql-syntax.html#lock-tables" title="13.3.5 LOCK TABLES and UNLOCK TABLES Syntax"><code class="literal">LOCK TABLES
          ... READ</code></a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_concurrency"></a>
          <a class="indexterm" name="idm140301491907680"></a>

          <a class="indexterm" name="idm140301491906576"></a>

          <a class="indexterm" name="idm140301491905120"></a>

          <code class="literal">innodb_thread_concurrency</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_concurrency" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_concurrency=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency">innodb_thread_concurrency</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000</code></td></tr></tbody></table>
</div>
<p>
          <code class="literal">InnoDB</code> tries to keep the number of
          operating system threads concurrently inside
          <code class="literal">InnoDB</code> less than or equal to the limit
          given by this variable (<code class="literal">InnoDB</code> uses
          operating system threads to process user transactions). Once
          the number of threads reaches this limit, additional threads
          are placed into a wait state within a <span class="quote">“<span class="quote">First In, First
          Out</span>”</span> (FIFO) queue for execution. Threads waiting for
          locks are not counted in the number of concurrently executing
          threads.
        </p><p>
          The range of this variable is 0 to 1000. A value of 0 (the
          default) is interpreted as infinite concurrency (no
          concurrency checking). Disabling thread concurrency checking
          enables <code class="literal">InnoDB</code> to create as many threads as
          it needs. A value of 0 also disables the <code class="literal">queries
          inside InnoDB</code> and <code class="literal">queries in queue
          counters</code> in the <code class="literal">ROW OPERATIONS</code>
          section of <code class="literal">SHOW ENGINE INNODB STATUS</code>
          output.
        </p><p>
          Consider setting this variable if your MySQL instance shares
          CPU resources with other applications, or if your workload or
          number of concurrent users is growing. The correct setting
          depends on workload, computing environment, and the version of
          MySQL that you are running. You will need to test a range of
          values to determine the setting that provides the best
          performance. <code class="literal">innodb_thread_concurrency</code> is a
          dynamic variable, which allows you to experiment with
          different settings on a live test system. If a particular
          setting performs poorly, you can quickly set
          <code class="literal">innodb_thread_concurrency</code> back to 0.
        </p><p>
          Use the following guidelines to help find and maintain an
          appropriate setting:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              If the number of concurrent user threads for a workload is
              less than 64, set
              <code class="literal">innodb_thread_concurrency=0</code>.
            </p></li><li class="listitem"><p>
              If your workload is consistently heavy or occasionally
              spikes, start by setting
              <code class="literal">innodb_thread_concurrency=128</code>, and
              lowering the value to 96, 80, 64, and so on, until you
              find the number of threads that provides the best
              performance. For example, suppose your system typically
              has 40 to 50 users, but periodically the number increases
              to 60, 70, or even 200. You find that performance is
              stable at 80 concurrent users but starts to show a
              regression above this number. In this case, you would set
              <code class="literal">innodb_thread_concurrency=80</code> to avoid
              impacting performance.
            </p></li><li class="listitem"><p>
              If you do not want <code class="literal">InnoDB</code> to use more
              than a certain number of vCPUs for user threads (20 vCPUs
              for example), set
              <code class="literal">innodb_thread_concurrency</code> to this
              number (or possibly lower, depending on performance
              results). If your goal is to isolate MySQL from other
              applications, you may consider binding the
              <code class="literal">mysqld</code> process exclusively to the
              vCPUs. Be aware, however, that exclusive binding could
              result in non-optimal hardware usage if the
              <code class="literal">mysqld</code> process is not consistently
              busy. In this case, you might bind the
              <code class="literal">mysqld</code> process to the vCPUs but also
              allow other applications to use some or all of the vCPUs.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
                From an operating system perspective, using a resource
                management solution (if available) to manage how CPU
                time is shared among applications may be preferable to
                binding the <code class="literal">mysqld</code> process. For
                example, you could assign 90% of vCPU time to a given
                application while other critical process <span class="emphasis"><em>are
                not</em></span> running, and scale that value back to 40%
                when other critical processes <span class="emphasis"><em>are</em></span>
                running.
</p>
</div>
</li><li class="listitem"><p>
              <code class="literal">innodb_thread_concurrency</code> values that
              are too high can cause performance regression due to
              increased contention on system internals and resources.
            </p></li><li class="listitem"><p>
              In some cases, the optimal
              <code class="literal">innodb_thread_concurrency</code> setting can
              be smaller than the number of vCPUs.
            </p></li><li class="listitem"><p>
              Monitor and analyze your system regularly. Changes to
              workload, number of users, or computing environment may
              require that you adjust the
              <code class="literal">innodb_thread_concurrency</code> setting.
</p></li></ul>
</div>
<p>
          For related information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.15.6 Configuring Thread Concurrency for InnoDB">Section 14.15.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_thread_sleep_delay"></a>
          <a class="indexterm" name="idm140301491848320"></a>

          <a class="indexterm" name="idm140301491847216"></a>

          <code class="literal">innodb_thread_sleep_delay</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_thread_sleep_delay" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_thread_sleep_delay=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay">innodb_thread_sleep_delay</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">Yes</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (64-bit platforms, &lt;= 5.5.36)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">18446744073709551615</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (32-bit platforms, &lt;= 5.5.36)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">4294967295</code></td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span> (&gt;= 5.5.37)</td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">10000</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">0</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">1000000</code></td></tr></tbody></table>
</div>
<p>
          How long <code class="literal">InnoDB</code> threads sleep before
          joining the <code class="literal">InnoDB</code> queue, in microseconds.
          The default value is 10000. A value of 0 disables sleep.
        </p><p>
          For more information, see
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-thread_concurrency" title="14.15.6 Configuring Thread Concurrency for InnoDB">Section 14.15.6, “Configuring Thread Concurrency for InnoDB”</a>.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_native_aio"></a>
          <a class="indexterm" name="idm140301491796608"></a>

          <a class="indexterm" name="idm140301491795568"></a>

          <code class="literal">innodb_use_native_aio</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_native_aio" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Introduced</strong></span></td><td colspan="3">5.5.4</td></tr><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_native_aio=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio">innodb_use_native_aio</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Specifies whether to use the Linux asynchronous I/O subsystem.
          This variable applies to Linux systems only, and cannot be
          changed while the server is running. Normally, you do not need
          to touch this option, because it is enabled by default.
        </p><p>
          As of MySQL 5.5, the
          <a class="link" href="glossary.html#glos_asynchronous_io" title="asynchronous I/O">asynchronous I/O</a>
          capability that <code class="literal">InnoDB</code> has on Windows
          systems is available on Linux systems. (Other Unix-like
          systems continue to use synchronous I/O calls.) This feature
          improves the scalability of heavily I/O-bound systems, which
          typically show many pending reads/writes in the output of the
          command <code class="literal">SHOW ENGINE INNODB STATUS\G</code>.
        </p><p>
          Running with a large number of <code class="literal">InnoDB</code> I/O
          threads, and especially running multiple such instances on the
          same server machine, can exceed capacity limits on Linux
          systems. In this case, you may receive the following error:
        </p><pre class="programlisting">
EAGAIN: The specified maxevents exceeds the user's limit of available events. 
</pre><p>
          You can typically address this error by writing a higher limit
          to <code class="literal">/proc/sys/fs/aio-max-nr</code>.
        </p><p>
          However, if a problem with the asynchronous I/O subsystem in
          the OS prevents <code class="literal">InnoDB</code> from starting, you
          can start the server with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a>
          disabled (use
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_native_aio"><code class="literal">innodb_use_native_aio=0</code></a> in
          the option file). This option may also be turned off
          automatically during startup if <code class="literal">InnoDB</code>
          detects a potential problem such as a combination of
          <code class="literal">tmpdir</code> location, <code class="literal">tmpfs</code>
          filesystem, and Linux kernel that does not support AIO on
          <code class="literal">tmpfs</code>.
        </p><p>
          This variable was added in MySQL 5.5.4.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_use_sys_malloc"></a>
          <a class="indexterm" name="idm140301491756608"></a>

          <a class="indexterm" name="idm140301491755568"></a>

          <code class="literal">innodb_use_sys_malloc</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_use_sys_malloc" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_use_sys_malloc=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc">innodb_use_sys_malloc</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="2"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">boolean</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">ON</code></td></tr></tbody></table>
</div>
<p>
          Whether <code class="literal">InnoDB</code> uses the operating system
          memory allocator (<code class="literal">ON</code>) or its own
          (<code class="literal">OFF</code>). The default value is
          <code class="literal">ON</code>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-use_sys_malloc" title="14.15.4 Configuring the Memory Allocator for InnoDB">Section 14.15.4, “Configuring the Memory Allocator for InnoDB”</a> for more
          information.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_version"></a>
          <a class="indexterm" name="idm140301491729152"></a>

          <a class="indexterm" name="idm140301491728144"></a>

          <code class="literal">innodb_version</code>
        </p><p>
          The <code class="literal">InnoDB</code> version number. Starting in
          5.5.30, the separate numbering for <code class="literal">InnoDB</code>
          is discontinued and this value is the same as for the
          <a class="link" href="server-administration.html#sysvar_version"><code class="literal">version</code></a> variable.
        </p></li><li class="listitem"><p><a name="sysvar_innodb_write_io_threads"></a>
          <a class="indexterm" name="idm140301491721472"></a>

          <a class="indexterm" name="idm140301491720432"></a>

          <code class="literal">innodb_write_io_threads</code>
</p>
<div class="informaltable">
<table summary="Options for innodb_write_io_threads" border="1"><colgroup><col class="title"><col class="vt"><col class="vd"><col class="v"></colgroup><tbody><tr><td scope="row"><span class="bold"><strong>Command-Line Format</strong></span></td><td colspan="3"><code class="literal">--innodb_write_io_threads=#</code></td></tr><tr><td scope="row" rowspan="3"><span class="bold"><strong>System Variable</strong></span></td><td><span class="bold"><strong>Name</strong></span></td><td colspan="2"><code class="literal"><a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads">innodb_write_io_threads</a></code></td></tr><tr><td scope="row"><span class="bold"><strong>Variable Scope</strong></span></td><td colspan="2">Global</td></tr><tr><td scope="row"><span class="bold"><strong>Dynamic Variable</strong></span></td><td colspan="2">No</td></tr><tr><td scope="row" rowspan="4"><span class="bold"><strong>Permitted Values</strong></span></td><td><span class="bold"><strong>Type</strong></span></td><td colspan="2"><code class="literal">integer</code></td></tr><tr><td scope="row"><span class="bold"><strong>Default</strong></span></td><td colspan="2"><code class="literal">4</code></td></tr><tr><td scope="row"><span class="bold"><strong>Min Value</strong></span></td><td colspan="2"><code class="literal">1</code></td></tr><tr><td scope="row"><span class="bold"><strong>Max Value</strong></span></td><td colspan="2"><code class="literal">64</code></td></tr></tbody></table>
</div>
<p>
          The number of I/O threads for write operations in
          <code class="literal">InnoDB</code>. The default value is 4. Its
          counterpart for read threads is
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>. See
          <a class="xref" href="innodb-storage-engine.html#innodb-performance-multiple_io_threads" title="14.15.7 Configuring the Number of Background InnoDB I/O Threads">Section 14.15.7, “Configuring the Number of Background InnoDB I/O Threads”</a> for
          more information. For general I/O tuning advice, see
          <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
            On Linux systems, running multiple MySQL servers (typically
            more than 12) with default settings for
            <code class="literal">innodb_read_io_threads</code>,
            <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>,
            and the Linux <code class="literal">aio-max-nr</code> setting can
            exceed system limits. Ideally, increase the
            <code class="literal">aio-max-nr</code> setting; as a workaround, you
            might reduce the settings for one or both of the MySQL
            configuration options.
</p>
</div>
</li></ul>
</div>
<p>
      You should also take into consideration the value of
      <a class="link" href="replication.html#sysvar_sync_binlog"><code class="literal">sync_binlog</code></a>, which controls
      synchronization of the binary log to disk.
    </p><p>
      For general I/O tuning advice, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-performance"></a>14.15 InnoDB Performance</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-overview">14.15.1 Overview of InnoDB Performance</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-buffer-pool">14.15.2 InnoDB Buffer Pool Configuration</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-latching">14.15.3 InnoDB Mutex and Read/Write Lock Implementation</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-use_sys_malloc">14.15.4 Configuring the Memory Allocator for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-change_buffering">14.15.5 Configuring InnoDB Change Buffering</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_concurrency">14.15.6 Configuring Thread Concurrency for InnoDB</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-multiple_io_threads">14.15.7 Configuring the Number of Background InnoDB I/O Threads</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-group_commit">14.15.8 Group Commit</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-thread_io_rate">14.15.9 Configuring the InnoDB Master Thread I/O Rate</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-spin_lock_polling">14.15.10 Configuring Spin Lock Polling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-schema">14.15.11 InnoDB Integration with MySQL Performance Schema</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-rollback-segments">14.15.12 Better Scalability with Multiple Rollback Segments</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-improved-purge-scheduling">14.15.13 Configuring InnoDB Purge Scheduling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-statistics-estimation">14.15.14 Configuring Optimizer Statistics Parameters</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-analyze-table-complexity">14.15.15 Estimating ANALYZE TABLE Complexity for InnoDB Tables</a></span></dt></dl>
</div>
<p>
    This section provides information about <code class="literal">InnoDB</code>
    features and enhancements related to performance and scalability.
  </p><p>
    Tips and guidelines for tuning <code class="literal">InnoDB</code> tables are
    provided in the optimization chapter. See
    <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-overview"></a>14.15.1 Overview of InnoDB Performance</h3>
</div>
</div>
</div>
<p>
      <code class="literal">InnoDB</code> has always been highly efficient, and
      includes several unique architectural elements to assure high
      performance and scalability. The latest <code class="literal">InnoDB</code>
      storage engine includes new features that take advantage of
      advances in operating systems and hardware platforms, such as
      multi-core processors and improved memory allocation systems. In
      addition, new configuration options let you better control some
      <code class="literal">InnoDB</code> internal subsystems to achieve the best
      performance with your workload.
    </p><p>
      Starting with MySQL 5.5 and <code class="literal">InnoDB</code> 1.1, the
      built-in <code class="literal">InnoDB</code> storage engine within MySQL is
      upgraded to the full feature set and performance of the former
      <code class="literal">InnoDB</code> Plugin. This change makes
      <code class="literal">InnoDB</code> performance and scalability features
      that were available with the former <code class="literal">InnoDB</code>
      Plugin available to a much wider audience than before, and
      eliminates the separate installation step of the
      <code class="literal">InnoDB</code> Plugin. After learning about the
      <code class="literal">InnoDB</code> performance features in this section,
      continue with <a class="xref" href="optimization.html" title="Chapter 8 Optimization">Chapter 8, <i>Optimization</i></a> to learn the best
      practices for overall MySQL performance, and
      <a class="xref" href="optimization.html#optimizing-innodb" title="8.5 Optimizing for InnoDB Tables">Section 8.5, “Optimizing for InnoDB Tables”</a> in particular for
      <code class="literal">InnoDB</code> tips and guidelines.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-buffer-pool"></a>14.15.2 InnoDB Buffer Pool Configuration</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-read_ahead">14.15.2.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-adaptive_flushing">14.15.2.2 Configuring the Rate of InnoDB Buffer Pool Flushing</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-performance-midpoint_insertion">14.15.2.3 Making the Buffer Pool Scan Resistant</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-multiple-buffer-pools">14.15.2.4 Using Multiple Buffer Pool Instances</a></span></dt></dl>
</div>
<p>
      This section provides performance related configuration
      information for the <code class="literal">InnoDB</code> buffer pool. For
      additional information, see <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-read_ahead"></a>14.15.2.1 Configuring InnoDB Buffer Pool Prefetching (Read-Ahead)</h4>
</div>
</div>
</div>
<a class="indexterm" name="idm140301491661952"></a><a class="indexterm" name="idm140301491660912"></a><a class="indexterm" name="idm140301491659408"></a><a class="indexterm" name="idm140301491657920"></a><p>
        A <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> request is
        an I/O request to prefetch multiple pages in the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>
        asynchronously, in anticipation that these pages will be needed
        soon. The requests bring in all the pages in one
        <a class="link" href="glossary.html#glos_extent" title="extent">extent</a>. InnoDB uses two
        read-ahead algorithms to improve I/O performance:
      </p><p>
        <span class="strong"><strong>Linear</strong></span> read-ahead is a
        technique that predicts what pages might be needed soon based on
        pages in the buffer pool being accessed sequentially. You
        control when InnoDB performs a read-ahead operation by adjusting
        the number of sequential page accesses required to trigger an
        asynchronous read request, using the configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>.
        Before this parameter was added, InnoDB would only calculate
        whether to issue an asynchronous prefetch request for the entire
        next extent when it read in the last page of the current extent.
      </p><p>
        The configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>
        controls how sensitive InnoDB is in detecting patterns of
        sequential page access. If the number of pages read sequentially
        from an extent is greater than or equal to
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_ahead_threshold"><code class="literal">innodb_read_ahead_threshold</code></a>,
        InnoDB initiates an asynchronous read-ahead operation of the
        entire following extent. It can be set to any value from 0-64.
        The default value is 56. The higher the value, the more strict
        the access pattern check. For example, if you set the value to
        48, InnoDB triggers a linear read-ahead request only when 48
        pages in the current extent have been accessed sequentially. If
        the value is 8, InnoDB would trigger an asynchronous read-ahead
        even if as few as 8 pages in the extent were accessed
        sequentially. You can set the value of this parameter in the
        MySQL <a class="link" href="glossary.html#glos_configuration_file" title="configuration file">configuration
        file</a>, or change it dynamically with the <code class="literal">SET
        GLOBAL</code> command, which requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        <span class="strong"><strong>Random</strong></span> read-ahead is a
        technique that predicts when pages might be needed soon based on
        pages already in the buffer pool, regardless of the order in
        which those pages were read. If 13 consecutive pages from the
        same extent are found in the buffer pool, InnoDB asynchronously
        issues a request to prefetch the remaining pages of the extent.
      </p><p>
        Random read-ahead functionality was removed from the
        <code class="literal">InnoDB Plugin</code> (version 1.0.4) and was
        therefore not included in MySQL 5.5.0 when <code class="literal">InnoDB
        Plugin</code> became the <span class="quote">“<span class="quote">built-in</span>”</span> version of
        <code class="literal">InnoDB</code>. Random read-ahead was reintroduced in
        MySQL 5.1.59 and 5.5.16 and higher along with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>
        configuration option, which is disabled by default. To enable
        this feature, set the configuration variable
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a> to
        <code class="literal">ON</code>.
      </p><p>
        The <code class="literal">SHOW ENGINE INNODB STATUS</code> command
        displays statistics to help you evaluate the effectiveness of
        the read-ahead algorithm. Statistics include counter information
        for the
        <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead"><code class="literal">Innodb_buffer_pool_read_ahead</code></a>
        and
        <a class="link" href="server-administration.html#statvar_Innodb_buffer_pool_read_ahead_evicted"><code class="literal">Innodb_buffer_pool_read_ahead_evicted</code></a>
        global status variables. This information can be useful when
        fine-tuning the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_random_read_ahead"><code class="literal">innodb_random_read_ahead</code></a>
        setting.
      </p><p>
        For more information about I/O performance, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a> and
        <a class="xref" href="optimization.html#disk-issues" title="8.11.3 Optimizing Disk I/O">Section 8.11.3, “Optimizing Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-adaptive_flushing"></a>14.15.2.2 Configuring the Rate of InnoDB Buffer Pool Flushing</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491627648"></a><a class="indexterm" name="idm140301491626608"></a><a class="indexterm" name="idm140301491625104"></a><a class="indexterm" name="idm140301491624016"></a><a class="indexterm" name="idm140301491622496"></a><a class="indexterm" name="idm140301491621008"></a><p>
        InnoDB performs certain tasks in the background, including
        <a class="link" href="glossary.html#glos_flush" title="flush">flushing</a> of
        <a class="link" href="glossary.html#glos_dirty_page" title="dirty page">dirty pages</a> (those pages
        that have been changed but are not yet written to the database
        files) from the <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a>, a task performed by the
        <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>.
        Currently, InnoDB aggressively flushes buffer pool pages if the
        percentage of dirty pages in the buffer pool exceeds
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a>.
      </p><p>
        InnoDB uses an algorithm to estimate the required rate of
        flushing, based on the speed of redo log generation and the
        current rate of flushing. The intent is to smooth overall
        performance by ensuring that buffer flush activity keeps up with
        the need to keep the buffer pool <span class="quote">“<span class="quote">clean</span>”</span>.
        Automatically adjusting the rate of flushing can help to avoid
        sudden dips in throughput, when excessive buffer pool flushing
        limits the I/O capacity available for ordinary read and write
        activity.
      </p><p>
        InnoDB uses its log files in a circular fashion. Before reusing
        a portion of a log file, InnoDB flushes to disk all dirty buffer
        pool pages whose redo entries are contained in that portion of
        the log file, a process known as a
        <a class="link" href="glossary.html#glos_sharp_checkpoint" title="sharp checkpoint">sharp checkpoint</a>.
        If a workload is write-intensive, it generates a lot of redo
        information, all written to the log file. If all available space
        in the log files is used up, a sharp checkpoint occurs, causing
        a temporary reduction in throughput. This situation can happen
        even though
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_max_dirty_pages_pct"><code class="literal">innodb_max_dirty_pages_pct</code></a> is
        not reached.
      </p><p>
        InnoDB uses a heuristic-based algorithm to avoid such a
        scenario, by measuring the number of dirty pages in the buffer
        pool and the rate at which redo is being generated. Based on
        these numbers, InnoDB decides how many dirty pages to flush from
        the buffer pool each second. This self-adapting algorithm is
        able to deal with sudden changes in the workload.
      </p><p>
        Internal benchmarking has also shown that this algorithm not
        only maintains throughput over time, but can also improve
        overall throughput significantly.
      </p><p>
        Because adaptive flushing can significantly affect the I/O
        pattern of a workload, the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        configuration parameter lets you turn off this feature. The
        default value for
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_flushing"><code class="literal">innodb_adaptive_flushing</code></a>
        is <code class="literal">TRUE</code>, enabling the adaptive flushing
        algorithm. You can set the value of this parameter in the MySQL
        option file (<code class="literal">my.cnf</code> or
        <code class="literal">my.ini</code>) or change it dynamically with the
        <code class="literal">SET GLOBAL</code> command, which requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        For more information about InnoDB I/O performance, see
        <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-performance-midpoint_insertion"></a>14.15.2.3 Making the Buffer Pool Scan Resistant</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491598816"></a><a class="indexterm" name="idm140301491597744"></a><a class="indexterm" name="idm140301491596672"></a><a class="indexterm" name="idm140301491595600"></a><a class="indexterm" name="idm140301491594528"></a><a class="indexterm" name="idm140301491593456"></a><p>
        Rather than using a strictly <a class="link" href="glossary.html#glos_lru" title="LRU">LRU</a>
        algorithm, InnoDB uses a technique to minimize the amount of
        data that is brought into the
        <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> and never
        accessed again. The goal is to make sure that frequently
        accessed (<span class="quote">“<span class="quote">hot</span>”</span>) pages remain in the buffer pool,
        even as <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> and
        <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a>
        bring in new blocks that might or might not be accessed
        afterward.
      </p><p>
        Newly read blocks are inserted into the middle of the LRU list.
        All newly read pages are inserted at a location that by default
        is <code class="literal">3/8</code> from the tail of the LRU list. The
        pages are moved to the front of the list (the most-recently used
        end) when they are accessed in the buffer pool for the first
        time. Thus pages that are never accessed never make it to the
        front portion of the LRU list, and <span class="quote">“<span class="quote">age out</span>”</span> sooner
        than with a strict LRU approach. This arrangement divides the
        LRU list into two segments, where the pages downstream of the
        insertion point are considered <span class="quote">“<span class="quote">old</span>”</span> and are
        desirable victims for LRU eviction.
      </p><p>
        For an explanation of the inner workings of the InnoDB buffer
        pool and the specifics of its LRU replacement algorithm, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
      </p><p>
        You can control the insertion point in the LRU list, and choose
        whether InnoDB applies the same optimization to blocks brought
        into the buffer pool by table or index scans. The configuration
        parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        controls the percentage of <span class="quote">“<span class="quote">old</span>”</span> blocks in the LRU
        list. The default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        is <code class="literal">37</code>, corresponding to the original fixed
        ratio of 3/8. The value range is <code class="literal">5</code> (new pages
        in the buffer pool age out very quickly) to
        <code class="literal">95</code> (only 5% of the buffer pool is reserved
        for hot pages, making the algorithm close to the familiar LRU
        strategy).
      </p><p>
        The optimization that keeps the buffer pool from being churned
        by read-ahead can avoid similar problems due to table or index
        scans. In these scans, a data page is typically accessed a few
        times in quick succession and is never touched again. The
        configuration parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        specifies the time window (in milliseconds) after the first
        access to a page during which it can be accessed without being
        moved to the front (most-recently used end) of the LRU list. The
        default value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> is
        <code class="literal">0</code>, corresponding to the original behavior of
        moving a page to the most-recently used end of the buffer pool
        list when it is first accessed in the buffer pool. Increasing
        this value makes more and more blocks likely to age out faster
        from the buffer pool.
      </p><p>
        Both
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a> are
        dynamic, global and can be specified in the MySQL option file
        (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or
        changed at runtime with the <code class="literal">SET GLOBAL</code>
        command. Changing the setting requires the
        <code class="literal">SUPER</code> privilege.
      </p><p>
        To help you gauge the effect of setting these parameters, the
        <code class="literal">SHOW ENGINE INNODB STATUS</code> command reports
        additional statistics. The <code class="literal">BUFFER POOL AND
        MEMORY</code> section looks like:
      </p><pre class="programlisting">
Total memory allocated 1107296256; in additional pool allocated 0
Dictionary memory allocated 80360
Buffer pool size   65535
Free buffers       0
Database pages     63920
Old database pages 23600
Modified db pages  34969
Pending reads 32
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 414946, not young 2930673
1274.75 youngs/s, 16521.90 non-youngs/s
Pages read 486005, created 3178, written 160585
2132.37 reads/s, 3.40 creates/s, 323.74 writes/s
Buffer pool hit rate 950 / 1000, young-making rate 30 / 1000 not 392 / 1000
Pages read ahead 1510.10/s, evicted without access 0.00/s
LRU len: 63920, unzip_LRU len: 0
I/O sum[43690]:cur[221], unzip sum[0]:cur[0]
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            <code class="literal">Old database pages</code> is the number of pages
            in the <span class="quote">“<span class="quote">old</span>”</span> segment of the LRU list.
          </p></li><li class="listitem"><p>
            <code class="literal">Pages made young</code> and <code class="literal">not
            young</code> is the total number of <span class="quote">“<span class="quote">old</span>”</span>
            pages that have been made young or not respectively.
          </p></li><li class="listitem"><p>
            <code class="literal">youngs/s</code> and
            <code class="literal">non-young/s</code> is the rate at which page
            accesses to the <span class="quote">“<span class="quote">old</span>”</span> pages have resulted in
            making such pages young or otherwise respectively since the
            last invocation of the command.
          </p></li><li class="listitem"><p>
            <code class="literal">young-making rate</code> and
            <code class="literal">not</code> provides the same rate but in terms
            of overall buffer pool accesses instead of accesses just to
            the <span class="quote">“<span class="quote">old</span>”</span> pages.
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
          Per second averages provided in <code class="literal">InnoDB</code>
          Monitor output are based on the elapsed time between the
          current time and the last time <code class="literal">InnoDB</code>
          Monitor output was printed.
</p>
</div>
<p>
        Because the effects of these parameters can vary widely based on
        your hardware configuration, your data, and the details of your
        workload, always benchmark to verify the effectiveness before
        changing these settings in any performance-critical or
        production environment.
      </p><p>
        In mixed workloads where most of the activity is OLTP type with
        periodic batch reporting queries which result in large scans,
        setting the value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        during the batch runs can help keep the working set of the
        normal workload in the buffer pool.
      </p><p>
        When scanning large tables that cannot fit entirely in the
        buffer pool, setting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        to a small value keeps the data that is only read once from
        consuming a significant portion of the buffer pool. For example,
        setting <code class="literal">innodb_old_blocks_pct=5</code> restricts
        this data that is only read once to 5% of the buffer pool.
      </p><p>
        When scanning small tables that do fit into memory, there is
        less overhead for moving pages around within the buffer pool, so
        you can leave
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a> at its
        default value, or even higher, such as
        <code class="literal">innodb_old_blocks_pct=50</code>.
      </p><p>
        The effect of the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_time"><code class="literal">innodb_old_blocks_time</code></a>
        parameter is harder to predict than the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        parameter, is relatively small, and varies more with the
        workload. To arrive at an optimal value, conduct your own
        benchmarks if the performance improvement from adjusting
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_old_blocks_pct"><code class="literal">innodb_old_blocks_pct</code></a>
        is not sufficient.
      </p><p>
        For more information about the InnoDB buffer pool, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-multiple-buffer-pools"></a>14.15.2.4 Using Multiple Buffer Pool Instances</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491534912"></a><p>
        For systems with buffer pools in the multi-gigabyte range,
        dividing the buffer pool into separate instances can improve
        concurrency, by reducing contention as different threads read
        and write to cached pages. This feature is typically intended
        for systems with a <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer
        pool</a> size in the multi-gigabyte range. Multiple buffer
        pool instances are configured using the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        configuration option, and you might also adjust the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> value.
      </p><p>
        When the InnoDB buffer pool is large, many data requests can be
        satisfied by retrieving from memory. You might encounter
        bottlenecks from multiple threads trying to access the buffer
        pool at once. You can enable multiple buffer pools to minimize
        this contention. Each page that is stored in or read from the
        buffer pool is assigned to one of the buffer pools randomly,
        using a hashing function. Each buffer pool manages its own free
        lists, flush lists, LRUs, and all other data structures
        connected to a buffer pool, and is protected by its own buffer
        pool mutex.
      </p><p>
        To enable multiple buffer pool instances, set the
        <code class="literal">innodb_buffer_pool_instances</code> configuration
        option to a value greater than 1 (the default) up to 64 (the
        maximum). This option takes effect only when you set the
        <code class="literal">innodb_buffer_pool_size</code> to a size of 1
        gigabyte or more. The total size you specify is divided among
        all the buffer pools. For best efficiency, specify a combination
        of <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_instances"><code class="literal">innodb_buffer_pool_instances</code></a>
        and <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a> so
        that each buffer pool instance is at least 1 gigabyte.
      </p><p>
        For more information about the InnoDB buffer pool, see
        <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-latching"></a>14.15.3 InnoDB Mutex and Read/Write Lock Implementation</h3>

</div>

</div>

</div>
<p>
      In MySQL and <code class="literal">InnoDB</code>, multiple threads of
      execution access shared data structures. <code class="literal">InnoDB</code>
      synchronizes these accesses with its own implementation of
      <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">read/write locks</a>.
      <code class="literal">InnoDB</code> has historically protected the internal
      state of a read/write lock with an <code class="literal">InnoDB</code>
      mutex. On Unix and Linux platforms, the internal state of an
      <code class="literal">InnoDB</code> mutex is protected by a
      <a class="link" href="glossary.html#glos_pthreads" title="Pthreads">Pthreads</a> mutex, as in IEEE
      Std 1003.1c (POSIX.1c).
    </p><p>
      On many platforms, there is a more efficient way to implement
      mutexes and read/write locks.
      <a class="link" href="glossary.html#glos_atomic" title="atomic">Atomic</a> operations can often be
      used to synchronize the actions of multiple threads more
      efficiently than Pthreads. Each operation to acquire or release a
      lock can be done in fewer CPU instructions, and thus result in
      less wasted time when threads are contending for access to shared
      data structures. This in turn means greater scalability on
      multi-core platforms.
    </p><p>
      <code class="literal">InnoDB</code> implements mutexes and read/write locks
      with the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a> instead of using the Pthreads approach
      previously used. More specifically, an <code class="literal">InnoDB</code>
      that is compiled with GCC version 4.1.2 or later uses the atomic
      builtins instead of a <code class="literal">pthread_mutex_t</code> to
      implement <code class="literal">InnoDB</code> mutexes and read/write locks.
    </p><p>
      On 32-bit Microsoft Windows, <code class="literal">InnoDB</code> has
      implemented mutexes (but not read/write locks) with hand-written
      assembler instructions. Beginning with Microsoft Windows 2000,
      functions for
      <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms684122(VS.85).aspx" target="_top">Interlocked
      Variable Access</a> are available that are similar to the
      built-in functions provided by GCC. On Windows 2000 and higher,
      <code class="literal">InnoDB</code> makes use of the Interlocked functions.
      Unlike the old hand-written assembler code, the new implementation
      supports read/write locks and 64-bit platforms.
    </p><p>
      Solaris 10 introduced library functions for atomic operations, and
      <code class="literal">InnoDB</code> uses these functions by default. When
      MySQL is compiled on Solaris 10 with a compiler that does not
      support the
      <a class="ulink" href="http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html" target="_top">built-in
      functions provided by the GNU Compiler Collection (GCC) for atomic
      memory access</a>, <code class="literal">InnoDB</code> uses the library
      functions.
    </p><p>
      This change improves the scalability of <code class="literal">InnoDB</code>
      on multi-core systems. This feature is enabled out-of-the-box on
      the platforms where it is supported. You do not have to set any
      parameter or option to take advantage of the improved performance.
      On platforms where the GCC, Windows, or Solaris functions for
      atomic memory access are not available, <code class="literal">InnoDB</code>
      uses the traditional Pthreads method of implementing mutexes and
      read/write locks.
    </p><p>
      When MySQL starts, <code class="literal">InnoDB</code> writes a message to
      the log file indicating whether atomic memory access is used for
      mutexes, for mutexes and read/write locks, or neither. If suitable
      tools are used to build <code class="literal">InnoDB</code> and the target
      CPU supports the atomic operations required,
      <code class="literal">InnoDB</code> uses the built-in functions for
      mutexing. If, in addition, the compare-and-swap operation can be
      used on thread identifiers (<code class="literal">pthread_t</code>), then
      <code class="literal">InnoDB</code> uses the instructions for read-write
      locks as well.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        If you are building from source, ensure that the build process
        properly takes advantage of your platform capabilities.
</p>
</div>
<p>
      For more information about the performance implications of
      locking, see <a class="xref" href="optimization.html#locking-issues" title="8.10 Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-use_sys_malloc"></a>14.15.4 Configuring the Memory Allocator for InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491491456"></a><a class="indexterm" name="idm140301491490416"></a><a class="indexterm" name="idm140301491488928"></a><a class="indexterm" name="idm140301491487424"></a><a class="indexterm" name="idm140301491485936"></a><a class="indexterm" name="idm140301491484400"></a><p>
      When <code class="literal">InnoDB</code> was developed, the memory
      allocators supplied with operating systems and run-time libraries
      were often lacking in performance and scalability. At that time,
      there were no memory allocator libraries tuned for multi-core
      CPUs. Therefore, <code class="literal">InnoDB</code> implemented its own
      memory allocator in the <code class="literal">mem</code> subsystem. This
      allocator is guarded by a single mutex, which may become a
      <a class="link" href="glossary.html#glos_bottleneck" title="bottleneck">bottleneck</a>.
      <code class="literal">InnoDB</code> also implements a wrapper interface
      around the system allocator (<code class="literal">malloc</code> and
      <code class="literal">free</code>) that is likewise guarded by a single
      mutex.
    </p><p>
      Today, as multi-core systems have become more widely available,
      and as operating systems have matured, significant improvements
      have been made in the memory allocators provided with operating
      systems. New memory allocators perform better and are more
      scalable than they were in the past. The leading high-performance
      memory allocators include <code class="literal">Hoard</code>,
      <code class="literal">libumem</code>, <code class="literal">mtmalloc</code>,
      <code class="literal">ptmalloc</code>, <code class="literal">tbbmalloc</code>, and
      <code class="literal">TCMalloc</code>. Most workloads, especially those
      where memory is frequently allocated and released (such as
      multi-table joins), benefit from using a more highly tuned memory
      allocator as opposed to the internal,
      <code class="literal">InnoDB</code>-specific memory allocator.
    </p><p>
      You can control whether <code class="literal">InnoDB</code> uses its own
      memory allocator or an allocator of the operating system, by
      setting the value of the system configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> in the
      MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>). If set to <code class="literal">ON</code> or
      <code class="literal">1</code> (the default), InnoDB uses the
      <code class="literal">malloc</code> and <code class="literal">free</code> functions of
      the underlying system rather than manage memory pools itself. This
      parameter is not dynamic, and takes effect only when the system is
      started. To continue to use the InnoDB memory allocator, set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> to
      <code class="literal">0</code>.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        When the <code class="literal">InnoDB</code> memory allocator is disabled,
        <code class="literal">InnoDB</code> ignores the value of the parameter
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_additional_mem_pool_size"><code class="literal">innodb_additional_mem_pool_size</code></a>.
        The <code class="literal">InnoDB</code> memory allocator uses an
        additional memory pool for satisfying allocation requests
        without having to fall back to the system memory allocator. When
        the <code class="literal">InnoDB</code> memory allocator is disabled, all
        such allocation requests are fulfilled by the system memory
        allocator.
      </p><p>
        On Unix-like systems that use dynamic linking, replacing the
        memory allocator may be as easy as making the environment
        variable <code class="literal">LD_PRELOAD</code> or
        <code class="literal">LD_LIBRARY_PATH</code> point to the dynamic library
        that implements the allocator. On other systems, some relinking
        may be necessary. Please refer to the documentation of the
        memory allocator library of your choice.
      </p><p>
        Since <code class="literal">InnoDB</code> cannot track all memory use when
        the system memory allocator is used
        (<a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> is
        <code class="literal">ON</code>), the section <span class="quote">“<span class="quote">BUFFER POOL AND
        MEMORY</span>”</span> in the output of the <code class="literal">SHOW ENGINE INNODB
        STATUS</code> command only includes the buffer pool
        statistics in the <span class="quote">“<span class="quote">Total memory allocated</span>”</span>. Any
        memory allocated using the <code class="literal">mem</code> subsystem or
        using <code class="literal">ut_malloc</code> is excluded.
</p>
</div>
<p>
      For more information about the performance implications of
      <code class="literal">InnoDB</code> memory usage, see
      <a class="xref" href="optimization.html#buffering-caching" title="8.9 Buffering and Caching">Section 8.9, “Buffering and Caching”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-change_buffering"></a>14.15.5 Configuring InnoDB Change Buffering</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491444944"></a><a class="indexterm" name="idm140301491443872"></a><a class="indexterm" name="idm140301491442384"></a><a class="indexterm" name="idm140301491440896"></a><p>
      When <code class="literal">INSERT</code>, <code class="literal">UPDATE</code>, and
      <code class="literal">DELETE</code> operations are done to a table, often
      the values of indexed columns (particularly the values of
      secondary keys) are not in sorted order, requiring substantial I/O
      to bring secondary indexes up to date. <code class="literal">InnoDB</code>
      has an <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert buffer</a>
      that caches changes to secondary index entries when the relevant
      <a class="link" href="glossary.html#glos_page" title="page">page</a> is not in the
      <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a>, thus avoiding
      I/O operations by not reading in the page from the disk. The
      buffered changes are merged when the page is loaded to the buffer
      pool, and the updated page is later flushed to disk using the
      normal mechanism. The <code class="literal">InnoDB</code> main thread merges
      buffered changes when the server is nearly idle, and during a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a>.
    </p><p>
      Because it can result in fewer disk reads and writes, this feature
      is most valuable for workloads that are I/O-bound, for example
      applications with a high volume of DML operations such as bulk
      inserts.
    </p><p>
      However, the insert buffer occupies a part of the buffer pool,
      reducing the memory available to cache data pages. If the working
      set almost fits in the buffer pool, or if your tables have
      relatively few secondary indexes, it may be useful to disable
      insert buffering. If the working set entirely fits in the buffer
      pool, insert buffering does not impose any extra overhead, because
      it only applies to pages that are not in the buffer pool.
    </p><p>
      You can control the extent to which <code class="literal">InnoDB</code>
      performs insert buffering with the system configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>. You can
      turn on and off buffering for inserts, delete operations (when
      index records are initially marked for deletion) and purge
      operations (when index records are physically deleted). An update
      operation is represented as a combination of an insert and a
      delete. In MySQL 5.5 and higher, the default value is changed from
      <code class="literal">inserts</code> to <code class="literal">all</code>.
    </p><p>
      The allowed values of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_change_buffering"><code class="literal">innodb_change_buffering</code></a>
      are:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">all</code></strong></span>
        </p><p>
          The default value: buffer inserts, delete-marking operations,
          and purges.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">none</code></strong></span>
        </p><p>
          Do not buffer any operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">inserts</code></strong></span>
        </p><p>
          Buffer insert operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">deletes</code></strong></span>
        </p><p>
          Buffer delete-marking operations.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">changes</code></strong></span>
        </p><p>
          Buffer both inserts and delete-marking.
        </p></li><li class="listitem"><p>
          <span class="bold"><strong><code class="literal">purges</code></strong></span>
        </p><p>
          Buffer the physical deletion operations that happen in the
          background.
</p></li></ul>
</div>
<p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege. Changing
      the setting affects the buffering of new operations; the merging
      of already buffered entries is not affected.
    </p><p>
      For more information about speeding up <code class="literal">INSERT</code>,
      <code class="literal">UPDATE</code>, and <code class="literal">DELETE</code>
      statements, see <a class="xref" href="optimization.html#non-select-optimization" title="8.2.2 Optimizing DML Statements">Section 8.2.2, “Optimizing DML Statements”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_concurrency"></a>14.15.6 Configuring Thread Concurrency for InnoDB</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491401472"></a><a class="indexterm" name="idm140301491400432"></a><a class="indexterm" name="idm140301491399344"></a><a class="indexterm" name="idm140301491398256"></a><a class="indexterm" name="idm140301491396752"></a><p>
      <code class="literal">InnoDB</code> uses operating system
      <a class="link" href="glossary.html#glos_thread" title="thread">threads</a> to process requests
      from user transactions. (Transactions may issue many requests to
      <code class="literal">InnoDB</code> before they commit or roll back.) On
      modern operating systems and servers with multi-core processors,
      where context switching is efficient, most workloads run well
      without any limit on the number of concurrent threads. Scalability
      improvements in MySQL 5.5 and up reduce the need to limit the
      number of concurrently executing threads inside
      <code class="literal">InnoDB</code>.
    </p><p>
      In situations where it is helpful to minimize context switching
      between threads, <code class="literal">InnoDB</code> can use a number of
      techniques to limit the number of concurrently executing operating
      system threads (and thus the number of requests that are processed
      at any one time). When <code class="literal">InnoDB</code> receives a new
      request from a user session, if the number of threads concurrently
      executing is at a pre-defined limit, the new request sleeps for a
      short time before it tries again. A request that cannot be
      rescheduled after the sleep is put in a first-in/first-out queue
      and eventually is processed. Threads waiting for locks are not
      counted in the number of concurrently executing threads.
    </p><p>
      You can limit the number of concurrent threads by setting the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the number of executing threads reaches this limit,
      additional threads sleep for a number of microseconds, set by the
      configuration parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a>,
      before being placed into the queue.
    </p><p>
      The default value for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      and the implied default limit on the number of concurrent threads
      has been changed in various releases of MySQL and
      <code class="literal">InnoDB</code>. Currently, the default value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, so that by default there is no limit on the
      number of concurrently executing threads, as shown in
      <a class="xref" href="innodb-storage-engine.html#innodb-thread-concurrency-table" title="Table 14.5 Changes to innodb_thread_concurrency">Table 14.5, “Changes to innodb_thread_concurrency”</a>.
</p>
<div class="table">
<a name="innodb-thread-concurrency-table"></a><p class="title"><b>Table 14.5 Changes to innodb_thread_concurrency</b></p>
<div class="table-contents">
<table summary="Changes to innodb_thread_concurrency" border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">InnoDB Version</th><th scope="col">MySQL Version</th><th scope="col">Default value</th><th scope="col">Default limit of concurrent threads</th><th scope="col">Value to allow unlimited threads</th></tr></thead><tbody><tr><td scope="row">Built-in</td><td>Earlier than 5.1.11</td><td>20</td><td>No limit</td><td>20 or higher</td></tr><tr><td scope="row">Built-in</td><td>5.1.11 and newer</td><td>8</td><td>8</td><td>0</td></tr><tr><td scope="row">InnoDB before 1.0.3</td><td>(corresponding to Plugin)</td><td>8</td><td>8</td><td>0</td></tr><tr><td scope="row">InnoDB 1.0.3 and newer</td><td>(corresponding to Plugin)</td><td>0</td><td>No limit</td><td>0</td></tr></tbody></table>
</div>

</div>
<br class="table-break"><p>
      Note that <code class="literal">InnoDB</code> causes threads to sleep only
      when the number of concurrent threads is limited. When there is no
      limit on the number of threads, all contend equally to be
      scheduled. That is, if
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is
      <code class="literal">0</code>, the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_sleep_delay"><code class="literal">innodb_thread_sleep_delay</code></a> is
      ignored.
    </p><p>
      When there is a limit on the number of threads (when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> is &gt;
      0), <code class="literal">InnoDB</code> reduces context switching overhead
      by permitting multiple requests made during the execution of a
      <span class="emphasis"><em>single SQL statement</em></span> to enter
      <code class="literal">InnoDB</code> without observing the limit set by
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Since an SQL statement (such as a join) may comprise multiple row
      operations within <code class="literal">InnoDB</code>,
      <code class="literal">InnoDB</code> assigns a specified number of
      <span class="quote">“<span class="quote">tickets</span>”</span> that allow a thread to be scheduled
      repeatedly with minimal overhead.
    </p><p>
      When a new SQL statement starts, a thread has no tickets, and it
      must observe
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>.
      Once the thread is entitled to enter <code class="literal">InnoDB</code>, it
      is assigned a number of tickets that it can use for subsequently
      entering <code class="literal">InnoDB</code> to perform row operations. If
      the tickets run out, the thread is evicted, and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a>
      is observed again which may place the thread back into the
      first-in/first-out queue of waiting threads. When the thread is
      once again entitled to enter <code class="literal">InnoDB</code>, tickets
      are assigned again. The number of tickets assigned is specified by
      the global option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_concurrency_tickets"><code class="literal">innodb_concurrency_tickets</code></a>,
      which is 500 by default. A thread that is waiting for a lock is
      given one ticket once the lock becomes available.
    </p><p>
      The correct values of these variables depend on your environment
      and workload. Try a range of different values to determine what
      value works for your applications. Before limiting the number of
      concurrently executing threads, review configuration options that
      may improve the performance of InnoDB on multi-core and
      multi-processor computers, such as
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_use_sys_malloc"><code class="literal">innodb_use_sys_malloc</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_adaptive_hash_index"><code class="literal">innodb_adaptive_hash_index</code></a>.
    </p><p>
      For general performance information about MySQL thread handling,
      see <a class="xref" href="optimization.html#connection-threads" title="8.11.5.1 How MySQL Uses Threads for Client Connections">Section 8.11.5.1, “How MySQL Uses Threads for Client Connections”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-multiple_io_threads"></a>14.15.7 Configuring the Number of Background InnoDB I/O Threads</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491336864"></a><a class="indexterm" name="idm140301491335792"></a><a class="indexterm" name="idm140301491334304"></a><a class="indexterm" name="idm140301491333232"></a><a class="indexterm" name="idm140301491331744"></a><a class="indexterm" name="idm140301491330672"></a><a class="indexterm" name="idm140301491329216"></a><a class="indexterm" name="idm140301491327728"></a><p>
      InnoDB uses background <a class="link" href="glossary.html#glos_thread" title="thread">threads</a>
      to service various types of I/O requests. You can configure the
      number of background threads that service read and write I/O on
      data pages, using the configuration parameters
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>. These
      parameters signify the number of background threads used for read
      and write requests respectively. They are effective on all
      supported platforms. You can set the value of these parameters in
      the MySQL option file (<code class="literal">my.cnf</code> or
      <code class="literal">my.ini</code>); you cannot change them dynamically.
      The default value for these parameters is <code class="literal">4</code> and
      the permissible values range from <code class="literal">1-64</code>.
    </p><p>
      These parameters replace
      <a class="ulink" href="http://dev.mysql.com/doc/refman/5.1/en/innodb-parameters.html#sysvar_innodb_file_io_threads" target="_top"><code class="literal">innodb_file_io_threads</code></a> from
      earlier versions of MySQL. If you try to set a value for this
      obsolete parameter, a warning is written to the log file and the
      value is ignored. This parameter only applied to Windows
      platforms. (On non-Windows platforms, there was only one thread
      each for read and write.)
    </p><p>
      The purpose of this change is to make InnoDB more scalable on high
      end systems. Each background thread can handle up to 256 pending
      I/O requests. A major source of background I/O is the
      <a class="link" href="glossary.html#glos_read_ahead" title="read-ahead">read-ahead</a> requests. InnoDB
      tries to balance the load of incoming requests in such way that
      most of the background threads share work equally. InnoDB also
      attempts to allocate read requests from the same extent to the
      same thread to increase the chances of coalescing the requests
      together. If you have a high end I/O subsystem and you see more
      than 64 ×
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> pending
      read requests in <code class="literal">SHOW ENGINE INNODB STATUS</code>, you
      might gain by increasing the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a>.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-group_commit"></a>14.15.8 Group Commit</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491309088"></a><p>
      InnoDB, like any other
      <a class="link" href="glossary.html#glos_acid" title="ACID">ACID</a>-compliant database engine,
      flushes the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a> of a
      transaction before it is committed. Historically, InnoDB used
      <a class="link" href="glossary.html#glos_group_commit" title="group commit">group commit</a>
      functionality to group multiple such flush requests together to
      avoid one flush for each commit. With group commit, InnoDB issues
      a single write to the log file to perform the commit action for
      multiple user transactions that commit at about the same time,
      significantly improving throughput.
    </p><p>
      Group commit in InnoDB worked until MySQL 4.x, and works once
      again with MySQL 5.1 with the InnoDB Plugin, and MySQL 5.5 and
      higher. The introduction of support for the distributed
      transactions and Two Phase Commit (2PC) in MySQL 5.0 interfered
      with the InnoDB group commit functionality. This issue is now
      resolved.
    </p><p>
      The group commit functionality inside InnoDB works with the Two
      Phase Commit protocol in MySQL. Re-enabling of the group commit
      functionality fully ensures that the ordering of commit in the
      MySQL binary log and the InnoDB log file is the same as it was
      before. It means it is <span class="strong"><strong>totally safe to use
      the MySQL Enterprise Backup product with InnoDB 1.0.4</strong></span>
      (that is, the InnoDB Plugin with MySQL 5.1) and above. When binary
      logging is enabled, to avoid synchronizing every transaction set
      <code class="literal">sync_binlog=0</code>.
    </p><p>
      Group commit is transparent; you do not need to do anything to
      take advantage of this significant performance improvement.
    </p><p>
      For more information about performance of
      <code class="literal">COMMIT</code> and other transactional operations, see
      <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2 Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing InnoDB Transaction Management”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-thread_io_rate"></a>14.15.9 Configuring the InnoDB Master Thread I/O Rate</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491297504"></a><a class="indexterm" name="idm140301491296432"></a><a class="indexterm" name="idm140301491294944"></a><p>
      The <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a> in
      InnoDB is a thread that performs various tasks in the background.
      Most of these tasks are I/O related, such as flushing dirty pages
      from the buffer pool or writing changes from the insert buffer to
      the appropriate secondary indexes. The master thread attempts to
      perform these tasks in a way that does not adversely affect the
      normal working of the server. It tries to estimate the free I/O
      bandwidth available and tune its activities to take advantage of
      this free capacity. Historically, InnoDB has used a hard coded
      value of 100 IOPs (input/output operations per second) as the
      total I/O capacity of the server.
    </p><p>
      The parameter <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      indicates the overall I/O capacity available to InnoDB. This
      parameter should be set to approximately the number of I/O
      operations that the system can perform per second. The value
      depends on your system configuration. When
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> is set, the
      master threads estimates the I/O bandwidth available for
      background tasks based on the set value. Setting the value to
      <code class="literal">100</code> reverts to the old behavior.
    </p><p>
      You can set the value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> to any
      number 100 or greater. The default value is
      <code class="literal">200</code>, reflecting that the performance of typical
      modern I/O devices is higher than in the early days of MySQL.
      Typically, values around the previous default of 100 are
      appropriate for consumer-level storage devices, such as hard
      drives up to 7200 RPMs. Faster hard drives, RAID configurations,
      and SSDs benefit from higher values.
    </p><p>
      The <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> setting is
      a total limit for all buffer pool instances. When dirty pages are
      flushed, the <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a>
      limit is divided equally among buffer pool instances. For more
      information, see the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_io_capacity"><code class="literal">innodb_io_capacity</code></a> system
      variable description.
    </p><p>
      You can set the value of this parameter in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      it dynamically with the <code class="literal">SET GLOBAL</code> command,
      which requires the <code class="literal">SUPER</code> privilege.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-spin_lock_polling"></a>14.15.10 Configuring Spin Lock Polling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491273840"></a><a class="indexterm" name="idm140301491272768"></a><p>
      Many InnoDB <a class="link" href="glossary.html#glos_mutex" title="mutex">mutexes</a> and
      <a class="link" href="glossary.html#glos_rw_lock" title="rw-lock">rw-locks</a> are reserved for a
      short time. On a multi-core system, it can be more efficient for a
      thread to continuously check if it can acquire a mutex or rw-lock
      for a while before sleeping. If the mutex or rw-lock becomes
      available during this polling period, the thread can continue
      immediately, in the same time slice. However, too-frequent polling
      by multiple threads of a shared object can cause <span class="quote">“<span class="quote">cache ping
      pong</span>”</span>, different processors invalidating portions of each
      others' cache. InnoDB minimizes this issue by waiting a random
      time between subsequent polls. The delay is implemented as a busy
      loop.
    </p><p>
      You can control the maximum delay between testing a mutex or
      rw-lock using the parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a>. The
      duration of the delay loop depends on the C compiler and the
      target processor. (In the 100MHz Pentium era, the unit of delay
      was one microsecond.) On a system where all processor cores share
      a fast cache memory, you might reduce the maximum delay or disable
      the busy loop altogether by setting
      <code class="literal">innodb_spin_wait_delay=0</code>. On a system with
      multiple processor chips, the effect of cache invalidation can be
      more significant and you might increase the maximum delay.
    </p><p>
      The default value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_spin_wait_delay"><code class="literal">innodb_spin_wait_delay</code></a> is
      <code class="literal">6</code>. The spin wait delay is a dynamic global
      parameter that you can specify in the MySQL option file
      (<code class="literal">my.cnf</code> or <code class="literal">my.ini</code>) or change
      at runtime with the command <code class="literal">SET GLOBAL
      innodb_spin_wait_delay=<em class="replaceable"><code>delay</code></em></code>,
      where <code class="literal"><em class="replaceable"><code>delay</code></em></code> is the
      desired maximum delay. Changing the setting requires the
      <code class="literal">SUPER</code> privilege.
    </p><p>
      For performance considerations for InnoDB locking operations, see
      <a class="xref" href="optimization.html#locking-issues" title="8.10 Optimizing Locking Operations">Section 8.10, “Optimizing Locking Operations”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-performance-schema"></a>14.15.11 InnoDB Integration with MySQL Performance Schema</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491255312"></a><p>
      This section provides a brief introduction to
      <code class="literal">InnoDB</code> integration with Performance Schema. For
      comprehensive Performance Schema documentation, see
      <a class="xref" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Chapter 22, <i>MySQL Performance Schema</i></a>.
    </p><p>
      Starting with InnoDB 1.1 with MySQL 5.5, you can profile certain
      internal <code class="literal">InnoDB</code> operations using the MySQL
      <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema
      feature</a>. This type of tuning is primarily for expert users
      who evaluate optimization strategies to overcome performance
      bottlenecks. DBAs can also use this feature for capacity planning,
      to see whether their typical workload encounters any performance
      bottlenecks with a particular combination of CPU, RAM, and disk
      storage; and if so, to judge whether performance can be improved
      by increasing the capacity of some part of the system.
    </p><p>
      To use this feature to examine <code class="literal">InnoDB</code>
      performance:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          You must be running MySQL 5.5 or higher with the Performance
          Schema feature available and enabled, as described in
          <a class="xref" href="performance-schema.html#performance-schema-configuration" title="22.2 Performance Schema Configuration">Section 22.2, “Performance Schema Configuration”</a>. Since the
          Performance Schema feature introduces some performance
          overhead, you should use it on a test or development system
          rather than on a production system.
        </p></li><li class="listitem"><p>
          You must be running InnoDB 1.1 or higher.
        </p></li><li class="listitem"><p>
          You must be generally familiar with how to use the
          <a class="link" href="performance-schema.html" title="Chapter 22 MySQL Performance Schema">Performance Schema
          feature</a>. For example, you should know how enable
          instruments and consumers, and how to query
          <code class="literal">performance_schema</code> tables to retrieve data.
          For an introductory overview, see
          <a class="xref" href="performance-schema.html#performance-schema-quick-start" title="22.1 Performance Schema Quick Start">Section 22.1, “Performance Schema Quick Start”</a>.
        </p></li><li class="listitem"><p>
          You should be familiar with Performance Schema instruments
          that are available for <code class="literal">InnoDB</code>. To view
          <code class="literal">InnoDB</code>-related instruments, you can query
          the <a class="link" href="performance-schema.html#setup-instruments-table" title="22.7.2.2 The setup_instruments Table"><code class="literal">setup_instruments</code></a> table for
          instrument names that contain '<code class="literal">innodb</code>'.
        </p><pre class="programlisting">mysql&gt; SELECT * FROM setup_instruments WHERE NAME LIKE '%innodb%';
+-------------------------------------------------------+---------+-------+
| NAME                                                  | ENABLED | TIMED |
+-------------------------------------------------------+---------+-------+
| wait/synch/mutex/innodb/commit_cond_mutex             | YES     | YES   |
| wait/synch/mutex/innodb/innobase_share_mutex          | YES     | YES   |
| wait/synch/mutex/innodb/prepare_commit_mutex          | YES     | YES   |
| wait/synch/mutex/innodb/autoinc_mutex                 | YES     | YES   |
| wait/synch/mutex/innodb/btr_search_enabled_mutex      | YES     | YES   |
| wait/synch/mutex/innodb/buf_pool_mutex                | YES     | YES   |
| wait/synch/mutex/innodb/buf_pool_zip_mutex            | YES     | YES   |
| wait/synch/mutex/innodb/cache_last_read_mutex         | YES     | YES   |
| wait/synch/mutex/innodb/dict_foreign_err_mutex        | YES     | YES   |
| wait/synch/mutex/innodb/dict_sys_mutex                | YES     | YES   |
| wait/synch/mutex/innodb/file_format_max_mutex         | YES     | YES   |
...
| wait/synch/rwlock/innodb/btr_search_latch             | YES     | YES   |
| wait/synch/rwlock/innodb/dict_operation_lock          | YES     | YES   |
| wait/synch/rwlock/innodb/fil_space_latch              | YES     | YES   |
| wait/synch/rwlock/innodb/checkpoint_lock              | YES     | YES   |
| wait/synch/rwlock/innodb/trx_i_s_cache_lock           | YES     | YES   |
| wait/synch/rwlock/innodb/trx_purge_latch              | YES     | YES   |
| wait/synch/rwlock/innodb/index_tree_rw_lock           | YES     | YES   |
| wait/synch/rwlock/innodb/dict_table_stats             | YES     | YES   |
| wait/synch/cond/innodb/commit_cond                    | YES     | YES   |
| wait/io/file/innodb/innodb_data_file                  | YES     | YES   |
| wait/io/file/innodb/innodb_log_file                   | YES     | YES   |
| wait/io/file/innodb/innodb_temp_file                  | YES     | YES   |
+-------------------------------------------------------+---------+-------+
46 rows in set (0.00 sec)</pre><p>
          For additional information about the instrumented
          <code class="literal">InnoDB</code> objects, you can query Performance
          Schema
          <a class="link" href="performance-schema.html#performance-schema-instance-tables" title="22.7.3 Performance Schema Instance Tables">instances
          tables</a>, which provide additional information about
          instrumented objects. Instance tables relevant to
          <code class="literal">InnoDB</code> include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <a class="link" href="performance-schema.html#mutex-instances-table" title="22.7.3.3 The mutex_instances Table"><code class="literal">mutex_instances</code></a> table
            </p></li><li class="listitem"><p>
              The <a class="link" href="performance-schema.html#rwlock-instances-table" title="22.7.3.4 The rwlock_instances Table"><code class="literal">rwlock_instances</code></a> table
            </p></li><li class="listitem"><p>
              The <a class="link" href="performance-schema.html#cond-instances-table" title="22.7.3.1 The cond_instances Table"><code class="literal">cond_instances</code></a> table
            </p></li><li class="listitem"><p>
              The <a class="link" href="performance-schema.html#file-instances-table" title="22.7.3.2 The file_instances Table"><code class="literal">file_instances</code></a> table
</p></li></ul>
</div>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Note
</div>
<p>
            Mutexes and RW-locks related to the
            <code class="literal">InnoDB</code> buffer pool are not included in
            this coverage; the same applies to the output of the
            <code class="literal">SHOW ENGINE INNODB MUTEX</code> command.
</p>
</div>
<p>
          For example, to view information about instrumented
          <code class="literal">InnoDB</code> file objects seen by the Performance
          Schema when executing file I/O instrumentation, you might
          issue the following query:
        </p><pre class="programlisting">mysql&gt; SELECT * FROM file_instances WHERE EVENT_NAME LIKE '%innodb%'\G
*************************** 1. row ***************************
 FILE_NAME: /path/to/mysql-5.5/data/ibdata1
EVENT_NAME: wait/io/file/innodb/innodb_data_file
OPEN_COUNT: 1
*************************** 2. row ***************************
 FILE_NAME: /path/to/mysql-5.5/data/ib_logfile0
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 1
*************************** 3. row ***************************
 FILE_NAME: /path/to/mysql-5.5/data/ib_logfile1
EVENT_NAME: wait/io/file/innodb/innodb_log_file
OPEN_COUNT: 1
3 rows in set (0.00 sec)</pre></li><li class="listitem"><p>
          You should be familiar with
          <code class="literal">performance_schema</code> tables that store
          <code class="literal">InnoDB</code> event data. Tables relevant to
          <code class="literal">InnoDB</code>-related events include:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              The <a class="link" href="performance-schema.html#performance-schema-wait-tables" title="22.7.4 Performance Schema Wait Event Tables">Wait
              Event</a> tables, which store wait events.
            </p></li><li class="listitem"><p>
              The
              <a class="link" href="performance-schema.html#performance-schema-summary-tables" title="22.7.5 Performance Schema Summary Tables">Summary</a>
              tables, which provide aggregated information for
              terminated events over time. Summary tables include
              <a class="link" href="performance-schema.html#file-summary-tables" title="22.7.5.2 File I/O Summary Tables">file I/O summary
              tables</a>, which aggregate information about I/O
              operations.
</p></li></ul>
</div>
<p>
          If you are only interested in
          <code class="literal">InnoDB</code>-related objects, use the clause
          <code class="literal">WHERE EVENT_NAME LIKE '%innodb%'</code> or
          <code class="literal">WHERE NAME LIKE '%innodb%'</code> (as required)
          when querying these tables.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-multiple-rollback-segments"></a>14.15.12 Better Scalability with Multiple Rollback Segments</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491202288"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the limit on concurrent
      <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a> is greatly
      expanded, removing a bottleneck with the InnoDB
      <a class="link" href="glossary.html#glos_rollback_segment" title="rollback segment">rollback segment</a> that
      affected high-capacity systems. The limit applies to concurrent
      transactions that change any data; read-only transactions do not
      count against that maximum.
    </p><p>
      The single rollback segment is now divided into 128 segments, each
      of which can support up to 1023 transactions that perform writes,
      for a total of approximately 128K concurrent transactions. The
      original transaction limit was 1023.
    </p><p>
      Each transaction is assigned to one of the rollback segments, and
      remains tied to that rollback segment for the duration. This
      enhancement improves both scalability (higher number of concurrent
      transactions) and performance (less contention when different
      transactions access the rollback segments).
    </p><p>
      To take advantage of this feature, you do not need to create any
      new database or tables, or reconfigure anything. You must do a
      <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a> before
      upgrading from MySQL 5.1 or earlier, or some time afterward.
      InnoDB makes the required changes inside the
      <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system tablespace</a>
      automatically, the first time you restart after performing a slow
      shutdown.
    </p><p>
      For more information about performance of InnoDB under high
      transactional load, see
      <a class="xref" href="optimization.html#optimizing-innodb-transaction-management" title="8.5.2 Optimizing InnoDB Transaction Management">Section 8.5.2, “Optimizing InnoDB Transaction Management”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-improved-purge-scheduling"></a>14.15.13 Configuring InnoDB Purge Scheduling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491192560"></a><p>
      Starting in InnoDB 1.1 with MySQL 5.5, the
      <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operations (a type of
      garbage collection) that InnoDB performs automatically can be done
      in a separate thread, rather than as part of the
      <a class="link" href="glossary.html#glos_master_thread" title="master thread">master thread</a>. This
      change improves scalability, because the main database operations
      run independently from maintenance work happening in the
      background.
    </p><p>
      To enable this feature, set the configuration option
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_threads"><code class="literal">innodb_purge_threads</code></a> to
      <code class="literal">1</code>, as opposed to the default of 0, which
      combines the purge operation into the master thread.
    </p><p>
      You might not notice a significant speedup, because the purge
      thread might encounter new types of contention; the single purge
      thread really lays the groundwork for further tuning and possibly
      multiple purge threads in the future. There is another new
      configuration option,
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_purge_batch_size"><code class="literal">innodb_purge_batch_size</code></a> with a
      default of 20 and maximum of 5000. This option is mainly intended
      for experimentation and tuning of purge operations, and should not
      be interesting to typical users.
    </p><p>
      For more information about InnoDB I/O performance, see
      <a class="xref" href="optimization.html#optimizing-innodb-diskio" title="8.5.7 Optimizing InnoDB Disk I/O">Section 8.5.7, “Optimizing InnoDB Disk I/O”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-statistics-estimation"></a>14.15.14 Configuring Optimizer Statistics Parameters</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491181920"></a><a class="indexterm" name="idm140301491180848"></a><a class="indexterm" name="idm140301491179808"></a><a class="indexterm" name="idm140301491178304"></a><p>
      The MySQL query optimizer uses estimated
      <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a> about key
      distributions to choose the indexes for an execution plan, based
      on the relative
      <a class="link" href="glossary.html#glos_selectivity" title="selectivity">selectivity</a> of the index.
      Certain operations cause InnoDB to sample random pages from each
      index on a table to estimate the
      <a class="link" href="glossary.html#glos_cardinality" title="cardinality">cardinality</a> of the index.
      (This technique is known as
      <a class="link" href="glossary.html#glos_random_dive" title="random dive">random dives</a>.) These
      operations include the <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a> statement, the <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE
      STATUS</code></a> statement, and accessing the table for the first
      time after a restart.
    </p><p>
      To give you control over the quality of the statistics estimate
      (and thus better information for the query optimizer), you can now
      change the number of sampled pages using the parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>.
      Previously, the number of sampled pages was always 8, which could
      be insufficient to produce an accurate estimate, leading to poor
      index choices by the query optimizer. This technique is especially
      important for large tables and tables used in
      <a class="link" href="glossary.html#glos_join" title="join">joins</a>. Unnecessary
      <a class="link" href="glossary.html#glos_full_table_scan" title="full table scan">full table scans</a> for
      such tables can be a substantial performance issue.
    </p><p>
      You can set the global parameter
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>, at
      runtime. The default value for this parameter is 8, preserving the
      same behavior as in past releases.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        The value of
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
        affects the index sampling for <span class="emphasis"><em>all</em></span> tables
        and indexes. There are the following potentially significant
        impacts when you change the index sample size:

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Small values like 1 or 2 can result in very inaccurate
              estimates of cardinality.

              
            </p></li><li class="listitem"><p>
              Increasing the
              <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
              value might require more disk reads. Values much larger
              than 8 (say, 100), can cause a big slowdown in the time it
              takes to open a table or execute <code class="literal">SHOW TABLE
              STATUS</code>.
            </p></li><li class="listitem"><p>
              The optimizer might choose very different query plans
              based on different estimates of index selectivity.
</p></li></ul>
</div>
<p>
</p>
</div>
<p>
      To disable the cardinality estimation for metadata statements such
      as <a class="link" href="sql-syntax.html#show-table-status" title="13.7.5.37 SHOW TABLE STATUS Syntax"><code class="literal">SHOW TABLE STATUS</code></a> or
      <a class="link" href="sql-syntax.html#show-index" title="13.7.5.23 SHOW INDEX Syntax"><code class="literal">SHOW INDEX</code></a>, or when accessing the
      <a class="link" href="information-schema.html#tables-table" title="21.21 The INFORMATION_SCHEMA TABLES Table"><code class="literal">INFORMATION_SCHEMA.TABLES</code></a> or
      <a class="link" href="information-schema.html#statistics-table" title="21.20 The INFORMATION_SCHEMA STATISTICS Table"><code class="literal">INFORMATION_SCHEMA.STATISTICS</code></a> tables,
      execute the statement <code class="literal">SET GLOBAL
      innodb_stats_on_metadata=OFF</code> (or <code class="literal">0</code>).
      The ability to set this option dynamically is also relatively new.
    </p><p>
      All <code class="literal">InnoDB</code> tables are opened, and the
      statistics are re-estimated for all associated indexes, when the
      <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client starts with the
      <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--auto-rehash</code></a> setting on (the
      default). To improve the start up time of the
      <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client, you can turn auto-rehash off
      using the
      <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--disable-auto-rehash</code></a>
      option. The <code class="literal">auto-rehash</code> feature enables
      automatic name completion of database, table, and column names for
      interactive users.
    </p><p>
      Whatever value of
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> works
      best for a system, set the option and leave it at that value.
      Choose a value that results in reasonably accurate estimates for
      all tables in your database without requiring excessive I/O.
      Because the statistics are automatically recalculated at various
      times other than on execution of <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE
      TABLE</code></a>, it does not make sense to increase the index
      sample size, run <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>,
      then decrease sample size again. The more accurate statistics
      calculated by <code class="literal">ANALYZE</code> running with a high value
      of <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> can
      be wiped away later.
    </p><p>
      Although it is not possible to specify the sample size on a
      per-table basis, smaller tables generally require fewer index
      samples than larger tables do. If your database has many large
      tables, consider using a higher value for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> than if
      you have mostly smaller tables.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-analyze-table-complexity"></a>14.15.15 Estimating ANALYZE TABLE Complexity for InnoDB Tables</h3>

</div>

</div>

</div>
<p>
      <code class="literal">ANALYZE TABLE</code> complexity for
      <code class="literal">InnoDB</code> tables is dependent on:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The number of pages sampled, as defined by
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>.
        </p></li><li class="listitem"><p>
          The number of indexed columns in a table
        </p></li><li class="listitem"><p>
          The number of partitions. If a table has no partitions, the
          number of partitions is considered to be 1.
</p></li></ul>
</div>
<p>
      Using these parameters, an approximate formula for estimating
      <code class="literal">ANALYZE TABLE</code> complexity would be:
    </p><p>
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a> *
      number of indexed columns in a table * number of partitions
    </p><p>
      Typically, the greater the resulting value, the greater the
      execution time for <a class="link" href="sql-syntax.html#analyze-table" title="13.7.2.1 ANALYZE TABLE Syntax"><code class="literal">ANALYZE TABLE</code></a>.
    </p><p>
      For more information about the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_stats_sample_pages"><code class="literal">innodb_stats_sample_pages</code></a>
      configuration parameter, see
      <a class="xref" href="innodb-storage-engine.html#innodb-statistics-estimation" title="14.15.14 Configuring Optimizer Statistics Parameters">Section 14.15.14, “Configuring Optimizer Statistics Parameters”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-information-schema"></a>14.16 InnoDB INFORMATION_SCHEMA Tables</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-compression-tables">14.16.1 InnoDB INFORMATION_SCHEMA Tables about Compression</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-transactions">14.16.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-buffer-pool-tables">14.16.3 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301491116320"></a><a class="indexterm" name="idm140301491114832"></a><a class="indexterm" name="idm140301491113344"></a><p>
    This section provides information and usage examples for
    <code class="literal">InnoDB</code>
    <a class="link" href="information-schema.html" title="Chapter 21 INFORMATION_SCHEMA Tables"><code class="literal">INFORMATION_SCHEMA</code></a>
    tables.
  </p><p>
    <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
    tables provide metadata, status information, and statistics about
    various aspects of the <code class="literal">InnoDB</code> storage engine. You
    can view a list of <code class="literal">InnoDB</code>
    <code class="literal">INFORMATION_SCHEMA</code> tables by issuing a
    <a class="link" href="sql-syntax.html#show-tables" title="13.7.5.38 SHOW TABLES Syntax"><code class="literal">SHOW TABLES</code></a> statement on the
    <code class="literal">INFORMATION_SCHEMA</code> database:
  </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB%';</pre><p>
    For table definitions, see <a class="xref" href="information-schema.html#innodb-i_s-tables" title="21.28 INFORMATION_SCHEMA Tables for InnoDB">Section 21.28, “INFORMATION_SCHEMA Tables for InnoDB”</a>. For
    general information regarding the <code class="literal">MySQL</code>
    <code class="literal">INFORMATION_SCHEMA</code> database, see
    <a class="xref" href="information-schema.html" title="Chapter 21 INFORMATION_SCHEMA Tables">Chapter 21, <i>INFORMATION_SCHEMA Tables</i></a>.
  </p><p>
    The <code class="literal">InnoDB</code> <code class="literal">INFORMATION_SCHEMA</code>
    tables are themselves plugins to the MySQL server. To see what
    plugins are installed, use the <a class="link" href="sql-syntax.html#show-plugins" title="13.7.5.26 SHOW PLUGINS Syntax"><code class="literal">SHOW
    PLUGINS</code></a> statement or query the
    <a class="link" href="information-schema.html#plugins-table" title="21.13 The INFORMATION_SCHEMA PLUGINS Table"><code class="literal">INFORMATION_SCHEMA.PLUGINS</code></a> table. Use
    <a class="link" href="sql-syntax.html#install-plugin" title="13.7.3.3 INSTALL PLUGIN Syntax"><code class="literal">INSTALL PLUGIN</code></a> syntax to install an
    <code class="literal">INFORMATION_SCHEMA</code> table plugin. If
    <code class="literal">INFORMATION_SCHEMA</code> table plugins are installed,
    but the <code class="literal">InnoDB</code> storage engine plugin is not
    installed, the tables appear empty.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-compression-tables"></a>14.16.1 InnoDB INFORMATION_SCHEMA Tables about Compression</h3>

</div>

</div>

</div>

<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmp">14.16.1.1 INNODB_CMP and INNODB_CMP_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-innodb_cmpmem">14.16.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples-compression-sect">14.16.1.3 Using the Compression Information Schema Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301491090368"></a><p>
      There are two pairs of <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables about compression
      that can provide insight into how well compression is working
      overall:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          contain information about the number of compression operations
          and the amount of time spent performing compression.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
          contain information about the way memory is allocated for
          compression.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmp"></a>14.16.1.1 INNODB_CMP and INNODB_CMP_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491078560"></a><a class="indexterm" name="idm140301491077072"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables contain status information about operations related to
        compressed tables, which are described in
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.9 InnoDB Compressed Tables">Section 14.9, “InnoDB Compressed Tables”</a>. The
        <code class="literal">PAGE_SIZE</code> column reports the compressed
        <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>.
      </p><p>
        These two tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        resets the statistics on compression and uncompression
        operations. For example, if you archive the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        every 60 minutes, you see the statistics for each hourly period.
        If you monitor the output of
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> (making sure never to
        read
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>),
        you see the cumulated statistics since <code class="literal">InnoDB</code>
        was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables">Section 21.28.1, “The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-innodb_cmpmem"></a>14.16.1.2 INNODB_CMPMEM and INNODB_CMPMEM_RESET</h4>

</div>

</div>

</div>
<a class="indexterm" name="idm140301491061488"></a><a class="indexterm" name="idm140301491060000"></a><a class="indexterm" name="idm140301491058496"></a><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables contain status information about compressed pages that
        reside in the buffer pool. Please consult
        <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.9 InnoDB Compressed Tables">Section 14.9, “InnoDB Compressed Tables”</a> for further information on
        compressed tables and the use of the buffer pool. The
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a> and
        <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP_RESET</code></a>
        tables should provide more useful statistics on compression.
</p>
<h5><a name="idm140301491051152"></a>Internal Details</h5>
<p>
        <code class="literal">InnoDB</code> uses a
        <a class="link" href="glossary.html#glos_buddy_allocator" title="buddy allocator">buddy allocator</a>
        system to manage memory allocated to
        <a class="link" href="glossary.html#glos_page_size" title="page size">pages of various sizes</a>,
        from 1KB to 16KB. Each row of the two tables described here
        corresponds to a single page size.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> and
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        tables have identical contents, but reading from
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        resets the statistics on relocation operations. For example, if
        every 60 minutes you archived the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>,
        it would show the hourly statistics. If you never read
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM_RESET</code></a>
        and monitored the output of
        <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a> instead, it would
        show the cumulated statistics since <code class="literal">InnoDB</code>
        was started.
      </p><p>
        For the table definition, see
        <a class="xref" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables">Section 21.28.2, “The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables”</a>.
</p>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples-compression-sect"></a>14.16.1.3 Using the Compression Information Schema Tables</h4>

</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-compression"></a><p class="title"><b>Example 14.1 Using the Compression Information Schema Tables</b></p>
<div class="example-contents">
<p>
          The following is sample output from a database that contains
          compressed tables (see <a class="xref" href="innodb-storage-engine.html#innodb-compression" title="14.9 InnoDB Compressed Tables">Section 14.9, “InnoDB Compressed Tables”</a>,
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INNODB_CMP</code></a>, and
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>).
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmp-table" title="21.28.1 The INFORMATION_SCHEMA INNODB_CMP and INNODB_CMP_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMP</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          The only compressed page size that the buffer pool contains is
          8K. Compressing or uncompressing pages has consumed less than
          a second since the time the statistics were reset, because the
          columns <code class="literal">COMPRESS_TIME</code> and
          <code class="literal">UNCOMPRESS_TIME</code> are zero.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmp"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_CMP
            table, showing the internal workings of InnoDB table
compression under a light workload. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">compress ops</th><th scope="col">compress ops ok</th><th scope="col">compress time</th><th scope="col">uncompress ops</th><th scope="col">uncompress time</th></tr></thead><tbody><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>1048</td><td>921</td><td>0</td><td>61</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>
<p>
          According to <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INNODB_CMPMEM</code></a>, there
          are 6169 compressed 8KB pages in the buffer pool.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-cmpmem-table" title="21.28.2 The INFORMATION_SCHEMA INNODB_CMPMEM and INNODB_CMPMEM_RESET Tables"><code class="literal">INFORMATION_SCHEMA.INNODB_CMPMEM</code></a>
          under a light <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
          Some memory is unusable due to fragmentation of the
          <code class="literal">InnoDB</code> memory allocator for compressed
          pages: <code class="literal">SUM(PAGE_SIZE*PAGES_FREE)=6784</code>. This
          is because small memory allocation requests are fulfilled by
          splitting bigger blocks, starting from the 16K blocks that are
          allocated from the main buffer pool, using the buddy
          allocation system. The fragmentation is this low because some
          allocated blocks have been relocated (copied) to form bigger
          adjacent free blocks. This copying of
          <code class="literal">SUM(PAGE_SIZE*RELOCATION_OPS)</code> bytes has
          consumed less than a second
          <code class="literal">(SUM(RELOCATION_TIME)=0)</code>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_cmpmem"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_CMPMEM table, showing buffer pool
            memory operations for InnoDB table compression under a light
workload. " border="1"><colgroup><col><col><col><col><col></colgroup><thead><tr><th scope="col">page size</th><th scope="col">pages used</th><th scope="col">pages free</th><th scope="col">relocation ops</th><th scope="col">relocation time</th></tr></thead><tbody><tr><td scope="row">1024</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><td scope="row">2048</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">4096</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><td scope="row">8192</td><td>6169</td><td>0</td><td>5</td><td>0</td></tr><tr><td scope="row">16384</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-transactions"></a>14.16.2 InnoDB INFORMATION_SCHEMA Transaction and Locking Tables</h3>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-examples">14.16.2.1 Usage Examples for InnoDB Transaction and Locking Tables</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-understanding_innodb_locking">14.16.2.2 INNODB_LOCKS and INNODB_LOCK_WAITS Data</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-information-schema-rapidly_changing_internal_data">14.16.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking
Tables</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301490971728"></a><p>
      Three <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> tables make it easy to
      monitor transactions and diagnose possible locking problems. The
      three tables are <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
      <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>, and
      <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="indexterm" name="idm140301490963536"></a>

          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>: Contains information
          about every transaction currently executing inside
          <code class="literal">InnoDB</code>, including whether the transaction
          is waiting for a lock, when the transaction started, and the
          particular SQL statement the transaction is executing.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140301490959088"></a>

          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>: Each transaction in
          InnoDB that is waiting for another transaction to release a
          lock (<code class="literal">INNODB_TRX.TRX_STATE='LOCK WAIT'</code>) is
          blocked by exactly one <span class="quote">“<span class="quote">blocking lock request</span>”</span>.
          That blocking lock request is for a row or table lock held by
          another transaction in an incompatible mode. The waiting or
          blocked transaction cannot proceed until the other transaction
          commits or rolls back, thereby releasing the requested lock.
          For every blocked transaction,
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> contains one row
          that describes each lock the transaction has requested, and
          for which it is waiting.
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> also contains one
          row for each lock that is blocking another transaction,
          whatever the state of the transaction that holds the lock
          (<code class="literal">'RUNNING'</code>, <code class="literal">'LOCK WAIT'</code>,
          <code class="literal">'ROLLING BACK'</code> or
          <code class="literal">'COMMITTING'</code>). The lock that is blocking a
          transaction is always held in a mode (read vs. write, shared
          vs. exclusive) incompatible with the mode of requested lock.
        </p></li><li class="listitem"><p>
          <a class="indexterm" name="idm140301490948256"></a>

          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>: Using this
          table, you can tell which transactions are waiting for a given
          lock, or for which lock a given transaction is waiting. This
          table contains one or more rows for each
          <span class="emphasis"><em>blocked</em></span> transaction, indicating the lock
          it has requested and any locks that are blocking that request.
          The <code class="literal">REQUESTED_LOCK_ID</code> refers to the lock
          that a transaction is requesting, and the
          <code class="literal">BLOCKING_LOCK_ID</code> refers to the lock (held
          by another transaction) that is preventing the first
          transaction from proceeding. For any given blocked
          transaction, all rows in
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> have the same
          value for <code class="literal">REQUESTED_LOCK_ID</code> and different
          values for <code class="literal">BLOCKING_LOCK_ID</code>.
</p></li></ul>
</div>

<div class="section">

<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-examples"></a>14.16.2.1 Usage Examples for InnoDB Transaction and Locking Tables</h4>

</div>

</div>

</div>

<div class="example">
<a name="innodb-information-schema-examples-simple-blocking"></a><p class="title"><b>Example 14.2 Identifying Blocking Transactions</b></p>
<div class="example-contents">
<p>
          It is sometimes helpful to be able to identify which
          transaction is blocking another. You can use the
          <code class="literal">INFORMATION_SCHEMA</code> tables to find out which
          transaction is waiting for another, and which resource is
          being requested.
        </p><p>
          Suppose you have the following scenario, with three users
          running concurrently. Each user (or session) corresponds to a
          MySQL thread, and executes one transaction after another.
          Consider the state of the system when these users have issued
          the following commands, but none has yet committed its
          transaction:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              <code class="literal"> User A: </code>
            </p><pre class="programlisting">
BEGIN;
SELECT a FROM t FOR UPDATE;
SELECT SLEEP(100);
</pre></li><li class="listitem"><p>
              <code class="literal"> User B: </code>
            </p><pre class="programlisting">
SELECT b FROM t FOR UPDATE;
</pre></li><li class="listitem"><p>
              <code class="literal"> User C: </code>
            </p><pre class="programlisting">
SELECT c FROM t FOR UPDATE;
</pre></li></ul>
</div>
<p>
          In this scenario, you can use this query to see who is waiting
          for whom:
        </p><pre class="programlisting">
SELECT r.trx_id waiting_trx_id,  
       r.trx_mysql_thread_id waiting_thread,
       r.trx_query waiting_query,
       b.trx_id blocking_trx_id, 
       b.trx_mysql_thread_id blocking_thread,
       b.trx_query blocking_query
   FROM       information_schema.innodb_lock_waits w
   INNER JOIN information_schema.innodb_trx b  ON  
    b.trx_id = w.blocking_trx_id
  INNER JOIN information_schema.innodb_trx r  ON  
    r.trx_id = w.requesting_trx_id;
</pre>
<div class="informaltable">
<table summary=" This table represents the result set of a query
            against the INFORMATION_SCHEMA.INNODB_LOCK_WAITS and
            INFORMATION_SCHEMA.INNODB_TRX tables, shown in the preceding
            text, indicating which InnoDB threads are waiting for which
other threads. " border="1"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">waiting trx id</th><th scope="col">waiting thread</th><th scope="col">waiting query</th><th scope="col">blocking trx id</th><th scope="col">blocking thread</th><th scope="col">blocking query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A3</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td><td><code class="literal">A4</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          In the above result, you can identify users by the
          <span class="quote">“<span class="quote">waiting query</span>”</span> or <span class="quote">“<span class="quote">blocking query</span>”</span>.
          As you can see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              User B (trx id <code class="literal">'A4'</code>, thread
              <code class="literal">6</code>) and User C (trx id
              <code class="literal">'A5'</code>, thread <code class="literal">7</code>) are
              both waiting for User A (trx id <code class="literal">'A3'</code>,
              thread <code class="literal">5</code>).
            </p></li><li class="listitem"><p>
              User C is waiting for User B as well as User A.
</p></li></ul>
</div>
<p>
          You can see the underlying data in the tables
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-trx"><code class="literal">INNODB_TRX</code></a>,
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-locks"><code class="literal">INNODB_LOCKS</code></a>,
          and
          <a class="link" href="innodb-storage-engine.html#innodb-information-schema-examples-simple-blocking-waits"><code class="literal">INNODB_LOCK_WAITS</code></a>.
        </p><p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the typical types of entries for each column.
" border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3</code></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 16:44:54</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2</code></td><td><code class="literal">5</code></td><td><code class="literal">SELECT SLEEP(100)</code></td></tr><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:09</code></td><td><code class="literal">2</code></td><td><code class="literal">6</code></td><td><code class="literal">SELECT b FROM t FOR UPDATE</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">2008-01-15 16:45:14</code></td><td><code class="literal">2</code></td><td><code class="literal">7</code></td><td><code class="literal">SELECT c FROM t FOR UPDATE</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the typical
types of entries for each column. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A3:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A4:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr><tr><td scope="row"><code class="literal">A5:1:3:2</code></td><td><code class="literal">A5</code></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`.`t`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">1</code></td><td><code class="literal">3</code></td><td><code class="literal">2</code></td><td><code class="literal">0x0200</code></td></tr></tbody></table>
</div>
<p>
          The following table shows some sample contents of
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code></a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-examples-simple-blocking-waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
typical types of entries for each column. " border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A3</code></td><td><code class="literal">A3:1:3:2</code></td></tr><tr><td scope="row"><code class="literal">A5</code></td><td><code class="literal">A5:1:3:2</code></td><td><code class="literal">A4</code></td><td><code class="literal">A4:1:3:2</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-sample-locks"></a><p class="title"><b>Example 14.3 More Complex Example of Transaction Data in Information Schema Tables</b></p>
<div class="example-contents">
<p>
          Sometimes you would like to correlate the internal
          <code class="literal">InnoDB</code> locking information with
          session-level information maintained by MySQL. For example,
          you might like to know, for a given <code class="literal">InnoDB</code>
          transaction ID, the corresponding MySQL session ID and name of
          the user that may be holding a lock, and thus blocking another
          transaction.
        </p><p>
          The following output from the
          <code class="literal">INFORMATION_SCHEMA</code> tables is taken from a
          somewhat loaded system.
        </p><p>
          As can be seen in the following tables, there are several
          transactions running.
        </p><p>
          The following <code class="literal">INNODB_LOCKS</code> and
          <code class="literal">INNODB_LOCK_WAITS</code> tables shows that:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
              Transaction
              <span class="color0"><code class="literal">77F</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transactions
              <span class="color1"><code class="literal">77E</code></span>,
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color1"><code class="literal">77E</code></span>
              (executing an INSERT) is waiting for transactions
              <span class="color2"><code class="literal">77D</code></span>
              and
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color2"><code class="literal">77D</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color3"><code class="literal">77B</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color3"><code class="literal">77B</code></span>
              (executing an INSERT) is waiting for transaction
              <span class="color4"><code class="literal">77A</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color4"><code class="literal">77A</code></span>
              is running, currently executing <code class="literal">SELECT</code>.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color5"><code class="literal">E56</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color6"><code class="literal">E55</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color6"><code class="literal">E55</code></span>
              (executing an <code class="literal">INSERT</code>) is waiting for
              transaction
              <span class="color7"><code class="literal">19C</code></span>
              to commit.
            </p></li><li class="listitem"><p>
              Transaction
              <span class="color7"><code class="literal">19C</code></span>
              is running, currently executing an
              <code class="literal">INSERT</code>.
</p></li></ul>
</div>
<p>
          Note that there may be an inconsistency between queries shown
          in the two tables <code class="literal">INNODB_TRX.TRX_QUERY</code> and
          <code class="literal">PROCESSLIST.INFO</code>. The current transaction
          ID for a thread, and the query being executed in that
          transaction, may be different in these two tables for any
          given thread. See
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-note_inconsistency" title="14.16.2.3.1 Potential Inconsistency with PROCESSLIST Data">Section 14.16.2.3.1, “Potential Inconsistency with PROCESSLIST Data”</a>
          for an explanation.
        </p><p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#processlist-table" title="21.14 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">INFORMATION_SCHEMA.PROCESSLIST</code></a> in
          a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-processlist"></a><table summary=" Sample data from the INFORMATION_SCHEMA.PROCESSLIST
            table, showing the internal workings of MySQL processes
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">ID</th><th scope="col">USER</th><th scope="col">HOST</th><th scope="col">DB</th><th scope="col">COMMAND</th><th scope="col">TIME</th><th scope="col">STATE</th><th scope="col">INFO</th></tr></thead><tbody><tr><td scope="row"><code class="literal">384</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">10</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">257</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">3</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">130</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">61</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">8</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">1</code></td><td><code class="literal">update</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><code class="literal">4</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Query</code></td><td><code class="literal">0</code></td><td><code class="literal">preparing</code></td><td><code class="literal">SELECT * FROM processlist</code></td></tr><tr><td scope="row"><code class="literal">2</code></td><td><code class="literal">root</code></td><td><code class="literal">localhost</code></td><td><code class="literal">test</code></td><td><code class="literal">Sleep</code></td><td><code class="literal">566</code></td><td><code class="literal"></code></td><td><code class="literal">NULL</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INFORMATION_SCHEMA.INNODB_TRX</code></a> in
          a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_trx"></a><table summary=" Sample data from the INFORMATION_SCHEMA.INNODB_TRX
            table, showing the internal workings of InnoDB transactions
under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">trx id</th><th scope="col">trx state</th><th scope="col">trx started</th><th scope="col">trx requested lock id</th><th scope="col">trx wait started</th><th scope="col">trx weight</th><th scope="col">trx mysql thread id</th><th scope="col">trx query</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">876</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">875</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">1</code></td><td><code class="literal">874</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">4</code></td><td><code class="literal">873</code></td><td><code class="literal">insert into t09 (D, B, C) values …</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:10:16</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">4</code></td><td><code class="literal">872</code></td><td><code class="literal">select b, c from t09 where …</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><code class="literal">2008-01-15 13:10:06</code></td><td><code class="literal">5</code></td><td><code class="literal">384</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">LOCK WAIT</code></td><td><code class="literal">2008-01-15 13:10:06</code></td><td><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><code class="literal">2008-01-15 13:10:13</code></td><td><code class="literal">965</code></td><td><code class="literal">257</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:09:10</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">2900</code></td><td><code class="literal">130</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color8"><code class="literal">E15</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:59</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">5395</code></td><td><code class="literal">61</code></td><td><code class="literal">insert into t2 values …</code></td></tr><tr><td scope="row"><span class="color9"><code class="literal">51D</code></span></td><td><code class="literal">RUN­NING</code></td><td><code class="literal">2008-01-15 13:08:47</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">9807</code></td><td><code class="literal">8</code></td><td><code class="literal">insert into t2 values …</code></td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCK_WAITS</code></a>
          in a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_lock_waits"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCK_WAITS table, showing the
            internal workings of InnoDB locking under a heavy workload.
" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th scope="col">requesting trx id</th><th scope="col">requested lock id</th><th scope="col">blocking trx id</th><th scope="col">blocking lock id</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span></td><td><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span></td><td><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span></td><td><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:806</td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span></td><td><span class="color3"><code class="literal">77B</code></span>:733:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><span class="color4"><code class="literal">77A</code></span>:733:12:1</td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span></td><td><span class="color5"><code class="literal">E56</code></span>:743:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:6:2</td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span></td><td><span class="color6"><code class="literal">E55</code></span>:743:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><span class="color7"><code class="literal">19C</code></span>:743:38:2</td></tr></tbody></table>
</div>
<p>
          The following table shows the contents of
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INFORMATION_SCHEMA.INNODB_LOCKS</code></a>
          in a system running a heavy
          <a class="link" href="glossary.html#glos_workload" title="workload">workload</a>.
</p>
<div class="informaltable">
<a name="innodb-information-schema-sample-innodb_locks"></a><table summary=" Sample data from the
            INFORMATION_SCHEMA.INNODB_LOCKS table, showing the internal
workings of InnoDB locking under a heavy workload. " border="1"><colgroup><col><col><col><col><col><col><col><col><col><col></colgroup><thead><tr><th scope="col">lock id</th><th scope="col">lock trx id</th><th scope="col">lock mode</th><th scope="col">lock type</th><th scope="col">lock table</th><th scope="col">lock index</th><th scope="col">lock space</th><th scope="col">lock page</th><th scope="col">lock rec</th><th scope="col">lock data</th></tr></thead><tbody><tr><td scope="row"><span class="color0"><code class="literal">77F</code></span>:806</td><td><span class="color0"><code class="literal">77F</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color1"><code class="literal">77E</code></span>:806</td><td><span class="color1"><code class="literal">77E</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color2"><code class="literal">77D</code></span>:806</td><td><span class="color2"><code class="literal">77D</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:806</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">AUTO​_INC</code></td><td><code class="literal">TABLE</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td><td><code class="literal">NULL</code></td></tr><tr><td scope="row"><span class="color3"><code class="literal">77B</code></span>:733​:12:1</td><td><span class="color3"><code class="literal">77B</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color4"><code class="literal">77A</code></span>:733​:12:1</td><td><span class="color4"><code class="literal">77A</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t09`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">733</code></td><td><code class="literal">12</code></td><td><code class="literal">1</code></td><td><code class="literal">supremum pseudo-record</code></td></tr><tr><td scope="row"><span class="color5"><code class="literal">E56</code></span>:743​:6:2</td><td><span class="color5"><code class="literal">E56</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:6:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">6</code></td><td><code class="literal">2</code></td><td><code class="literal">0, 0</code></td></tr><tr><td scope="row"><span class="color6"><code class="literal">E55</code></span>:743​:38:2</td><td><span class="color6"><code class="literal">E55</code></span></td><td><code class="literal">S</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr><tr><td scope="row"><span class="color7"><code class="literal">19C</code></span>:743​:38:2</td><td><span class="color7"><code class="literal">19C</code></span></td><td><code class="literal">X</code></td><td><code class="literal">RECORD</code></td><td><code class="literal">`test`​.`t2`</code></td><td><code class="literal">`PRIMARY`</code></td><td><code class="literal">743</code></td><td><code class="literal">38</code></td><td><code class="literal">2</code></td><td><code class="literal">1922, 1922</code></td></tr></tbody></table>
</div>

</div>

</div>
<br class="example-break">
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-understanding_innodb_locking"></a>14.16.2.2 INNODB_LOCKS and INNODB_LOCK_WAITS Data</h4>

</div>

</div>

</div>
<p>
        When a transaction updates a row in a table, or locks it with
        <code class="literal">SELECT FOR UPDATE</code>, <code class="literal">InnoDB</code>
        establishes a list or queue of locks on that row. Similarly,
        <code class="literal">InnoDB</code> maintains a list of locks on a table
        for table-level locks. If a second transaction wants to update a
        row or lock a table already locked by a prior transaction in an
        incompatible mode, <code class="literal">InnoDB</code> adds a lock request
        for the row to the corresponding queue. For a lock to be
        acquired by a transaction, all incompatible lock requests
        previously entered into the lock queue for that row or table
        must be removed (the transactions holding or requesting those
        locks either commit or roll back).
      </p><p>
        A transaction may have any number of lock requests for different
        rows or tables. At any given time, a transaction may request a
        lock that is held by another transaction, in which case it is
        blocked by that other transaction. The requesting transaction
        must wait for the transaction that holds the blocking lock to
        commit or rollback. If a transaction is not waiting for a lock,
        it is in a <code class="literal">'RUNNING'</code> state. If a transaction
        is waiting for a lock, it is in a <code class="literal">'LOCK WAIT'</code>
        state.
      </p><p>
        The <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> table holds one or
        more rows for each <code class="literal">'LOCK WAIT'</code> transaction,
        indicating any lock requests that are preventing its progress.
        This table also contains one row describing each lock in a queue
        of locks pending for a given row or table. The
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a> table shows which
        locks already held by a transaction are blocking locks requested
        by other transactions.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h4 class="title"><a name="innodb-information-schema-rapidly_changing_internal_data"></a>14.16.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking
Tables</h4>
</div>
</div>
</div>
<p>
        The data exposed by the transaction and locking tables
        (<a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
        <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a>, and
        <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>) represent a
        glimpse into fast-changing data. This is not like other (user)
        tables, where the data changes only when application-initiated
        updates occur. The underlying data is internal system-managed
        data, and can change very quickly.
      </p><p>
        For performance reasons, and to minimize the chance of
        misleading <code class="literal">JOIN</code>s between the
        <code class="literal">InnoDB</code> transaction and locking
        <code class="literal">INFORMATION_SCHEMA</code> tables,
        <code class="literal">InnoDB</code> collects the required transaction and
        locking information into an intermediate buffer whenever a
        <code class="literal">SELECT</code> on any of the tables is issued. This
        buffer is refreshed only if more than 0.1 seconds has elapsed
        since the last time the buffer was read. The data needed to fill
        the three tables is fetched atomically and consistently and is
        saved in this global internal buffer, forming a point-in-time
        <span class="quote">“<span class="quote">snapshot</span>”</span>. If multiple table accesses occur within
        0.1 seconds (as they almost certainly do when MySQL processes a
        join among these tables), then the same snapshot is used to
        satisfy the query.
      </p><p>
        A correct result is returned when you <code class="literal">JOIN</code>
        any of these tables together in a single query, because the data
        for the three tables comes from the same snapshot. Because the
        buffer is not refreshed with every query of any of these tables,
        if you issue separate queries against these tables within a
        tenth of a second, the results are the same from query to query.
        On the other hand, two separate queries of the same or different
        tables issued more than a tenth of a second apart may see
        different results, since the data come from different snapshots.
      </p><p>
        Because <code class="literal">InnoDB</code> must temporarily stall while
        the transaction and locking data is collected, too frequent
        queries of these tables can negatively impact performance as
        seen by other users.
      </p><p>
        As these tables contain sensitive information (at least
        <code class="literal">INNODB_LOCKS.LOCK_DATA</code> and
        <code class="literal">INNODB_TRX.TRX_QUERY</code>), for security reasons,
        only the users with the <code class="literal">PROCESS</code> privilege are
        allowed to <code class="literal">SELECT</code> from them.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h5 class="title"><a name="innodb-information-schema-note_inconsistency"></a>14.16.2.3.1 Potential Inconsistency with PROCESSLIST Data</h5>
</div>
</div>
</div>
<a class="indexterm" name="idm140301490392864"></a><p>
          As described in
          <a class="xref" href="innodb-storage-engine.html#innodb-information-schema-rapidly_changing_internal_data" title="14.16.2.3 Data Persistence and Consistency for InnoDB Transaction and Locking Tables">Section 14.16.2.3, “Data Persistence and Consistency for InnoDB Transaction and Locking
        Tables”</a>,
          the data that fills the <code class="literal">InnoDB</code> transaction
          and locking tables (<a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a>,
          <a class="link" href="information-schema.html#innodb-locks-table" title="21.28.4 The INFORMATION_SCHEMA INNODB_LOCKS Table"><code class="literal">INNODB_LOCKS</code></a> and
          <a class="link" href="information-schema.html#innodb-lock-waits-table" title="21.28.5 The INFORMATION_SCHEMA INNODB_LOCK_WAITS Table"><code class="literal">INNODB_LOCK_WAITS</code></a>) is fetched
          automatically and saved to an intermediate buffer that
          provides a <span class="quote">“<span class="quote">point-in-time</span>”</span> snapshot. The data
          across all three tables is consistent when queried from the
          same snapshot. However, the underlying data changes so fast
          that similar glimpses at other, similarly fast-changing data,
          may not be in synchrony. Thus, you should be careful when
          comparing data in the <code class="literal">InnoDB</code> transaction
          and locking tables with data in the
          <a class="link" href="information-schema.html#processlist-table" title="21.14 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table. The data from
          the <a class="link" href="information-schema.html#processlist-table" title="21.14 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> table does not
          come from the same snapshot as the data about locking and
          transactions. Even if you issue a single
          <code class="literal">SELECT</code> (joining
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> and
          <a class="link" href="information-schema.html#processlist-table" title="21.14 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a>, for example), the
          content of those tables is generally not consistent.
          <a class="link" href="information-schema.html#innodb-trx-table" title="21.28.3 The INFORMATION_SCHEMA INNODB_TRX Table"><code class="literal">INNODB_TRX</code></a> may reference rows
          that are not present in
          <a class="link" href="information-schema.html#processlist-table" title="21.14 The INFORMATION_SCHEMA PROCESSLIST Table"><code class="literal">PROCESSLIST</code></a> or the currently
          executing SQL query of a transaction, shown in
          <code class="literal">INNODB_TRX.TRX_QUERY</code> may differ from the
          one in <code class="literal">PROCESSLIST.INFO</code>.
</p>
</div>

</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-information-schema-buffer-pool-tables"></a>14.16.3 InnoDB INFORMATION_SCHEMA Buffer Pool Tables</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables provide
      buffer pool status information and metadata about the pages within
      the <code class="literal">InnoDB</code> buffer pool. The tables were
      introduced in MySQL 5.6.2 and later backported to MySQL 5.5 (in
      MySQL 5.5.28) and MySQL 5.1 (in MySQL 5.1.66).
    </p><p>
      The <code class="literal">InnoDB</code>
      <code class="literal">INFORMATION_SCHEMA</code> buffer pool tables include
      those listed below:
    </p><pre class="programlisting">mysql&gt; SHOW TABLES FROM INFORMATION_SCHEMA LIKE 'INNODB_BUFFER%';
+-----------------------------------------------+
| Tables_in_INFORMATION_SCHEMA (INNODB_BUFFER%) |
+-----------------------------------------------+
| INNODB_BUFFER_PAGE_LRU                        |
| INNODB_BUFFER_PAGE                            |
| INNODB_BUFFER_POOL_STATS                      |
+-----------------------------------------------+
3 rows in set (0.00 sec)</pre>
<h4><a name="idm140301490366240"></a>Table Overview</h4>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.28.6 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>: Holds
          information about each page in the <code class="literal">InnoDB</code>
          buffer pool.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.28.7 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>: Holds
          information about the pages in the <code class="literal">InnoDB</code>
          buffer pool, in particular how they are ordered in the LRU
          list that determines which pages to evict from the buffer pool
          when it becomes full. The
          <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.28.7 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table has
          the same columns as the
          <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.28.6 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a> table, except
          that the <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.28.7 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
          table has an <code class="literal">LRU_POSITION</code> column instead of
          a <code class="literal">BLOCK_ID</code> column.
        </p></li><li class="listitem"><p>
          <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="21.28.8 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a>:
          Provides buffer pool status information. Much of the same
          information is provided by
          <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
          INNODB STATUS</code></a> output, or may be obtained using
          <code class="literal">InnoDB</code> buffer pool server status variables.
</p></li></ul>
</div>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<div class="admon-title">
Warning
</div>
<p>
        Querying the <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.28.6 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>
        table or <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.28.7 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a>
        table can introduce significant performance overhead. Do not
        query these tables on a production system unless you are aware
        of the performance impact that your query may have, and have
        determined it to be acceptable. To avoid impacting performance,
        reproduce the issue you want to investigate on a test instance
        and run your queries on the test instance.
</p>
</div>

<div class="example">
<a name="innodb-information-schema-buffer-pool-system-data-example"></a><p class="title"><b>Example 14.4 Querying System Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages that contain
        system data by excluding pages where the
        <code class="literal">TABLE_NAME</code> value is either
        <code class="literal">NULL</code> or includes a slash
        <span class="quote">“<span class="quote"><code class="literal">/</code></span>”</span> or period
        <span class="quote">“<span class="quote"><code class="literal">.</code></span>”</span> in the table name, which
        indicates a user-defined table.
      </p><pre class="programlisting">SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);
+----------+
| COUNT(*) |
+----------+
|      381 |
+----------+
1 row in set (0.14 sec)</pre><p>
        This query returns the approximate number of pages that contain
        system data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain system data.
      </p><pre class="programlisting">SELECT  
(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0)
) AS system_pages,
(
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
) AS total_pages,
(
SELECT ROUND((system_pages/total_pages) * 100)
) AS system_page_percentage;
+--------------+-------------+------------------------+
| system_pages | total_pages | system_page_percentage |
+--------------+-------------+------------------------+
|          381 |        8192 |                      5 |
+--------------+-------------+------------------------+
1 row in set (0.22 sec)</pre><p>
        The type of system data in the buffer pool can be determined by
        querying the <code class="literal">PAGE_TYPE</code> value. For example,
        the following query returns eight distinct
        <code class="literal">PAGE_TYPE</code> values among the pages that contain
        system data:
      </p><pre class="programlisting">mysql&gt; SELECT DISTINCT PAGE_TYPE FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NULL OR (INSTR(TABLE_NAME, '/') = 0 AND INSTR(TABLE_NAME, '.') = 0);
+-------------------+
| PAGE_TYPE         |
+-------------------+
| IBUF_BITMAP       |
| SYSTEM            |
| INDEX             |
| UNDO_LOG          |
| FILE_SPACE_HEADER |
| UNKNOWN           |
| INODE             |
| EXTENT_DESCRIPTOR |
+-------------------+
8 rows in set (2.00 sec)</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-user-data-example"></a><p class="title"><b>Example 14.5 Querying User Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        This query provides an approximate count of pages containing
        user data by counting pages where the
        <code class="literal">TABLE_NAME</code> value is <code class="literal">NOT
        NULL</code>.
      </p><pre class="programlisting">mysql&gt; SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NOT NULL;
+----------+
| COUNT(*) |
+----------+
|     7811 |
+----------+
1 row in set (0.11 sec)</pre><p>
        This query returns the approximate number of pages that contain
        user data, the total number of buffer pool pages, and an
        approximate percentage of pages that contain user data.
      </p><pre class="programlisting">mysql&gt; SELECT  
(SELECT COUNT(*) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE 
WHERE TABLE_NAME IS NOT NULL AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0)
) AS user_pages,
(
SELECT COUNT(*)
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
) AS total_pages,
(
SELECT ROUND((user_pages/total_pages) * 100)
) AS user_page_percentage;
+------------+-------------+----------------------+
| user_pages | total_pages | user_page_percentage |
+------------+-------------+----------------------+
|       7811 |        8192 |                   95 |
+------------+-------------+----------------------+
1 row in set (0.45 sec)</pre><p>
        This query identifies user-defined tables with pages in the
        buffer pool:
      </p><pre class="programlisting">mysql&gt; SELECT DISTINCT TABLE_NAME 
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE  
WHERE TABLE_NAME IS NOT NULL 
AND (INSTR(TABLE_NAME, '/') &gt; 0 OR INSTR(TABLE_NAME, '.') &gt; 0); 
+---------------------+
| TABLE_NAME          |
+---------------------+
| employees/salaries  |
| employees/employees |
+---------------------+
2 rows in set (0.12 sec)</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-index-data-example"></a><p class="title"><b>Example 14.6 Querying Index Data in the INNODB_BUFFER_PAGE Table</b></p>
<div class="example-contents">
<p>
        For information about index pages, query the
        <code class="literal">INDEX_NAME</code> column using the name of the
        index. For example, the following query returns the number of
        pages and total data size of pages for the
        <code class="literal">emp_no</code> index that is defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre class="programlisting">mysql&gt; SELECT INDEX_NAME, COUNT(*) AS Pages,  
ROUND(SUM(IF(COMPRESSED_SIZE = 0, 16384, COMPRESSED_SIZE))/1024/1024)  
AS 'Total Data (MB)'  FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE  
WHERE INDEX_NAME='emp_no' AND TABLE_NAME = 'employees/salaries';
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1244 |              19 |
+------------+-------+-----------------+
1 row in set (0.11 sec)</pre><p>
        This query returns the number of pages and total data size of
        pages for all indexes defined on the
        <code class="literal">employees.salaries</code> table:
      </p><pre class="programlisting">mysql&gt; SELECT INDEX_NAME, COUNT(*) AS Pages,
ROUND(SUM(IF(COMPRESSED_SIZE = 0, 16384, COMPRESSED_SIZE))/1024/1024) 
AS 'Total Data (MB)'
FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE
WHERE TABLE_NAME = 'employees/salaries'
GROUP BY INDEX_NAME;
+------------+-------+-----------------+
| INDEX_NAME | Pages | Total Data (MB) |
+------------+-------+-----------------+
| emp_no     |  1244 |              19 |
| PRIMARY    |  6086 |              95 |
+------------+-------+-----------------+
2 rows in set (0.17 sec)</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-lru-position-example"></a><p class="title"><b>Example 14.7 Querying LRU_POSITION Data in the INNODB_BUFFER_PAGE_LRU Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-page-lru-table" title="21.28.7 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE_LRU Table"><code class="literal">INNODB_BUFFER_PAGE_LRU</code></a> table
        holds information about the pages in the
        <code class="literal">InnoDB</code> buffer pool, in particular how they
        are ordered that determines which pages to evict from the buffer
        pool when it becomes full. The definition for this page is the
        same as for <a class="link" href="information-schema.html#innodb-buffer-page-table" title="21.28.6 The INFORMATION_SCHEMA INNODB_BUFFER_PAGE Table"><code class="literal">INNODB_BUFFER_PAGE</code></a>,
        except this table has an <code class="literal">LRU_POSITION</code> column
        instead of a <code class="literal">BLOCK_ID</code> column.
      </p><p>
        This query counts the number of positions at a specific location
        in the LRU list occupied by pages of the
        <code class="literal">employees.employees</code> table.
      </p><pre class="programlisting">mysql&gt; SELECT COUNT(LRU_POSITION) FROM INFORMATION_SCHEMA.INNODB_BUFFER_PAGE_LRU 
WHERE TABLE_NAME='employees/employees' AND LRU_POSITION &lt; 3072;
+---------------------+
| COUNT(LRU_POSITION) |
+---------------------+
|                 481 |
+---------------------+
1 row in set (0.11 sec)</pre>
</div>

</div>
<br class="example-break">
<div class="example">
<a name="innodb-information-schema-buffer-pool-stats-example"></a><p class="title"><b>Example 14.8 Querying the INNODB_BUFFER_POOL_STATS Table</b></p>
<div class="example-contents">
<p>
        The <a class="link" href="information-schema.html#innodb-buffer-pool-stats-table" title="21.28.8 The INFORMATION_SCHEMA INNODB_BUFFER_POOL_STATS Table"><code class="literal">INNODB_BUFFER_POOL_STATS</code></a> table
        provides information similar to
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> and <code class="literal">InnoDB</code> buffer pool
        status variables.
      </p><pre class="programlisting">mysql&gt; SELECT * FROM information_schema.INNODB_BUFFER_POOL_STATS \G
*************************** 1. row ***************************
                         POOL_ID: 0
                       POOL_SIZE: 8192
                    FREE_BUFFERS: 1
                  DATABASE_PAGES: 7942
              OLD_DATABASE_PAGES: 2911
         MODIFIED_DATABASE_PAGES: 0
              PENDING_DECOMPRESS: 0
                   PENDING_READS: 0
               PENDING_FLUSH_LRU: 0
              PENDING_FLUSH_LIST: 0
                PAGES_MADE_YOUNG: 8358
            PAGES_NOT_MADE_YOUNG: 0
           PAGES_MADE_YOUNG_RATE: 0
       PAGES_MADE_NOT_YOUNG_RATE: 0
               NUMBER_PAGES_READ: 7045
            NUMBER_PAGES_CREATED: 12382
            NUMBER_PAGES_WRITTEN: 15790
                 PAGES_READ_RATE: 0
               PAGES_CREATE_RATE: 0
              PAGES_WRITTEN_RATE: 0
                NUMBER_PAGES_GET: 28731589
                        HIT_RATE: 0
    YOUNG_MAKE_PER_THOUSAND_GETS: 0
NOT_YOUNG_MAKE_PER_THOUSAND_GETS: 0
         NUMBER_PAGES_READ_AHEAD: 2934
       NUMBER_READ_AHEAD_EVICTED: 23
                 READ_AHEAD_RATE: 0
         READ_AHEAD_EVICTED_RATE: 0
                    LRU_IO_TOTAL: 0
                  LRU_IO_CURRENT: 0
                UNCOMPRESS_TOTAL: 0
              UNCOMPRESS_CURRENT: 0
1 row in set (0.00 sec)</pre><p>
        For comparison,
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output and <code class="literal">InnoDB</code> buffer
        pool status variable output is shown below, based on the same
        data set.
      </p><p>
        For more information about
        <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
        STATUS</code></a> output, see
        <a class="xref" href="innodb-storage-engine.html#innodb-standard-monitor" title="14.17.3 InnoDB Standard Monitor and Lock Monitor Output">Section 14.17.3, “InnoDB Standard Monitor and Lock Monitor Output”</a>.
      </p><pre class="programlisting">mysql&gt; SHOW ENGINE INNODB STATUS \G
...
----------------------
BUFFER POOL AND MEMORY
----------------------
Total memory allocated 137363456; in additional pool allocated 0
Dictionary memory allocated 71426
Buffer pool size   8192
Free buffers       1
Database pages     7942
Old database pages 2911
Modified db pages  0
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 8358, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 7045, created 12382, written 15790
0.00 reads/s, 0.00 creates/s, 0.00 writes/s
No buffer pool page gets since the last printout
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
LRU len: 7942, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
...</pre><p>
        For status variable descriptions, see
        <a class="xref" href="server-administration.html#server-status-variables" title="5.1.6 Server Status Variables">Section 5.1.6, “Server Status Variables”</a>.
      </p><pre class="programlisting">mysql&gt; SHOW STATUS LIKE 'Innodb_buffer%';
+---------------------------------------+-----------+
| Variable_name                         | Value     |
+---------------------------------------+-----------+
| Innodb_buffer_pool_pages_data         | 7942      |
| Innodb_buffer_pool_bytes_data         | 130121728 |
| Innodb_buffer_pool_pages_dirty        | 0         |
| Innodb_buffer_pool_bytes_dirty        | 0         |
| Innodb_buffer_pool_pages_flushed      | 15790     |
| Innodb_buffer_pool_pages_free         | 1         |
| Innodb_buffer_pool_pages_misc         | 249       |
| Innodb_buffer_pool_pages_total        | 8192      |
| Innodb_buffer_pool_read_ahead_rnd     | 0         |
| Innodb_buffer_pool_read_ahead         | 2934      |
| Innodb_buffer_pool_read_ahead_evicted | 23        |
| Innodb_buffer_pool_read_requests      | 28731589  |
| Innodb_buffer_pool_reads              | 4112      |
| Innodb_buffer_pool_wait_free          | 0         |
| Innodb_buffer_pool_write_requests     | 11965146  |
+---------------------------------------+-----------+
15 rows in set (0.00 sec)
</pre>
</div>

</div>
<br class="example-break">
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-monitors"></a>14.17 InnoDB Monitors</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-monitor-types">14.17.1 InnoDB Monitor Types</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-enabling-monitors">14.17.2 Enabling InnoDB Monitors</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-standard-monitor">14.17.3 InnoDB Standard Monitor and Lock Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-tablespace-monitor">14.17.4 InnoDB Tablespace Monitor Output</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-table-monitor">14.17.5 InnoDB Table Monitor Output</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301490286384"></a><a class="indexterm" name="idm140301490284896"></a><a class="indexterm" name="idm140301490283408"></a><a class="indexterm" name="idm140301490281920"></a><a class="indexterm" name="idm140301490280432"></a><a class="indexterm" name="idm140301490278944"></a><p>
    <code class="literal">InnoDB</code> monitors provide information about the
    <code class="literal">InnoDB</code> internal state. This information is useful
    for performance tuning.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-monitor-types"></a>14.17.1 InnoDB Monitor Types</h3>
</div>
</div>
</div>
<p>
      There are four types of <code class="literal">InnoDB</code> monitors:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          The standard <code class="literal">InnoDB</code> Monitor displays the
          following types of information:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              Table and record locks held by each active transaction.
            </p></li><li class="listitem"><p>
              Lock waits of a transaction.
            </p></li><li class="listitem"><p>
              Semaphore waits of threads.
            </p></li><li class="listitem"><p>
              Pending file I/O requests.
            </p></li><li class="listitem"><p>
              Buffer pool statistics.
            </p></li><li class="listitem"><p>
              Purge and insert buffer merge activity of the main
              <code class="literal">InnoDB</code> thread.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Lock Monitor prints additional
          lock information as part of the standard
          <code class="literal">InnoDB</code> Monitor output.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Tablespace Monitor prints a list
          of file segments in the shared tablespace and validates the
          tablespace allocation data structures.
        </p></li><li class="listitem"><p>
          The <code class="literal">InnoDB</code> Table Monitor prints the
          contents of the <code class="literal">InnoDB</code> internal data
          dictionary.
</p></li></ul>
</div>
<p>
      For additional information about <code class="literal">InnoDB</code>
      monitors, see:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Mark Leith:
          <a class="ulink" href="http://www.markleith.co.uk/?p=25" target="_top">InnoDB Table and
          Tablespace Monitors</a>
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-enabling-monitors"></a>14.17.2 Enabling InnoDB Monitors</h3>

</div>

</div>

</div>
<p>
      When you enable <code class="literal">InnoDB</code> monitors for periodic
      output, <code class="literal">InnoDB</code> writes their output to the
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> server standard error output
      (<code class="literal">stderr</code>). In this case, no output is sent to
      clients. When switched on, <code class="literal">InnoDB</code> monitors
      print data about every 15 seconds. Server output usually is
      directed to the error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2 The Error Log">Section 5.2.2, “The Error Log”</a>). This
      data is useful in performance tuning. On Windows, start the server
      from a command prompt in a console window with the
      <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option if you want to
      direct the output to the window rather than to the error log.
    </p><p>
      <code class="literal">InnoDB</code> sends diagnostic output to
      <code class="literal">stderr</code> or to files rather than to
      <code class="literal">stdout</code> or fixed-size memory buffers, to avoid
      potential buffer overflows. As a side effect, the output of
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> is written to a status file in the MySQL data
      directory every fifteen seconds. The name of the file is
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>,
      where <em class="replaceable"><code>pid</code></em> is the server process ID.
      <code class="literal">InnoDB</code> removes the file for a normal shutdown.
      If abnormal shutdowns have occurred, instances of these status
      files may be present and must be removed manually. Before removing
      them, you might want to examine them to see whether they contain
      useful information about the cause of abnormal shutdowns. The
      <code class="filename">innodb_status.<em class="replaceable"><code>pid</code></em></code>
      file is created only if the configuration option
      <a class="link" href="innodb-storage-engine.html#option_mysqld_innodb-status-file"><code class="option">innodb-status-file=1</code></a> is set.
    </p><p>
      <code class="literal">InnoDB</code> monitors should be enabled only when you
      actually want to see monitor information because output generation
      does result in some performance decrement. Also, if you enable
      monitor output by creating the associated table, your error log
      may become quite large if you forget to remove the table later.
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Note
</div>
<p>
        To assist with troubleshooting, <code class="literal">InnoDB</code>
        temporarily enables standard <code class="literal">InnoDB</code> Monitor
        output under certain conditions. For more information, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting" title="14.20 InnoDB Troubleshooting">Section 14.20, “InnoDB Troubleshooting”</a>.
</p>
</div>
<p>
      Each monitor begins with a header containing a timestamp and the
      monitor name. For example:
    </p><pre class="programlisting">
=====================================
141016 15:41:44 INNODB MONITOR OUTPUT
=====================================
</pre><p>
      The header for the standard <code class="literal">InnoDB</code> Monitor
      (<code class="literal">INNODB MONITOR OUTPUT</code>) is also used for the
      Lock Monitor because the latter produces the same output with the
      addition of extra lock information.
    </p><p>
      Enabling an <code class="literal">InnoDB</code> monitor for periodic output
      involves using a <code class="literal">CREATE TABLE</code> statement to
      create a specially named <code class="literal">InnoDB</code> table that is
      associated with the monitor. For example, to enable the standard
      <code class="literal">InnoDB</code> Monitor, you would create an
      <code class="literal">InnoDB</code> table named
      <code class="literal">innodb_monitor</code>.
    </p><p>
      Using <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> syntax is just a
      way to pass a command to the <code class="literal">InnoDB</code> engine
      through MySQL's SQL parser. The only things that matter are the
      table name and that it be an <code class="literal">InnoDB</code> table. The
      structure of the table is not relevant. If you shut down the
      server, the monitor does not restart automatically when you
      restart the server. Drop the monitor table and issue a new
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement to start the
      monitor.
    </p><p>
      The <a class="link" href="security.html#priv_process"><code class="literal">PROCESS</code></a> privilege is required
      to start or stop the <code class="literal">InnoDB</code> monitors.
</p>
<h4><a name="idm140301490219376"></a>Enabling the Standard InnoDB Monitor</h4>
<p>
      To enable the standard <code class="literal">InnoDB</code> Monitor for
      periodic output, create the <code class="literal">innodb_monitor</code>
      table:
    </p><pre class="programlisting">
CREATE TABLE innodb_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Monitor, drop
      the table:
    </p><pre class="programlisting">
DROP TABLE innodb_monitor;
</pre>
<h4><a name="idm140301490214160"></a>Obtaining Standard InnoDB Monitor Output On Demand</h4>
<p>
      As an alternative to enabling the standard
      <code class="literal">InnoDB</code> Monitor for periodic output, you can
      obtain standard <code class="literal">InnoDB</code> Monitor output on demand
      using the <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE
      INNODB STATUS</code></a> SQL statement, which fetches the output to
      your client program. If you are using the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a>
      interactive client, the output is more readable if you replace the
      usual semicolon statement terminator with <code class="literal">\G</code>:
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
</pre><p>
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> output also includes <code class="literal">InnoDB</code>
      Lock Monitor data if the <code class="literal">InnoDB</code> Lock Monitor is
      enabled for periodic output.
</p>
<h4><a name="idm140301490203536"></a>Enabling the InnoDB Lock Monitor</h4>
<p>
      To enable the <code class="literal">InnoDB</code> Lock Monitor for periodic
      output, create the <code class="literal">innodb_lock_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_lock_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the <code class="literal">InnoDB</code> Lock Monitor, drop the
      table:
    </p><pre class="programlisting">
DROP TABLE innodb_lock_monitor;
</pre>
<h4><a name="idm140301490198320"></a>Enabling the InnoDB Tablespace Monitor</h4>
<p>
      To enable the <code class="literal">InnoDB</code> Tablespace Monitor for
      periodic output, create the
      <code class="literal">innodb_tablespace_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_tablespace_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the standard <code class="literal">InnoDB</code> Tablespace
      Monitor, drop the table:
    </p><pre class="programlisting">
DROP TABLE innodb_tablespace_monitor;
</pre>
<h4><a name="idm140301490193056"></a>Enabling the InnoDB Table Monitor</h4>
<p>
      To enable the <code class="literal">InnoDB</code> Table Monitor for periodic
      output, create the <code class="literal">innodb_table_monitor</code> table:
    </p><pre class="programlisting">
CREATE TABLE innodb_table_monitor (a INT) ENGINE=INNODB;
</pre><p>
      To disable the <code class="literal">InnoDB</code> Table Monitor, drop the
      table:
    </p><pre class="programlisting">
DROP TABLE innodb_table_monitor;
</pre>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-standard-monitor"></a>14.17.3 InnoDB Standard Monitor and Lock Monitor Output</h3>

</div>

</div>

</div>
<p>
      The Lock Monitor is the same as the standard Monitor except that
      it includes additional lock information. Enabling either monitor
      for periodic output turns on the same output stream, but the
      stream includes extra information if the Lock Monitor is enabled.
      For example, if you enable the standard <code class="literal">InnoDB</code>
      Monitor and <code class="literal">InnoDB</code> Lock Monitor, that turns on
      a single output stream. The stream includes extra lock information
      until you disable the Lock Monitor.
    </p><p>
      Example InnoDB Monitor output (as of MySQL 5.5.38):
    </p><pre class="programlisting">
mysql&gt; <strong class="userinput"><code>SHOW ENGINE INNODB STATUS\G</code></strong>
*************************** 1. row ***************************
  Type: InnoDB
  Name: 
Status: 
=====================================
141016 15:41:44 INNODB MONITOR OUTPUT
=====================================
Per second averages calculated from the last 6 seconds
-----------------
BACKGROUND THREAD
-----------------
srv_master_thread loops: 49 1_second, 48 sleeps, 3 10_second, 18 background, 
18 flush
srv_master_thread log flush and writes: 48
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 46, signal count 45
Mutex spin waits 30, rounds 900, OS waits 27
RW-shared spins 14, rounds 420, OS waits 14
RW-excl spins 0, rounds 150, OS waits 5
Spin rounds per wait: 30.00 mutex, 30.00 RW-shared, 150.00 RW-excl
------------------------
LATEST FOREIGN KEY ERROR
------------------------
141016 15:37:30 Transaction:
TRANSACTION 3D005, ACTIVE 0 sec inserting
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1248, 3 row lock(s), undo log entries 3
MySQL thread id 1, OS thread handle 0x7f0ee440e700, query id 70 localhost root 
update
INSERT INTO child VALUES
    (NULL, 1)
    , (NULL, 2)
    , (NULL, 3)
    , (NULL, 4)
    , (NULL, 5)
    , (NULL, 6)
Foreign key constraint fails for table `mysql`.`child`:
,
  CONSTRAINT `child_ibfk_1` FOREIGN KEY (`parent_id`) REFERENCES `parent` (`id`) 
  ON DELETE CASCADE ON UPDATE CASCADE
Trying to add in child table, in index `par_ind` tuple:
DATA TUPLE: 2 fields;
 0: len 4; hex 80000003; asc     ;;
 1: len 4; hex 80000003; asc     ;;

But in parent table `mysql`.`parent`, in index `PRIMARY`,
the closest match we can find is record:
PHYSICAL RECORD: n_fields 3; compact format; info bits 0
 0: len 4; hex 80000004; asc     ;;
 1: len 6; hex 00000003d002; asc       ;;
 2: len 7; hex 8300001d480137; asc     H 7;;

------------------------
LATEST DETECTED DEADLOCK
------------------------
141016 15:39:58
*** (1) TRANSACTION:
TRANSACTION 3D009, ACTIVE 19 sec starting index read
mysql tables in use 1, locked 1
LOCK WAIT 2 lock struct(s), heap size 376, 1 row lock(s)
MySQL thread id 2, OS thread handle 0x7f0ee43cd700, query id 78 localhost root 
updating
DELETE FROM t WHERE i = 1
*** (1) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 2428 n bits 72 index `GEN_CLUST_INDEX` of table
`mysql`.`t` trx id 3D009 lock_mode X waiting
Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000700; asc       ;;
 1: len 6; hex 00000003d007; asc       ;;
 2: len 7; hex 87000009560110; asc     V  ;;
 3: len 4; hex 80000001; asc     ;;

*** (2) TRANSACTION:
TRANSACTION 3D008, ACTIVE 69 sec starting index read
mysql tables in use 1, locked 1
4 lock struct(s), heap size 1248, 3 row lock(s)
MySQL thread id 1, OS thread handle 0x7f0ee440e700, query id 79 localhost root 
updating
DELETE FROM t WHERE i = 1
*** (2) HOLDS THE LOCK(S):
RECORD LOCKS space id 0 page no 2428 n bits 72 index `GEN_CLUST_INDEX` of table 
`mysql`.`t` trx id 3D008 lock mode S
Record lock, heap no 1 PHYSICAL RECORD: n_fields 1; compact format; info bits 0
 0: len 8; hex 73757072656d756d; asc supremum;;

Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000700; asc       ;;
 1: len 6; hex 00000003d007; asc       ;;
 2: len 7; hex 87000009560110; asc     V  ;;
 3: len 4; hex 80000001; asc     ;;

*** (2) WAITING FOR THIS LOCK TO BE GRANTED:
RECORD LOCKS space id 0 page no 2428 n bits 72 index `GEN_CLUST_INDEX` of table 
`mysql`.`t` trx id 3D008 lock_mode X waiting
Record lock, heap no 2 PHYSICAL RECORD: n_fields 4; compact format; info bits 0
 0: len 6; hex 000000000700; asc       ;;
 1: len 6; hex 00000003d007; asc       ;;
 2: len 7; hex 87000009560110; asc     V  ;;
 3: len 4; hex 80000001; asc     ;;

*** WE ROLL BACK TRANSACTION (1)
------------
TRANSACTIONS
------------
Trx id counter 3D038
Purge done for trx's n:o &lt; 3D02A undo n:o &lt; 0
History list length 1047
Total number of lock structs in row lock hash table 0
LIST OF TRANSACTIONS FOR EACH SESSION:
---TRANSACTION 3D009, not started
MySQL thread id 2, OS thread handle 0x7f0ee43cd700, query id 78 localhost root
---TRANSACTION 3D008, not started
MySQL thread id 1, OS thread handle 0x7f0ee440e700, query id 113 localhost root
SHOW ENGINE INNODB STATUS
---TRANSACTION 3D037, ACTIVE 1 sec inserting
mysql tables in use 1, locked 1
1 lock struct(s), heap size 376, 0 row lock(s), undo log entries 11940
MySQL thread id 3, OS thread handle 0x7f0ee438c700, query id 112 localhost root 
update
INSERT INTO `employees` VALUES (413215,'1962-07-08','Ronghao','Molberg','F',
'1985-06-20'),(413216,'1954-05-25','Masaru','Lieberherr','M','1992-04-08'),
(413217,'1953-03-17','Phule','Waschkowski','F','1988-07-28'),(413218,'1964-10-07',
'Vitaly','Negoita','M','1986-01-13'),(413219,'1957-03-31','Danil','Kalafatis','F',
'1985-04-12'),(413220,'1958-07-25','Jianwen','Radwan','M','1986-09-03'),(413221,
'1964-04-08','Paloma','Bach','M','1986-05-03'),(413222,'1955-06-10','Stafford',
'Muhlberg','M','1989-03-22'),(413223,'1963-10-27','Aiichiro','Benzmuller','M',
'1987-12-02'),(413224,'1955-10-02','Giordano','N
TABLE LOCK table `employees`.`employees` trx id 3D037 lock mode IX
--------
FILE I/O
--------
I/O thread 0 state: waiting for completed aio requests (insert buffer thread)
I/O thread 1 state: waiting for completed aio requests (log thread)
I/O thread 2 state: waiting for completed aio requests (read thread)
I/O thread 3 state: waiting for completed aio requests (read thread)
I/O thread 4 state: waiting for completed aio requests (read thread)
I/O thread 5 state: waiting for completed aio requests (read thread)
I/O thread 6 state: waiting for completed aio requests (write thread)
I/O thread 7 state: waiting for completed aio requests (write thread)
I/O thread 8 state: waiting for completed aio requests (write thread)
I/O thread 9 state: waiting for completed aio requests (write thread)
Pending normal aio reads: 0 [0, 0, 0, 0] , aio writes: 0 [0, 0, 0, 0] ,
 ibuf aio reads: 0, log i/o's: 0, sync i/o's: 0
Pending flushes (fsync) log: 0; buffer pool: 0
439 OS file reads, 917 OS file writes, 199 OS fsyncs
0.00 reads/s, 0 avg bytes/read, 56.32 writes/s, 7.67 fsyncs/s
-------------------------------------
INSERT BUFFER AND ADAPTIVE HASH INDEX
-------------------------------------
Ibuf: size 1, free list len 0, seg size 2, 0 merges
merged operations:
 insert 0, delete mark 0, delete 0
discarded operations:
 insert 0, delete mark 0, delete 0
Hash table size 4425293, used cells 32, node heap has 1 buffer(s)
13577.57 hash searches/s, 202.47 non-hash searches/s
---
LOG
---
Log sequence number 794838329
Log flushed up to   793815740
Last checkpoint at  788417971
0 pending log writes, 0 pending chkp writes
96 log i/o's done, 3.50 log i/o's/second
----------------------
BUFFER POOL AND MEMORY
----------------------
Total memory allocated 2217738240; in additional pool allocated 0
Dictionary memory allocated 121719
Buffer pool size   131072
Free buffers       129937
Database pages     1134
Old database pages 211
Modified db pages  187
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 426, created 708, written 768
0.00 reads/s, 40.99 creates/s, 50.49 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 
0.00/s
LRU len: 1134, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
----------------------
INDIVIDUAL BUFFER POOL INFO
----------------------
---BUFFER POOL 0
Buffer pool size   65536
Free buffers       65029
Database pages     506
Old database pages 0
Modified db pages  95
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 137, created 369, written 412
0.00 reads/s, 20.16 creates/s, 18.00 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 
0.00/s
LRU len: 506, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
---BUFFER POOL 1
Buffer pool size   65536
Free buffers       64908
Database pages     628
Old database pages 211
Modified db pages  92
Pending reads 0
Pending writes: LRU 0, flush list 0, single page 0
Pages made young 0, not young 0
0.00 youngs/s, 0.00 non-youngs/s
Pages read 289, created 339, written 356
0.00 reads/s, 20.83 creates/s, 32.49 writes/s
Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 
0.00/s
LRU len: 628, unzip_LRU len: 0
I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--------------
ROW OPERATIONS
--------------
0 queries inside InnoDB, 0 queries in queue
1 read views open inside InnoDB
Main thread process no. 30091, id 139699544078080, state: sleeping
Number of rows inserted 225354, updated 0, deleted 3, read 4
13690.55 inserts/s, 0.00 updates/s, 0.00 deletes/s, 0.00 reads/s
----------------------------
END OF INNODB MONITOR OUTPUT
============================
</pre><p>
      Standard <code class="literal">InnoDB</code> Monitor output is limited to
      1MB when produced using the
      <a class="link" href="sql-syntax.html#show-engine" title="13.7.5.16 SHOW ENGINE Syntax"><code class="literal">SHOW ENGINE INNODB
      STATUS</code></a> statement. This limit does not apply to output
      written to the server's error output.
    </p><p>
      Some notes on the output sections:
    </p><p>
      <span class="bold"><strong><code class="literal">Status</code></strong></span>
    </p><p>
      This section shows the timestamp, the monitor name, and the number
      of seconds that per-second averages are based on. The number of
      seconds is the elapsed time between the current time and the last
      time <code class="literal">InnoDB</code> Monitor output was printed.
    </p><p>
      <span class="bold"><strong><code class="literal">BACKGROUND
      THREAD</code></strong></span>
    </p><p>
      The <code class="literal">srv_master_thread</code> lines shows work done by
      the main background thread.
    </p><p>
      <span class="bold"><strong><code class="literal">SEMAPHORES</code></strong></span>
    </p><p>
      This section reports threads waiting for a semaphore and
      statistics on how many times threads have needed a spin or a wait
      on a mutex or a rw-lock semaphore. A large number of threads
      waiting for semaphores may be a result of disk I/O, or contention
      problems inside <code class="literal">InnoDB</code>. Contention can be due
      to heavy parallelism of queries or problems in operating system
      thread scheduling. Setting the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_thread_concurrency"><code class="literal">innodb_thread_concurrency</code></a> system
      variable smaller than the default value might help in such
      situations. The <code class="literal">Spin rounds per wait</code> line shows
      the number of spinlock rounds per OS wait for a mutex.
    </p><p>
      <span class="bold"><strong><code class="literal">LATEST FOREIGN KEY
      ERROR</code></strong></span>
    </p><p>
      This section provides information about the most recent foreign
      key constraint error. It is not present if no such error has
      occurred. The contents include the statement that failed as well
      as information about the constraint that failed and the referenced
      and referencing tables.
    </p><p>
      <span class="bold"><strong><code class="literal">LATEST DETECTED
      DEADLOCK</code></strong></span>
    </p><p>
      This section provides information about the most recent deadlock.
      It is not present if no deadlock has occurred. The contents show
      which transactions are involved, the statement each was attempting
      to execute, the locks they have and need, and which transaction
      <code class="literal">InnoDB</code> decided to roll back to break the
      deadlock. The lock modes reported in this section are explained in
      <a class="xref" href="innodb-storage-engine.html#innodb-lock-modes" title="14.5.3 InnoDB Lock Modes">Section 14.5.3, “InnoDB Lock Modes”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">TRANSACTIONS</code></strong></span>
    </p><p>
      If this section reports lock waits, your applications might have
      lock contention. The output can also help to trace the reasons for
      transaction deadlocks.
    </p><p>
      <span class="bold"><strong><code class="literal">FILE I/O</code></strong></span>
    </p><p>
      This section provides information about threads that
      <code class="literal">InnoDB</code> uses to perform various types of I/O.
      The first few of these are dedicated to general
      <code class="literal">InnoDB</code> processing. The contents also display
      information for pending I/O operations and statistics for I/O
      performance.
    </p><p>
      The number of these threads are controlled by the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_read_io_threads"><code class="literal">innodb_read_io_threads</code></a> and
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_write_io_threads"><code class="literal">innodb_write_io_threads</code></a>
      parameters. See <a class="xref" href="innodb-storage-engine.html#innodb-parameters" title="14.14 InnoDB Startup Options and System Variables">Section 14.14, “InnoDB Startup Options and System Variables”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">INSERT BUFFER AND ADAPTIVE HASH
      INDEX</code></strong></span>
    </p><p>
      This section shows the status of the <code class="literal">InnoDB</code>
      insert buffer and adaptive hash index. (See
      <a class="xref" href="innodb-storage-engine.html#innodb-insert-buffering" title="14.5.13.4 Insert Buffering">Section 14.5.13.4, “Insert Buffering”</a>, and
      <a class="xref" href="innodb-storage-engine.html#innodb-adaptive-hash" title="14.5.13.5 Adaptive Hash Indexes">Section 14.5.13.5, “Adaptive Hash Indexes”</a>.) The contents include the
      number of operations performed for each, plus statistics for hash
      index performance.
    </p><p>
      <span class="bold"><strong><code class="literal">LOG</code></strong></span>
    </p><p>
      This section displays information about the
      <code class="literal">InnoDB</code> log. The contents include the current
      log sequence number, how far the log has been flushed to disk, and
      the position at which <code class="literal">InnoDB</code> last took a
      checkpoint. (See <a class="xref" href="innodb-storage-engine.html#innodb-checkpoints" title="14.12.3 InnoDB Checkpoints">Section 14.12.3, “InnoDB Checkpoints”</a>.) The
      section also displays information about pending writes and write
      performance statistics.
    </p><p>
      <span class="bold"><strong><code class="literal">BUFFER POOL AND
      MEMORY</code></strong></span>
    </p><p>
      This section gives you statistics on pages read and written. You
      can calculate from these numbers how many data file I/O operations
      your queries currently are doing.
    </p><p>
      For additional information about the operation of the buffer pool,
      see <a class="xref" href="optimization.html#innodb-buffer-pool" title="8.9.1 The InnoDB Buffer Pool">Section 8.9.1, “The InnoDB Buffer Pool”</a>.
    </p><p>
      <span class="bold"><strong><code class="literal">ROW OPERATIONS</code></strong></span>
    </p><p>
      This section shows what the main thread is doing, including the
      number and performance rate for each type of row operation.
    </p><p>
      In MySQL 5.5, output from the standard
      <code class="literal">InnoDB</code> Monitor includes additional sections
      compared to the output for previous versions. For details, see
      <a class="xref" href="introduction.html#monitoring-improvements" title="1.4.3 Diagnostic and Monitoring Capabilities">Section 1.4.3, “Diagnostic and Monitoring Capabilities”</a>.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-tablespace-monitor"></a>14.17.4 InnoDB Tablespace Monitor Output</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">InnoDB</code> Tablespace Monitor prints
      information about the file segments in the shared tablespace and
      validates the tablespace allocation data structures. The
      Tablespace Monitor does not describe file-per-table tablespaces
      created with the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option.
    </p><p>
      Example <code class="literal">InnoDB</code> Tablespace Monitor output:
    </p><pre class="programlisting">
================================================
090408 21:28:09 INNODB TABLESPACE MONITOR OUTPUT
================================================
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
SEGMENT id 0 2 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 3 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
SEGMENT id 0 488 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 17 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
...
SEGMENT id 0 171 space 0; page 2; res 592 used 481; full ext 7
fragm pages 16; free extents 0; not full extents 2: pages 17
SEGMENT id 0 172 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
SEGMENT id 0 173 space 0; page 2; res 96 used 44; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 12
...
SEGMENT id 0 601 space 0; page 2; res 1 used 1; full ext 0
fragm pages 1; free extents 0; not full extents 0: pages 0
NUMBER of file segments: 73
Validating tablespace
Validation ok
---------------------------------------
END OF INNODB TABLESPACE MONITOR OUTPUT
=======================================
</pre><p>
      The Tablespace Monitor output includes information about the
      shared tablespace as a whole, followed by a list containing a
      breakdown for each segment within the tablespace.
    </p><p>
      In this example using the default
      <a class="link" href="glossary.html#glos_page_size" title="page size">page size</a>, the tablespace
      consists of database pages that are 16KB each. The pages are
      grouped into <a class="link" href="glossary.html#glos_extent" title="extent">extents</a> of size
      1MB (64 consecutive pages).
    </p><p>
      The initial part of the output that displays overall tablespace
      information has this format:
    </p><pre class="programlisting">
FILE SPACE INFO: id 0
size 13440, free limit 3136, free extents 28
not full frag extents 2: used pages 78, full frag extents 3
first seg id not used 0 23845
</pre><p>
      Overall tablespace information includes these values:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">id</code>: The tablespace ID. A value of 0 refers
          to the shared tablespace.
        </p></li><li class="listitem"><p>
          <code class="literal">size</code>: The current tablespace size in pages.
        </p></li><li class="listitem"><p>
          <code class="literal">free limit</code>: The minimum page number for
          which the free list has not been initialized. Pages at or
          above this limit are free.
        </p></li><li class="listitem"><p>
          <code class="literal">free extents</code>: The number of free extents.
        </p></li><li class="listitem"><p>
          <code class="literal">not full frag extents</code>, <code class="literal">used
          pages</code>: The number of fragment extents that are not
          completely filled, and the number of pages in those extents
          that have been allocated.
        </p></li><li class="listitem"><p>
          <code class="literal">full frag extents</code>: The number of completely
          full fragment extents.
        </p></li><li class="listitem"><p>
          <code class="literal">first seg id not used</code>: The first unused
          segment ID.
</p></li></ul>
</div>
<p>
      Individual segment information has this format:
    </p><pre class="programlisting">
SEGMENT id 0 15 space 0; page 2; res 160 used 160; full ext 2
fragm pages 32; free extents 0; not full extents 0: pages 0
</pre><p>
      Segment information includes these values:
    </p><p>
      <code class="literal">id</code>: The segment ID.
    </p><p>
      <code class="literal">space</code>, <code class="literal">page</code>: The tablespace
      number and page within the tablespace where the segment
      <span class="quote">“<span class="quote">inode</span>”</span> is located. A tablespace number of 0
      indicates the shared tablespace. <code class="literal">InnoDB</code> uses
      inodes to keep track of segments in the tablespace. The other
      fields displayed for a segment (<code class="literal">id</code>,
      <code class="literal">res</code>, and so forth) are derived from information
      in the inode.
    </p><p>
      <code class="literal">res</code>: The number of pages allocated (reserved)
      for the segment.
    </p><p>
      <code class="literal">used</code>: The number of allocated pages in use by
      the segment.
    </p><p>
      <code class="literal">full ext</code>: The number of extents allocated for
      the segment that are completely used.
    </p><p>
      <code class="literal">fragm pages</code>: The number of initial pages that
      have been allocated to the segment.
    </p><p>
      <code class="literal">free extents</code>: The number of extents allocated
      for the segment that are completely unused.
    </p><p>
      <code class="literal">not full extents</code>: The number of extents
      allocated for the segment that are partially used.
    </p><p>
      <code class="literal">pages</code>: The number of pages used within the
      not-full extents.
    </p><p>
      When a segment grows, it starts as a single page, and
      <code class="literal">InnoDB</code> allocates the first pages for it one at
      a time, up to 32 pages (this is the <code class="literal">fragm pages</code>
      value). After that, <code class="literal">InnoDB</code> allocates complete
      extents. <code class="literal">InnoDB</code> can add up to 4 extents at a
      time to a large segment to ensure good sequentiality of data.
    </p><p>
      For the example segment shown earlier, it has 32 fragment pages,
      plus 2 full extents (64 pages each), for a total of 160 pages used
      out of 160 pages allocated. The following segment has 32 fragment
      pages and one partially full extent using 14 pages for a total of
      46 pages used out of 96 pages allocated:
    </p><pre class="programlisting">
SEGMENT id 0 1 space 0; page 2; res 96 used 46; full ext 0
fragm pages 32; free extents 0; not full extents 1: pages 14
</pre><p>
      It is possible for a segment that has extents allocated to it to
      have a <code class="literal">fragm pages</code> value less than 32 if some
      of the individual pages have been deallocated subsequent to extent
      allocation.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-table-monitor"></a>14.17.5 InnoDB Table Monitor Output</h3>

</div>

</div>

</div>
<p>
      The <code class="literal">InnoDB</code> Table Monitor prints the contents of
      the <code class="literal">InnoDB</code> internal data dictionary.
    </p><p>
      The output contains one section per table. The
      <code class="literal">SYS_FOREIGN</code> and
      <code class="literal">SYS_FOREIGN_COLS</code> sections are for internal data
      dictionary tables that maintain information about foreign keys.
      There are also sections for the Table Monitor table and each
      user-created <code class="literal">InnoDB</code> table. Suppose that the
      following two tables have been created in the
      <code class="literal">test</code> database:
    </p><pre class="programlisting">
CREATE TABLE parent
(
  par_id    INT NOT NULL,
  fname      CHAR(20),
  lname      CHAR(20),
  PRIMARY KEY (par_id),
  UNIQUE INDEX (lname, fname)
) ENGINE = INNODB;

CREATE TABLE child
(
  par_id      INT NOT NULL,
  child_id    INT NOT NULL,
  name        VARCHAR(40),
  birth       DATE,
  weight      DECIMAL(10,2),
  misc_info   VARCHAR(255),
  last_update TIMESTAMP,
  PRIMARY KEY (par_id, child_id),
  INDEX (name),
  FOREIGN KEY (par_id) REFERENCES parent (par_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE = INNODB;
</pre><p>
      Then the Table Monitor output will look something like this
      (reformatted slightly):
    </p><pre class="programlisting">
===========================================
090420 12:09:32 INNODB TABLE MONITOR OUTPUT
===========================================
--------------------------------------
TABLE: name SYS_FOREIGN, id 0 11, columns 7, indexes 3, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           FOR_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           N_COLS: DATA_INT len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 11, fields 1/6, uniq 1, type 3
   root page 46, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID DB_TRX_ID DB_ROLL_PTR FOR_NAME REF_NAME N_COLS
  INDEX: name FOR_IND, id 0 12, fields 1/2, uniq 2, type 0
   root page 47, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  FOR_NAME ID
  INDEX: name REF_IND, id 0 13, fields 1/2, uniq 2, type 0
   root page 48, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  REF_NAME ID
--------------------------------------
TABLE: name SYS_FOREIGN_COLS, id 0 12, columns 7, indexes 1, appr.rows 1
  COLUMNS: ID: DATA_VARCHAR DATA_ENGLISH len 0;
           POS: DATA_INT len 4;
           FOR_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           REF_COL_NAME: DATA_VARCHAR DATA_ENGLISH len 0;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name ID_IND, id 0 14, fields 2/6, uniq 2, type 3
   root page 49, appr.key vals 1, leaf pages 1, size pages 1
   FIELDS:  ID POS DB_TRX_ID DB_ROLL_PTR FOR_COL_NAME REF_COL_NAME
--------------------------------------
TABLE: name test/child, id 0 14, columns 10, indexes 2, appr.rows 201
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           child_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           name: DATA_VARCHAR prtype 524303 len 40;
           birth: DATA_INT DATA_BINARY_TYPE len 3;
           weight: DATA_FIXBINARY DATA_BINARY_TYPE len 5;
           misc_info: DATA_VARCHAR prtype 524303 len 255;
           last_update: DATA_INT DATA_UNSIGNED DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 17, fields 2/9, uniq 2, type 3
   root page 52, appr.key vals 201, leaf pages 5, size pages 6
   FIELDS:  par_id child_id DB_TRX_ID DB_ROLL_PTR name birth weight misc_info last_update
  INDEX: name name, id 0 18, fields 1/3, uniq 3, type 0
   root page 53, appr.key vals 210, leaf pages 1, size pages 1
   FIELDS:  name par_id child_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
--------------------------------------
TABLE: name test/innodb_table_monitor, id 0 15, columns 4, indexes 1, appr.rows 0
  COLUMNS: i: DATA_INT DATA_BINARY_TYPE len 4;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name GEN_CLUST_INDEX, id 0 19, fields 0/4, uniq 1, type 1
   root page 193, appr.key vals 0, leaf pages 1, size pages 1
   FIELDS:  DB_ROW_ID DB_TRX_ID DB_ROLL_PTR i
--------------------------------------
TABLE: name test/parent, id 0 13, columns 6, indexes 2, appr.rows 299
  COLUMNS: par_id: DATA_INT DATA_BINARY_TYPE DATA_NOT_NULL len 4;
           fname: DATA_CHAR prtype 524542 len 20;
           lname: DATA_CHAR prtype 524542 len 20;
           DB_ROW_ID: DATA_SYS prtype 256 len 6;
           DB_TRX_ID: DATA_SYS prtype 257 len 6;
  INDEX: name PRIMARY, id 0 15, fields 1/5, uniq 1, type 3
   root page 50, appr.key vals 299, leaf pages 2, size pages 3
   FIELDS:  par_id DB_TRX_ID DB_ROLL_PTR fname lname
  INDEX: name lname, id 0 16, fields 2/3, uniq 2, type 2
   root page 51, appr.key vals 300, leaf pages 1, size pages 1
   FIELDS:  lname fname par_id
  FOREIGN KEY CONSTRAINT test/child_ibfk_1: test/child ( par_id )
             REFERENCES test/parent ( par_id )
-----------------------------------
END OF INNODB TABLE MONITOR OUTPUT
==================================
</pre><p>
      For each table, Table Monitor output contains a section that
      displays general information about the table and specific
      information about its columns, indexes, and foreign keys.
    </p><p>
      The general information for each table includes the table name (in
      <code class="literal"><em class="replaceable"><code>db_name</code></em>/<em class="replaceable"><code>tbl_name</code></em></code>
      format except for internal tables), its ID, the number of columns
      and indexes, and an approximate row count.
    </p><p>
      The <code class="literal">COLUMNS</code> part of a table section lists each
      column in the table. Information for each column indicates its
      name and data type characteristics. Some internal columns are
      added by <code class="literal">InnoDB</code>, such as
      <code class="literal">DB_ROW_ID</code> (row ID),
      <code class="literal">DB_TRX_ID</code> (transaction ID), and
      <code class="literal">DB_ROLL_PTR</code> (a pointer to the rollback/undo
      data).
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code>: These
          symbols indicate the data type. There may be multiple
          <code class="literal">DATA_<em class="replaceable"><code>xxx</code></em></code> symbols
          for a given column.
        </p></li><li class="listitem"><p>
          <code class="literal">prtype</code>: The column's <span class="quote">“<span class="quote">precise</span>”</span>
          type. This field includes information such as the column data
          type, character set code, nullability, signedness, and whether
          it is a binary string. This field is described in the
          <code class="filename">innobase/include/data0type.h</code> source file.
        </p></li><li class="listitem"><p>
          <code class="literal">len</code>: The column length in bytes.
</p></li></ul>
</div>
<p>
      Each <code class="literal">INDEX</code> part of the table section provides
      the name and characteristics of one table index:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">name</code>: The index name. If the name is
          <code class="literal">PRIMARY</code>, the index is a primary key. If the
          name is <code class="literal">GEN_CLUST_INDEX</code>, the index is the
          clustered index that is created automatically if the table
          definition doesn't include a primary key or
          non-<code class="literal">NULL</code> unique index. See
          <a class="xref" href="innodb-storage-engine.html#innodb-index-types" title="14.5.13.2 Clustered and Secondary Indexes">Section 14.5.13.2, “Clustered and Secondary Indexes”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">id</code>: The index ID.
        </p></li><li class="listitem"><p>
          <code class="literal">fields</code>: The number of fields in the index,
          as a value in
          <code class="literal"><em class="replaceable"><code>m</code></em>/<em class="replaceable"><code>n</code></em></code>
          format:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
              <em class="replaceable"><code>m</code></em> is the number of user-defined
              columns; that is, the number of columns you would see in
              the index definition in a <code class="literal">CREATE TABLE</code>
              statement.
            </p></li><li class="listitem"><p>
              <em class="replaceable"><code>n</code></em> is the total number of index
              columns, including those added internally. For the
              clustered index, the total includes the other columns in
              the table definition, plus any columns added internally.
              For a secondary index, the total includes the columns from
              the primary key that are not part of the secondary index.
</p></li></ul>
</div>
</li><li class="listitem"><p>
          <code class="literal">uniq</code>: The number of leading fields that are
          enough to determine index values uniquely.
        </p></li><li class="listitem"><p>
          <code class="literal">type</code>: The index type. This is a bit field.
          For example, 1 indicates a clustered index and 2 indicates a
          unique index, so a clustered index (which always contains
          unique values), will have a <code class="literal">type</code> value of
          3. An index with a <code class="literal">type</code> value of 0 is
          neither clustered nor unique. The flag values are defined in
          the <code class="filename">innobase/include/dict0mem.h</code> source
          file.
        </p></li><li class="listitem"><p>
          <code class="literal">root page</code>: The index root page number.
        </p></li><li class="listitem"><p>
          <code class="literal">appr. key vals</code>: The approximate index
          cardinality.
        </p></li><li class="listitem"><p>
          <code class="literal">leaf pages</code>: The approximate number of leaf
          pages in the index.
        </p></li><li class="listitem"><p>
          <code class="literal">size pages</code>: The approximate total number of
          pages in the index.
        </p></li><li class="listitem"><p>
          <code class="literal">FIELDS</code>: The names of the fields in the
          index. For a clustered index that was generated automatically,
          the field list begins with the internal
          <code class="literal">DB_ROW_ID</code> (row ID) field.
          <code class="literal">DB_TRX_ID</code> and
          <code class="literal">DB_ROLL_PTR</code> are always added internally to
          the clustered index, following the fields that comprise the
          primary key. For a secondary index, the final fields are those
          from the primary key that are not part of the secondary index.
</p></li></ul>
</div>
<p>
      The end of the table section lists the <code class="literal">FOREIGN
      KEY</code> definitions that apply to the table. This
      information appears whether the table is a referencing or
      referenced table.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-backup"></a>14.18 InnoDB Backup and Recovery</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#innodb-recovery">14.18.1 The InnoDB Recovery Process</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301490003728"></a><a class="indexterm" name="idm140301490002272"></a><p>
    The key to safe database management is making regular backups.
    Depending on your data volume, number of MySQL servers, and database
    workload, you can use these techniques, alone or in combination:
    <a class="link" href="glossary.html#glos_hot_backup" title="hot backup">hot backup</a> with MySQL
    Enterprise Backup; <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> by copying files while the MySQL server is shut down;
    <a class="link" href="glossary.html#glos_physical_backup" title="physical backup">physical backup</a> for fast
    operation (especially for restore);
    <a class="link" href="glossary.html#glos_logical_backup" title="logical backup">logical backup</a> with
    <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> for smaller data volumes or to record
    the structure of schema objects.
</p>
<h3><a name="idm140301489995280"></a>Hot Backups</h3>
<p>
    The <span class="command"><strong>mysqlbackup</strong></span> command, part of the MySQL
    Enterprise Backup component, lets you back up a running MySQL
    instance, including <code class="literal">InnoDB</code> and
    <a class="link" href="storage-engines.html#myisam-storage-engine" title="15.3 The MyISAM Storage Engine"><code class="literal">MyISAM</code></a> tables, with minimal disruption
    to operations while producing a consistent snapshot of the database.
    When <span class="command"><strong>mysqlbackup</strong></span> is copying
    <code class="literal">InnoDB</code> tables, reads and writes to both
    <code class="literal">InnoDB</code> and <code class="literal">MyISAM</code> tables can
    continue. During the copying of <code class="literal">MyISAM</code> tables,
    reads (but not writes) to those tables are permitted. MySQL
    Enterprise Backup can also create compressed backup files, and back
    up subsets of tables and databases. In conjunction with MySQL’s
    binary log, users can perform point-in-time recovery. MySQL
    Enterprise Backup is part of the MySQL Enterprise subscription. For
    more details, see <a class="xref" href="mysql-enterprise.html#mysql-enterprise-backup" title="25.2 MySQL Enterprise Backup Overview">Section 25.2, “MySQL Enterprise Backup Overview”</a>.
</p>
<h3><a name="idm140301489986256"></a>Cold Backups</h3>
<p>
    If you can shut down your MySQL server, you can make a binary backup
    that consists of all files used by <code class="literal">InnoDB</code> to
    manage its tables. Use the following procedure:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
        Do a <a class="link" href="glossary.html#glos_slow_shutdown" title="slow shutdown">slow shutdown</a> of
        the MySQL server and make sure that it stops without errors.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> data files
        (<code class="filename">ibdata</code> files and <code class="filename">.ibd</code>
        files) into a safe place.
      </p></li><li class="listitem"><p>
        Copy all the <code class="filename">.frm</code> files for
        <code class="literal">InnoDB</code> tables to a safe place.
      </p></li><li class="listitem"><p>
        Copy all <code class="literal">InnoDB</code> log files
        (<code class="filename">ib_logfile</code> files) to a safe place.
      </p></li><li class="listitem"><p>
        Copy your <code class="filename">my.cnf</code> configuration file or
        files to a safe place.
</p></li></ol>
</div>
<h3><a name="idm140301489972592"></a>Alternative Backup Types</h3>
<p>
    In addition to making binary backups as just described, regularly
    make dumps of your tables with <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a>. A
    binary file might be corrupted without you noticing it. Dumped
    tables are stored into text files that are human-readable, so
    spotting table corruption becomes easier. Also, because the format
    is simpler, the chance for serious data corruption is smaller.
    <a class="link" href="programs.html#mysqldump" title="4.5.4 mysqldump — A Database Backup Program"><span class="command"><strong>mysqldump</strong></span></a> also has a
    <a class="link" href="programs.html#option_mysqldump_single-transaction"><code class="option">--single-transaction</code></a> option for
    making a consistent snapshot without locking out other clients. See
    <a class="xref" href="backup-and-recovery.html#backup-policy" title="7.3.1 Establishing a Backup Policy">Section 7.3.1, “Establishing a Backup Policy”</a>.
  </p><p>
    Replication works with <a class="link" href="innodb-storage-engine.html" title="Chapter 14 The InnoDB Storage Engine"><code class="literal">InnoDB</code></a> tables,
    so you can use MySQL replication capabilities to keep a copy of your
    database at database sites requiring high availability.
</p>
<h3><a name="idm140301489965104"></a>Performing Recovery</h3>
<p>
    To recover your <code class="literal">InnoDB</code> database to the present
    from the time at which the binary backup was made, you must run your
    MySQL server with binary logging turned on, even before taking the
    backup. To achieve point-in-time recovery after restoring a backup,
    you can apply changes from the binary log that occurred after the
    backup was made. See <a class="xref" href="backup-and-recovery.html#point-in-time-recovery" title="7.5 Point-in-Time (Incremental) Recovery Using the Binary Log">Section 7.5, “Point-in-Time (Incremental) Recovery Using the Binary Log”</a>.
  </p><p>
    To recover from a crash of your MySQL server, the only requirement
    is to restart it. <code class="literal">InnoDB</code> automatically checks the
    logs and performs a roll-forward of the database to the present.
    <code class="literal">InnoDB</code> automatically rolls back uncommitted
    transactions that were present at the time of the crash. During
    recovery, <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> displays output something like
    this:
  </p><pre class="programlisting">
InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections
</pre><p>
    If your database becomes corrupted or disk failure occurs, you must
    perform the recovery using a backup. In the case of corruption,
    first find a backup that is not corrupted. After restoring the base
    backup, do a point-in-time recovery from the binary log files using
    <a class="link" href="programs.html#mysqlbinlog" title="4.6.7 mysqlbinlog — Utility for Processing Binary Log Files"><span class="command"><strong>mysqlbinlog</strong></span></a> and <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> to
    restore the changes that occurred after the backup was made.
  </p><a class="indexterm" name="idm140301489953968"></a><a class="indexterm" name="idm140301489952480"></a><a class="indexterm" name="idm140301489950992"></a><p>
    In some cases of database corruption, it is enough just to dump,
    drop, and re-create one or a few corrupt tables. You can use the
    <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> SQL statement to check
    whether a table is corrupt, although <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK
    TABLE</code></a> naturally cannot detect every possible kind of
    corruption. You can use the Tablespace Monitor to check the
    integrity of the file space management inside the tablespace files.
  </p><p>
    In some cases, apparent database page corruption is actually due to
    the operating system corrupting its own file cache, and the data on
    disk may be okay. It is best first to try restarting your computer.
    Doing so may eliminate errors that appeared to be database page
    corruption. If MySQL still has trouble starting because of
    <code class="literal">InnoDB</code> consistency problems, see
    <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a> for steps to start the
    instance in a diagnostic mode where you can dump the data.
</p>
<div class="section">

<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-recovery"></a>14.18.1 The InnoDB Recovery Process</h3>
</div>
</div>
</div>
<a class="indexterm" name="idm140301489942880"></a><p>
      <code class="literal">InnoDB</code>
      <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a> consists
      of several steps:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Applying the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>:
          Redo log application is the first step and is performed during
          initialization, before accepting any connections. If all
          changes were flushed from the
          <a class="link" href="glossary.html#glos_buffer_pool" title="buffer pool">buffer pool</a> to the
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespaces</a>
          (<code class="filename">ibdata*</code> and <code class="filename">*.ibd</code>
          files) at the time of the shutdown or crash, the redo log
          application can be skipped. If the redo log files are missing
          at startup, <code class="literal">InnoDB</code> skips the redo log
          application.
        </p><p>
          Removing redo logs to speed up the recovery process is not
          recommended, even if some data loss is acceptable. Removing
          redo logs should only be considered an option after a clean
          shutdown is performed, with
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_fast_shutdown"><code class="literal">innodb_fast_shutdown</code></a> set to
          <code class="literal">0</code> or <code class="literal">1</code>.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_rollback" title="rollback">Rolling back</a> incomplete
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transactions</a>: Any
          transactions that were active at the time of crash or
          <a class="link" href="glossary.html#glos_fast_shutdown" title="fast shutdown">fast shutdown</a>. The
          time it takes to roll back an incomplete transaction can be
          three or four times the amount of time a transaction is active
          before it is interrupted, depending on server load.
        </p><p>
          You cannot cancel transactions that are in the process of
          being rolled back. In extreme cases, when rolling back
          transactions is expected to take an exceptionally long time,
          it may be faster to start <code class="literal">InnoDB</code> with an
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting
          of <code class="literal">3</code> or greater. See
          <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a> for more
          information.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">Insert buffer</a> merge:
          Applying changes from the insert buffer (part of the
          <a class="link" href="glossary.html#glos_system_tablespace" title="system tablespace">system
          tablespace</a>) to leaf pages of secondary indexes, as the
          index pages are read to the buffer pool.
        </p></li><li class="listitem"><p>
          <a class="link" href="glossary.html#glos_purge" title="purge">Purge</a>: Deleting
          delete-marked records that are no longer visible for any
          active transaction.
</p></li></ul>
</div>
<p>
      The steps that follow redo log application do not depend on the
      redo log (other than for logging the writes) and are performed in
      parallel with normal processing. Of these, only rollback of
      incomplete transactions is special to crash recovery. The insert
      buffer merge and the purge are performed during normal processing.
    </p><p>
      After redo log application, <code class="literal">InnoDB</code> attempts to
      accept connections as early as possible, to reduce downtime. As
      part of crash recovery, <code class="literal">InnoDB</code> rolls back any
      transactions that were not committed or in <code class="literal">XA
      PREPARE</code> state when the server crashed. The rollback is
      performed by a background thread, executed in parallel with
      transactions from new connections. Until the rollback operation is
      completed, new connections may encounter locking conflicts with
      recovered transactions.
    </p><p>
      In most situations, even if the MySQL server was killed
      unexpectedly in the middle of heavy activity, the recovery process
      happens automatically and no action is needed from the DBA. If a
      hardware failure or severe system error corrupted
      <code class="literal">InnoDB</code> data, MySQL might refuse to start. In
      that case, see <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a> for the
      steps to troubleshoot such an issue.
    </p><p>
      For information about the binary log and <code class="literal">InnoDB</code>
      crash recovery, see <a class="xref" href="server-administration.html#binary-log" title="5.2.4 The Binary Log">Section 5.2.4, “The Binary Log”</a>.
</p>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-and-mysql-replication"></a>14.19 InnoDB and MySQL Replication</h2>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489908960"></a><p>
    MySQL replication works for <code class="literal">InnoDB</code> tables as it
    does for <code class="literal">MyISAM</code> tables. It is also possible to
    use replication in a way where the storage engine on the slave is
    not the same as the original storage engine on the master. For
    example, you can replicate modifications to an
    <code class="literal">InnoDB</code> table on the master to a
    <code class="literal">MyISAM</code> table on the slave.
  </p><p>
    To set up a new slave for a master, make a copy of the
    <code class="literal">InnoDB</code> tablespace and the log files, as well as
    the <code class="filename">.frm</code> files of the <code class="literal">InnoDB</code>
    tables, and move the copies to the slave. If the
    <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a> option is
    enabled, copy the <code class="filename">.ibd</code> files as well. For the
    proper procedure to do this, see <a class="xref" href="innodb-storage-engine.html#innodb-backup" title="14.18 InnoDB Backup and Recovery">Section 14.18, “InnoDB Backup and Recovery”</a>.
  </p><p>
    To make a new slave without taking down the master or an existing
    slave, use the <a class="link" href="mysql-enterprise.html#mysql-enterprise-backup" title="25.2 MySQL Enterprise Backup Overview">MySQL
    Enterprise Backup</a> product. If you can shut down the master or
    an existing slave, take a <a class="link" href="glossary.html#glos_cold_backup" title="cold backup">cold
    backup</a> of the <code class="literal">InnoDB</code> tablespaces and log
    files and use that to set up a slave.
  </p><p>
    Transactions that fail on the master do not affect replication at
    all. MySQL replication is based on the binary log where MySQL writes
    SQL statements that modify data. A transaction that fails (for
    example, because of a foreign key violation, or because it is rolled
    back) is not written to the binary log, so it is not sent to slaves.
    See <a class="xref" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax">Section 13.3.1, “START TRANSACTION, COMMIT, and ROLLBACK Syntax”</a>.
  </p><p><b>Replication and CASCADE. </b>
      Cascading actions for <code class="literal">InnoDB</code> tables on the
      master are replicated on the slave <span class="emphasis"><em>only</em></span> if
      the tables sharing the foreign key relation use
      <code class="literal">InnoDB</code> on both the master and slave. This is
      true whether you are using statement-based or row-based
      replication. Suppose that you have started replication, and then
      create two tables on the master using the following
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statements:
    </p><pre class="programlisting">
CREATE TABLE fc1 (
    i INT PRIMARY KEY,
    j INT
) ENGINE = InnoDB;

CREATE TABLE fc2 (
    m INT PRIMARY KEY,
    n INT,
    FOREIGN KEY ni (n) REFERENCES fc1 (i)
        ON DELETE CASCADE
) ENGINE = InnoDB;
</pre><p>
    Suppose that the slave does not have <code class="literal">InnoDB</code>
    support enabled. If this is the case, then the tables on the slave
    are created, but they use the <code class="literal">MyISAM</code> storage
    engine, and the <code class="literal">FOREIGN KEY</code> option is ignored.
    Now we insert some rows into the tables on the master:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>INSERT INTO fc1 VALUES (1, 1), (2, 2);</code></strong>
Query OK, 2 rows affected (0.09 sec)
Records: 2  Duplicates: 0  Warnings: 0

master&gt; <strong class="userinput"><code>INSERT INTO fc2 VALUES (1, 1), (2, 2), (3, 1);</code></strong>
Query OK, 3 rows affected (0.19 sec)
Records: 3  Duplicates: 0  Warnings: 0
</pre><p>
    At this point, on both the master and the slave, table
    <code class="literal">fc1</code> contains 2 rows, and table
    <code class="literal">fc2</code> contains 3 rows, as shown here:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc1;</code></strong>
+---+------+
| i | j    |
+---+------+
| 1 |    1 |
| 2 |    2 |
+---+------+
2 rows in set (0.00 sec)

slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+------+
| m | n    |
+---+------+
| 1 |    1 |
| 2 |    2 |
| 3 |    1 |
+---+------+
3 rows in set (0.00 sec)
</pre><p>
    Now suppose that you perform the following
    <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> statement on the master:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>DELETE FROM fc1 WHERE i=1;</code></strong>
Query OK, 1 row affected (0.09 sec)
</pre><p>
    Due to the cascade, table <code class="literal">fc2</code> on the master now
    contains only 1 row:
  </p><pre class="programlisting">
master&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 2 | 2 |
+---+---+
1 row in set (0.00 sec)
</pre><p>
    However, the cascade does not propagate on the slave because on the
    slave the <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> for
    <code class="literal">fc1</code> deletes no rows from <code class="literal">fc2</code>.
    The slave's copy of <code class="literal">fc2</code> still contains all of the
    rows that were originally inserted:
  </p><pre class="programlisting">
slave&gt; <strong class="userinput"><code>SELECT * FROM fc2;</code></strong>
+---+---+
| m | n |
+---+---+
| 1 | 1 |
| 3 | 1 |
| 2 | 2 |
+---+---+
3 rows in set (0.00 sec)
</pre><p>
    This difference is due to the fact that the cascading deletes are
    handled internally by the <code class="literal">InnoDB</code> storage engine,
    which means that none of the changes are logged.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both"><a name="innodb-troubleshooting"></a>14.20 InnoDB Troubleshooting</h2>

</div>

</div>

</div>
<div class="toc">
<dl class="toc"><dt><span class="section"><a href="innodb-storage-engine.html#error-creating-innodb">14.20.1 Troubleshooting InnoDB I/O Problems</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#forcing-innodb-recovery">14.20.2 Forcing InnoDB Recovery</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-troubleshooting-datadict">14.20.3 Troubleshooting InnoDB Data Dictionary Operations</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-handling">14.20.4 InnoDB Error Handling</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#innodb-error-codes">14.20.5 InnoDB Error Codes</a></span></dt><dt><span class="section"><a href="innodb-storage-engine.html#operating-system-error-codes">14.20.6 Operating System Error Codes</a></span></dt></dl>
</div>
<a class="indexterm" name="idm140301489863488"></a><p>
    The following general guidelines apply to troubleshooting
    <code class="literal">InnoDB</code> problems:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        When an operation fails or you suspect a bug, look at the MySQL
        server error log (see <a class="xref" href="server-administration.html#error-log" title="5.2.2 The Error Log">Section 5.2.2, “The Error Log”</a>).
      </p></li><li class="listitem"><p>
        If the failure is related to a
        <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>, run with the
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_print_all_deadlocks"><code class="literal">innodb_print_all_deadlocks</code></a>
        option enabled so that details about each
        <code class="literal">InnoDB</code> deadlock are printed to the MySQL
        server error log.
      </p></li><li class="listitem"><p>
        Issues relating to the <code class="literal">InnoDB</code> data dictionary
        include failed <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>
        statements (orphaned table files), inability to open
        <code class="filename">.InnoDB</code> files, and <span class="errortext">system cannot
        find the path specified</span> errors. For information
        about these sorts of problems and errors, see
        <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting-datadict" title="14.20.3 Troubleshooting InnoDB Data Dictionary Operations">Section 14.20.3, “Troubleshooting InnoDB Data Dictionary Operations”</a>.
      </p></li><li class="listitem"><p>
        When troubleshooting, it is usually best to run the MySQL server
        from the command prompt, rather than through
        <a class="link" href="programs.html#mysqld-safe" title="4.3.2 mysqld_safe — MySQL Server Startup Script"><span class="command"><strong>mysqld_safe</strong></span></a> or as a Windows service. You can
        then see what <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> prints to the console,
        and so have a better grasp of what is going on. On Windows,
        start <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> with the
        <a class="link" href="server-administration.html#option_mysqld_console"><code class="option">--console</code></a> option to direct the
        output to the console window.
      </p></li><li class="listitem"><p>
        <a class="indexterm" name="idm140301489843984"></a>

        <a class="indexterm" name="idm140301489842496"></a>

        Enable the <code class="literal">InnoDB</code> Monitors to obtain
        information about a problem (see
        <a class="xref" href="innodb-storage-engine.html#innodb-monitors" title="14.17 InnoDB Monitors">Section 14.17, “InnoDB Monitors”</a>). If the problem is
        performance-related, or your server appears to be hung, you
        should enable the standard Monitor to print information about
        the internal state of <code class="literal">InnoDB</code>. If the problem
        is with locks, enable the Lock Monitor. If the problem is in
        creation of tables or other data dictionary operations, enable
        the Table Monitor to print the contents of the
        <code class="literal">InnoDB</code> internal data dictionary. To see
        tablespace information enable the Tablespace Monitor.
      </p><p>
        <code class="literal">InnoDB</code> temporarily enables standard
        <code class="literal">InnoDB</code> Monitor output under the following
        conditions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
            A long semaphore wait
          </p></li><li class="listitem"><p>
            <code class="literal">InnoDB</code> cannot find free blocks in the
            buffer pool
          </p></li><li class="listitem"><p>
            Over 67% of the buffer pool is occupied by lock heaps or the
            adaptive hash index
</p></li></ul>
</div>
</li><li class="listitem"><p>
        If you suspect that a table is corrupt, run
        <a class="link" href="sql-syntax.html#check-table" title="13.7.2.2 CHECK TABLE Syntax"><code class="literal">CHECK TABLE</code></a> on that table.
</p></li></ul>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="error-creating-innodb"></a>14.20.1 Troubleshooting InnoDB I/O Problems</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489828432"></a><p>
      The troubleshooting steps for <code class="literal">InnoDB</code> I/O
      problems depend on when the problem occurs: during startup of the
      MySQL server, or during normal operations when a DML or DDL
      statement fails due to problems at the file system level.
</p>
<h4><a name="idm140301489825216"></a>Initialization Problems</h4>
<p>
      If something goes wrong when <code class="literal">InnoDB</code> attempts to
      initialize its tablespace or its log files, delete all files
      created by <code class="literal">InnoDB</code>: all
      <code class="filename">ibdata</code> files and all
      <code class="filename">ib_logfile</code> files. If you already created some
      <code class="literal">InnoDB</code> tables, also delete the corresponding
      <code class="filename">.frm</code> files for these tables, and any
      <code class="filename">.ibd</code> files if you are using multiple
      tablespaces, from the MySQL database directories. Then try the
      <code class="literal">InnoDB</code> database creation again. For easiest
      troubleshooting, start the MySQL server from a command prompt so
      that you see what is happening.
</p>
<h4><a name="idm140301489817952"></a>Runtime Problems</h4>
<p>
      If <code class="literal">InnoDB</code> prints an operating system error
      during a file operation, usually the problem has one of the
      following solutions:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Make sure the <code class="literal">InnoDB</code> data file directory
          and the <code class="literal">InnoDB</code> log directory exist.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> has access rights to
          create files in those directories.
        </p></li><li class="listitem"><p>
          Make sure <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> can read the proper
          <code class="filename">my.cnf</code> or <code class="filename">my.ini</code>
          option file, so that it starts with the options that you
          specified.
        </p></li><li class="listitem"><p>
          Make sure the disk is not full and you are not exceeding any
          disk quota.
        </p></li><li class="listitem"><p>
          Make sure that the names you specify for subdirectories and
          data files do not clash.
        </p></li><li class="listitem"><p>
          Doublecheck the syntax of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_home_dir"><code class="literal">innodb_data_home_dir</code></a> and
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> values.
          In particular, any <code class="literal">MAX</code> value in the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_data_file_path"><code class="literal">innodb_data_file_path</code></a> option
          is a hard limit, and exceeding that limit causes a fatal
          error.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="forcing-innodb-recovery"></a>14.20.2 Forcing InnoDB Recovery</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489799264"></a><a class="indexterm" name="idm140301489797360"></a><a class="indexterm" name="idm140301489795904"></a><p>
      To investigate database page corruption, you might dump your
      tables from the database with
      <a class="link" href="sql-syntax.html#select-into" title="13.2.9.1 SELECT ... INTO Syntax"><code class="literal">SELECT ... INTO
      OUTFILE</code></a>. Usually, most of the data obtained in this way
      is intact. Serious corruption might cause <code class="literal">SELECT * FROM
      <em class="replaceable"><code>tbl_name</code></em></code> statements or
      <code class="literal">InnoDB</code> background operations to crash or
      assert, or even cause <code class="literal">InnoDB</code> roll-forward
      recovery to crash. In such cases, you can use the
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> option to
      force the <code class="literal">InnoDB</code> storage engine to start up
      while preventing background operations from running, so that you
      can dump your tables. For example, you can add the following line
      to the <code class="literal">[mysqld]</code> section of your option file
      before restarting the server:
    </p><pre class="programlisting">
[mysqld]
innodb_force_recovery = 1
</pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">

<div class="admon-title">
Warning
</div>
<p>
        Only set <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
        to a value greater than 0 in an emergency situation, so that you
        can start <code class="literal">InnoDB</code> and dump your tables. Before
        doing so, ensure that you have a backup copy of your database in
        case you need to recreate it. Values of 4 or greater can
        permanently corrupt data files. Only use an
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> setting
        of 4 or greater on a production server instance after you have
        successfully tested the setting on separate physical copy of
        your database. When forcing <code class="literal">InnoDB</code> recovery,
        you should always start with
        <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery=1</code></a> and
        only increase the value incrementally, as necessary.
</p>
</div>
<p>
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is 0 by
      default (normal startup without forced recovery). The permissible
      nonzero values for
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> are 1 to 6.
      A larger value includes the functionality of lesser values. For
      example, a value of 3 includes all of the functionality of values
      1 and 2.
    </p><p>
      If you are able to dump your tables with an
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> value of 3
      or less, then you are relatively safe that only some data on
      corrupt individual pages is lost. A value of 4 or greater is
      considered dangerous because data files can be permanently
      corrupted. A value of 6 is considered drastic because database
      pages are left in an obsolete state, which in turn may introduce
      more corruption into B-trees and other database structures.
    </p><p>
      As a safety measure, <code class="literal">InnoDB</code> prevents
      <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>,
      <a class="link" href="sql-syntax.html#update" title="13.2.11 UPDATE Syntax"><code class="literal">UPDATE</code></a>, or
      <a class="link" href="sql-syntax.html#delete" title="13.2.2 DELETE Syntax"><code class="literal">DELETE</code></a> operations when
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> is greater
      than 0.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">1</code>
          (<code class="literal">SRV_FORCE_IGNORE_CORRUPT</code>)
        </p><p>
          Lets the server run even if it detects a corrupt
          <a class="link" href="glossary.html#glos_page" title="page">page</a>. Tries to make
          <code class="literal">SELECT * FROM
          <em class="replaceable"><code>tbl_name</code></em></code> jump over
          corrupt index records and pages, which helps in dumping
          tables.
        </p></li><li class="listitem"><p>
          <code class="literal">2</code>
          (<code class="literal">SRV_FORCE_NO_BACKGROUND</code>)
        </p><p>
          Prevents the <a class="link" href="glossary.html#glos_master_thread" title="master thread">master
          thread</a> and any <a class="link" href="glossary.html#glos_purge_thread" title="purge thread">purge
          threads</a> from running. If a crash would occur during the
          <a class="link" href="glossary.html#glos_purge" title="purge">purge</a> operation, this
          recovery value prevents it.
        </p></li><li class="listitem"><p>
          <code class="literal">3</code>
          (<code class="literal">SRV_FORCE_NO_TRX_UNDO</code>)
        </p><p>
          Does not run transaction
          <a class="link" href="glossary.html#glos_rollback" title="rollback">rollbacks</a> after
          <a class="link" href="glossary.html#glos_crash_recovery" title="crash recovery">crash recovery</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">4</code>
          (<code class="literal">SRV_FORCE_NO_IBUF_MERGE</code>)
        </p><p>
          Prevents <a class="link" href="glossary.html#glos_insert_buffer" title="insert buffer">insert
          buffer</a> merge operations. If they would cause a crash,
          does not do them. Does not calculate table
          <a class="link" href="glossary.html#glos_statistics" title="statistics">statistics</a>. This value
          can permanently corrupt data files. After using this value, be
          prepared to drop and recreate all secondary indexes.
        </p></li><li class="listitem"><p>
          <code class="literal">5</code>
          (<code class="literal">SRV_FORCE_NO_UNDO_LOG_SCAN</code>)
        </p><p>
          Does not look at <a class="link" href="glossary.html#glos_undo_log" title="undo log">undo
          logs</a> when starting the database:
          <code class="literal">InnoDB</code> treats even incomplete transactions
          as committed. This value can permanently corrupt data files.
        </p></li><li class="listitem"><p>
          <code class="literal">6</code>
          (<code class="literal">SRV_FORCE_NO_LOG_REDO</code>)
        </p><p>
          Does not do the <a class="link" href="glossary.html#glos_redo_log" title="redo log">redo log</a>
          roll-forward in connection with recovery. This value can
          permanently corrupt data files. Leaves database pages in an
          obsolete state, which in turn may introduce more corruption
          into B-trees and other database structures.
</p></li></ul>
</div>
<p>
      You can <a class="link" href="sql-syntax.html#select" title="13.2.9 SELECT Syntax"><code class="literal">SELECT</code></a> from tables to dump
      them, or <code class="literal">DROP</code> or <code class="literal">CREATE</code>
      tables even if forced recovery is used. If you know that a given
      table is causing a crash on rollback, you can drop it. You can
      also use this to stop a runaway rollback caused by a failing mass
      import or <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a>: kill the
      <a class="link" href="programs.html#mysqld" title="4.3.1 mysqld — The MySQL Server"><span class="command"><strong>mysqld</strong></span></a> process and set
      <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a> to
      <code class="literal">3</code> to bring the database up without the
      rollback, then <code class="literal">DROP</code> the table that is causing
      the runaway rollback.
    </p><p>
      If corruption within the table data prevents you from dumping the
      entire table contents, a query with an <code class="literal">ORDER BY
      <em class="replaceable"><code>primary_key</code></em> DESC</code> clause might
      be able to dump the portion of the table after the corrupted part.
    </p><p>
      If a high <a class="link" href="innodb-storage-engine.html#sysvar_innodb_force_recovery"><code class="literal">innodb_force_recovery</code></a>
      value is required to start <code class="literal">InnoDB</code>, there may be
      corrupted data structures that could cause complex queries
      (queries containing <code class="literal">WHERE</code>, <code class="literal">ORDER
      BY</code>, or other clauses) to fail. In this case, you may
      only be able to run basic <code class="literal">SELECT * FROM t</code>
      queries.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-troubleshooting-datadict"></a>14.20.3 Troubleshooting InnoDB Data Dictionary Operations</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489724688"></a><p>
      Information about table definitions is stored both in the
      <code class="literal">.frm</code> files, and in the InnoDB
      <a class="link" href="glossary.html#glos_data_dictionary" title="data dictionary">data dictionary</a>. If
      you move <code class="filename">.frm</code> files around, or if the server
      crashes in the middle of a data dictionary operation, these
      sources of information can become inconsistent.
    </p><p>
      If a data dictionary corruption or consistency issue prevents you
      from starting <code class="literal">InnoDB</code>, see
      <a class="xref" href="innodb-storage-engine.html#forcing-innodb-recovery" title="14.20.2 Forcing InnoDB Recovery">Section 14.20.2, “Forcing InnoDB Recovery”</a> for information about
      manual recovery.
</p>
<h4><a name="idm140301489717968"></a>Problem with CREATE TABLE</h4>
<p>
      A symptom of an out-of-sync data dictionary is that a
      <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a> statement fails. If
      this occurs, look in the server's error log. If the log says that
      the table already exists inside the <code class="literal">InnoDB</code>
      internal data dictionary, you have an orphaned table inside the
      <code class="literal">InnoDB</code> tablespace files that has no
      corresponding <code class="filename">.frm</code> file. The error message
      looks like this:
    </p><pre class="programlisting">
InnoDB: Error: table test/parent already exists in InnoDB internal
InnoDB: data dictionary. Have you deleted the .frm file
InnoDB: and not used DROP TABLE? Have you used DROP DATABASE
InnoDB: for InnoDB tables in MySQL version &lt;= 3.23.43?
InnoDB: See the Restrictions section of the InnoDB manual.
InnoDB: You can drop the orphaned table inside InnoDB by
InnoDB: creating an InnoDB table with the same name in another
InnoDB: database and moving the .frm file to the current database.
InnoDB: Then MySQL thinks the table exists, and DROP TABLE will
InnoDB: succeed.
</pre><p>
      You can drop the orphaned table by following the instructions
      given in the error message. If you are still unable to use
      <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> successfully, the
      problem may be due to name completion in the
      <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client. To work around this problem,
      start the <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> client with the
      <a class="link" href="programs.html#option_mysql_auto-rehash"><code class="option">--skip-auto-rehash</code></a>
      option and try <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> again.
      (With name completion on, <a class="link" href="programs.html#mysql" title="4.5.1 mysql — The MySQL Command-Line Tool"><span class="command"><strong>mysql</strong></span></a> tries to
      construct a list of table names, which fails when a problem such
      as just described exists.)
</p>
<h4><a name="idm140301489702992"></a>Problem Opening Table</h4>
<p>
      Another symptom of an out-of-sync data dictionary is that MySQL
      prints an error that it cannot open a <code class="filename">.InnoDB</code>
      file:
    </p><pre class="programlisting">
ERROR 1016: Can't open file: 'child2.InnoDB'. (errno: 1)
</pre><p>
      In the error log you can find a message like this:
    </p><pre class="programlisting">
InnoDB: Cannot find table test/child2 from the internal data dictionary
InnoDB: of InnoDB though the .frm file for the table exists. Maybe you
InnoDB: have deleted and recreated InnoDB data files but have forgotten
InnoDB: to delete the corresponding .frm files of InnoDB tables?
</pre><p>
      This means that there is an orphaned <code class="filename">.frm</code>
      file without a corresponding table inside
      <code class="literal">InnoDB</code>. You can drop the orphaned
      <code class="filename">.frm</code> file by deleting it manually.
</p><a class="indexterm" name="idm140301489696240"></a><a class="indexterm" name="idm140301489694752"></a><a class="indexterm" name="idm140301489693264"></a>
<h4><a name="idm140301489691776"></a>Orphaned Intermediate Tables</h4>
<p>
      If MySQL crashes in the middle of an <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER
      TABLE</code></a> operation, you may be left with an orphaned
      intermediate table. Intermediate table names begin with
      <span class="quote">“<span class="quote">#sql-</span>”</span>. In your data directory you will see an
      <code class="filename">#sql-*.ibd</code> file and an accompanying
      <code class="filename">#sql-*.frm</code> file with the same name. The
      intermediate table is also listed in
      <a class="link" href="innodb-storage-engine.html#innodb-monitors" title="14.17 InnoDB Monitors">Table Monitor</a> output.
    </p><p>
      If both the <code class="filename">#sql-*.ibd</code> and
      <code class="filename">#sql-*.frm</code> files appear in your data
      directory, drop the intermediate table by issuing a <code class="literal">DROP
      TABLE</code> statement, prefixing the name of the table with
      <code class="literal">#mysql50#</code> and enclosing the table name in
      backticks. For example:
    </p><pre class="programlisting">mysql&gt; DROP TABLE `#mysql50##sql-1291_3`;
Query OK, 0 rows affected (0.01 sec)</pre><p>
      The <code class="literal">#mysql50#</code> prefix tells MySQL to ignore
      <code class="literal">file name safe encoding</code> introduced in MySQL
      5.1. Enclosing the table name in backticks is required to perform
      SQL statements on table names with special characters such as
      <span class="quote">“<span class="quote">#</span>”</span>.
    </p><p>
      If there is no table format file (<code class="filename">#sql-*.frm</code>
      file) in your data directory or the <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP
      TABLE</code></a> operation fails, create a new
      <code class="literal">.frm</code> file that matches the table schema of the
      <code class="filename">#sql-*.ibd</code> file (it must have the same
      columns and indexes defined). To do this, perform the following
      steps:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Determine if the <code class="filename">#sql-*.ibd</code> file has a
          pre-<code class="literal">ALTER</code> or post-<code class="literal">ALTER</code>
          schema definition. You can view the columns and indexes of the
          intermediate table using the
          <a class="link" href="innodb-storage-engine.html#innodb-monitors" title="14.17 InnoDB Monitors">Table Monitor</a>.
        </p></li><li class="listitem"><p>
          Once you have determined if the
          <code class="filename">#sql-*.ibd</code> file has a
          pre-<code class="literal">ALTER</code> or post-<code class="literal">ALTER</code>
          schema definition, create a matching
          <code class="filename">#sql-*.frm</code> file in a different database
          directory. For example, if an intermediate table has a
          post-<code class="literal">ALTER</code> schema definition, create an
          <code class="literal">.frm</code> file that matches the altered schema
          definition:
        </p><pre class="programlisting">mysql&gt; CREATE TABLE tmp LIKE employees.salaries; ALTER TABLE tmp DROP COLUMN to_date;
Query OK, 0 rows affected (0.02 sec)
      
Query OK, 0 rows affected (0.06 sec)
Records: 0  Duplicates: 0  Warnings: 0    </pre></li><li class="listitem"><p>
          Copy the <code class="literal">.frm</code> file to the database
          directory where the orphaned table is located and rename it to
          match the name of the <code class="filename">#sql-*.ibd</code> file
        </p><pre class="programlisting">shell&gt; cp tmp.frm employees/#sql-sql-1291_3.frm</pre></li><li class="listitem"><p>
          Drop the intermediate table by issuing a
          <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> statement, prefixing
          the name of the table with <code class="literal">#mysql50#</code> and
          enclosing the table name in backticks. For example:
        </p><pre class="programlisting">mysql&gt; DROP TABLE `#mysql50##sql-1291_3`;
Query OK, 0 rows affected (0.01 sec)</pre></li></ol>
</div>
<h4><a name="idm140301489657456"></a>Problem with Missing Tablespace</h4>
<p>
      With <a class="link" href="innodb-storage-engine.html#sysvar_innodb_file_per_table"><code class="literal">innodb_file_per_table</code></a>
      enabled, the following message might occur if the
      <code class="literal">.frm</code> or <code class="literal">.ibd</code> files (or both)
      are missing:
    </p><pre class="programlisting">
InnoDB: in InnoDB data dictionary has tablespace id <em class="replaceable"><code>N</code></em>,
InnoDB: but tablespace with that id or name does not exist. Have
InnoDB: you deleted or moved .ibd files?
InnoDB: This may also be a table created with CREATE TEMPORARY TABLE
InnoDB: whose .ibd and .frm files MySQL automatically removed, but the
InnoDB: table still exists in the InnoDB internal data dictionary.
</pre><p>
      If this occurs, try the following procedure to resolve the
      problem:
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1"><li class="listitem"><p>
          Create a matching <code class="filename">.frm</code> file in some other
          database directory and copy it to the database directory where
          the orphan table is located.
        </p></li><li class="listitem"><p>
          Issue <a class="link" href="sql-syntax.html#drop-table" title="13.1.28 DROP TABLE Syntax"><code class="literal">DROP TABLE</code></a> for the
          original table. That should successfully drop the table and
          <code class="literal">InnoDB</code> should print a warning to the error
          log that the <code class="filename">.ibd</code> file was missing.
</p></li></ol>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-error-handling"></a>14.20.4 InnoDB Error Handling</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489643024"></a><a class="indexterm" name="idm140301489641120"></a><p>
      Error handling in <code class="literal">InnoDB</code> is not always the same
      as specified in the SQL standard. According to the standard, any
      error during an SQL statement should cause rollback of that
      statement. <code class="literal">InnoDB</code> sometimes rolls back only
      part of the statement, or the whole transaction. The following
      items describe how <code class="literal">InnoDB</code> performs error
      handling:
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          If you run out of file space in a
          <a class="link" href="glossary.html#glos_tablespace" title="tablespace">tablespace</a>, a MySQL
          <code class="literal">Table is full</code> error occurs and
          <code class="literal">InnoDB</code> rolls back the SQL statement.
        </p></li><li class="listitem"><p>
          A transaction <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>
          causes <code class="literal">InnoDB</code> to
          <a class="link" href="glossary.html#glos_rollback" title="rollback">roll back</a> the entire
          <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>. Retry the
          whole transaction when this happens.
        </p><p>
          A lock wait timeout causes <code class="literal">InnoDB</code> to roll
          back only the single statement that was waiting for the lock
          and encountered the timeout. (To have the entire transaction
          roll back, start the server with the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>
          option.) Retry the statement if using the current behavior, or
          the entire transaction if using
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_rollback_on_timeout"><code class="option">--innodb_rollback_on_timeout</code></a>.
        </p><p>
          Both deadlocks and lock wait timeouts are normal on busy
          servers and it is necessary for applications to be aware that
          they may happen and handle them by retrying. You can make them
          less likely by doing as little work as possible between the
          first change to data during a transaction and the commit, so
          the locks are held for the shortest possible time and for the
          smallest possible number of rows. Sometimes splitting work
          between different transactions may be practical and helpful.
        </p><p>
          When a transaction rollback occurs due to a deadlock or lock
          wait timeout, it cancels the effect of the statements within
          the transaction. But if the start-transaction statement was
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">START
          TRANSACTION</code></a> or
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">BEGIN</code></a>
          statement, rollback does not cancel that statement. Further
          SQL statements become part of the transaction until the
          occurrence of <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">COMMIT</code></a>,
          <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a>, or
          some SQL statement that causes an implicit commit.
        </p></li><li class="listitem"><p>
          A duplicate-key error rolls back the SQL statement, if you
          have not specified the <code class="literal">IGNORE</code> option in
          your statement.
        </p></li><li class="listitem"><p>
          A <code class="literal">row too long error</code> rolls back the SQL
          statement.
        </p></li><li class="listitem"><p>
          Other errors are mostly detected by the MySQL layer of code
          (above the <code class="literal">InnoDB</code> storage engine level),
          and they roll back the corresponding SQL statement. Locks are
          not released in a rollback of a single SQL statement.
</p></li></ul>
</div>
<p>
      During implicit rollbacks, as well as during the execution of an
      explicit
      <a class="link" href="sql-syntax.html#commit" title="13.3.1 START TRANSACTION, COMMIT, and ROLLBACK Syntax"><code class="literal">ROLLBACK</code></a> SQL
      statement, <a class="link" href="sql-syntax.html#show-processlist" title="13.7.5.30 SHOW PROCESSLIST Syntax"><code class="literal">SHOW PROCESSLIST</code></a>
      displays <code class="literal">Rolling back</code> in the
      <code class="literal">State</code> column for the relevant connection.
</p>
</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="innodb-error-codes"></a>14.20.5 InnoDB Error Codes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489607520"></a><p>
      The following is a nonexhaustive list of common
      <code class="literal">InnoDB</code>-specific errors that you may encounter,
      with information about why each occurs and how to resolve the
      problem.
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">1005 (ER_CANT_CREATE_TABLE)</code>
        </p><p>
          Cannot create table. If the error message refers to error 150,
          table creation failed because a
          <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
          constraint</a> was not correctly formed. If the error
          message refers to error −1, table creation probably
          failed because the table includes a column name that matched
          the name of an internal <code class="literal">InnoDB</code> table.
        </p></li><li class="listitem"><p>
          <code class="literal">1016 (ER_CANT_OPEN_FILE)</code>
        </p><p>
          Cannot find the <code class="literal">InnoDB</code> table from the
          <code class="literal">InnoDB</code> <a class="link" href="glossary.html#glos_data_files" title="data files">data
          files</a>, although the <code class="filename">.frm</code> file for
          the table exists. See
          <a class="xref" href="innodb-storage-engine.html#innodb-troubleshooting-datadict" title="14.20.3 Troubleshooting InnoDB Data Dictionary Operations">Section 14.20.3, “Troubleshooting InnoDB Data Dictionary Operations”</a>.
        </p></li><li class="listitem"><p>
          <code class="literal">ERROR 1025 (HY000): Error on rename of
          '<em class="replaceable"><code>./db2/#sql-18eb_3</code></em>' to
          '<em class="replaceable"><code>./db2/foo</code></em>'(errno: 150)</code>
        </p><p>
          This error message is reported when you attempt to drop the
          last index that can enforce a particular referential
          constraint. As of MySQL 5.5, this error message has been
          replaced by <code class="literal">ERROR 1553</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">1114 (ER_RECORD_FILE_FULL)</code>
        </p><p>
          <code class="literal">InnoDB</code> has run out of free space in the
          tablespace. Reconfigure the tablespace to add a new data file.
        </p></li><li class="listitem"><p>
          <code class="literal">1205 (ER_LOCK_WAIT_TIMEOUT)</code>
        </p><p>
          Lock wait timeout expired. The statement that waited too long
          was <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled back</a> (not the
          entire <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>).
          You can increase the value of the
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_lock_wait_timeout"><code class="literal">innodb_lock_wait_timeout</code></a>
          configuration option if SQL statements should wait longer for
          other transactions to complete, or decrease it if too many
          long-running transactions are causing
          <a class="link" href="glossary.html#glos_locking" title="locking">locking</a> problems and
          reducing <a class="link" href="glossary.html#glos_concurrency" title="concurrency">concurrency</a>
          on a busy system.
        </p></li><li class="listitem"><p>
          <code class="literal">1206 (ER_LOCK_TABLE_FULL)</code>
        </p><p>
          The total number of locks exceeds the amount of memory
          <code class="literal">InnoDB</code> devotes to managing locks. To avoid
          this error, increase the value of
          <a class="link" href="innodb-storage-engine.html#sysvar_innodb_buffer_pool_size"><code class="literal">innodb_buffer_pool_size</code></a>.
          Within an individual application, a workaround may be to break
          a large operation into smaller pieces. For example, if the
          error occurs for a large
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a>, perform several smaller
          <a class="link" href="sql-syntax.html#insert" title="13.2.5 INSERT Syntax"><code class="literal">INSERT</code></a> operations.
        </p></li><li class="listitem"><p>
          <code class="literal">1213 (ER_LOCK_DEADLOCK)</code>
        </p><p>
          The <a class="link" href="glossary.html#glos_transaction" title="transaction">transaction</a>
          encountered a <a class="link" href="glossary.html#glos_deadlock" title="deadlock">deadlock</a>
          and was automatically <a class="link" href="glossary.html#glos_rollback" title="rollback">rolled
          back</a> so that your application could take corrective
          action. To recover from this error, run all the operations in
          this transaction again. A deadlock occurs when requests for
          locks arrive in inconsistent order between transactions. The
          transaction that was rolled back released all its locks, and
          the other transaction can now get all the locks it requested.
          Thus when you re-run the transaction that was rolled back, it
          might have to wait for other transactions to complete, but
          typically the deadlock does not recur. If you encounter
          frequent deadlocks, make the sequence of locking operations
          (<code class="literal">LOCK TABLES</code>, <code class="literal">SELECT ... FOR
          UPDATE</code>, and so on) consistent between the different
          transactions or applications that experience the issue. See
          <a class="xref" href="innodb-storage-engine.html#innodb-deadlocks" title="14.5.11 How to Cope with Deadlocks">Section 14.5.11, “How to Cope with Deadlocks”</a> for details.
        </p></li><li class="listitem"><p>
          <code class="literal">1216 (ER_NO_REFERENCED_ROW)</code>
        </p><p>
          You are trying to add a row but there is no parent row, and a
          <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
          constraint</a> fails. Add the parent row first.
        </p></li><li class="listitem"><p>
          <code class="literal">1217 (ER_ROW_IS_REFERENCED)</code>
        </p><p>
          You are trying to delete a parent row that has children, and a
          <a class="link" href="glossary.html#glos_foreign_key_constraint" title="FOREIGN KEY constraint">foreign key
          constraint</a> fails. Delete the children first.
        </p></li><li class="listitem"><p>
          <code class="literal">ERROR 1553 (HY000): Cannot drop index
          '<em class="replaceable"><code>fooIdx</code></em>': needed in a foreign key
          constraint</code>
        </p><p>
          This error message, which replaces <code class="literal">ERROR
          1025</code>, is reported when you attempt to drop the last
          index that can enforce a particular referential constraint.
        </p><p>
          For optimal performance with DML statements,
          <code class="literal">InnoDB</code> requires an index to exist on
          <a class="link" href="glossary.html#glos_foreign_key" title="foreign key">foreign key</a> columns,
          so that <code class="literal">UPDATE</code> and
          <code class="literal">DELETE</code> operations on a
          <a class="link" href="glossary.html#glos_parent_table" title="parent table">parent table</a> can
          easily check whether corresponding rows exist in the
          <a class="link" href="glossary.html#glos_child_table" title="child table">child table</a>. MySQL
          creates or drops such indexes automatically when needed, as a
          side-effect of <a class="link" href="sql-syntax.html#create-table" title="13.1.17 CREATE TABLE Syntax"><code class="literal">CREATE TABLE</code></a>,
          <a class="link" href="sql-syntax.html#create-index" title="13.1.13 CREATE INDEX Syntax"><code class="literal">CREATE INDEX</code></a>, and
          <a class="link" href="sql-syntax.html#alter-table" title="13.1.7 ALTER TABLE Syntax"><code class="literal">ALTER TABLE</code></a> statements.
        </p><p>
          When you drop an index, <code class="literal">InnoDB</code> checks
          whether the index is not used for checking a foreign key
          constraint. It is still OK to drop the index if there is
          another index that can be used to enforce the same constraint.
          <code class="literal">InnoDB</code> prevents you from dropping the last
          index that can enforce a particular referential constraint.
        </p></li><li class="listitem"><p>
          <code class="literal">ERROR 42000: This table type requires a primary
          key</code>
        </p><p>
          Prior to MySQL 5.5, this error would be reported when
          attempting to drop an implicit
          <a class="link" href="glossary.html#glos_clustered_index" title="clustered index">clustered index</a>
          (the first <code class="literal">UNIQUE NOT NULL</code> index) if the
          table did not contain a PRIMARY KEY.
        </p><p>
          This error should no longer be reported as of MySQL 5.5. For
          tables without an explicit <code class="literal">PRIMARY KEY</code>,
          <code class="literal">InnoDB</code> creates an implicit clustered index
          using the first columns of the table that are declared
          <code class="literal">UNIQUE</code> and <code class="literal">NOT NULL</code>.
          When you drop such an index, <code class="literal">InnoDB</code> now
          automatically copies the table and rebuilds the index using a
          different <code class="literal">UNIQUE NOT NULL</code> group of columns
          or a system-generated key. Since this operation changes the
          primary key, it uses the slow method of copying the table and
          re-creating the index, rather than the Fast Index Creation
          technique from
          <a class="xref" href="innodb-storage-engine.html#innodb-create-index-implementation" title="14.13.3 Implementation Details of Fast Index Creation">Section 14.13.3, “Implementation Details of Fast Index Creation”</a>.
</p></li></ul>
</div>

</div>
<div class="section">
<div class="titlepage">
<div>
<div>
<h3 class="title"><a name="operating-system-error-codes"></a>14.20.6 Operating System Error Codes</h3>

</div>

</div>

</div>
<a class="indexterm" name="idm140301489534096"></a><a class="indexterm" name="idm140301489532192"></a><p>
      To print the error message for an operating system error number,
      you can use one of the following options. The
      <a class="link" href="programs.html#perror" title="4.8.1 perror — Explain Error Codes"><span class="command"><strong>perror</strong></span></a> program is provided with the MySQL
      distribution.
    </p><pre class="programlisting">
$ perror 123
$ perl -MPOSIX -le 'print strerror 123'
$ python -c 'import os; print os.strerror(123)'
</pre>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a name="operating-system-error-codes-linux"></a>
          <span class="bold"><strong>Linux System Error Codes</strong></span>
        </p><p>
          The following table provides a partial list of Linux system
          error codes.
</p>
<div class="informaltable">
<table summary=" Linux error codes associated with InnoDB file
operations and other system calls. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Number</th><th scope="col">Macro</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row">1</td><td><code class="literal">EPERM</code></td><td>Operation not permitted</td></tr><tr><td scope="row">2</td><td><code class="literal">ENOENT</code></td><td>No such file or directory</td></tr><tr><td scope="row">3</td><td><code class="literal">ESRCH</code></td><td>No such process</td></tr><tr><td scope="row">4</td><td><code class="literal">EINTR</code></td><td>Interrupted system call</td></tr><tr><td scope="row">5</td><td><code class="literal">EIO</code></td><td>I/O error</td></tr><tr><td scope="row">6</td><td><code class="literal">ENXIO</code></td><td>No such device or address</td></tr><tr><td scope="row">7</td><td><code class="literal">E2BIG</code></td><td>Arg list too long</td></tr><tr><td scope="row">8</td><td><code class="literal">ENOEXEC</code></td><td>Exec format error</td></tr><tr><td scope="row">9</td><td><code class="literal">EBADF</code></td><td>Bad file number</td></tr><tr><td scope="row">10</td><td><code class="literal">ECHILD</code></td><td>No child processes</td></tr><tr><td scope="row">11</td><td><code class="literal">EAGAIN</code></td><td>Try again</td></tr><tr><td scope="row">12</td><td><code class="literal">ENOMEM</code></td><td>Out of memory</td></tr><tr><td scope="row">13</td><td><code class="literal">EACCES</code></td><td>Permission denied</td></tr><tr><td scope="row">14</td><td><code class="literal">EFAULT</code></td><td>Bad address</td></tr><tr><td scope="row">15</td><td><code class="literal">ENOTBLK</code></td><td>Block device required</td></tr><tr><td scope="row">16</td><td><code class="literal">EBUSY</code></td><td>Device or resource busy</td></tr><tr><td scope="row">17</td><td><code class="literal">EEXIST</code></td><td>File exists</td></tr><tr><td scope="row">18</td><td><code class="literal">EXDEV</code></td><td>Cross-device link</td></tr><tr><td scope="row">19</td><td><code class="literal">ENODEV</code></td><td>No such device</td></tr><tr><td scope="row">20</td><td><code class="literal">ENOTDIR</code></td><td>Not a directory</td></tr><tr><td scope="row">21</td><td><code class="literal">EISDIR</code></td><td>Is a directory</td></tr><tr><td scope="row">22</td><td><code class="literal">EINVAL</code></td><td>Invalid argument</td></tr><tr><td scope="row">23</td><td><code class="literal">ENFILE</code></td><td>File table overflow</td></tr><tr><td scope="row">24</td><td><code class="literal">EMFILE</code></td><td>Too many open files</td></tr><tr><td scope="row">25</td><td><code class="literal">ENOTTY</code></td><td>Inappropriate ioctl for device</td></tr><tr><td scope="row">26</td><td><code class="literal">ETXTBSY</code></td><td>Text file busy</td></tr><tr><td scope="row">27</td><td><code class="literal">EFBIG</code></td><td>File too large</td></tr><tr><td scope="row">28</td><td><code class="literal">ENOSPC</code></td><td>No space left on device</td></tr><tr><td scope="row">29</td><td><code class="literal">ESPIPE</code></td><td>File descriptor does not allow seeking</td></tr><tr><td scope="row">30</td><td><code class="literal">EROFS</code></td><td>Read-only file system</td></tr><tr><td scope="row">31</td><td><code class="literal">EMLINK</code></td><td>Too many links</td></tr></tbody></table>
</div>
</li><li class="listitem"><p><a name="operating-system-error-codes-windows"></a>
          <span class="bold"><strong>Windows System Error Codes</strong></span>
        </p><p>
          The following table provides a list of some common Windows
          system error codes. For a complete list, see the
          <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms681381.aspx" target="_top">Microsoft
          Web site</a>.
</p>
<div class="informaltable">
<table summary=" Windows error codes associated with InnoDB file
            operations and other system calls. " border="1"><colgroup><col><col><col></colgroup><thead><tr><th scope="col">Number</th><th scope="col">Macro</th><th scope="col">Description</th></tr></thead><tbody><tr><td scope="row">1</td><td><code class="literal">ERROR_INVALID_FUNCTION</code></td><td>Incorrect function.</td></tr><tr><td scope="row">2</td><td><code class="literal">ERROR_FILE_NOT_FOUND</code></td><td>The system cannot find the file specified.</td></tr><tr><td scope="row">3</td><td><code class="literal">ERROR_PATH_NOT_FOUND</code></td><td>The system cannot find the path specified.</td></tr><tr><td scope="row">4</td><td><code class="literal">ERROR_TOO_MANY_OPEN_FILES</code></td><td>The system cannot open the file.</td></tr><tr><td scope="row">5</td><td><code class="literal">ERROR_ACCESS_DENIED</code></td><td>Access is denied.</td></tr><tr><td scope="row">6</td><td><code class="literal">ERROR_INVALID_HANDLE</code></td><td>The handle is invalid.</td></tr><tr><td scope="row">7</td><td><code class="literal">ERROR_ARENA_TRASHED</code></td><td>The storage control blocks were destroyed.</td></tr><tr><td scope="row">8</td><td><code class="literal">ERROR_NOT_ENOUGH_MEMORY</code></td><td>Not enough storage is available to process this command.</td></tr><tr><td scope="row">9</td><td><code class="literal">ERROR_INVALID_BLOCK</code></td><td>The storage control block address is invalid.</td></tr><tr><td scope="row">10</td><td><code class="literal">ERROR_BAD_ENVIRONMENT</code></td><td>The environment is incorrect.</td></tr><tr><td scope="row">11</td><td><code class="literal">ERROR_BAD_FORMAT</code></td><td>An attempt was made to load a program with an incorrect format.</td></tr><tr><td scope="row">12</td><td><code class="literal">ERROR_INVALID_ACCESS</code></td><td>The access code is invalid.</td></tr><tr><td scope="row">13</td><td><code class="literal">ERROR_INVALID_DATA</code></td><td>The data is invalid.</td></tr><tr><td scope="row">14</td><td><code class="literal">ERROR_OUTOFMEMORY</code></td><td>Not enough storage is available to complete this operation.</td></tr><tr><td scope="row">15</td><td><code class="literal">ERROR_INVALID_DRIVE</code></td><td>The system cannot find the drive specified.</td></tr><tr><td scope="row">16</td><td><code class="literal">ERROR_CURRENT_DIRECTORY</code></td><td>The directory cannot be removed.</td></tr><tr><td scope="row">17</td><td><code class="literal">ERROR_NOT_SAME_DEVICE</code></td><td>The system cannot move the file to a different disk drive.</td></tr><tr><td scope="row">18</td><td><code class="literal">ERROR_NO_MORE_FILES</code></td><td>There are no more files.</td></tr><tr><td scope="row">19</td><td><code class="literal">ERROR_WRITE_PROTECT</code></td><td>The media is write protected.</td></tr><tr><td scope="row">20</td><td><code class="literal">ERROR_BAD_UNIT</code></td><td>The system cannot find the device specified.</td></tr><tr><td scope="row">21</td><td><code class="literal">ERROR_NOT_READY</code></td><td>The device is not ready.</td></tr><tr><td scope="row">22</td><td><code class="literal">ERROR_BAD_COMMAND</code></td><td>The device does not recognize the command.</td></tr><tr><td scope="row">23</td><td><code class="literal">ERROR_CRC</code></td><td>Data error (cyclic redundancy check).</td></tr><tr><td scope="row">24</td><td><code class="literal">ERROR_BAD_LENGTH</code></td><td>The program issued a command but the command length is incorrect.</td></tr><tr><td scope="row">25</td><td><code class="literal">ERROR_SEEK</code></td><td>The drive cannot locate a specific area or track on the disk.</td></tr><tr><td scope="row">26</td><td><code class="literal">ERROR_NOT_DOS_DISK</code></td><td>The specified disk or diskette cannot be accessed.</td></tr><tr><td scope="row">27</td><td><code class="literal">ERROR_SECTOR_NOT_FOUND</code></td><td>The drive cannot find the sector requested.</td></tr><tr><td scope="row">28</td><td><code class="literal">ERROR_OUT_OF_PAPER</code></td><td>The printer is out of paper.</td></tr><tr><td scope="row">29</td><td><code class="literal">ERROR_WRITE_FAULT</code></td><td>The system cannot write to the specified device.</td></tr><tr><td scope="row">30</td><td><code class="literal">ERROR_READ_FAULT</code></td><td>The system cannot read from the specified device.</td></tr><tr><td scope="row">31</td><td><code class="literal">ERROR_GEN_FAILURE</code></td><td>A device attached to the system is not functioning.</td></tr><tr><td scope="row">32</td><td><code class="literal">ERROR_SHARING_VIOLATION</code></td><td>The process cannot access the file because it is being used by another
                  process.</td></tr><tr><td scope="row">33</td><td><code class="literal">ERROR_LOCK_VIOLATION</code></td><td>The process cannot access the file because another process has locked a
                  portion of the file.</td></tr><tr><td scope="row">34</td><td><code class="literal">ERROR_WRONG_DISK</code></td><td>The wrong diskette is in the drive. Insert %2 (Volume Serial Number: %3)
into drive %1.</td></tr><tr><td scope="row">36</td><td><code class="literal">ERROR_SHARING_BUFFER_EXCEEDED</code></td><td>Too many files opened for sharing.</td></tr><tr><td scope="row">38</td><td><code class="literal">ERROR_HANDLE_EOF</code></td><td>Reached the end of the file.</td></tr><tr><td scope="row">39</td><td><code class="literal">ERROR_HANDLE_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td scope="row">87</td><td><code class="literal">ERROR_INVALID_PARAMETER</code></td><td>The parameter is incorrect.</td></tr><tr><td scope="row">112</td><td><code class="literal">ERROR_DISK_FULL</code></td><td>The disk is full.</td></tr><tr><td scope="row">123</td><td><code class="literal">ERROR_INVALID_NAME</code></td><td>The file name, directory name, or volume label syntax is incorrect.</td></tr><tr><td scope="row">1450</td><td><code class="literal">ERROR_NO_SYSTEM_RESOURCES</code></td><td>Insufficient system resources exist to complete the requested service.</td></tr></tbody></table>
</div>
</li></ul>
</div>

</div>

</div>

</div>
<div class="copyright-footer">

</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left"><a accesskey="p" href="sql-syntax.html">Prev</a></td>
<td width="20%" align="center"><a accesskey="u" href="">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="storage-engines.html">Next</a></td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 13 SQL Statement Syntax</td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top">Chapter 15 Alternative Storage Engines</td>
</tr>
</table>
</div>
</body>
</html>
